{"version":3,"file":"makehuman.js","sources":["../node_modules/toad.jsx/lib/jsx-runtime.js","../../toad.js/lib/src/Signal.js","../../toad.js/lib/src/model/Model.js","../../toad.js/lib/src/model/GenericModel.js","../../toad.js/lib/src/model/NumberModel.js","../src/modifier/Human.ts","../src/lib/StringToLineIterator.ts","../src/lib/StringToLine.ts","../src/filesystem/FileSystemAdapter.ts","../src/target/Target.ts","../src/target/Component.ts","../src/target/TargetFactory.ts","../node_modules/gl-matrix/esm/common.js","../node_modules/gl-matrix/esm/mat4.js","../node_modules/gl-matrix/esm/vec3.js","../node_modules/gl-matrix/esm/vec4.js","../src/skeleton/Bone.ts","../src/skeleton/loadSkeleton.ts","../src/skeleton/VertexBoneWeights.ts","../src/skeleton/Skeleton.ts","../src/modifier/getTargetWeights.ts","../../toad.js/node_modules/toad.jsx/lib/jsx-runtime.js","../../toad.js/lib/src/util/lsx.js","../../toad.js/lib/src/model/BooleanModel.js","../../toad.js/lib/src/model/TextModel.js","../../toad.js/lib/src/model/HtmlModel.js","../../toad.js/lib/src/model/Action.js","../../toad.js/lib/src/util/dom.js","../../toad.js/lib/src/controller/globalController.js","../../toad.js/lib/src/controller/Controller.js","../../toad.js/lib/src/util/animation.js","../../toad.js/lib/src/model/OptionModelBase.js","../../toad.js/lib/src/model/EnumModel.js","../../toad.js/lib/src/view/View.js","../../toad.js/lib/src/view/ModelView.js","../../toad.js/lib/src/view/ActionView.js","../../toad.js/lib/src/style/tx-text.js","../../toad.js/lib/src/view/Text.js","../../toad.js/lib/src/view/textAreaStyle.js","../../toad.js/lib/src/view/TextTool.js","../../toad.js/lib/src/view/TextArea.js","../../toad.js/lib/src/view/Display.js","../../toad.js/lib/src/style/tx-button.js","../../toad.js/lib/src/view/Button.js","../../toad.js/lib/src/view/BooleanView.js","../../toad.js/lib/src/style/tx-checkbox.js","../../toad.js/lib/src/view/Checkbox.js","../../toad.js/lib/src/style/tx-search.js","../../toad.js/lib/src/view/Search.js","../../toad.js/lib/src/style/tx-switch.js","../../toad.js/lib/src/view/Switch.js","../../toad.js/lib/src/style/tx-radio.js","../../toad.js/lib/src/view/RadioButton.js","../../toad.js/lib/src/menu/MenuState.js","../../toad.js/lib/src/menu/MenuHelper.js","../../toad.js/lib/src/menu/PopupMenu.js","../../toad.js/lib/src/style/tx-combobox.js","../../toad.js/lib/src/style/tx-menu.js","../../toad.js/lib/src/view/Select.js","../../toad.js/lib/src/style/tx-slider.js","../../toad.js/lib/src/view/Slider.js","../../toad.js/lib/src/view/GenericTool.js","../../toad.js/lib/src/view/ToolButton.js","../../toad.js/lib/src/view/SlotView.js","../../toad.js/lib/src/view/ToadIf.js","../../toad.js/lib/src/style/tx-tabs.js","../../toad.js/lib/src/view/Tab.js","../../toad.js/lib/src/menu/menuStyle.js","../../toad.js/lib/src/menu/MenuButton.js","../../toad.js/lib/src/menu/MenuNode.js","../../toad.js/lib/src/menu/Menu.js","../../toad.js/lib/src/menu/MenuSpacer.js","../../toad.js/lib/src/table/model/TableModel.js","../../toad.js/lib/src/table/TableEditMode.js","../../toad.js/lib/src/table/adapter/TableAdapter.js","../../toad.js/lib/src/table/TableEventType.js","../../toad.js/lib/src/table/TablePos.js","../../toad.js/lib/src/table/model/SelectionModel.js","../../toad.js/lib/src/table/model/TypedTableModel.js","../../toad.js/lib/src/table/private/TableFriend.js","../../toad.js/lib/src/table/private/TableAnimation.js","../../toad.js/lib/src/table/private/InsertAnimation.js","../../toad.js/lib/src/table/private/InsertRowAnimation.js","../../toad.js/lib/src/table/private/RemoveRowAnimation.js","../../toad.js/lib/src/table/private/InsertColumnAnimation.js","../../toad.js/lib/src/table/private/RemoveColumnAnimation.js","../../toad.js/lib/src/util/scrollIntoView.js","../../toad.js/lib/src/table/style/tx-table.js","../../toad.js/lib/src/table/Table.js","../../toad.js/lib/src/table/TableTool.js","../../toad.js/lib/src/table/adapter/TypedTableAdapter.js","../../toad.js/lib/src/table/TableEvent.js","../../toad.js/lib/src/table/model/TreeModel.js","../../toad.js/lib/src/table/adapter/TreeAdapter.js","../../toad.js/lib/src/table/model/TreeNodeModel.js","../src/modifier/Modifier.ts","../src/modifier/ManagedTargetModifier.ts","../src/modifier/TargetRef.ts","../src/modifier/findTargets.ts","../src/modifier/MacroModifier.ts","../src/modifier/findMacroDependencies.ts","../src/modifier/EthnicModifier.ts","../src/modifier/UniversalModifier.ts","../src/modifier/loadModifiers.ts","../src/modifier/loadSliders.ts","../src/mesh/Mesh.ts","../src/mesh/WavefrontObj.ts","../src/mesh/HumanMesh.ts","../src/render/RenderMode.ts","../src/mesh/BaseMeshGroup.ts","../src/mesh/Collada.ts","../src/lib/zipForEach.ts","../src/ui/poseView.tsx","../src/ui/morphView.tsx","../src/render/shader/AbstractShader.ts","../src/render/shader/RGBAShader.ts","../src/render/shader/TextureShader.ts","../src/lib/calculateNormals.ts","../src/render/RenderMesh.ts","../src/render/render.ts","../node_modules/fflate/esm/browser.js","../src/filesystem/HTTPFSAdapter.ts","../src/main.tsx"],"sourcesContent":["export class Reference {\n    constructor(object, attribute) {\n        this.object = object;\n        this.attribute = attribute.toString();\n    }\n    get() {\n        return this.object[this.attribute];\n    }\n    set(value) {\n        Object.defineProperty(this.object, this.attribute, { value: value });\n    }\n    toString() {\n        return `${this.object[this.attribute]}`;\n    }\n    fromString(value) {\n        const type = typeof this.object[this.attribute];\n        let outValue;\n        switch (type) {\n            case \"string\":\n                outValue = value;\n                break;\n            case \"number\":\n                outValue = Number.parseFloat(value);\n                break;\n            default:\n                throw Error(`Reference.fromString() isn't yet supported for type ${type}`);\n        }\n        Object.defineProperty(this.object, this.attribute, { value: outValue });\n    }\n}\nexport function ref(object, attribute) {\n    return new Reference(object, attribute);\n}\nexport function refs(object, ...attributes) {\n    return attributes.map(a => new Reference(object, a));\n}\nexport class Fragment extends Array {\n    constructor(props) {\n        super(...props?.children);\n        for (let i = 0; i < this.length; ++i) {\n            const e = this[i];\n            if (typeof e === \"string\") {\n                this[i] = document.createTextNode(e);\n            }\n        }\n    }\n    replaceIn(element) {\n        while (element.childNodes.length > 0) {\n            element.removeChild(element.childNodes[element.childNodes.length - 1]);\n        }\n        this.appendTo(element);\n    }\n    appendTo(element) {\n        for (let child of this) {\n            element.appendChild(child);\n        }\n    }\n}\nexport function jsx(nameOrConstructor, props, key) {\n    if (props !== undefined && props.children !== undefined) {\n        props.children = [props.children];\n    }\n    return jsxs(nameOrConstructor, props);\n}\nexport function jsxs(nameOrConstructor, props, key) {\n    let namespace;\n    if (typeof nameOrConstructor !== 'string') {\n        return new nameOrConstructor(props);\n    }\n    const name = nameOrConstructor;\n    switch (name) {\n        case \"svg\":\n        case \"line\":\n        case \"rect\":\n        case \"circle\":\n        case \"path\":\n        case \"text\":\n            namespace = \"http://www.w3.org/2000/svg\";\n            break;\n        default:\n            namespace = \"http://www.w3.org/1999/xhtml\";\n    }\n    const tag = document.createElementNS(namespace, name);\n    setInitialProperties(tag, props, namespace);\n    return tag;\n}\nexport function setInitialProperties(element, props, namespace) {\n    if (props === null || props === undefined)\n        return;\n    for (let [key, value] of Object.entries(props)) {\n        switch (key) {\n            case 'children':\n                break;\n            case 'action':\n                element.setAction(value);\n                break;\n            case 'model':\n                element.setModel(value);\n                break;\n            case 'class':\n                element.classList.add(value);\n                break;\n            case 'style':\n                for (let [skey, svalue] of Object.entries(value)) {\n                    const regex = /[A-Z]/g;\n                    skey = skey.replace(regex, (upperCase) => \"-\" + upperCase.toLowerCase());\n                    element.style.setProperty(skey, svalue);\n                }\n                break;\n            case 'set':\n                Object.defineProperty(props.set.object, props.set.attribute, { value: element });\n                break;\n            default:\n                if (key.substring(0, 2) === \"on\") {\n                    element.addEventListener(key.substr(2), value);\n                }\n                else {\n                    if (typeof value !== \"object\") {\n                        if (namespace === \"http://www.w3.org/2000/svg\") {\n                            const regex = /[A-Z]/g;\n                            key = key.replace(regex, (upperCase) => \"-\" + upperCase.toLowerCase());\n                        }\n                        element.setAttributeNS(null, key, `${value}`);\n                    }\n                }\n        }\n    }\n    if (props.children !== undefined) {\n        for (let child of props.children) {\n            if (typeof child === \"string\") {\n                element.appendChild(document.createTextNode(child));\n            }\n            else {\n                element.appendChild(child);\n            }\n        }\n    }\n}\nexport function createElement(nameOrConstructor, props, ...children) {\n    let key;\n    if (props !== null) {\n        if ('key' in props) {\n            key = props.key;\n            delete props.key;\n        }\n        if (children !== undefined) {\n            props.children = children;\n        }\n    }\n    else {\n        if (children !== undefined)\n            props = { children };\n    }\n    return jsxs(nameOrConstructor, props, key);\n}\n//# sourceMappingURL=jsx-runtime.js.map","export class SignalLink {\n    constructor(callback, id) {\n        this.callback = callback;\n        this.id = id;\n    }\n}\nexport class Signal {\n    add(callback, id) {\n        if (!this.callbacks)\n            this.callbacks = new Array();\n        this.callbacks.push(new SignalLink(callback, id));\n    }\n    remove(id) {\n        if (!this.callbacks)\n            return;\n        for (let i = this.callbacks.length - 1; i >= 0; --i) {\n            if (this.callbacks[i].id === id)\n                this.callbacks.splice(i, 1);\n        }\n    }\n    count() {\n        if (!this.callbacks)\n            return 0;\n        return this.callbacks.length;\n    }\n    lock() {\n        this.locked = true;\n    }\n    unlock() {\n        this.locked = undefined;\n        if (this.triggered) {\n            let data = this.triggered.data;\n            this.triggered = undefined;\n            this.trigger(data);\n        }\n    }\n    trigger(data) {\n        if (this.locked) {\n            this.triggered = { data: data };\n            return;\n        }\n        if (!this.callbacks)\n            return;\n        for (let i = 0; i < this.callbacks.length; ++i)\n            this.callbacks[i].callback(data);\n    }\n}\n//# sourceMappingURL=Signal.js.map","import { Signal } from \"../Signal.js\";\nexport class Model {\n    constructor() {\n        this._enabled = true;\n        this.modified = new Signal();\n    }\n    set enabled(enabled) {\n        if (this._enabled == enabled)\n            return;\n        this._enabled = enabled;\n        this.modified.trigger(undefined);\n    }\n    get enabled() {\n        return this._enabled;\n    }\n}\n//# sourceMappingURL=Model.js.map","import { Model } from \"./Model.js\";\nexport class GenericModel extends Model {\n    constructor(value) {\n        super();\n        this._value = value;\n    }\n    set value(value) {\n        if (this._value == value)\n            return;\n        this._value = value;\n        this.modified.trigger();\n    }\n    get value() {\n        return this._value;\n    }\n}\n//# sourceMappingURL=GenericModel.js.map","import { GenericModel } from \"./GenericModel.js\";\nexport class NumberModel extends GenericModel {\n    constructor(value, options) {\n        super(value);\n        if (options) {\n            this.min = options.min;\n            this.max = options.max;\n            this.step = options.step;\n        }\n    }\n    increment() {\n        if (this.step !== undefined) {\n            this.value += this.step;\n        }\n    }\n    decrement() {\n        if (this.step !== undefined) {\n            this.value -= this.step;\n        }\n    }\n    get value() {\n        return super.value;\n    }\n    set value(value) {\n        if (this.min !== undefined) {\n            if (value < this.min) {\n                value = this.min;\n            }\n        }\n        if (this.max !== undefined) {\n            if (value > this.max) {\n                value = this.max;\n            }\n        }\n        super.value = value;\n    }\n}\n//# sourceMappingURL=NumberModel.js.map","import { Modifier } from './Modifier'\nimport { NumberModel } from 'toad.js/model/NumberModel'\nimport { Signal } from 'toad.js/Signal'\nimport { HumanMesh } from 'mesh/HumanMesh'\n\n// apps/human.py class Human\n/**\n * Aggregate the morph modifiers\n */\nexport class Human {\n    scene!: HumanMesh\n\n    modified = new Signal()\n\n    private modifiers: Map<string, Modifier>\n    private modifierGroups: Map<string, Modifier[]>\n\n    // for now HumanMesh is our quick'n dirty friend\n    public targetsDetailStack: Map<string, number>\n\n    // values to be edited by the macro/ethnic modifiers\n    age = new NumberModel(0.5, { min: 0, max: 1, step: 0.05 })\n    gender = new NumberModel(0.5, { min: 0, max: 1, step: 0.05 })\n    weight = new NumberModel(0.5, { min: 0, max: 1, step: 0.05 })\n    muscle = new NumberModel(0.5, { min: 0, max: 1, step: 0.05 })\n    height = new NumberModel(0.5, { min: 0, max: 1, step: 0.05 })\n    breastSize = new NumberModel(0.5, { min: 0, max: 1, step: 0.05 })\n    breastFirmness = new NumberModel(0.5, { min: 0, max: 1, step: 0.05 })\n    bodyProportions = new NumberModel(0.5, { min: 0, max: 1, step: 0.05 })\n\n    // all variables suffixed with 'Val' will be read by ManagedTargetModifier.getFactors()\n    caucasianVal = new NumberModel(1 / 3, { min: 0, max: 1, step: 0.05 })\n    asianVal = new NumberModel(1 / 3, { min: 0, max: 1, step: 0.05 })\n    africanVal = new NumberModel(1 / 3, { min: 0, max: 1, step: 0.05 })\n\n    // the above values are transformed into the values below,\n    // which are then used by the modifiers\n    private maleVal = new NumberModel(0)\n    private femaleVal = new NumberModel(0)\n    private oldVal = new NumberModel(0)\n    private babyVal = new NumberModel(0)\n    private youngVal = new NumberModel(0)\n    private childVal = new NumberModel(0)\n    private maxweightVal = new NumberModel(0)\n    private minweightVal = new NumberModel(0)\n    private averageweightVal = new NumberModel(0)\n    private maxmuscleVal = new NumberModel(0)\n    private minmuscleVal = new NumberModel(0)\n    private averagemuscleVal = new NumberModel(0)\n    private maxheightVal = new NumberModel(0)\n    private minheightVal = new NumberModel(0)\n    private averageheightVal = new NumberModel(0)\n    private maxcupVal = new NumberModel(0)\n    private mincupVal = new NumberModel(0)\n    private averagecupVal = new NumberModel(0)\n    private maxfirmnessVal = new NumberModel(0)\n    private minfirmnessVal = new NumberModel(0)\n    private averagefirmnessVal = new NumberModel(0)\n    private idealproportionsVal = new NumberModel(0)\n    private uncommonproportionsVal = new NumberModel(0)\n    private regularproportionsVal = new NumberModel(0)\n\n    constructor() {\n        this._setDependendValues()\n\n        this.gender.modified.add(() => this._setGenderVals())\n        this.age.modified.add(() => this._setAgeVals())\n        this.muscle.modified.add(() => this._setMuscleVals())\n        this.weight.modified.add(() => this._setWeightVals())\n        this.height.modified.add(() => this._setHeightVals())\n        this.breastSize.modified.add(() => this._setBreastSizeVals())\n        this.breastFirmness.modified.add(() => this._setBreastFirmnessVals())\n        this.bodyProportions.modified.add(() => this._setBodyProportionVals())\n        this.africanVal.modified.add(() => this._setEthnicVals(\"African\"))\n        this.asianVal.modified.add(() => this._setEthnicVals(\"Asian\"))\n        this.caucasianVal.modified.add(() => this._setEthnicVals(\"Caucasian\"))\n\n        this.modifiers = new Map<string, Modifier>()\n        this.modifierGroups = new Map<string, Modifier[]>()\n        this.targetsDetailStack = new Map()\n    }\n\n    getModifier(name: string): Modifier | undefined {\n        return this.modifiers.get(name)\n    }\n\n    getModifiersByGroup(groupName: string): Modifier[] {\n        const group = this.modifierGroups.get(groupName)\n        if (group === undefined) {\n            console.log(`Modifier group ${groupName} does not exist.`)\n            return []\n        }\n        return group\n    }\n\n    addModifier(modifier: Modifier) {\n        // console.log(`Human.addModifier(${modifier.fullName})`)\n        //         if modifier.fullName in self._modifiers:\n        if (this.modifiers.has(modifier.fullName)) {\n            //             log.error(\"Modifier with name %s is already attached to human.\", modifier.fullName)\n            //             raise RuntimeError(\"Modifier with name %s is already attached to human.\" % modifier.fullName)\n            throw Error(`Modifier with name ${modifier.fullName} is already attached to human.`)\n        }\n\n        //         self._modifier_type_cache = dict()\n        //         self._modifiers[modifier.fullName] = modifier\n        this.modifiers.set(modifier.fullName, modifier)\n\n        //         if modifier.groupName not in self._modifier_groups:\n        if (!this.modifierGroups.has(modifier.groupName)) {\n            //             self._modifier_groups[modifier.groupName] = []\n            this.modifierGroups.set(modifier.groupName, new Array<Modifier>())\n        }\n\n        //         self._modifier_groups[modifier.groupName].append(modifier)\n        this.modifierGroups.get(modifier.groupName)!.push(modifier)\n\n        //         # Update dependency mapping\n        //         if modifier.macroVariable and modifier.macroVariable != 'None':\n        //             if modifier.macroVariable in self._modifier_varMapping and \\\n        //                self._modifier_varMapping[modifier.macroVariable] != modifier.groupName:\n        //                 log.error(\"Error, multiple modifier groups setting var %s (%s and %s)\", modifier.macroVariable, modifier.groupName, self._modifier_varMapping[modifier.macroVariable])\n        //             else:\n        //                 self._modifier_varMapping[modifier.macroVariable] = modifier.groupName\n        //                 # Update any new backwards references that might be influenced by this change (to make it independent of order of adding modifiers)\n        //                 toRemove = set()  # Modifiers to remove again from backwards map because they belogn to the same group as the modifier controlling the var\n        //                 dep = modifier.macroVariable\n        //                 for affectedModifierGroup in self._modifier_dependencyMapping.get(dep, []):\n        //                     if affectedModifierGroup == modifier.groupName:\n        //                         toRemove.add(affectedModifierGroup)\n        //                         #log.debug('REMOVED from backwards map again %s', affectedModifierGroup)\n        //                 if len(toRemove) > 0:\n        //                     if len(toRemove) == len(self._modifier_dependencyMapping[dep]):\n        //                         del self._modifier_dependencyMapping[dep]\n        //                     else:\n        //                         for t in toRemove:\n        //                             self._modifier_dependencyMapping[dep].remove(t)\n        //         for dep in modifier.macroDependencies:\n        //             groupName = self._modifier_varMapping.get(dep, None)\n        //             if groupName and groupName == modifier.groupName:\n        //                 # Do not include dependencies within the same modifier group\n        //                 # (this step might be omitted if the mapping is still incomplete (dependency is not yet mapped to a group), and can later be fixed by removing the entry again from the reverse mapping)\n        //                 continue\n        //             if dep not in self._modifier_dependencyMapping:\n        //                 self._modifier_dependencyMapping[dep] = []\n        //             if modifier.groupName not in self._modifier_dependencyMapping[dep]:\n        //                 self._modifier_dependencyMapping[dep].append(modifier.groupName)\n        //             if modifier.isMacro():\n        //                 self.updateMacroModifiers()\n    }\n\n    setDetail(targetName: string, value: number | undefined) {\n        // NOTE: no 'name=canonicalpath(name)' as the host filesystem is a detail to be ignored in the domain core\n        // console.log(`Human.setDetail('${name}', ${value})`)\n        if (value !== undefined) { // TODO: check if '&& isZero(value)' is a valid optimization\n            this.targetsDetailStack.set(targetName, value)\n        } else {\n            this.targetsDetailStack.delete(targetName)\n        }\n    }\n\n    getDetail(targetName: string): number {\n        // NOTE: no 'name=canonicalpath(name)' as the host filesystem is a detail to be ignored in the domain core\n        let value = this.targetsDetailStack.get(targetName)\n        if (value === undefined)\n            value = 0\n        // console.log(`Human.getDetail('${name}') -> ${value}`)\n        return value\n    }\n\n    setDefaultValues() {\n        this.age.value = 0.5\n        this.gender.value = 0.5\n        this.weight.value = 0.5\n        this.muscle.value = 0.5\n        this.height.value = 0.5\n        this.breastSize.value = 0.5\n        this.breastFirmness.value = 0.5\n        this.bodyProportions.value = 0.5\n        this.caucasianVal.value = 1 / 3\n        this.asianVal.value = 1 / 3\n        this.africanVal.value = 1 / 3\n        this._setDependendValues()\n    }\n\n    _setDependendValues() {\n        this._setGenderVals()\n        this._setAgeVals()\n        this._setWeightVals()\n        this._setMuscleVals()\n        this._setHeightVals()\n        this._setBreastSizeVals()\n        this._setBreastFirmnessVals()\n        this._setBodyProportionVals()\n    }\n\n    _setGenderVals() {\n        this.maleVal.value = this.gender.value\n        this.femaleVal.value = 1 - this.gender.value\n    }\n\n    _setAgeVals() {\n        // New system (A8):\n        // ----------------\n        //\n        // 1y       10y       25y            90y\n        // baby    child     young           old\n        // |---------|---------|--------------|\n        // 0      0.1875      0.5             1  = age [0, 1]\n        //\n        // val ^     child young     old\n        //   1 |baby\\ / \\ /   \\    /\n        //     |     \\   \\      /\n        //     |    / \\ / \\  /    \\ young\n        //   0 ______________________________> age\n        //        0  0.1875 0.5      1\n        if (this.age.value < 0.5) {\n            this.oldVal.value = 0.0\n            this.babyVal.value = Math.max(0.0, 1 - this.age.value * 5.333)  // 1/0.1875 = 5.333\n            this.youngVal.value = Math.max(0.0, (this.age.value - 0.1875) * 3.2) // 1/(0.5-0.1875) = 3.2\n            this.childVal.value = Math.max(0.0, Math.min(1.0, 5.333 * this.age.value) - this.youngVal.value)\n        } else {\n            this.childVal.value = 0.0\n            this.babyVal.value = 0.0\n            this.oldVal.value = Math.max(0.0, this.age.value * 2 - 1)\n            this.youngVal.value = 1 - this.oldVal.value\n        }\n    }\n\n    _setWeightVals() {\n        this.maxweightVal.value = Math.max(0.0, this.weight.value * 2 - 1)\n        this.minweightVal.value = Math.max(0.0, 1 - this.weight.value * 2)\n        this.averageweightVal.value = 1 - (this.maxweightVal.value + this.minweightVal.value)\n    }\n\n    _setMuscleVals() {\n        this.maxmuscleVal.value = Math.max(0.0, this.muscle.value * 2 - 1)\n        this.minmuscleVal.value = Math.max(0.0, 1 - this.muscle.value * 2)\n        this.averagemuscleVal.value = 1 - (this.maxmuscleVal.value + this.minmuscleVal.value)\n    }\n\n    _setHeightVals() {\n        this.maxheightVal.value = Math.max(0.0, this.height.value * 2 - 1)\n        this.minheightVal.value = Math.max(0.0, 1 - this.height.value * 2)\n        if (this.maxheightVal.value > this.minheightVal.value) {\n            this.averageheightVal.value = 1 - this.maxheightVal.value\n        } else {\n            this.averageheightVal.value = 1 - this.minheightVal.value\n        }\n    }\n\n    _setBreastSizeVals() {\n        this.maxcupVal.value = Math.max(0.0, this.breastSize.value * 2 - 1)\n        this.mincupVal.value = Math.max(0.0, 1 - this.breastSize.value * 2)\n        if (this.maxcupVal.value > this.mincupVal.value) {\n            this.averagecupVal.value = 1 - this.maxcupVal.value\n        } else {\n            this.averagecupVal.value = 1 - this.mincupVal.value\n        }\n    }\n\n    _setBreastFirmnessVals() {\n        this.maxfirmnessVal.value = Math.max(0.0, this.breastFirmness.value * 2 - 1)\n        this.minfirmnessVal.value = Math.max(0.0, 1 - this.breastFirmness.value * 2)\n\n        if (this.maxfirmnessVal.value > this.minfirmnessVal.value) {\n            this.averagefirmnessVal.value = 1 - this.maxfirmnessVal.value\n        } else {\n            this.averagefirmnessVal.value = 1 - this.minfirmnessVal.value\n        }\n    }\n\n    _setBodyProportionVals() {\n        this.idealproportionsVal.value = Math.max(0.0, this.bodyProportions.value * 2 - 1)\n        this.uncommonproportionsVal.value = Math.max(0.0, 1 - this.bodyProportions.value * 2)\n\n        if (this.idealproportionsVal > this.uncommonproportionsVal) {\n            this.regularproportionsVal.value = 1 - this.idealproportionsVal.value\n        } else {\n            this.regularproportionsVal.value = 1 - this.uncommonproportionsVal.value\n        }\n    }\n\n    flag = false\n    _setEthnicVals(exclude: undefined | \"African\" | \"Asian\" | \"Caucasian\") {\n        if (this.flag)\n            return\n        this.flag = true\n        this.africanVal.modified.lock()\n        this.asianVal.modified.lock()\n        this.caucasianVal.modified.lock()\n        this._setEthnicValsCore(exclude)\n        this.africanVal.modified.unlock()\n        this.asianVal.modified.unlock()\n        this.caucasianVal.modified.unlock()\n        this.flag = false\n    }\n\n    protected _setEthnicValsCore(exclude: undefined | \"African\" | \"Asian\" | \"Caucasian\") {\n        let remaining = 1\n        let otherTotal = 0\n        if (exclude !== \"African\") {\n            otherTotal += this.africanVal.value\n        } else {\n            remaining -= this.africanVal.value\n        }\n        if (exclude !== \"Asian\") {\n            otherTotal += this.asianVal.value\n        } else {\n            remaining -= this.asianVal.value\n        }\n        if (exclude !== \"Caucasian\") {\n            otherTotal += this.caucasianVal.value\n        } else {\n            remaining -= this.caucasianVal.value\n        }\n\n        if (otherTotal === 0) {\n            if (exclude === undefined) {\n                // All values 0, this cannot be. Reset to default values.\n                this.caucasianVal.value = 1 / 3\n                this.asianVal.value = 1 / 3\n                this.africanVal.value = 1 / 3\n            }\n            else if (Math.abs(remaining) < 0.001) {\n                // One ethnicity is 1, the rest is 0\n                if (exclude !== \"African\") {\n                    this.africanVal.value = 1\n                } else {\n                    this.africanVal.value = 0\n                }\n                if (exclude !== \"Asian\") {\n                    this.asianVal.value = 1\n                } else {\n                    this.asianVal.value = 0\n                }\n                if (exclude !== \"Caucasian\") {\n                    this.caucasianVal.value = 1\n                } else {\n                    this.caucasianVal.value = 0\n                }\n            } else {\n                // Increase values of other ethnicities (that were 0) to hit total sum of 1\n                if (exclude !== \"African\") {\n                    this.africanVal.value = 0.01\n                }\n                if (exclude !== \"Asian\") {\n                    this.asianVal.value = 0.01\n                }\n                if (exclude !== \"Caucasian\") {\n                    this.caucasianVal.value = 0.01\n                }\n                this._setEthnicValsCore(exclude)\n            }\n        } else {\n            if (exclude !== \"African\") {\n                this.africanVal.value = remaining * this.africanVal.value / otherTotal\n            }\n            if (exclude !== \"Asian\") {\n                this.asianVal.value = remaining * this.asianVal.value / otherTotal\n            }\n            if (exclude !== \"Caucasian\") {\n                this.caucasianVal.value = remaining * this.caucasianVal.value / otherTotal\n            }\n        }\n    }\n\n    updateProxyMesh(fitToPosed = false) {\n        // console.log(\"Human.updateProxyMesh with:\")\n        this.modified.trigger()\n        // this.targetsDetailStack.forEach( (value, targetName) => console.log(`${targetName}=${value}`) )\n        // if self.proxy and self.__proxyMesh:\n        //     self.proxy.update(self.__proxyMesh, fit_to_posed)\n        //     self.__proxyMesh.update()\n    }\n}\n","\nexport class StringToLineIterator implements Iterator<string> {\n    private data: string\n    private index: number\n\n    constructor(data: string) {\n        this.data = data\n        this.index = 0\n    }\n\n    next(): IteratorResult<string> {\n        if (this.data.length === 0 || this.index === -1)\n            return { value: undefined, done: true }\n        const nextIndex = this.data.indexOf('\\n', this.index)\n        let length: number | undefined\n        if (nextIndex === -1) {\n            length = undefined\n        } else {\n            length = nextIndex - this.index\n        }\n        const result = this.data.substr(this.index, length)\n        if (nextIndex === -1) {\n            this.index = -1\n        } else {\n            this.index = nextIndex + 1\n        }\n        return { value: result, done: false }\n    }\n\n}\n","import { StringToLineIterator } from './StringToLineIterator'\n\nexport class StringToLine implements Iterable<string> {\n    data: string;\n    constructor(data: string) {\n        this.data = data\n    }\n\n    [Symbol.iterator](): Iterator<string> {\n        return new StringToLineIterator(this.data)\n    }\n}\n","import { AbstractFileSystemAdapter } from './AbstractFileSystemAdapter'\n\nexport class FileSystemAdapter {\n    private static instance?: AbstractFileSystemAdapter\n    static setInstance(instance: AbstractFileSystemAdapter) {\n        FileSystemAdapter.instance = instance\n    }\n    static getInstance(): AbstractFileSystemAdapter {\n        if (FileSystemAdapter.instance === undefined)\n            throw Error('Missing call to FileSystemAdapter.setInstance(instance: AbstractFilesystemAdapter).')\n        return FileSystemAdapter.instance\n    }\n}\n","import { StringToLine } from '../lib/StringToLine'\nimport { FileSystemAdapter } from '../filesystem/FileSystemAdapter'\n\n// import { vec3 } from 'gl-matrix'\n\n// lib/targets.py\n// getTargets()\n\n// FILE: data/modifiers/modeling_modifiers.json\n// points to the files in the data/targets/ directory: data/targets/<group>/<target>-(<min>|<max>).target\n//\n// [\n// {\n//    \"group\": \"<group>\"\n//    \"modifiers\": [\n//       { \"macrovar\": \"<name>\" [, \"modifierType\": \"EthnicModifier\"]\n//       { \"target\": \"<target>\", \"min\": \"<min>\", \"max\": \"<max>\" },\n//    ]\n// }\n// ]\n//\n// \n// data/targets/macrodetails/(african|asian|caucasian)-(male|female)-(baby|child|young|old).target\n// data/targets/macrodetails/universal-(male|female)-(baby|child|young|old)-(minweight|averageweight|maxweight).target\n// data/targets/macrodetails/height/(male|female)-(minmuscle|averagemuscle|maxmuscle)-(minweight|averageweight|maxweight)-(minheight|maxheight).target\n// data/targets/macrodetails/proportions/(male|female)-(minmuscle|averagemuscle|maxmuscle)-(minweight|averageweight|maxweight)-(idealproportions|uncommonproportions).target\n// FILE: data/modifiers/modeling_modifiers_desc.json\n// additional description for the UI\n//\n// FILE: data/modifiers/modeling_sliders.json\n//\n// ./compile_targets.py: create a binary representation of the target files?\n// ./lib/targets.py    : load target files?\n// apps/human.py\n// apps/compat.py\n// apps/devtests.py\n// apps/humanmodifier.py\n// apps/warpmodifier.py\n// core/algos3d.py: class Target!\n// number: 64bit double float\n// should use these instead to save memory and to improve performance:\n// Int8Array, Uint8Array, Uint8ClampedArray, Int16Array, Uint16Array, Int32Array, Uint32Array\n// Float32Array, Float64Array\n// BigInt64Array, BigUint64Array\n\n// morph target\nexport class Target {\n    verts: Array<number>; // x, y, z\n    data: Array<number>; // index\n\n    constructor() {\n        this.verts = new Array<number>()\n        this.data = new Array<number>()\n    }\n\n    load(filename: string) {\n        const data = FileSystemAdapter.getInstance().readFile(filename)\n        // index x y, z\n        const reader = new StringToLine(data)\n        //  const reader = readline.createInterface(input)\n        let lineNumber = 0\n        for (let line of reader) {\n            ++lineNumber\n            // console.log(line)\n            line = line.trim()\n            if (line.length === 0)\n                continue\n            if (line[0] === '#')\n                continue\n            const tokens = line.split(/\\s+/)\n            this.data.push(parseInt(tokens[0], 10))\n            this.verts.push(parseFloat(tokens[1]))\n            this.verts.push(parseFloat(tokens[2]))\n            this.verts.push(parseFloat(tokens[3]))\n        }\n    }\n\n    apply(verts: number[], scale: number) {\n        // console.log(`morphing ${this.data.length} vertices by ${scale}`)\n        let dataIndex = 0, vertexIndex = 0\n        while(dataIndex < this.data.length) {\n            let index = this.data[dataIndex++] * 3\n            verts[index++] += this.verts[vertexIndex++] * scale\n            verts[index++] += this.verts[vertexIndex++] * scale\n            verts[index++] += this.verts[vertexIndex++] * scale\n        }\n    }\n}\n","// _cat_data\nconst categoryData = {\n    // category        values\n    'gender':          ['male', 'female'],\n    'age':             ['baby', 'child', 'young', 'old'],\n    'race':            ['caucasian', 'asian', 'african'],\n    'muscle':          ['maxmuscle', 'averagemuscle', 'minmuscle'],\n    'weight':          ['minweight', 'averageweight', 'maxweight'],\n    'height':          ['minheight', 'averageheight', 'maxheight'],\n    'breastsize':      ['mincup', 'averagecup', 'maxcup'],\n    'breastfirmness':  ['minfirmness', 'averagefirmness', 'maxfirmness'],\n    'bodyproportions': ['uncommonproportions', 'regularproportions', 'idealproportions']\n}\n// _categories\nexport const validCategories = new Array<string>()\n// _value_cat\nexport const valueToCategory = new Map<string, string>()\n\nfor(const category in categoryData) {\n    if (!categoryData.hasOwnProperty(category))\n        continue\n    validCategories.push(category)\n    // tslint:disable-next-line: forin\n    for(const value of (categoryData as any)[category]) {\n        valueToCategory.set(value, category)\n    }\n}\n\nexport class Component {\n    path?: string\n    parent?: Component\n\n    // the target's file name is split into parts.\n    // if the part belongs to a category, it is stored in ...\n    data: Map<string, string|undefined> // Map<category, value>\n    // ... otherwise it is stored in ...\n    key: string[] // values (TargetsCrawler sorts the directory content so that the keys in here are sorted)\n\n    constructor(parent?: Component) {\n        this.parent = parent\n        if (parent === undefined) {\n            this.key = new Array<string>()\n            this.data = new Map<string, string|undefined>()\n        } else {\n            this.key = parent.key.slice()\n            this.data = new Map(parent.data)\n        }\n    }\n\n    isRoot(): boolean {\n        return this.parent === undefined\n    }\n\n    createChild(): Component {\n        return new Component(this)\n    }\n\n    update(value: string) {\n        const category = valueToCategory.get(value)\n        if (category !== undefined) {\n            this.setData(category, value)\n        } else\n        if (value !== 'target') {\n            this.addKey(value)\n        }\n    }\n\n    tuple(): string {\n        let s = ''\n        for(const key of this.key) {\n            if (s.length !== 0)\n                s += '-'\n            s += key\n        }\n        return s\n    }\n\n    getVariables(): string[] {\n        // return [value for key,value in list(self.data.items()) if value != None]\n        const result = []\n        for(const [key, value] of this.data.entries()) {\n            if (value !== undefined)\n                result.push(value)\n        }\n        return result\n    }\n\n    private addKey(key: string) {\n        this.key.push(key)\n    }\n\n    private setData(category: string, value: string) {\n        this.data = new Map(this.data)\n        const orig = this.data.get(category)\n        if (orig !== undefined) {\n            if (orig !== value)\n                throw Error(`Component category ${category} can not be set to ${value} as it is already been set to ${orig}`)\n            return\n        }\n        this.data.set(category, value)\n    }\n\n    finish(pathname: string) {\n        this.path = pathname\n        for(const category of validCategories) {\n            if (!this.data.has(category))\n                this.data.set(category, undefined)\n        }\n    }\n}\n","import { Target } from './Target'\nimport { Component} from './Component'\nimport { FileSystemAdapter } from '../filesystem/FileSystemAdapter'\n\n\n// what's inside TargetFactory:\n//   groups: Map<target name, Component>\n//      \"buttocks-buttocks-volume-decr\"\n///       parent: key: [\"buttocks\"]\n//        key: the name splitted at '-'\n//        data: gender, age, race, muscle, weight, height, breastsize, breastfirmness, bodypropotions: all undefined\n//        path: \"/targets/buttocks/buttocks-volume-decr.target\"\n//   images: Map<target name, image filename>\n//   index: (superset of groups?)\n//     \"buttocks\" -> [\"buttocks-buttocks-volume-decr\", \"buttocks-buttocks-volume-incr\"]\n//     \"buttocks-buttocks-volume-decr\" -> Component\n//     \"buttocks-buttocks-volume-incr\" -> Component\n//   targets:\n//     list of all Components\n\nexport class TargetFactory {\n    rootComponent: Component\n    targets: Component[] // all components\n    groups: Map<string, Component[]> // Component.keys to Components\n    index: Map<string, (Component|string)[]>\n    images: Map<string, string> // list of all PNG files found while crawling\n\n    private constructor() {\n        this.rootComponent = new Component()\n        this.images = new Map<string, string>()\n        this.targets = new Array<Component>()\n        this.groups = new Map<string, Component[]>()\n        this.index = new Map<string, (Component|string)[]>() // Component key names to ...\n        this.loadTargetDirectory()\n        console.log(`Loaded target directory: ${this.targets.length} targets, ${this.groups.size} groups, ${this.index.size} indizes, ${this.images.size} images`)\n    }\n\n    private static instance?: TargetFactory\n    static getInstance(): TargetFactory {\n        if (TargetFactory.instance === undefined)\n            TargetFactory.instance = new TargetFactory()\n        return TargetFactory.instance\n    }\n\n    private loadTargetDirectory() {\n        this.walkTargets('', this.rootComponent)\n        this.buildIndex()\n    }\n\n    findTargets(partialGroup: string): Component[] {\n        // if isinstance(partialGroup, str):\n        //     partialGroup = tuple(partialGroup.split('-'))\n        // elif not isinstance(partialGroup, tuple):\n        //     partialGroup = tuple(partialGroup)\n        // if partialGroup not in self.index:\n        if (!this.index.has(partialGroup))\n        //     return []\n            return []\n        // result = []\n        const result = new Array<Component>()\n        // for entry in self.index[partialGroup]:\n        for (const entry of this.index.get(partialGroup)!) {\n        //     if isinstance(entry, Component):\n            if (entry instanceof Component)\n            //         result.append(entry)\n                result.push(entry)\n            //     else:\n            else\n            //         result.extend(self.findTargets(entry))\n                result.concat(this.findTargets(entry))\n        }\n        // return result\n        return result\n    }\n\n    getTargetsByGroup(group: string): Component[]|undefined {\n        return this.groups.get(group)\n    }\n\n    private walkTargets(root: string, base: Component) {\n        const fs = FileSystemAdapter.getInstance()\n        const directoryPath = fs.realPath(root)\n        const dir = fs.listDir(directoryPath).sort()\n        // console.log(`dir=${dir}`)\n        for(const name of dir) {\n            // console.log(`directoryPath='${directoryPath}', dir=${dir}, name='${name}'`)\n            const p = fs.joinPath(directoryPath, name)\n            if (fs.isFile(p) && ! p.toLowerCase().endsWith('.target')) {\n                if (p.toLowerCase().endsWith('.png')) {\n                    this.images.set(name.toLowerCase(), p)\n                }\n            } else {\n                const item = base.createChild()\n                const parts = name.replace('_', '-').replace('.', '-').split('-')\n                for(const part of parts.entries()) {\n                    if (part[0]===0 && part[1]==='targets')\n                        continue\n                    item.update(part[1])\n                }\n\n                if (fs.isDir(p)) {\n                    const nextRoot = fs.joinPath(root, name)\n                    this.walkTargets(nextRoot, item)\n                } else {\n                    item.finish(`data/${root}/${name}`)\n                    this.targets.push(item)\n                    const key = item.tuple()\n                    let a = this.groups.get(key)\n                    if (a === undefined) {\n                        a = new Array<Component>()\n                        this.groups.set(key, a)\n                    }\n                    a!.push(item)\n                }\n            }\n        }\n    }\n\n    private buildIndex() {\n        for(const target of this.targets) {\n            if (!this.index.has(target.tuple())) {\n                this.index.set(target.tuple(), [])\n            }\n            this.index.get(target.tuple())!.push(target)\n            let component = target\n            while(component.parent !== undefined) {\n                const parent = component.parent\n                if (!this.index.has(parent.tuple())) {\n                    this.index.set(parent.tuple(), new Array<Component|string>())\n                }\n                if (component.tuple() !== parent.tuple() &&\n                     !this.index.get(parent.tuple())!.includes(component.tuple()) ) {\n                        this.index.get(parent.tuple())!.push(component.tuple())\n                }\n                component = parent\n            }\n        }\n    }\n}\n\n\n// class FaceGroup // a group of faces with a unique name\n\n// class Object3D\n\n// FROM: core/algos3d.py\n// filename to target?\nconst targetBuffer = new Map<string, Target>()\n\nexport function getTarget(filename: string) {\n    let target = targetBuffer.get(filename)\n    if (target !== undefined)\n        return target\n    target = new Target() // Target(3DObject, filename)\n    target.load(filename)\n    targetBuffer.set(filename, target)\n    return target\n}\n\nexport function refreshCachedTarget(filename: string) {\n    if (targetBuffer.has(filename))\n        targetBuffer.delete(filename)\n}\n","/**\n * Common utilities\n * @module glMatrix\n */\n// Configuration Constants\nexport var EPSILON = 0.000001;\nexport var ARRAY_TYPE = typeof Float32Array !== 'undefined' ? Float32Array : Array;\nexport var RANDOM = Math.random;\n/**\n * Sets the type of array used when creating new vectors and matrices\n *\n * @param {Float32ArrayConstructor | ArrayConstructor} type Array type, such as Float32Array or Array\n */\n\nexport function setMatrixArrayType(type) {\n  ARRAY_TYPE = type;\n}\nvar degree = Math.PI / 180;\n/**\n * Convert Degree To Radian\n *\n * @param {Number} a Angle in Degrees\n */\n\nexport function toRadian(a) {\n  return a * degree;\n}\n/**\n * Tests whether or not the arguments have approximately the same value, within an absolute\n * or relative tolerance of glMatrix.EPSILON (an absolute tolerance is used for values less\n * than or equal to 1.0, and a relative tolerance is used for larger values)\n *\n * @param {Number} a The first number to test.\n * @param {Number} b The second number to test.\n * @returns {Boolean} True if the numbers are approximately equal, false otherwise.\n */\n\nexport function equals(a, b) {\n  return Math.abs(a - b) <= EPSILON * Math.max(1.0, Math.abs(a), Math.abs(b));\n}\nif (!Math.hypot) Math.hypot = function () {\n  var y = 0,\n      i = arguments.length;\n\n  while (i--) {\n    y += arguments[i] * arguments[i];\n  }\n\n  return Math.sqrt(y);\n};","import * as glMatrix from \"./common.js\";\n/**\n * 4x4 Matrix<br>Format: column-major, when typed out it looks like row-major<br>The matrices are being post multiplied.\n * @module mat4\n */\n\n/**\n * Creates a new identity mat4\n *\n * @returns {mat4} a new 4x4 matrix\n */\n\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(16);\n\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    out[4] = 0;\n    out[6] = 0;\n    out[7] = 0;\n    out[8] = 0;\n    out[9] = 0;\n    out[11] = 0;\n    out[12] = 0;\n    out[13] = 0;\n    out[14] = 0;\n  }\n\n  out[0] = 1;\n  out[5] = 1;\n  out[10] = 1;\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a new mat4 initialized with values from an existing matrix\n *\n * @param {ReadonlyMat4} a matrix to clone\n * @returns {mat4} a new 4x4 matrix\n */\n\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(16);\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  out[4] = a[4];\n  out[5] = a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  out[9] = a[9];\n  out[10] = a[10];\n  out[11] = a[11];\n  out[12] = a[12];\n  out[13] = a[13];\n  out[14] = a[14];\n  out[15] = a[15];\n  return out;\n}\n/**\n * Copy the values from one mat4 to another\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the source matrix\n * @returns {mat4} out\n */\n\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  out[4] = a[4];\n  out[5] = a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  out[9] = a[9];\n  out[10] = a[10];\n  out[11] = a[11];\n  out[12] = a[12];\n  out[13] = a[13];\n  out[14] = a[14];\n  out[15] = a[15];\n  return out;\n}\n/**\n * Create a new mat4 with the given values\n *\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\n * @param {Number} m03 Component in column 0, row 3 position (index 3)\n * @param {Number} m10 Component in column 1, row 0 position (index 4)\n * @param {Number} m11 Component in column 1, row 1 position (index 5)\n * @param {Number} m12 Component in column 1, row 2 position (index 6)\n * @param {Number} m13 Component in column 1, row 3 position (index 7)\n * @param {Number} m20 Component in column 2, row 0 position (index 8)\n * @param {Number} m21 Component in column 2, row 1 position (index 9)\n * @param {Number} m22 Component in column 2, row 2 position (index 10)\n * @param {Number} m23 Component in column 2, row 3 position (index 11)\n * @param {Number} m30 Component in column 3, row 0 position (index 12)\n * @param {Number} m31 Component in column 3, row 1 position (index 13)\n * @param {Number} m32 Component in column 3, row 2 position (index 14)\n * @param {Number} m33 Component in column 3, row 3 position (index 15)\n * @returns {mat4} A new mat4\n */\n\nexport function fromValues(m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33) {\n  var out = new glMatrix.ARRAY_TYPE(16);\n  out[0] = m00;\n  out[1] = m01;\n  out[2] = m02;\n  out[3] = m03;\n  out[4] = m10;\n  out[5] = m11;\n  out[6] = m12;\n  out[7] = m13;\n  out[8] = m20;\n  out[9] = m21;\n  out[10] = m22;\n  out[11] = m23;\n  out[12] = m30;\n  out[13] = m31;\n  out[14] = m32;\n  out[15] = m33;\n  return out;\n}\n/**\n * Set the components of a mat4 to the given values\n *\n * @param {mat4} out the receiving matrix\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\n * @param {Number} m03 Component in column 0, row 3 position (index 3)\n * @param {Number} m10 Component in column 1, row 0 position (index 4)\n * @param {Number} m11 Component in column 1, row 1 position (index 5)\n * @param {Number} m12 Component in column 1, row 2 position (index 6)\n * @param {Number} m13 Component in column 1, row 3 position (index 7)\n * @param {Number} m20 Component in column 2, row 0 position (index 8)\n * @param {Number} m21 Component in column 2, row 1 position (index 9)\n * @param {Number} m22 Component in column 2, row 2 position (index 10)\n * @param {Number} m23 Component in column 2, row 3 position (index 11)\n * @param {Number} m30 Component in column 3, row 0 position (index 12)\n * @param {Number} m31 Component in column 3, row 1 position (index 13)\n * @param {Number} m32 Component in column 3, row 2 position (index 14)\n * @param {Number} m33 Component in column 3, row 3 position (index 15)\n * @returns {mat4} out\n */\n\nexport function set(out, m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33) {\n  out[0] = m00;\n  out[1] = m01;\n  out[2] = m02;\n  out[3] = m03;\n  out[4] = m10;\n  out[5] = m11;\n  out[6] = m12;\n  out[7] = m13;\n  out[8] = m20;\n  out[9] = m21;\n  out[10] = m22;\n  out[11] = m23;\n  out[12] = m30;\n  out[13] = m31;\n  out[14] = m32;\n  out[15] = m33;\n  return out;\n}\n/**\n * Set a mat4 to the identity matrix\n *\n * @param {mat4} out the receiving matrix\n * @returns {mat4} out\n */\n\nexport function identity(out) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = 1;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 1;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Transpose the values of a mat4\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the source matrix\n * @returns {mat4} out\n */\n\nexport function transpose(out, a) {\n  // If we are transposing ourselves we can skip a few steps but have to cache some values\n  if (out === a) {\n    var a01 = a[1],\n        a02 = a[2],\n        a03 = a[3];\n    var a12 = a[6],\n        a13 = a[7];\n    var a23 = a[11];\n    out[1] = a[4];\n    out[2] = a[8];\n    out[3] = a[12];\n    out[4] = a01;\n    out[6] = a[9];\n    out[7] = a[13];\n    out[8] = a02;\n    out[9] = a12;\n    out[11] = a[14];\n    out[12] = a03;\n    out[13] = a13;\n    out[14] = a23;\n  } else {\n    out[0] = a[0];\n    out[1] = a[4];\n    out[2] = a[8];\n    out[3] = a[12];\n    out[4] = a[1];\n    out[5] = a[5];\n    out[6] = a[9];\n    out[7] = a[13];\n    out[8] = a[2];\n    out[9] = a[6];\n    out[10] = a[10];\n    out[11] = a[14];\n    out[12] = a[3];\n    out[13] = a[7];\n    out[14] = a[11];\n    out[15] = a[15];\n  }\n\n  return out;\n}\n/**\n * Inverts a mat4\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the source matrix\n * @returns {mat4} out\n */\n\nexport function invert(out, a) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2],\n      a03 = a[3];\n  var a10 = a[4],\n      a11 = a[5],\n      a12 = a[6],\n      a13 = a[7];\n  var a20 = a[8],\n      a21 = a[9],\n      a22 = a[10],\n      a23 = a[11];\n  var a30 = a[12],\n      a31 = a[13],\n      a32 = a[14],\n      a33 = a[15];\n  var b00 = a00 * a11 - a01 * a10;\n  var b01 = a00 * a12 - a02 * a10;\n  var b02 = a00 * a13 - a03 * a10;\n  var b03 = a01 * a12 - a02 * a11;\n  var b04 = a01 * a13 - a03 * a11;\n  var b05 = a02 * a13 - a03 * a12;\n  var b06 = a20 * a31 - a21 * a30;\n  var b07 = a20 * a32 - a22 * a30;\n  var b08 = a20 * a33 - a23 * a30;\n  var b09 = a21 * a32 - a22 * a31;\n  var b10 = a21 * a33 - a23 * a31;\n  var b11 = a22 * a33 - a23 * a32; // Calculate the determinant\n\n  var det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  if (!det) {\n    return null;\n  }\n\n  det = 1.0 / det;\n  out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\n  out[1] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\n  out[2] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\n  out[3] = (a22 * b04 - a21 * b05 - a23 * b03) * det;\n  out[4] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\n  out[5] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\n  out[6] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\n  out[7] = (a20 * b05 - a22 * b02 + a23 * b01) * det;\n  out[8] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\n  out[9] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\n  out[10] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\n  out[11] = (a21 * b02 - a20 * b04 - a23 * b00) * det;\n  out[12] = (a11 * b07 - a10 * b09 - a12 * b06) * det;\n  out[13] = (a00 * b09 - a01 * b07 + a02 * b06) * det;\n  out[14] = (a31 * b01 - a30 * b03 - a32 * b00) * det;\n  out[15] = (a20 * b03 - a21 * b01 + a22 * b00) * det;\n  return out;\n}\n/**\n * Calculates the adjugate of a mat4\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the source matrix\n * @returns {mat4} out\n */\n\nexport function adjoint(out, a) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2],\n      a03 = a[3];\n  var a10 = a[4],\n      a11 = a[5],\n      a12 = a[6],\n      a13 = a[7];\n  var a20 = a[8],\n      a21 = a[9],\n      a22 = a[10],\n      a23 = a[11];\n  var a30 = a[12],\n      a31 = a[13],\n      a32 = a[14],\n      a33 = a[15];\n  out[0] = a11 * (a22 * a33 - a23 * a32) - a21 * (a12 * a33 - a13 * a32) + a31 * (a12 * a23 - a13 * a22);\n  out[1] = -(a01 * (a22 * a33 - a23 * a32) - a21 * (a02 * a33 - a03 * a32) + a31 * (a02 * a23 - a03 * a22));\n  out[2] = a01 * (a12 * a33 - a13 * a32) - a11 * (a02 * a33 - a03 * a32) + a31 * (a02 * a13 - a03 * a12);\n  out[3] = -(a01 * (a12 * a23 - a13 * a22) - a11 * (a02 * a23 - a03 * a22) + a21 * (a02 * a13 - a03 * a12));\n  out[4] = -(a10 * (a22 * a33 - a23 * a32) - a20 * (a12 * a33 - a13 * a32) + a30 * (a12 * a23 - a13 * a22));\n  out[5] = a00 * (a22 * a33 - a23 * a32) - a20 * (a02 * a33 - a03 * a32) + a30 * (a02 * a23 - a03 * a22);\n  out[6] = -(a00 * (a12 * a33 - a13 * a32) - a10 * (a02 * a33 - a03 * a32) + a30 * (a02 * a13 - a03 * a12));\n  out[7] = a00 * (a12 * a23 - a13 * a22) - a10 * (a02 * a23 - a03 * a22) + a20 * (a02 * a13 - a03 * a12);\n  out[8] = a10 * (a21 * a33 - a23 * a31) - a20 * (a11 * a33 - a13 * a31) + a30 * (a11 * a23 - a13 * a21);\n  out[9] = -(a00 * (a21 * a33 - a23 * a31) - a20 * (a01 * a33 - a03 * a31) + a30 * (a01 * a23 - a03 * a21));\n  out[10] = a00 * (a11 * a33 - a13 * a31) - a10 * (a01 * a33 - a03 * a31) + a30 * (a01 * a13 - a03 * a11);\n  out[11] = -(a00 * (a11 * a23 - a13 * a21) - a10 * (a01 * a23 - a03 * a21) + a20 * (a01 * a13 - a03 * a11));\n  out[12] = -(a10 * (a21 * a32 - a22 * a31) - a20 * (a11 * a32 - a12 * a31) + a30 * (a11 * a22 - a12 * a21));\n  out[13] = a00 * (a21 * a32 - a22 * a31) - a20 * (a01 * a32 - a02 * a31) + a30 * (a01 * a22 - a02 * a21);\n  out[14] = -(a00 * (a11 * a32 - a12 * a31) - a10 * (a01 * a32 - a02 * a31) + a30 * (a01 * a12 - a02 * a11));\n  out[15] = a00 * (a11 * a22 - a12 * a21) - a10 * (a01 * a22 - a02 * a21) + a20 * (a01 * a12 - a02 * a11);\n  return out;\n}\n/**\n * Calculates the determinant of a mat4\n *\n * @param {ReadonlyMat4} a the source matrix\n * @returns {Number} determinant of a\n */\n\nexport function determinant(a) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2],\n      a03 = a[3];\n  var a10 = a[4],\n      a11 = a[5],\n      a12 = a[6],\n      a13 = a[7];\n  var a20 = a[8],\n      a21 = a[9],\n      a22 = a[10],\n      a23 = a[11];\n  var a30 = a[12],\n      a31 = a[13],\n      a32 = a[14],\n      a33 = a[15];\n  var b00 = a00 * a11 - a01 * a10;\n  var b01 = a00 * a12 - a02 * a10;\n  var b02 = a00 * a13 - a03 * a10;\n  var b03 = a01 * a12 - a02 * a11;\n  var b04 = a01 * a13 - a03 * a11;\n  var b05 = a02 * a13 - a03 * a12;\n  var b06 = a20 * a31 - a21 * a30;\n  var b07 = a20 * a32 - a22 * a30;\n  var b08 = a20 * a33 - a23 * a30;\n  var b09 = a21 * a32 - a22 * a31;\n  var b10 = a21 * a33 - a23 * a31;\n  var b11 = a22 * a33 - a23 * a32; // Calculate the determinant\n\n  return b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n}\n/**\n * Multiplies two mat4s\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the first operand\n * @param {ReadonlyMat4} b the second operand\n * @returns {mat4} out\n */\n\nexport function multiply(out, a, b) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2],\n      a03 = a[3];\n  var a10 = a[4],\n      a11 = a[5],\n      a12 = a[6],\n      a13 = a[7];\n  var a20 = a[8],\n      a21 = a[9],\n      a22 = a[10],\n      a23 = a[11];\n  var a30 = a[12],\n      a31 = a[13],\n      a32 = a[14],\n      a33 = a[15]; // Cache only the current line of the second matrix\n\n  var b0 = b[0],\n      b1 = b[1],\n      b2 = b[2],\n      b3 = b[3];\n  out[0] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[1] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[2] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[3] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  b0 = b[4];\n  b1 = b[5];\n  b2 = b[6];\n  b3 = b[7];\n  out[4] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[5] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[6] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[7] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  b0 = b[8];\n  b1 = b[9];\n  b2 = b[10];\n  b3 = b[11];\n  out[8] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[9] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[10] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[11] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  b0 = b[12];\n  b1 = b[13];\n  b2 = b[14];\n  b3 = b[15];\n  out[12] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[13] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[14] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[15] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  return out;\n}\n/**\n * Translate a mat4 by the given vector\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to translate\n * @param {ReadonlyVec3} v vector to translate by\n * @returns {mat4} out\n */\n\nexport function translate(out, a, v) {\n  var x = v[0],\n      y = v[1],\n      z = v[2];\n  var a00, a01, a02, a03;\n  var a10, a11, a12, a13;\n  var a20, a21, a22, a23;\n\n  if (a === out) {\n    out[12] = a[0] * x + a[4] * y + a[8] * z + a[12];\n    out[13] = a[1] * x + a[5] * y + a[9] * z + a[13];\n    out[14] = a[2] * x + a[6] * y + a[10] * z + a[14];\n    out[15] = a[3] * x + a[7] * y + a[11] * z + a[15];\n  } else {\n    a00 = a[0];\n    a01 = a[1];\n    a02 = a[2];\n    a03 = a[3];\n    a10 = a[4];\n    a11 = a[5];\n    a12 = a[6];\n    a13 = a[7];\n    a20 = a[8];\n    a21 = a[9];\n    a22 = a[10];\n    a23 = a[11];\n    out[0] = a00;\n    out[1] = a01;\n    out[2] = a02;\n    out[3] = a03;\n    out[4] = a10;\n    out[5] = a11;\n    out[6] = a12;\n    out[7] = a13;\n    out[8] = a20;\n    out[9] = a21;\n    out[10] = a22;\n    out[11] = a23;\n    out[12] = a00 * x + a10 * y + a20 * z + a[12];\n    out[13] = a01 * x + a11 * y + a21 * z + a[13];\n    out[14] = a02 * x + a12 * y + a22 * z + a[14];\n    out[15] = a03 * x + a13 * y + a23 * z + a[15];\n  }\n\n  return out;\n}\n/**\n * Scales the mat4 by the dimensions in the given vec3 not using vectorization\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to scale\n * @param {ReadonlyVec3} v the vec3 to scale the matrix by\n * @returns {mat4} out\n **/\n\nexport function scale(out, a, v) {\n  var x = v[0],\n      y = v[1],\n      z = v[2];\n  out[0] = a[0] * x;\n  out[1] = a[1] * x;\n  out[2] = a[2] * x;\n  out[3] = a[3] * x;\n  out[4] = a[4] * y;\n  out[5] = a[5] * y;\n  out[6] = a[6] * y;\n  out[7] = a[7] * y;\n  out[8] = a[8] * z;\n  out[9] = a[9] * z;\n  out[10] = a[10] * z;\n  out[11] = a[11] * z;\n  out[12] = a[12];\n  out[13] = a[13];\n  out[14] = a[14];\n  out[15] = a[15];\n  return out;\n}\n/**\n * Rotates a mat4 by the given angle around the given axis\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @param {ReadonlyVec3} axis the axis to rotate around\n * @returns {mat4} out\n */\n\nexport function rotate(out, a, rad, axis) {\n  var x = axis[0],\n      y = axis[1],\n      z = axis[2];\n  var len = Math.hypot(x, y, z);\n  var s, c, t;\n  var a00, a01, a02, a03;\n  var a10, a11, a12, a13;\n  var a20, a21, a22, a23;\n  var b00, b01, b02;\n  var b10, b11, b12;\n  var b20, b21, b22;\n\n  if (len < glMatrix.EPSILON) {\n    return null;\n  }\n\n  len = 1 / len;\n  x *= len;\n  y *= len;\n  z *= len;\n  s = Math.sin(rad);\n  c = Math.cos(rad);\n  t = 1 - c;\n  a00 = a[0];\n  a01 = a[1];\n  a02 = a[2];\n  a03 = a[3];\n  a10 = a[4];\n  a11 = a[5];\n  a12 = a[6];\n  a13 = a[7];\n  a20 = a[8];\n  a21 = a[9];\n  a22 = a[10];\n  a23 = a[11]; // Construct the elements of the rotation matrix\n\n  b00 = x * x * t + c;\n  b01 = y * x * t + z * s;\n  b02 = z * x * t - y * s;\n  b10 = x * y * t - z * s;\n  b11 = y * y * t + c;\n  b12 = z * y * t + x * s;\n  b20 = x * z * t + y * s;\n  b21 = y * z * t - x * s;\n  b22 = z * z * t + c; // Perform rotation-specific matrix multiplication\n\n  out[0] = a00 * b00 + a10 * b01 + a20 * b02;\n  out[1] = a01 * b00 + a11 * b01 + a21 * b02;\n  out[2] = a02 * b00 + a12 * b01 + a22 * b02;\n  out[3] = a03 * b00 + a13 * b01 + a23 * b02;\n  out[4] = a00 * b10 + a10 * b11 + a20 * b12;\n  out[5] = a01 * b10 + a11 * b11 + a21 * b12;\n  out[6] = a02 * b10 + a12 * b11 + a22 * b12;\n  out[7] = a03 * b10 + a13 * b11 + a23 * b12;\n  out[8] = a00 * b20 + a10 * b21 + a20 * b22;\n  out[9] = a01 * b20 + a11 * b21 + a21 * b22;\n  out[10] = a02 * b20 + a12 * b21 + a22 * b22;\n  out[11] = a03 * b20 + a13 * b21 + a23 * b22;\n\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged last row\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  }\n\n  return out;\n}\n/**\n * Rotates a matrix by the given angle around the X axis\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\n\nexport function rotateX(out, a, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n  var a10 = a[4];\n  var a11 = a[5];\n  var a12 = a[6];\n  var a13 = a[7];\n  var a20 = a[8];\n  var a21 = a[9];\n  var a22 = a[10];\n  var a23 = a[11];\n\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged rows\n    out[0] = a[0];\n    out[1] = a[1];\n    out[2] = a[2];\n    out[3] = a[3];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  } // Perform axis-specific matrix multiplication\n\n\n  out[4] = a10 * c + a20 * s;\n  out[5] = a11 * c + a21 * s;\n  out[6] = a12 * c + a22 * s;\n  out[7] = a13 * c + a23 * s;\n  out[8] = a20 * c - a10 * s;\n  out[9] = a21 * c - a11 * s;\n  out[10] = a22 * c - a12 * s;\n  out[11] = a23 * c - a13 * s;\n  return out;\n}\n/**\n * Rotates a matrix by the given angle around the Y axis\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\n\nexport function rotateY(out, a, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n  var a00 = a[0];\n  var a01 = a[1];\n  var a02 = a[2];\n  var a03 = a[3];\n  var a20 = a[8];\n  var a21 = a[9];\n  var a22 = a[10];\n  var a23 = a[11];\n\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged rows\n    out[4] = a[4];\n    out[5] = a[5];\n    out[6] = a[6];\n    out[7] = a[7];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  } // Perform axis-specific matrix multiplication\n\n\n  out[0] = a00 * c - a20 * s;\n  out[1] = a01 * c - a21 * s;\n  out[2] = a02 * c - a22 * s;\n  out[3] = a03 * c - a23 * s;\n  out[8] = a00 * s + a20 * c;\n  out[9] = a01 * s + a21 * c;\n  out[10] = a02 * s + a22 * c;\n  out[11] = a03 * s + a23 * c;\n  return out;\n}\n/**\n * Rotates a matrix by the given angle around the Z axis\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\n\nexport function rotateZ(out, a, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n  var a00 = a[0];\n  var a01 = a[1];\n  var a02 = a[2];\n  var a03 = a[3];\n  var a10 = a[4];\n  var a11 = a[5];\n  var a12 = a[6];\n  var a13 = a[7];\n\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged last row\n    out[8] = a[8];\n    out[9] = a[9];\n    out[10] = a[10];\n    out[11] = a[11];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  } // Perform axis-specific matrix multiplication\n\n\n  out[0] = a00 * c + a10 * s;\n  out[1] = a01 * c + a11 * s;\n  out[2] = a02 * c + a12 * s;\n  out[3] = a03 * c + a13 * s;\n  out[4] = a10 * c - a00 * s;\n  out[5] = a11 * c - a01 * s;\n  out[6] = a12 * c - a02 * s;\n  out[7] = a13 * c - a03 * s;\n  return out;\n}\n/**\n * Creates a matrix from a vector translation\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, dest, vec);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {ReadonlyVec3} v Translation vector\n * @returns {mat4} out\n */\n\nexport function fromTranslation(out, v) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = 1;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 1;\n  out[11] = 0;\n  out[12] = v[0];\n  out[13] = v[1];\n  out[14] = v[2];\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from a vector scaling\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.scale(dest, dest, vec);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {ReadonlyVec3} v Scaling vector\n * @returns {mat4} out\n */\n\nexport function fromScaling(out, v) {\n  out[0] = v[0];\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = v[1];\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = v[2];\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from a given angle around a given axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotate(dest, dest, rad, axis);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @param {ReadonlyVec3} axis the axis to rotate around\n * @returns {mat4} out\n */\n\nexport function fromRotation(out, rad, axis) {\n  var x = axis[0],\n      y = axis[1],\n      z = axis[2];\n  var len = Math.hypot(x, y, z);\n  var s, c, t;\n\n  if (len < glMatrix.EPSILON) {\n    return null;\n  }\n\n  len = 1 / len;\n  x *= len;\n  y *= len;\n  z *= len;\n  s = Math.sin(rad);\n  c = Math.cos(rad);\n  t = 1 - c; // Perform rotation-specific matrix multiplication\n\n  out[0] = x * x * t + c;\n  out[1] = y * x * t + z * s;\n  out[2] = z * x * t - y * s;\n  out[3] = 0;\n  out[4] = x * y * t - z * s;\n  out[5] = y * y * t + c;\n  out[6] = z * y * t + x * s;\n  out[7] = 0;\n  out[8] = x * z * t + y * s;\n  out[9] = y * z * t - x * s;\n  out[10] = z * z * t + c;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from the given angle around the X axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotateX(dest, dest, rad);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\n\nexport function fromXRotation(out, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad); // Perform axis-specific matrix multiplication\n\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = c;\n  out[6] = s;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = -s;\n  out[10] = c;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from the given angle around the Y axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotateY(dest, dest, rad);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\n\nexport function fromYRotation(out, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad); // Perform axis-specific matrix multiplication\n\n  out[0] = c;\n  out[1] = 0;\n  out[2] = -s;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = 1;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = s;\n  out[9] = 0;\n  out[10] = c;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from the given angle around the Z axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotateZ(dest, dest, rad);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\n\nexport function fromZRotation(out, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad); // Perform axis-specific matrix multiplication\n\n  out[0] = c;\n  out[1] = s;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = -s;\n  out[5] = c;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 1;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from a quaternion rotation and vector translation\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, vec);\n *     let quatMat = mat4.create();\n *     quat4.toMat4(quat, quatMat);\n *     mat4.multiply(dest, quatMat);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {quat4} q Rotation quaternion\n * @param {ReadonlyVec3} v Translation vector\n * @returns {mat4} out\n */\n\nexport function fromRotationTranslation(out, q, v) {\n  // Quaternion math\n  var x = q[0],\n      y = q[1],\n      z = q[2],\n      w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var xy = x * y2;\n  var xz = x * z2;\n  var yy = y * y2;\n  var yz = y * z2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  out[0] = 1 - (yy + zz);\n  out[1] = xy + wz;\n  out[2] = xz - wy;\n  out[3] = 0;\n  out[4] = xy - wz;\n  out[5] = 1 - (xx + zz);\n  out[6] = yz + wx;\n  out[7] = 0;\n  out[8] = xz + wy;\n  out[9] = yz - wx;\n  out[10] = 1 - (xx + yy);\n  out[11] = 0;\n  out[12] = v[0];\n  out[13] = v[1];\n  out[14] = v[2];\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a new mat4 from a dual quat.\n *\n * @param {mat4} out Matrix\n * @param {ReadonlyQuat2} a Dual Quaternion\n * @returns {mat4} mat4 receiving operation result\n */\n\nexport function fromQuat2(out, a) {\n  var translation = new glMatrix.ARRAY_TYPE(3);\n  var bx = -a[0],\n      by = -a[1],\n      bz = -a[2],\n      bw = a[3],\n      ax = a[4],\n      ay = a[5],\n      az = a[6],\n      aw = a[7];\n  var magnitude = bx * bx + by * by + bz * bz + bw * bw; //Only scale if it makes sense\n\n  if (magnitude > 0) {\n    translation[0] = (ax * bw + aw * bx + ay * bz - az * by) * 2 / magnitude;\n    translation[1] = (ay * bw + aw * by + az * bx - ax * bz) * 2 / magnitude;\n    translation[2] = (az * bw + aw * bz + ax * by - ay * bx) * 2 / magnitude;\n  } else {\n    translation[0] = (ax * bw + aw * bx + ay * bz - az * by) * 2;\n    translation[1] = (ay * bw + aw * by + az * bx - ax * bz) * 2;\n    translation[2] = (az * bw + aw * bz + ax * by - ay * bx) * 2;\n  }\n\n  fromRotationTranslation(out, a, translation);\n  return out;\n}\n/**\n * Returns the translation vector component of a transformation\n *  matrix. If a matrix is built with fromRotationTranslation,\n *  the returned vector will be the same as the translation vector\n *  originally supplied.\n * @param  {vec3} out Vector to receive translation component\n * @param  {ReadonlyMat4} mat Matrix to be decomposed (input)\n * @return {vec3} out\n */\n\nexport function getTranslation(out, mat) {\n  out[0] = mat[12];\n  out[1] = mat[13];\n  out[2] = mat[14];\n  return out;\n}\n/**\n * Returns the scaling factor component of a transformation\n *  matrix. If a matrix is built with fromRotationTranslationScale\n *  with a normalized Quaternion paramter, the returned vector will be\n *  the same as the scaling vector\n *  originally supplied.\n * @param  {vec3} out Vector to receive scaling factor component\n * @param  {ReadonlyMat4} mat Matrix to be decomposed (input)\n * @return {vec3} out\n */\n\nexport function getScaling(out, mat) {\n  var m11 = mat[0];\n  var m12 = mat[1];\n  var m13 = mat[2];\n  var m21 = mat[4];\n  var m22 = mat[5];\n  var m23 = mat[6];\n  var m31 = mat[8];\n  var m32 = mat[9];\n  var m33 = mat[10];\n  out[0] = Math.hypot(m11, m12, m13);\n  out[1] = Math.hypot(m21, m22, m23);\n  out[2] = Math.hypot(m31, m32, m33);\n  return out;\n}\n/**\n * Returns a quaternion representing the rotational component\n *  of a transformation matrix. If a matrix is built with\n *  fromRotationTranslation, the returned quaternion will be the\n *  same as the quaternion originally supplied.\n * @param {quat} out Quaternion to receive the rotation component\n * @param {ReadonlyMat4} mat Matrix to be decomposed (input)\n * @return {quat} out\n */\n\nexport function getRotation(out, mat) {\n  var scaling = new glMatrix.ARRAY_TYPE(3);\n  getScaling(scaling, mat);\n  var is1 = 1 / scaling[0];\n  var is2 = 1 / scaling[1];\n  var is3 = 1 / scaling[2];\n  var sm11 = mat[0] * is1;\n  var sm12 = mat[1] * is2;\n  var sm13 = mat[2] * is3;\n  var sm21 = mat[4] * is1;\n  var sm22 = mat[5] * is2;\n  var sm23 = mat[6] * is3;\n  var sm31 = mat[8] * is1;\n  var sm32 = mat[9] * is2;\n  var sm33 = mat[10] * is3;\n  var trace = sm11 + sm22 + sm33;\n  var S = 0;\n\n  if (trace > 0) {\n    S = Math.sqrt(trace + 1.0) * 2;\n    out[3] = 0.25 * S;\n    out[0] = (sm23 - sm32) / S;\n    out[1] = (sm31 - sm13) / S;\n    out[2] = (sm12 - sm21) / S;\n  } else if (sm11 > sm22 && sm11 > sm33) {\n    S = Math.sqrt(1.0 + sm11 - sm22 - sm33) * 2;\n    out[3] = (sm23 - sm32) / S;\n    out[0] = 0.25 * S;\n    out[1] = (sm12 + sm21) / S;\n    out[2] = (sm31 + sm13) / S;\n  } else if (sm22 > sm33) {\n    S = Math.sqrt(1.0 + sm22 - sm11 - sm33) * 2;\n    out[3] = (sm31 - sm13) / S;\n    out[0] = (sm12 + sm21) / S;\n    out[1] = 0.25 * S;\n    out[2] = (sm23 + sm32) / S;\n  } else {\n    S = Math.sqrt(1.0 + sm33 - sm11 - sm22) * 2;\n    out[3] = (sm12 - sm21) / S;\n    out[0] = (sm31 + sm13) / S;\n    out[1] = (sm23 + sm32) / S;\n    out[2] = 0.25 * S;\n  }\n\n  return out;\n}\n/**\n * Creates a matrix from a quaternion rotation, vector translation and vector scale\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, vec);\n *     let quatMat = mat4.create();\n *     quat4.toMat4(quat, quatMat);\n *     mat4.multiply(dest, quatMat);\n *     mat4.scale(dest, scale)\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {quat4} q Rotation quaternion\n * @param {ReadonlyVec3} v Translation vector\n * @param {ReadonlyVec3} s Scaling vector\n * @returns {mat4} out\n */\n\nexport function fromRotationTranslationScale(out, q, v, s) {\n  // Quaternion math\n  var x = q[0],\n      y = q[1],\n      z = q[2],\n      w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var xy = x * y2;\n  var xz = x * z2;\n  var yy = y * y2;\n  var yz = y * z2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  var sx = s[0];\n  var sy = s[1];\n  var sz = s[2];\n  out[0] = (1 - (yy + zz)) * sx;\n  out[1] = (xy + wz) * sx;\n  out[2] = (xz - wy) * sx;\n  out[3] = 0;\n  out[4] = (xy - wz) * sy;\n  out[5] = (1 - (xx + zz)) * sy;\n  out[6] = (yz + wx) * sy;\n  out[7] = 0;\n  out[8] = (xz + wy) * sz;\n  out[9] = (yz - wx) * sz;\n  out[10] = (1 - (xx + yy)) * sz;\n  out[11] = 0;\n  out[12] = v[0];\n  out[13] = v[1];\n  out[14] = v[2];\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from a quaternion rotation, vector translation and vector scale, rotating and scaling around the given origin\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, vec);\n *     mat4.translate(dest, origin);\n *     let quatMat = mat4.create();\n *     quat4.toMat4(quat, quatMat);\n *     mat4.multiply(dest, quatMat);\n *     mat4.scale(dest, scale)\n *     mat4.translate(dest, negativeOrigin);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {quat4} q Rotation quaternion\n * @param {ReadonlyVec3} v Translation vector\n * @param {ReadonlyVec3} s Scaling vector\n * @param {ReadonlyVec3} o The origin vector around which to scale and rotate\n * @returns {mat4} out\n */\n\nexport function fromRotationTranslationScaleOrigin(out, q, v, s, o) {\n  // Quaternion math\n  var x = q[0],\n      y = q[1],\n      z = q[2],\n      w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var xy = x * y2;\n  var xz = x * z2;\n  var yy = y * y2;\n  var yz = y * z2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  var sx = s[0];\n  var sy = s[1];\n  var sz = s[2];\n  var ox = o[0];\n  var oy = o[1];\n  var oz = o[2];\n  var out0 = (1 - (yy + zz)) * sx;\n  var out1 = (xy + wz) * sx;\n  var out2 = (xz - wy) * sx;\n  var out4 = (xy - wz) * sy;\n  var out5 = (1 - (xx + zz)) * sy;\n  var out6 = (yz + wx) * sy;\n  var out8 = (xz + wy) * sz;\n  var out9 = (yz - wx) * sz;\n  var out10 = (1 - (xx + yy)) * sz;\n  out[0] = out0;\n  out[1] = out1;\n  out[2] = out2;\n  out[3] = 0;\n  out[4] = out4;\n  out[5] = out5;\n  out[6] = out6;\n  out[7] = 0;\n  out[8] = out8;\n  out[9] = out9;\n  out[10] = out10;\n  out[11] = 0;\n  out[12] = v[0] + ox - (out0 * ox + out4 * oy + out8 * oz);\n  out[13] = v[1] + oy - (out1 * ox + out5 * oy + out9 * oz);\n  out[14] = v[2] + oz - (out2 * ox + out6 * oy + out10 * oz);\n  out[15] = 1;\n  return out;\n}\n/**\n * Calculates a 4x4 matrix from the given quaternion\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {ReadonlyQuat} q Quaternion to create matrix from\n *\n * @returns {mat4} out\n */\n\nexport function fromQuat(out, q) {\n  var x = q[0],\n      y = q[1],\n      z = q[2],\n      w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var yx = y * x2;\n  var yy = y * y2;\n  var zx = z * x2;\n  var zy = z * y2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  out[0] = 1 - yy - zz;\n  out[1] = yx + wz;\n  out[2] = zx - wy;\n  out[3] = 0;\n  out[4] = yx - wz;\n  out[5] = 1 - xx - zz;\n  out[6] = zy + wx;\n  out[7] = 0;\n  out[8] = zx + wy;\n  out[9] = zy - wx;\n  out[10] = 1 - xx - yy;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Generates a frustum matrix with the given bounds\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {Number} left Left bound of the frustum\n * @param {Number} right Right bound of the frustum\n * @param {Number} bottom Bottom bound of the frustum\n * @param {Number} top Top bound of the frustum\n * @param {Number} near Near bound of the frustum\n * @param {Number} far Far bound of the frustum\n * @returns {mat4} out\n */\n\nexport function frustum(out, left, right, bottom, top, near, far) {\n  var rl = 1 / (right - left);\n  var tb = 1 / (top - bottom);\n  var nf = 1 / (near - far);\n  out[0] = near * 2 * rl;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = near * 2 * tb;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = (right + left) * rl;\n  out[9] = (top + bottom) * tb;\n  out[10] = (far + near) * nf;\n  out[11] = -1;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = far * near * 2 * nf;\n  out[15] = 0;\n  return out;\n}\n/**\n * Generates a perspective projection matrix with the given bounds.\n * The near/far clip planes correspond to a normalized device coordinate Z range of [-1, 1],\n * which matches WebGL/OpenGL's clip volume.\n * Passing null/undefined/no value for far will generate infinite projection matrix.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} fovy Vertical field of view in radians\n * @param {number} aspect Aspect ratio. typically viewport width/height\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum, can be null or Infinity\n * @returns {mat4} out\n */\n\nexport function perspectiveNO(out, fovy, aspect, near, far) {\n  var f = 1.0 / Math.tan(fovy / 2),\n      nf;\n  out[0] = f / aspect;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = f;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[11] = -1;\n  out[12] = 0;\n  out[13] = 0;\n  out[15] = 0;\n\n  if (far != null && far !== Infinity) {\n    nf = 1 / (near - far);\n    out[10] = (far + near) * nf;\n    out[14] = 2 * far * near * nf;\n  } else {\n    out[10] = -1;\n    out[14] = -2 * near;\n  }\n\n  return out;\n}\n/**\n * Alias for {@link mat4.perspectiveNO}\n * @function\n */\n\nexport var perspective = perspectiveNO;\n/**\n * Generates a perspective projection matrix suitable for WebGPU with the given bounds.\n * The near/far clip planes correspond to a normalized device coordinate Z range of [0, 1],\n * which matches WebGPU/Vulkan/DirectX/Metal's clip volume.\n * Passing null/undefined/no value for far will generate infinite projection matrix.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} fovy Vertical field of view in radians\n * @param {number} aspect Aspect ratio. typically viewport width/height\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum, can be null or Infinity\n * @returns {mat4} out\n */\n\nexport function perspectiveZO(out, fovy, aspect, near, far) {\n  var f = 1.0 / Math.tan(fovy / 2),\n      nf;\n  out[0] = f / aspect;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = f;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[11] = -1;\n  out[12] = 0;\n  out[13] = 0;\n  out[15] = 0;\n\n  if (far != null && far !== Infinity) {\n    nf = 1 / (near - far);\n    out[10] = far * nf;\n    out[14] = far * near * nf;\n  } else {\n    out[10] = -1;\n    out[14] = -near;\n  }\n\n  return out;\n}\n/**\n * Generates a perspective projection matrix with the given field of view.\n * This is primarily useful for generating projection matrices to be used\n * with the still experiemental WebVR API.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {Object} fov Object containing the following values: upDegrees, downDegrees, leftDegrees, rightDegrees\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum\n * @returns {mat4} out\n */\n\nexport function perspectiveFromFieldOfView(out, fov, near, far) {\n  var upTan = Math.tan(fov.upDegrees * Math.PI / 180.0);\n  var downTan = Math.tan(fov.downDegrees * Math.PI / 180.0);\n  var leftTan = Math.tan(fov.leftDegrees * Math.PI / 180.0);\n  var rightTan = Math.tan(fov.rightDegrees * Math.PI / 180.0);\n  var xScale = 2.0 / (leftTan + rightTan);\n  var yScale = 2.0 / (upTan + downTan);\n  out[0] = xScale;\n  out[1] = 0.0;\n  out[2] = 0.0;\n  out[3] = 0.0;\n  out[4] = 0.0;\n  out[5] = yScale;\n  out[6] = 0.0;\n  out[7] = 0.0;\n  out[8] = -((leftTan - rightTan) * xScale * 0.5);\n  out[9] = (upTan - downTan) * yScale * 0.5;\n  out[10] = far / (near - far);\n  out[11] = -1.0;\n  out[12] = 0.0;\n  out[13] = 0.0;\n  out[14] = far * near / (near - far);\n  out[15] = 0.0;\n  return out;\n}\n/**\n * Generates a orthogonal projection matrix with the given bounds.\n * The near/far clip planes correspond to a normalized device coordinate Z range of [-1, 1],\n * which matches WebGL/OpenGL's clip volume.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} left Left bound of the frustum\n * @param {number} right Right bound of the frustum\n * @param {number} bottom Bottom bound of the frustum\n * @param {number} top Top bound of the frustum\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum\n * @returns {mat4} out\n */\n\nexport function orthoNO(out, left, right, bottom, top, near, far) {\n  var lr = 1 / (left - right);\n  var bt = 1 / (bottom - top);\n  var nf = 1 / (near - far);\n  out[0] = -2 * lr;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = -2 * bt;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 2 * nf;\n  out[11] = 0;\n  out[12] = (left + right) * lr;\n  out[13] = (top + bottom) * bt;\n  out[14] = (far + near) * nf;\n  out[15] = 1;\n  return out;\n}\n/**\n * Alias for {@link mat4.orthoNO}\n * @function\n */\n\nexport var ortho = orthoNO;\n/**\n * Generates a orthogonal projection matrix with the given bounds.\n * The near/far clip planes correspond to a normalized device coordinate Z range of [0, 1],\n * which matches WebGPU/Vulkan/DirectX/Metal's clip volume.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} left Left bound of the frustum\n * @param {number} right Right bound of the frustum\n * @param {number} bottom Bottom bound of the frustum\n * @param {number} top Top bound of the frustum\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum\n * @returns {mat4} out\n */\n\nexport function orthoZO(out, left, right, bottom, top, near, far) {\n  var lr = 1 / (left - right);\n  var bt = 1 / (bottom - top);\n  var nf = 1 / (near - far);\n  out[0] = -2 * lr;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = -2 * bt;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = nf;\n  out[11] = 0;\n  out[12] = (left + right) * lr;\n  out[13] = (top + bottom) * bt;\n  out[14] = near * nf;\n  out[15] = 1;\n  return out;\n}\n/**\n * Generates a look-at matrix with the given eye position, focal point, and up axis.\n * If you want a matrix that actually makes an object look at another object, you should use targetTo instead.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {ReadonlyVec3} eye Position of the viewer\n * @param {ReadonlyVec3} center Point the viewer is looking at\n * @param {ReadonlyVec3} up vec3 pointing up\n * @returns {mat4} out\n */\n\nexport function lookAt(out, eye, center, up) {\n  var x0, x1, x2, y0, y1, y2, z0, z1, z2, len;\n  var eyex = eye[0];\n  var eyey = eye[1];\n  var eyez = eye[2];\n  var upx = up[0];\n  var upy = up[1];\n  var upz = up[2];\n  var centerx = center[0];\n  var centery = center[1];\n  var centerz = center[2];\n\n  if (Math.abs(eyex - centerx) < glMatrix.EPSILON && Math.abs(eyey - centery) < glMatrix.EPSILON && Math.abs(eyez - centerz) < glMatrix.EPSILON) {\n    return identity(out);\n  }\n\n  z0 = eyex - centerx;\n  z1 = eyey - centery;\n  z2 = eyez - centerz;\n  len = 1 / Math.hypot(z0, z1, z2);\n  z0 *= len;\n  z1 *= len;\n  z2 *= len;\n  x0 = upy * z2 - upz * z1;\n  x1 = upz * z0 - upx * z2;\n  x2 = upx * z1 - upy * z0;\n  len = Math.hypot(x0, x1, x2);\n\n  if (!len) {\n    x0 = 0;\n    x1 = 0;\n    x2 = 0;\n  } else {\n    len = 1 / len;\n    x0 *= len;\n    x1 *= len;\n    x2 *= len;\n  }\n\n  y0 = z1 * x2 - z2 * x1;\n  y1 = z2 * x0 - z0 * x2;\n  y2 = z0 * x1 - z1 * x0;\n  len = Math.hypot(y0, y1, y2);\n\n  if (!len) {\n    y0 = 0;\n    y1 = 0;\n    y2 = 0;\n  } else {\n    len = 1 / len;\n    y0 *= len;\n    y1 *= len;\n    y2 *= len;\n  }\n\n  out[0] = x0;\n  out[1] = y0;\n  out[2] = z0;\n  out[3] = 0;\n  out[4] = x1;\n  out[5] = y1;\n  out[6] = z1;\n  out[7] = 0;\n  out[8] = x2;\n  out[9] = y2;\n  out[10] = z2;\n  out[11] = 0;\n  out[12] = -(x0 * eyex + x1 * eyey + x2 * eyez);\n  out[13] = -(y0 * eyex + y1 * eyey + y2 * eyez);\n  out[14] = -(z0 * eyex + z1 * eyey + z2 * eyez);\n  out[15] = 1;\n  return out;\n}\n/**\n * Generates a matrix that makes something look at something else.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {ReadonlyVec3} eye Position of the viewer\n * @param {ReadonlyVec3} center Point the viewer is looking at\n * @param {ReadonlyVec3} up vec3 pointing up\n * @returns {mat4} out\n */\n\nexport function targetTo(out, eye, target, up) {\n  var eyex = eye[0],\n      eyey = eye[1],\n      eyez = eye[2],\n      upx = up[0],\n      upy = up[1],\n      upz = up[2];\n  var z0 = eyex - target[0],\n      z1 = eyey - target[1],\n      z2 = eyez - target[2];\n  var len = z0 * z0 + z1 * z1 + z2 * z2;\n\n  if (len > 0) {\n    len = 1 / Math.sqrt(len);\n    z0 *= len;\n    z1 *= len;\n    z2 *= len;\n  }\n\n  var x0 = upy * z2 - upz * z1,\n      x1 = upz * z0 - upx * z2,\n      x2 = upx * z1 - upy * z0;\n  len = x0 * x0 + x1 * x1 + x2 * x2;\n\n  if (len > 0) {\n    len = 1 / Math.sqrt(len);\n    x0 *= len;\n    x1 *= len;\n    x2 *= len;\n  }\n\n  out[0] = x0;\n  out[1] = x1;\n  out[2] = x2;\n  out[3] = 0;\n  out[4] = z1 * x2 - z2 * x1;\n  out[5] = z2 * x0 - z0 * x2;\n  out[6] = z0 * x1 - z1 * x0;\n  out[7] = 0;\n  out[8] = z0;\n  out[9] = z1;\n  out[10] = z2;\n  out[11] = 0;\n  out[12] = eyex;\n  out[13] = eyey;\n  out[14] = eyez;\n  out[15] = 1;\n  return out;\n}\n/**\n * Returns a string representation of a mat4\n *\n * @param {ReadonlyMat4} a matrix to represent as a string\n * @returns {String} string representation of the matrix\n */\n\nexport function str(a) {\n  return \"mat4(\" + a[0] + \", \" + a[1] + \", \" + a[2] + \", \" + a[3] + \", \" + a[4] + \", \" + a[5] + \", \" + a[6] + \", \" + a[7] + \", \" + a[8] + \", \" + a[9] + \", \" + a[10] + \", \" + a[11] + \", \" + a[12] + \", \" + a[13] + \", \" + a[14] + \", \" + a[15] + \")\";\n}\n/**\n * Returns Frobenius norm of a mat4\n *\n * @param {ReadonlyMat4} a the matrix to calculate Frobenius norm of\n * @returns {Number} Frobenius norm\n */\n\nexport function frob(a) {\n  return Math.hypot(a[0], a[1], a[2], a[3], a[4], a[5], a[6], a[7], a[8], a[9], a[10], a[11], a[12], a[13], a[14], a[15]);\n}\n/**\n * Adds two mat4's\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the first operand\n * @param {ReadonlyMat4} b the second operand\n * @returns {mat4} out\n */\n\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  out[3] = a[3] + b[3];\n  out[4] = a[4] + b[4];\n  out[5] = a[5] + b[5];\n  out[6] = a[6] + b[6];\n  out[7] = a[7] + b[7];\n  out[8] = a[8] + b[8];\n  out[9] = a[9] + b[9];\n  out[10] = a[10] + b[10];\n  out[11] = a[11] + b[11];\n  out[12] = a[12] + b[12];\n  out[13] = a[13] + b[13];\n  out[14] = a[14] + b[14];\n  out[15] = a[15] + b[15];\n  return out;\n}\n/**\n * Subtracts matrix b from matrix a\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the first operand\n * @param {ReadonlyMat4} b the second operand\n * @returns {mat4} out\n */\n\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  out[3] = a[3] - b[3];\n  out[4] = a[4] - b[4];\n  out[5] = a[5] - b[5];\n  out[6] = a[6] - b[6];\n  out[7] = a[7] - b[7];\n  out[8] = a[8] - b[8];\n  out[9] = a[9] - b[9];\n  out[10] = a[10] - b[10];\n  out[11] = a[11] - b[11];\n  out[12] = a[12] - b[12];\n  out[13] = a[13] - b[13];\n  out[14] = a[14] - b[14];\n  out[15] = a[15] - b[15];\n  return out;\n}\n/**\n * Multiply each element of the matrix by a scalar.\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to scale\n * @param {Number} b amount to scale the matrix's elements by\n * @returns {mat4} out\n */\n\nexport function multiplyScalar(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  out[2] = a[2] * b;\n  out[3] = a[3] * b;\n  out[4] = a[4] * b;\n  out[5] = a[5] * b;\n  out[6] = a[6] * b;\n  out[7] = a[7] * b;\n  out[8] = a[8] * b;\n  out[9] = a[9] * b;\n  out[10] = a[10] * b;\n  out[11] = a[11] * b;\n  out[12] = a[12] * b;\n  out[13] = a[13] * b;\n  out[14] = a[14] * b;\n  out[15] = a[15] * b;\n  return out;\n}\n/**\n * Adds two mat4's after multiplying each element of the second operand by a scalar value.\n *\n * @param {mat4} out the receiving vector\n * @param {ReadonlyMat4} a the first operand\n * @param {ReadonlyMat4} b the second operand\n * @param {Number} scale the amount to scale b's elements by before adding\n * @returns {mat4} out\n */\n\nexport function multiplyScalarAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  out[2] = a[2] + b[2] * scale;\n  out[3] = a[3] + b[3] * scale;\n  out[4] = a[4] + b[4] * scale;\n  out[5] = a[5] + b[5] * scale;\n  out[6] = a[6] + b[6] * scale;\n  out[7] = a[7] + b[7] * scale;\n  out[8] = a[8] + b[8] * scale;\n  out[9] = a[9] + b[9] * scale;\n  out[10] = a[10] + b[10] * scale;\n  out[11] = a[11] + b[11] * scale;\n  out[12] = a[12] + b[12] * scale;\n  out[13] = a[13] + b[13] * scale;\n  out[14] = a[14] + b[14] * scale;\n  out[15] = a[15] + b[15] * scale;\n  return out;\n}\n/**\n * Returns whether or not the matrices have exactly the same elements in the same position (when compared with ===)\n *\n * @param {ReadonlyMat4} a The first matrix.\n * @param {ReadonlyMat4} b The second matrix.\n * @returns {Boolean} True if the matrices are equal, false otherwise.\n */\n\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3] && a[4] === b[4] && a[5] === b[5] && a[6] === b[6] && a[7] === b[7] && a[8] === b[8] && a[9] === b[9] && a[10] === b[10] && a[11] === b[11] && a[12] === b[12] && a[13] === b[13] && a[14] === b[14] && a[15] === b[15];\n}\n/**\n * Returns whether or not the matrices have approximately the same elements in the same position.\n *\n * @param {ReadonlyMat4} a The first matrix.\n * @param {ReadonlyMat4} b The second matrix.\n * @returns {Boolean} True if the matrices are equal, false otherwise.\n */\n\nexport function equals(a, b) {\n  var a0 = a[0],\n      a1 = a[1],\n      a2 = a[2],\n      a3 = a[3];\n  var a4 = a[4],\n      a5 = a[5],\n      a6 = a[6],\n      a7 = a[7];\n  var a8 = a[8],\n      a9 = a[9],\n      a10 = a[10],\n      a11 = a[11];\n  var a12 = a[12],\n      a13 = a[13],\n      a14 = a[14],\n      a15 = a[15];\n  var b0 = b[0],\n      b1 = b[1],\n      b2 = b[2],\n      b3 = b[3];\n  var b4 = b[4],\n      b5 = b[5],\n      b6 = b[6],\n      b7 = b[7];\n  var b8 = b[8],\n      b9 = b[9],\n      b10 = b[10],\n      b11 = b[11];\n  var b12 = b[12],\n      b13 = b[13],\n      b14 = b[14],\n      b15 = b[15];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3)) && Math.abs(a4 - b4) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a4), Math.abs(b4)) && Math.abs(a5 - b5) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a5), Math.abs(b5)) && Math.abs(a6 - b6) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a6), Math.abs(b6)) && Math.abs(a7 - b7) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a7), Math.abs(b7)) && Math.abs(a8 - b8) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a8), Math.abs(b8)) && Math.abs(a9 - b9) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a9), Math.abs(b9)) && Math.abs(a10 - b10) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a10), Math.abs(b10)) && Math.abs(a11 - b11) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a11), Math.abs(b11)) && Math.abs(a12 - b12) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a12), Math.abs(b12)) && Math.abs(a13 - b13) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a13), Math.abs(b13)) && Math.abs(a14 - b14) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a14), Math.abs(b14)) && Math.abs(a15 - b15) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a15), Math.abs(b15));\n}\n/**\n * Alias for {@link mat4.multiply}\n * @function\n */\n\nexport var mul = multiply;\n/**\n * Alias for {@link mat4.subtract}\n * @function\n */\n\nexport var sub = subtract;","import * as glMatrix from \"./common.js\";\n/**\n * 3 Dimensional Vector\n * @module vec3\n */\n\n/**\n * Creates a new, empty vec3\n *\n * @returns {vec3} a new 3D vector\n */\n\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(3);\n\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[0] = 0;\n    out[1] = 0;\n    out[2] = 0;\n  }\n\n  return out;\n}\n/**\n * Creates a new vec3 initialized with values from an existing vector\n *\n * @param {ReadonlyVec3} a vector to clone\n * @returns {vec3} a new 3D vector\n */\n\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(3);\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  return out;\n}\n/**\n * Calculates the length of a vec3\n *\n * @param {ReadonlyVec3} a vector to calculate length of\n * @returns {Number} length of a\n */\n\nexport function length(a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  return Math.hypot(x, y, z);\n}\n/**\n * Creates a new vec3 initialized with the given values\n *\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @returns {vec3} a new 3D vector\n */\n\nexport function fromValues(x, y, z) {\n  var out = new glMatrix.ARRAY_TYPE(3);\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  return out;\n}\n/**\n * Copy the values from one vec3 to another\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the source vector\n * @returns {vec3} out\n */\n\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  return out;\n}\n/**\n * Set the components of a vec3 to the given values\n *\n * @param {vec3} out the receiving vector\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @returns {vec3} out\n */\n\nexport function set(out, x, y, z) {\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  return out;\n}\n/**\n * Adds two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  return out;\n}\n/**\n * Subtracts vector b from vector a\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  return out;\n}\n/**\n * Multiplies two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function multiply(out, a, b) {\n  out[0] = a[0] * b[0];\n  out[1] = a[1] * b[1];\n  out[2] = a[2] * b[2];\n  return out;\n}\n/**\n * Divides two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function divide(out, a, b) {\n  out[0] = a[0] / b[0];\n  out[1] = a[1] / b[1];\n  out[2] = a[2] / b[2];\n  return out;\n}\n/**\n * Math.ceil the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to ceil\n * @returns {vec3} out\n */\n\nexport function ceil(out, a) {\n  out[0] = Math.ceil(a[0]);\n  out[1] = Math.ceil(a[1]);\n  out[2] = Math.ceil(a[2]);\n  return out;\n}\n/**\n * Math.floor the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to floor\n * @returns {vec3} out\n */\n\nexport function floor(out, a) {\n  out[0] = Math.floor(a[0]);\n  out[1] = Math.floor(a[1]);\n  out[2] = Math.floor(a[2]);\n  return out;\n}\n/**\n * Returns the minimum of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function min(out, a, b) {\n  out[0] = Math.min(a[0], b[0]);\n  out[1] = Math.min(a[1], b[1]);\n  out[2] = Math.min(a[2], b[2]);\n  return out;\n}\n/**\n * Returns the maximum of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function max(out, a, b) {\n  out[0] = Math.max(a[0], b[0]);\n  out[1] = Math.max(a[1], b[1]);\n  out[2] = Math.max(a[2], b[2]);\n  return out;\n}\n/**\n * Math.round the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to round\n * @returns {vec3} out\n */\n\nexport function round(out, a) {\n  out[0] = Math.round(a[0]);\n  out[1] = Math.round(a[1]);\n  out[2] = Math.round(a[2]);\n  return out;\n}\n/**\n * Scales a vec3 by a scalar number\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to scale\n * @param {Number} b amount to scale the vector by\n * @returns {vec3} out\n */\n\nexport function scale(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  out[2] = a[2] * b;\n  return out;\n}\n/**\n * Adds two vec3's after scaling the second operand by a scalar value\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {Number} scale the amount to scale b by before adding\n * @returns {vec3} out\n */\n\nexport function scaleAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  out[2] = a[2] + b[2] * scale;\n  return out;\n}\n/**\n * Calculates the euclidian distance between two vec3's\n *\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {Number} distance between a and b\n */\n\nexport function distance(a, b) {\n  var x = b[0] - a[0];\n  var y = b[1] - a[1];\n  var z = b[2] - a[2];\n  return Math.hypot(x, y, z);\n}\n/**\n * Calculates the squared euclidian distance between two vec3's\n *\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {Number} squared distance between a and b\n */\n\nexport function squaredDistance(a, b) {\n  var x = b[0] - a[0];\n  var y = b[1] - a[1];\n  var z = b[2] - a[2];\n  return x * x + y * y + z * z;\n}\n/**\n * Calculates the squared length of a vec3\n *\n * @param {ReadonlyVec3} a vector to calculate squared length of\n * @returns {Number} squared length of a\n */\n\nexport function squaredLength(a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  return x * x + y * y + z * z;\n}\n/**\n * Negates the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to negate\n * @returns {vec3} out\n */\n\nexport function negate(out, a) {\n  out[0] = -a[0];\n  out[1] = -a[1];\n  out[2] = -a[2];\n  return out;\n}\n/**\n * Returns the inverse of the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to invert\n * @returns {vec3} out\n */\n\nexport function inverse(out, a) {\n  out[0] = 1.0 / a[0];\n  out[1] = 1.0 / a[1];\n  out[2] = 1.0 / a[2];\n  return out;\n}\n/**\n * Normalize a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to normalize\n * @returns {vec3} out\n */\n\nexport function normalize(out, a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  var len = x * x + y * y + z * z;\n\n  if (len > 0) {\n    //TODO: evaluate use of glm_invsqrt here?\n    len = 1 / Math.sqrt(len);\n  }\n\n  out[0] = a[0] * len;\n  out[1] = a[1] * len;\n  out[2] = a[2] * len;\n  return out;\n}\n/**\n * Calculates the dot product of two vec3's\n *\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {Number} dot product of a and b\n */\n\nexport function dot(a, b) {\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];\n}\n/**\n * Computes the cross product of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function cross(out, a, b) {\n  var ax = a[0],\n      ay = a[1],\n      az = a[2];\n  var bx = b[0],\n      by = b[1],\n      bz = b[2];\n  out[0] = ay * bz - az * by;\n  out[1] = az * bx - ax * bz;\n  out[2] = ax * by - ay * bx;\n  return out;\n}\n/**\n * Performs a linear interpolation between two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\n\nexport function lerp(out, a, b, t) {\n  var ax = a[0];\n  var ay = a[1];\n  var az = a[2];\n  out[0] = ax + t * (b[0] - ax);\n  out[1] = ay + t * (b[1] - ay);\n  out[2] = az + t * (b[2] - az);\n  return out;\n}\n/**\n * Performs a hermite interpolation with two control points\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {ReadonlyVec3} c the third operand\n * @param {ReadonlyVec3} d the fourth operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\n\nexport function hermite(out, a, b, c, d, t) {\n  var factorTimes2 = t * t;\n  var factor1 = factorTimes2 * (2 * t - 3) + 1;\n  var factor2 = factorTimes2 * (t - 2) + t;\n  var factor3 = factorTimes2 * (t - 1);\n  var factor4 = factorTimes2 * (3 - 2 * t);\n  out[0] = a[0] * factor1 + b[0] * factor2 + c[0] * factor3 + d[0] * factor4;\n  out[1] = a[1] * factor1 + b[1] * factor2 + c[1] * factor3 + d[1] * factor4;\n  out[2] = a[2] * factor1 + b[2] * factor2 + c[2] * factor3 + d[2] * factor4;\n  return out;\n}\n/**\n * Performs a bezier interpolation with two control points\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {ReadonlyVec3} c the third operand\n * @param {ReadonlyVec3} d the fourth operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\n\nexport function bezier(out, a, b, c, d, t) {\n  var inverseFactor = 1 - t;\n  var inverseFactorTimesTwo = inverseFactor * inverseFactor;\n  var factorTimes2 = t * t;\n  var factor1 = inverseFactorTimesTwo * inverseFactor;\n  var factor2 = 3 * t * inverseFactorTimesTwo;\n  var factor3 = 3 * factorTimes2 * inverseFactor;\n  var factor4 = factorTimes2 * t;\n  out[0] = a[0] * factor1 + b[0] * factor2 + c[0] * factor3 + d[0] * factor4;\n  out[1] = a[1] * factor1 + b[1] * factor2 + c[1] * factor3 + d[1] * factor4;\n  out[2] = a[2] * factor1 + b[2] * factor2 + c[2] * factor3 + d[2] * factor4;\n  return out;\n}\n/**\n * Generates a random vector with the given scale\n *\n * @param {vec3} out the receiving vector\n * @param {Number} [scale] Length of the resulting vector. If ommitted, a unit vector will be returned\n * @returns {vec3} out\n */\n\nexport function random(out, scale) {\n  scale = scale || 1.0;\n  var r = glMatrix.RANDOM() * 2.0 * Math.PI;\n  var z = glMatrix.RANDOM() * 2.0 - 1.0;\n  var zScale = Math.sqrt(1.0 - z * z) * scale;\n  out[0] = Math.cos(r) * zScale;\n  out[1] = Math.sin(r) * zScale;\n  out[2] = z * scale;\n  return out;\n}\n/**\n * Transforms the vec3 with a mat4.\n * 4th vector component is implicitly '1'\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to transform\n * @param {ReadonlyMat4} m matrix to transform with\n * @returns {vec3} out\n */\n\nexport function transformMat4(out, a, m) {\n  var x = a[0],\n      y = a[1],\n      z = a[2];\n  var w = m[3] * x + m[7] * y + m[11] * z + m[15];\n  w = w || 1.0;\n  out[0] = (m[0] * x + m[4] * y + m[8] * z + m[12]) / w;\n  out[1] = (m[1] * x + m[5] * y + m[9] * z + m[13]) / w;\n  out[2] = (m[2] * x + m[6] * y + m[10] * z + m[14]) / w;\n  return out;\n}\n/**\n * Transforms the vec3 with a mat3.\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to transform\n * @param {ReadonlyMat3} m the 3x3 matrix to transform with\n * @returns {vec3} out\n */\n\nexport function transformMat3(out, a, m) {\n  var x = a[0],\n      y = a[1],\n      z = a[2];\n  out[0] = x * m[0] + y * m[3] + z * m[6];\n  out[1] = x * m[1] + y * m[4] + z * m[7];\n  out[2] = x * m[2] + y * m[5] + z * m[8];\n  return out;\n}\n/**\n * Transforms the vec3 with a quat\n * Can also be used for dual quaternions. (Multiply it with the real part)\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to transform\n * @param {ReadonlyQuat} q quaternion to transform with\n * @returns {vec3} out\n */\n\nexport function transformQuat(out, a, q) {\n  // benchmarks: https://jsperf.com/quaternion-transform-vec3-implementations-fixed\n  var qx = q[0],\n      qy = q[1],\n      qz = q[2],\n      qw = q[3];\n  var x = a[0],\n      y = a[1],\n      z = a[2]; // var qvec = [qx, qy, qz];\n  // var uv = vec3.cross([], qvec, a);\n\n  var uvx = qy * z - qz * y,\n      uvy = qz * x - qx * z,\n      uvz = qx * y - qy * x; // var uuv = vec3.cross([], qvec, uv);\n\n  var uuvx = qy * uvz - qz * uvy,\n      uuvy = qz * uvx - qx * uvz,\n      uuvz = qx * uvy - qy * uvx; // vec3.scale(uv, uv, 2 * w);\n\n  var w2 = qw * 2;\n  uvx *= w2;\n  uvy *= w2;\n  uvz *= w2; // vec3.scale(uuv, uuv, 2);\n\n  uuvx *= 2;\n  uuvy *= 2;\n  uuvz *= 2; // return vec3.add(out, a, vec3.add(out, uv, uuv));\n\n  out[0] = x + uvx + uuvx;\n  out[1] = y + uvy + uuvy;\n  out[2] = z + uvz + uuvz;\n  return out;\n}\n/**\n * Rotate a 3D vector around the x-axis\n * @param {vec3} out The receiving vec3\n * @param {ReadonlyVec3} a The vec3 point to rotate\n * @param {ReadonlyVec3} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec3} out\n */\n\nexport function rotateX(out, a, b, rad) {\n  var p = [],\n      r = []; //Translate point to the origin\n\n  p[0] = a[0] - b[0];\n  p[1] = a[1] - b[1];\n  p[2] = a[2] - b[2]; //perform rotation\n\n  r[0] = p[0];\n  r[1] = p[1] * Math.cos(rad) - p[2] * Math.sin(rad);\n  r[2] = p[1] * Math.sin(rad) + p[2] * Math.cos(rad); //translate to correct position\n\n  out[0] = r[0] + b[0];\n  out[1] = r[1] + b[1];\n  out[2] = r[2] + b[2];\n  return out;\n}\n/**\n * Rotate a 3D vector around the y-axis\n * @param {vec3} out The receiving vec3\n * @param {ReadonlyVec3} a The vec3 point to rotate\n * @param {ReadonlyVec3} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec3} out\n */\n\nexport function rotateY(out, a, b, rad) {\n  var p = [],\n      r = []; //Translate point to the origin\n\n  p[0] = a[0] - b[0];\n  p[1] = a[1] - b[1];\n  p[2] = a[2] - b[2]; //perform rotation\n\n  r[0] = p[2] * Math.sin(rad) + p[0] * Math.cos(rad);\n  r[1] = p[1];\n  r[2] = p[2] * Math.cos(rad) - p[0] * Math.sin(rad); //translate to correct position\n\n  out[0] = r[0] + b[0];\n  out[1] = r[1] + b[1];\n  out[2] = r[2] + b[2];\n  return out;\n}\n/**\n * Rotate a 3D vector around the z-axis\n * @param {vec3} out The receiving vec3\n * @param {ReadonlyVec3} a The vec3 point to rotate\n * @param {ReadonlyVec3} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec3} out\n */\n\nexport function rotateZ(out, a, b, rad) {\n  var p = [],\n      r = []; //Translate point to the origin\n\n  p[0] = a[0] - b[0];\n  p[1] = a[1] - b[1];\n  p[2] = a[2] - b[2]; //perform rotation\n\n  r[0] = p[0] * Math.cos(rad) - p[1] * Math.sin(rad);\n  r[1] = p[0] * Math.sin(rad) + p[1] * Math.cos(rad);\n  r[2] = p[2]; //translate to correct position\n\n  out[0] = r[0] + b[0];\n  out[1] = r[1] + b[1];\n  out[2] = r[2] + b[2];\n  return out;\n}\n/**\n * Get the angle between two 3D vectors\n * @param {ReadonlyVec3} a The first operand\n * @param {ReadonlyVec3} b The second operand\n * @returns {Number} The angle in radians\n */\n\nexport function angle(a, b) {\n  var ax = a[0],\n      ay = a[1],\n      az = a[2],\n      bx = b[0],\n      by = b[1],\n      bz = b[2],\n      mag1 = Math.sqrt(ax * ax + ay * ay + az * az),\n      mag2 = Math.sqrt(bx * bx + by * by + bz * bz),\n      mag = mag1 * mag2,\n      cosine = mag && dot(a, b) / mag;\n  return Math.acos(Math.min(Math.max(cosine, -1), 1));\n}\n/**\n * Set the components of a vec3 to zero\n *\n * @param {vec3} out the receiving vector\n * @returns {vec3} out\n */\n\nexport function zero(out) {\n  out[0] = 0.0;\n  out[1] = 0.0;\n  out[2] = 0.0;\n  return out;\n}\n/**\n * Returns a string representation of a vector\n *\n * @param {ReadonlyVec3} a vector to represent as a string\n * @returns {String} string representation of the vector\n */\n\nexport function str(a) {\n  return \"vec3(\" + a[0] + \", \" + a[1] + \", \" + a[2] + \")\";\n}\n/**\n * Returns whether or not the vectors have exactly the same elements in the same position (when compared with ===)\n *\n * @param {ReadonlyVec3} a The first vector.\n * @param {ReadonlyVec3} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\n\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2];\n}\n/**\n * Returns whether or not the vectors have approximately the same elements in the same position.\n *\n * @param {ReadonlyVec3} a The first vector.\n * @param {ReadonlyVec3} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\n\nexport function equals(a, b) {\n  var a0 = a[0],\n      a1 = a[1],\n      a2 = a[2];\n  var b0 = b[0],\n      b1 = b[1],\n      b2 = b[2];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2));\n}\n/**\n * Alias for {@link vec3.subtract}\n * @function\n */\n\nexport var sub = subtract;\n/**\n * Alias for {@link vec3.multiply}\n * @function\n */\n\nexport var mul = multiply;\n/**\n * Alias for {@link vec3.divide}\n * @function\n */\n\nexport var div = divide;\n/**\n * Alias for {@link vec3.distance}\n * @function\n */\n\nexport var dist = distance;\n/**\n * Alias for {@link vec3.squaredDistance}\n * @function\n */\n\nexport var sqrDist = squaredDistance;\n/**\n * Alias for {@link vec3.length}\n * @function\n */\n\nexport var len = length;\n/**\n * Alias for {@link vec3.squaredLength}\n * @function\n */\n\nexport var sqrLen = squaredLength;\n/**\n * Perform some operation over an array of vec3s.\n *\n * @param {Array} a the array of vectors to iterate over\n * @param {Number} stride Number of elements between the start of each vec3. If 0 assumes tightly packed\n * @param {Number} offset Number of elements to skip at the beginning of the array\n * @param {Number} count Number of vec3s to iterate over. If 0 iterates over entire array\n * @param {Function} fn Function to call for each vector in the array\n * @param {Object} [arg] additional argument to pass to fn\n * @returns {Array} a\n * @function\n */\n\nexport var forEach = function () {\n  var vec = create();\n  return function (a, stride, offset, count, fn, arg) {\n    var i, l;\n\n    if (!stride) {\n      stride = 3;\n    }\n\n    if (!offset) {\n      offset = 0;\n    }\n\n    if (count) {\n      l = Math.min(count * stride + offset, a.length);\n    } else {\n      l = a.length;\n    }\n\n    for (i = offset; i < l; i += stride) {\n      vec[0] = a[i];\n      vec[1] = a[i + 1];\n      vec[2] = a[i + 2];\n      fn(vec, vec, arg);\n      a[i] = vec[0];\n      a[i + 1] = vec[1];\n      a[i + 2] = vec[2];\n    }\n\n    return a;\n  };\n}();","import * as glMatrix from \"./common.js\";\n/**\n * 4 Dimensional Vector\n * @module vec4\n */\n\n/**\n * Creates a new, empty vec4\n *\n * @returns {vec4} a new 4D vector\n */\n\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(4);\n\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[0] = 0;\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n  }\n\n  return out;\n}\n/**\n * Creates a new vec4 initialized with values from an existing vector\n *\n * @param {ReadonlyVec4} a vector to clone\n * @returns {vec4} a new 4D vector\n */\n\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(4);\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  return out;\n}\n/**\n * Creates a new vec4 initialized with the given values\n *\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @param {Number} w W component\n * @returns {vec4} a new 4D vector\n */\n\nexport function fromValues(x, y, z, w) {\n  var out = new glMatrix.ARRAY_TYPE(4);\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  out[3] = w;\n  return out;\n}\n/**\n * Copy the values from one vec4 to another\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the source vector\n * @returns {vec4} out\n */\n\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  return out;\n}\n/**\n * Set the components of a vec4 to the given values\n *\n * @param {vec4} out the receiving vector\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @param {Number} w W component\n * @returns {vec4} out\n */\n\nexport function set(out, x, y, z, w) {\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  out[3] = w;\n  return out;\n}\n/**\n * Adds two vec4's\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @returns {vec4} out\n */\n\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  out[3] = a[3] + b[3];\n  return out;\n}\n/**\n * Subtracts vector b from vector a\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @returns {vec4} out\n */\n\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  out[3] = a[3] - b[3];\n  return out;\n}\n/**\n * Multiplies two vec4's\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @returns {vec4} out\n */\n\nexport function multiply(out, a, b) {\n  out[0] = a[0] * b[0];\n  out[1] = a[1] * b[1];\n  out[2] = a[2] * b[2];\n  out[3] = a[3] * b[3];\n  return out;\n}\n/**\n * Divides two vec4's\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @returns {vec4} out\n */\n\nexport function divide(out, a, b) {\n  out[0] = a[0] / b[0];\n  out[1] = a[1] / b[1];\n  out[2] = a[2] / b[2];\n  out[3] = a[3] / b[3];\n  return out;\n}\n/**\n * Math.ceil the components of a vec4\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a vector to ceil\n * @returns {vec4} out\n */\n\nexport function ceil(out, a) {\n  out[0] = Math.ceil(a[0]);\n  out[1] = Math.ceil(a[1]);\n  out[2] = Math.ceil(a[2]);\n  out[3] = Math.ceil(a[3]);\n  return out;\n}\n/**\n * Math.floor the components of a vec4\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a vector to floor\n * @returns {vec4} out\n */\n\nexport function floor(out, a) {\n  out[0] = Math.floor(a[0]);\n  out[1] = Math.floor(a[1]);\n  out[2] = Math.floor(a[2]);\n  out[3] = Math.floor(a[3]);\n  return out;\n}\n/**\n * Returns the minimum of two vec4's\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @returns {vec4} out\n */\n\nexport function min(out, a, b) {\n  out[0] = Math.min(a[0], b[0]);\n  out[1] = Math.min(a[1], b[1]);\n  out[2] = Math.min(a[2], b[2]);\n  out[3] = Math.min(a[3], b[3]);\n  return out;\n}\n/**\n * Returns the maximum of two vec4's\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @returns {vec4} out\n */\n\nexport function max(out, a, b) {\n  out[0] = Math.max(a[0], b[0]);\n  out[1] = Math.max(a[1], b[1]);\n  out[2] = Math.max(a[2], b[2]);\n  out[3] = Math.max(a[3], b[3]);\n  return out;\n}\n/**\n * Math.round the components of a vec4\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a vector to round\n * @returns {vec4} out\n */\n\nexport function round(out, a) {\n  out[0] = Math.round(a[0]);\n  out[1] = Math.round(a[1]);\n  out[2] = Math.round(a[2]);\n  out[3] = Math.round(a[3]);\n  return out;\n}\n/**\n * Scales a vec4 by a scalar number\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the vector to scale\n * @param {Number} b amount to scale the vector by\n * @returns {vec4} out\n */\n\nexport function scale(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  out[2] = a[2] * b;\n  out[3] = a[3] * b;\n  return out;\n}\n/**\n * Adds two vec4's after scaling the second operand by a scalar value\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @param {Number} scale the amount to scale b by before adding\n * @returns {vec4} out\n */\n\nexport function scaleAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  out[2] = a[2] + b[2] * scale;\n  out[3] = a[3] + b[3] * scale;\n  return out;\n}\n/**\n * Calculates the euclidian distance between two vec4's\n *\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @returns {Number} distance between a and b\n */\n\nexport function distance(a, b) {\n  var x = b[0] - a[0];\n  var y = b[1] - a[1];\n  var z = b[2] - a[2];\n  var w = b[3] - a[3];\n  return Math.hypot(x, y, z, w);\n}\n/**\n * Calculates the squared euclidian distance between two vec4's\n *\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @returns {Number} squared distance between a and b\n */\n\nexport function squaredDistance(a, b) {\n  var x = b[0] - a[0];\n  var y = b[1] - a[1];\n  var z = b[2] - a[2];\n  var w = b[3] - a[3];\n  return x * x + y * y + z * z + w * w;\n}\n/**\n * Calculates the length of a vec4\n *\n * @param {ReadonlyVec4} a vector to calculate length of\n * @returns {Number} length of a\n */\n\nexport function length(a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  var w = a[3];\n  return Math.hypot(x, y, z, w);\n}\n/**\n * Calculates the squared length of a vec4\n *\n * @param {ReadonlyVec4} a vector to calculate squared length of\n * @returns {Number} squared length of a\n */\n\nexport function squaredLength(a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  var w = a[3];\n  return x * x + y * y + z * z + w * w;\n}\n/**\n * Negates the components of a vec4\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a vector to negate\n * @returns {vec4} out\n */\n\nexport function negate(out, a) {\n  out[0] = -a[0];\n  out[1] = -a[1];\n  out[2] = -a[2];\n  out[3] = -a[3];\n  return out;\n}\n/**\n * Returns the inverse of the components of a vec4\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a vector to invert\n * @returns {vec4} out\n */\n\nexport function inverse(out, a) {\n  out[0] = 1.0 / a[0];\n  out[1] = 1.0 / a[1];\n  out[2] = 1.0 / a[2];\n  out[3] = 1.0 / a[3];\n  return out;\n}\n/**\n * Normalize a vec4\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a vector to normalize\n * @returns {vec4} out\n */\n\nexport function normalize(out, a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  var w = a[3];\n  var len = x * x + y * y + z * z + w * w;\n\n  if (len > 0) {\n    len = 1 / Math.sqrt(len);\n  }\n\n  out[0] = x * len;\n  out[1] = y * len;\n  out[2] = z * len;\n  out[3] = w * len;\n  return out;\n}\n/**\n * Calculates the dot product of two vec4's\n *\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @returns {Number} dot product of a and b\n */\n\nexport function dot(a, b) {\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2] + a[3] * b[3];\n}\n/**\n * Returns the cross-product of three vectors in a 4-dimensional space\n *\n * @param {ReadonlyVec4} result the receiving vector\n * @param {ReadonlyVec4} U the first vector\n * @param {ReadonlyVec4} V the second vector\n * @param {ReadonlyVec4} W the third vector\n * @returns {vec4} result\n */\n\nexport function cross(out, u, v, w) {\n  var A = v[0] * w[1] - v[1] * w[0],\n      B = v[0] * w[2] - v[2] * w[0],\n      C = v[0] * w[3] - v[3] * w[0],\n      D = v[1] * w[2] - v[2] * w[1],\n      E = v[1] * w[3] - v[3] * w[1],\n      F = v[2] * w[3] - v[3] * w[2];\n  var G = u[0];\n  var H = u[1];\n  var I = u[2];\n  var J = u[3];\n  out[0] = H * F - I * E + J * D;\n  out[1] = -(G * F) + I * C - J * B;\n  out[2] = G * E - H * C + J * A;\n  out[3] = -(G * D) + H * B - I * A;\n  return out;\n}\n/**\n * Performs a linear interpolation between two vec4's\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec4} out\n */\n\nexport function lerp(out, a, b, t) {\n  var ax = a[0];\n  var ay = a[1];\n  var az = a[2];\n  var aw = a[3];\n  out[0] = ax + t * (b[0] - ax);\n  out[1] = ay + t * (b[1] - ay);\n  out[2] = az + t * (b[2] - az);\n  out[3] = aw + t * (b[3] - aw);\n  return out;\n}\n/**\n * Generates a random vector with the given scale\n *\n * @param {vec4} out the receiving vector\n * @param {Number} [scale] Length of the resulting vector. If ommitted, a unit vector will be returned\n * @returns {vec4} out\n */\n\nexport function random(out, scale) {\n  scale = scale || 1.0; // Marsaglia, George. Choosing a Point from the Surface of a\n  // Sphere. Ann. Math. Statist. 43 (1972), no. 2, 645--646.\n  // http://projecteuclid.org/euclid.aoms/1177692644;\n\n  var v1, v2, v3, v4;\n  var s1, s2;\n\n  do {\n    v1 = glMatrix.RANDOM() * 2 - 1;\n    v2 = glMatrix.RANDOM() * 2 - 1;\n    s1 = v1 * v1 + v2 * v2;\n  } while (s1 >= 1);\n\n  do {\n    v3 = glMatrix.RANDOM() * 2 - 1;\n    v4 = glMatrix.RANDOM() * 2 - 1;\n    s2 = v3 * v3 + v4 * v4;\n  } while (s2 >= 1);\n\n  var d = Math.sqrt((1 - s1) / s2);\n  out[0] = scale * v1;\n  out[1] = scale * v2;\n  out[2] = scale * v3 * d;\n  out[3] = scale * v4 * d;\n  return out;\n}\n/**\n * Transforms the vec4 with a mat4.\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the vector to transform\n * @param {ReadonlyMat4} m matrix to transform with\n * @returns {vec4} out\n */\n\nexport function transformMat4(out, a, m) {\n  var x = a[0],\n      y = a[1],\n      z = a[2],\n      w = a[3];\n  out[0] = m[0] * x + m[4] * y + m[8] * z + m[12] * w;\n  out[1] = m[1] * x + m[5] * y + m[9] * z + m[13] * w;\n  out[2] = m[2] * x + m[6] * y + m[10] * z + m[14] * w;\n  out[3] = m[3] * x + m[7] * y + m[11] * z + m[15] * w;\n  return out;\n}\n/**\n * Transforms the vec4 with a quat\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the vector to transform\n * @param {ReadonlyQuat} q quaternion to transform with\n * @returns {vec4} out\n */\n\nexport function transformQuat(out, a, q) {\n  var x = a[0],\n      y = a[1],\n      z = a[2];\n  var qx = q[0],\n      qy = q[1],\n      qz = q[2],\n      qw = q[3]; // calculate quat * vec\n\n  var ix = qw * x + qy * z - qz * y;\n  var iy = qw * y + qz * x - qx * z;\n  var iz = qw * z + qx * y - qy * x;\n  var iw = -qx * x - qy * y - qz * z; // calculate result * inverse quat\n\n  out[0] = ix * qw + iw * -qx + iy * -qz - iz * -qy;\n  out[1] = iy * qw + iw * -qy + iz * -qx - ix * -qz;\n  out[2] = iz * qw + iw * -qz + ix * -qy - iy * -qx;\n  out[3] = a[3];\n  return out;\n}\n/**\n * Set the components of a vec4 to zero\n *\n * @param {vec4} out the receiving vector\n * @returns {vec4} out\n */\n\nexport function zero(out) {\n  out[0] = 0.0;\n  out[1] = 0.0;\n  out[2] = 0.0;\n  out[3] = 0.0;\n  return out;\n}\n/**\n * Returns a string representation of a vector\n *\n * @param {ReadonlyVec4} a vector to represent as a string\n * @returns {String} string representation of the vector\n */\n\nexport function str(a) {\n  return \"vec4(\" + a[0] + \", \" + a[1] + \", \" + a[2] + \", \" + a[3] + \")\";\n}\n/**\n * Returns whether or not the vectors have exactly the same elements in the same position (when compared with ===)\n *\n * @param {ReadonlyVec4} a The first vector.\n * @param {ReadonlyVec4} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\n\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3];\n}\n/**\n * Returns whether or not the vectors have approximately the same elements in the same position.\n *\n * @param {ReadonlyVec4} a The first vector.\n * @param {ReadonlyVec4} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\n\nexport function equals(a, b) {\n  var a0 = a[0],\n      a1 = a[1],\n      a2 = a[2],\n      a3 = a[3];\n  var b0 = b[0],\n      b1 = b[1],\n      b2 = b[2],\n      b3 = b[3];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3));\n}\n/**\n * Alias for {@link vec4.subtract}\n * @function\n */\n\nexport var sub = subtract;\n/**\n * Alias for {@link vec4.multiply}\n * @function\n */\n\nexport var mul = multiply;\n/**\n * Alias for {@link vec4.divide}\n * @function\n */\n\nexport var div = divide;\n/**\n * Alias for {@link vec4.distance}\n * @function\n */\n\nexport var dist = distance;\n/**\n * Alias for {@link vec4.squaredDistance}\n * @function\n */\n\nexport var sqrDist = squaredDistance;\n/**\n * Alias for {@link vec4.length}\n * @function\n */\n\nexport var len = length;\n/**\n * Alias for {@link vec4.squaredLength}\n * @function\n */\n\nexport var sqrLen = squaredLength;\n/**\n * Perform some operation over an array of vec4s.\n *\n * @param {Array} a the array of vectors to iterate over\n * @param {Number} stride Number of elements between the start of each vec4. If 0 assumes tightly packed\n * @param {Number} offset Number of elements to skip at the beginning of the array\n * @param {Number} count Number of vec4s to iterate over. If 0 iterates over entire array\n * @param {Function} fn Function to call for each vector in the array\n * @param {Object} [arg] additional argument to pass to fn\n * @returns {Array} a\n * @function\n */\n\nexport var forEach = function () {\n  var vec = create();\n  return function (a, stride, offset, count, fn, arg) {\n    var i, l;\n\n    if (!stride) {\n      stride = 4;\n    }\n\n    if (!offset) {\n      offset = 0;\n    }\n\n    if (count) {\n      l = Math.min(count * stride + offset, a.length);\n    } else {\n      l = a.length;\n    }\n\n    for (i = offset; i < l; i += stride) {\n      vec[0] = a[i];\n      vec[1] = a[i + 1];\n      vec[2] = a[i + 2];\n      vec[3] = a[i + 3];\n      fn(vec, vec, arg);\n      a[i] = vec[0];\n      a[i + 1] = vec[1];\n      a[i + 2] = vec[2];\n      a[i + 3] = vec[3];\n    }\n\n    return a;\n  };\n}();","import { Human } from '../modifier/Human'\nimport { vec3, mat4, vec4 } from 'gl-matrix'\nimport { getMatrix, get_normal } from './loadSkeleton'\nimport { Skeleton } from \"./Skeleton\"\n\nexport class Bone {\n    skeleton: Skeleton\n    name: string\n    index: number = -1;\n    headJoint: string\n    tailJoint: string\n    headPos = [0, 0, 0];\n    tailPos = [0, 0, 0];\n    roll: string | Array<string>\n    length = 0;\n    yvector4?: vec4 // direction vector of this bone\n\n    parent?: Bone\n    children: Bone[] = [];\n\n    level: number\n    reference_bones = [];\n\n    // user defined value\n    matPose: mat4\n\n    // calculated rest position\n    matRestGlobal?: mat4   // bone relative to world\n    matRestRelative?: mat4 // bone relative to parent\n    // calculated pose positions\n    matPoseGlobal?: mat4 // relative to world\n    matPoseVerts?: mat4 // relative to world and own rest pose, used for skinning\n\n    // shared/skeleton.py: 709\n    constructor(\n        skeleton: Skeleton,\n        name: string,\n        parentName: string | null,\n        headJoint: string,\n        tailJoint: string,\n        roll: string,\n        reference_bones?: any,\n        weight_reference_bones?: any) {\n        this.skeleton = skeleton\n        this.name = name\n        this.headJoint = headJoint\n        this.tailJoint = tailJoint\n        this.roll = roll\n\n        this.updateJointPositions()\n\n        if (parentName !== null) {\n            this.parent = this.skeleton.getBone(parentName)\n            this.parent!.children.push(this)\n        }\n\n        if (this.parent) {\n            this.level = this.parent.level + 1\n        } else {\n            this.level = 0\n        }\n\n        // self.reference_bones = []  # Used for mapping animations and poses\n        // if reference_bones is not None:\n        //     if not isinstance(reference_bones, list):\n        //         reference_bones = [ reference_bones ]\n        //     self.reference_bones.extend( set(reference_bones) )\n        // self._weight_reference_bones = None  # For mapping vertex weights (can be automatically set by c\n        // if weight_reference_bones is not None:\n        //     if not isinstance(weight_reference_bones, list):\n        //         weight_reference_bones = [ weight_reference_bones ]\n        //     self._weight_reference_bones = list( set(weight_reference_bones) )\n\n        this.matPose = mat4.identity(mat4.create()) // not posed yet\n    }\n\n    get planes(): Map<string, Array<string>> {\n        return this.skeleton.planes\n    }\n\n    // line 768\n    // Update the joint positions of this bone based on the current state\n    // of the human mesh.\n    // Remember to call build() after calling this method.\n    updateJointPositions(in_rest: boolean = true) {\n        // if not human:\n        //   from core import G\n        //   human = G.app.selectedHuman\n        // self.headPos[:] = self.skeleton.getJointPosition(self.headJoint, human, in_rest)[:3] * self.skeleton.scale\n        // self.tailPos[:] = self.skeleton.getJointPosition(self.tailJoint, human, in_rest)[:3] * self.skeleton.scale\n        this.headPos = this.skeleton.getJointPosition(this.headJoint, in_rest)!\n        this.tailPos = this.skeleton.getJointPosition(this.tailJoint, in_rest)!\n    }\n\n    // line 826\n    // called from Skeleton.build(ref_skel), which is called from Skeleton.constructor()\n    // Calculate this bone's rest matrices and determine its local axis (roll\n    // or bone normal).\n    // Sets matPoseVerts, matPoseGlobal and matRestRelative.\n    // This method needs to be called everytime the skeleton structure is\n    // changed, the rest pose is changed or joint positions are updated.\n    // Pass a ref_skel to copy the bone normals from a reference skeleton\n    // instead of recalculating them (Recalculating bone normals generally\n    // only works if the skeleton is in rest pose).\n    build(ref_skel?: any) {\n        const head3 = vec3.fromValues(this.headPos[0], this.headPos[1], this.headPos[2])\n        const tail3 = vec3.fromValues(this.tailPos[0], this.tailPos[1], this.tailPos[2])\n\n        let normal\n        if (ref_skel) {\n            throw Error(\"not implemented yet\")\n        } else {\n            normal = this.get_normal()\n        }\n        this.matRestGlobal = getMatrix(head3, tail3, normal)\n        this.length = vec3.distance(head3, tail3)\n        if (this.parent === undefined) {\n            this.matRestRelative = this.matRestGlobal\n        } else {\n            this.matRestRelative =\n                mat4.mul(\n                    mat4.create(),\n                    mat4.invert(mat4.create(), this.parent.matRestGlobal!),\n                    this.matRestGlobal\n                )\n        }\n        this.yvector4 = vec4.fromValues(0, this.length, 0, 1)\n    }\n\n    // calculate matPoseGlobal & matPoseVerts\n    update() {\n        if (this.parent !== undefined) {\n            this.matPoseGlobal =\n                mat4.multiply(mat4.create(), this.parent.matPoseGlobal!,\n                    mat4.multiply(mat4.create(), this.matRestRelative!, this.matPose!))\n        } else {\n            this.matPoseGlobal = mat4.multiply(mat4.create(), this.matRestRelative!, this.matPose!)\n        }\n        this.matPoseVerts = mat4.multiply(mat4.create(), this.matPoseGlobal,\n            mat4.invert(mat4.create(), this.matRestGlobal!))\n    }\n\n    get_normal(): vec3 {\n        let normal\n        if (this.roll instanceof Array) {\n            throw Error(\"Not implemented yet\")\n            // # Average the normal over multiple planes\n            // count = 0\n            // normal = np.zeros(3, dtype=np.float32)\n            // for plane_name in self.roll:\n            //     norm = get_normal(self.skeleton, plane_name, self.planes)\n            //     if not np.allclose(norm, np.zeros(3), atol=1e-05):\n            //         count += 1\n            //         normal += norm\n            // if count > 0 and not np.allclose(normal, np.zeros(3), atol=1e-05):\n            //     normal /= count\n            // else:\n            //     normal = np.asarray([0.0, 1.0, 0.0], dtype=np.float32)\n        }\n        else if (typeof this.roll === \"string\") {\n            const plane_name = this.roll // TODO ugly.. why not call this something else than \"roll\"?\n            normal = get_normal(this.skeleton, plane_name, this.planes)\n            // if np.allclose(normal, np.zeros(3), atol=1e-05):\n            //     normal = np.asarray([0.0, 1.0, 0.0], dtype=np.float32)\n        } else {\n            normal = vec3.fromValues(0, 1, 0)\n        }\n        return normal\n    }\n}\n","import { Human } from '../modifier/Human'\nimport { FileSystemAdapter } from '../filesystem/FileSystemAdapter'\nimport { vec3, mat4 } from 'gl-matrix'\nimport { Skeleton } from './Skeleton'\nimport { HumanMesh } from '../mesh/HumanMesh'\n\nexport function loadSkeleton(scene: HumanMesh, filename: string) {\n    const root = parseSkeleton(\n        scene,\n        FileSystemAdapter.getInstance().readFile(filename),\n        filename)\n    console.log(`Loaded skeleton with ${root.bones.size} bones from file ${filename}`)\n    return root\n}\n\nexport function parseSkeleton(scene: HumanMesh, data: string, filename = 'memory') {\n    let json\n    try {\n        json = JSON.parse(data)\n    }\n    catch (error) {\n        console.log(`Failed to parse JSON in ${filename}:\\n${data.substring(0, 256)}`)\n        throw error\n    }\n    return new Skeleton(scene, filename, json)\n}\n\nexport interface FileInformation {\n    name: string\n    version: string\n    tags?: string[]\n    description: string\n    copyright: string\n    license: string\n}\n\nfunction a2vec3(a: number[] | undefined) {\n    if (a === undefined) {\n        throw Error()\n    }\n    return vec3.fromValues(a[0], a[1], a[2])\n}\n\nexport function getMatrix(head: vec3, tail: vec3, normal: vec3): mat4 {\n    let bone_direction = vec3.subtract(vec3.create(), tail, head)\n    vec3.normalize(bone_direction, bone_direction)\n    const norm = vec3.normalize(vec3.create(), normal)\n    const z_axis = vec3.normalize(vec3.create(), vec3.cross(vec3.create(), norm, bone_direction))\n    const x_axis = vec3.normalize(vec3.create(), vec3.cross(vec3.create(), bone_direction, z_axis))\n    return mat4.fromValues(\n        x_axis[0], x_axis[1], x_axis[2], 0,                         // bone local X axis\n        bone_direction[0], bone_direction[1], bone_direction[2], 0, // bone local Y axis\n        z_axis[0], z_axis[1], z_axis[2], 0,                         // bone local Z axis\n        head[0], head[1], head[2], 1                                // head position as translation\n    )\n}\n\n// Return the normal of a triangle plane defined between three joint positions,\n// using counter-clockwise winding order (right-handed).\nexport function get_normal(skel: Skeleton, plane_name: string, plane_defs: Map<string, Array<string>>) {\n    if (!plane_defs.has(plane_name)) {\n        console.warn(`No plane with name ${plane_name} defined for skeleton.`)\n        vec3.fromValues(0, 1, 0)\n    }\n    const joint_names = plane_defs.get(plane_name)!\n    const [j1, j2, j3] = joint_names\n    const p1 = vec3.scale(vec3.create(), a2vec3(skel.getJointPosition(j1)), skel.scale)\n    const p2 = vec3.scale(vec3.create(), a2vec3(skel.getJointPosition(j2)), skel.scale)\n    const p3 = vec3.scale(vec3.create(), a2vec3(skel.getJointPosition(j3)), skel.scale)\n    const pvec = vec3.normalize(vec3.create(), vec3.subtract(vec3.create(), p2, p1))\n    const yvec = vec3.normalize(vec3.create(), vec3.subtract(vec3.create(), p3, p2))\n    return vec3.normalize(vec3.create(), vec3.cross(vec3.create(), yvec, pvec))\n}\n\n// // line 1368\n// // Get the position of a joint from the human mesh.\n// // This position is determined by the center of the joint helper with the\n// // specified name.\n// // Note: you probably want to use Skeleton.getJointPosition()\n// export function _getHumanJointPosition(human: Human, jointName: string, rest_coord = true): number[] {\n//     throw Error(`NOT IMPLEMENTED: _getHumanJointPosition(..., jointName='${jointName}', rest_coord=${rest_coord})`)\n//     // if (!jointName.startsWith(\"joint-\")) {\n//     //     jointName = \"joint-\" + jointName\n//     // }\n//     const fg = human.meshData.getFaceGroup(jointName)\n//     if (fg === undefined) {\n//         console.warn(`Cannot find position for joint ${jointName}`)\n//         console.log(human.meshData)\n//         return [0, 0, 0]\n//     }\n//     console.log(`found face group for joint ${jointName}`)\n//     // human.obj.group.get()\n//     // fg = human.meshData.getFaceGroup(jointName)\n//     // if fg is None:\n//     //     log.warning('Cannot find position for joint %s', jointName)\n//     //     return np.asarray([0,0,0], dtype=np.float32)\n//     // v_idx = human.meshData.getVerticesForGroups([fg.name])\n//     // if rest_coord:\n//     //     verts = human.getRestposeCoordinates()[v_idx]\n//     // else:\n//     //     verts = human.meshData.getCoords(v_idx)\n//     // return verts.mean(axis=0)\n// }","import { FileInformation } from './loadSkeleton'\n\n// makehuman/shared/skeleton.py\n// General skeleton, rig or armature class.\n// A skeleton is a hierarchic structure of bones, defined between a head and tail\n// joint position. Bones can be detached from each other (their head joint doesn't\n// necessarily need to be at the same position as the tail joint of their parent\n// bone).\n// A pose can be applied to the skeleton by setting a pose matrix for each of the\n// bones, allowing static posing or animation playback.\n// The skeleton supports skinning of a mesh using a list of vertex-to-bone\n// assignments.\n// skeleton file\n//   data: bones, joints, planes, weights_file, plane_map_strategy\n//   info: name, version, tags, description, copyright, license\n// weights files\n//   data: weights\n//   info: name, version, description, copyright, license\n\n// Map<boneName, [vertexIndex[], vertexWeight[]]\n//                ^              ^\n//                |              how much the vertex is influenced by the bone\n//                index of vertex influenced by the bone\nexport type VertexBoneMapping = Map<string, Array<Array<number>>>\n\nexport class VertexBoneWeights {\n    info!: FileInformation\n    _vertexCount!: number\n    _data: VertexBoneMapping\n    constructor(filename: string, data: any) {\n        // data.weights = []\n        console.log(`VertexBoneWeights: filename='${filename}', data=${data}`)\n        if (data.name) {\n            this.info = {\n                name: data.name,\n                version: data.version,\n                // tags: data.tags,\n                description: data.description,\n                copyright: data.copyright,\n                license: data.license,\n            }\n        }\n        this._data = this._build_vertex_weights_data(data.weights)\n        this._calculate_num_weights()\n    }\n\n    // name -> [[i,w]], ...]\n    protected _build_vertex_weights_data(vertexWeightsDict: any, vertexCount: number | undefined = undefined, rootBone: string = \"root\"): VertexBoneMapping {\n        const WEIGHT_THRESHOLD = 1e-4 // Threshold for including bone weight\n\n        if (vertexWeightsDict === undefined) {\n            throw Error(`vertexWeightsDict must not be undefined`)\n        }\n\n        // first_entry = list(vertexWeightsDict.keys())[0] if len(vertexWeightsDict) > 0 else None\n        // if len(vertexWeightsDict) > 0 and \\\n        //    len(vertexWeightsDict[first_entry]) == 2 and \\\n        //    isinstance(vertexWeightsDict[first_entry], tuple) and \\\n        //    isinstance(vertexWeightsDict[first_entry][1], np.ndarray) and \\\n        //    isinstance(vertexWeightsDict[first_entry][2], np.ndarray):\n        //     # Input dict is already in the expected format, presume it does not\n        //     # need to be built again\n        //     if vertexCount is not None:\n        //         self._vertexCount = vertexCount\n        //     else:\n        //         self._vertexCount = max([vn for vg in list(vertexWeightsDict.values()) for vn in vg[0]])+1\n        //     return vertexWeightsDict\n\n        // calculate vertex count\n        let vcount: number\n        if (vertexCount !== undefined) {\n            vcount = vertexCount\n        } else {\n            vcount = 0\n            for (let bone_name of Object.getOwnPropertyNames(vertexWeightsDict)) {\n                const weight_list = vertexWeightsDict[bone_name]\n                weight_list.forEach((item: any) => {\n                    const vertex_index = item[0]\n                    vcount = Math.max(vcount, vertex_index)\n                })\n            }\n            ++vcount\n        }\n        this._vertexCount = vcount\n\n        // prepare to normalize weights by calculating the total weight for each bone\n        const totalWeightPerVertex = new Array<number>(vcount).fill(0)\n        for (let bone_name of Object.getOwnPropertyNames(vertexWeightsDict)) {\n            const weight_list = vertexWeightsDict[bone_name]\n            weight_list.forEach((item: any) => {\n                const vertex_index = item[0]\n                const vertex_weight = item[1]\n                totalWeightPerVertex[vertex_index] += vertex_weight\n            })\n        }\n\n        const boneWeights: VertexBoneMapping = new Map<string, any>()\n        for (let bname of Object.getOwnPropertyNames(vertexWeightsDict)) {\n            const vgroup = vertexWeightsDict[bname]\n            if (vgroup.length === 0) {\n                continue\n            }\n            let weights: number[] = [], verts: number[] = [], v_lookup = new Map<number, number>(), n = 0\n            for (let [vn, w] of vgroup) {\n                const wn = w / totalWeightPerVertex[vn]\n                if (!v_lookup.has(vn)) {\n                    v_lookup.set(vn, verts.length)\n                    verts.push(vn)\n                    weights.push(wn)\n                } else {\n                    const v_idx = v_lookup.get(vn)!\n                    weights[v_idx] += wn\n                }\n            }\n            // filter out weights under the threshold and sort by vertex index\n            const i_s = weights\n                .map((weight, index) => weight > WEIGHT_THRESHOLD ? index : undefined)\n                .filter(index => index !== undefined)\n                .sort((a, b) => verts[a!] - verts[b!])\n\n            verts = i_s.map(i => verts[i!])\n            weights = i_s.map(i => weights[i!])\n            boneWeights.set(bname, [verts, weights])\n        }\n\n        // assign unweighted vertices to root bone with weight 1\n        let vs: number[], ws: number[]\n        if (!boneWeights.has(rootBone)) {\n            vs = []\n            ws = []\n        } else {\n            [vs, ws] = boneWeights.get(rootBone)!\n        }\n        const rw_i = totalWeightPerVertex\n            .map((value, index) => value === 0 ? index : -1)\n            .filter(index => index >= 0)\n        vs = vs.concat(rw_i)\n        ws = ws.concat(new Array<number>(rw_i.length).fill(1))\n        if (rw_i.length > 0) {\n            if (rw_i.length < 100) {\n                // To avoid spamming the log, only print vertex indices if there's less than 100\n                console.log(`Adding trivial bone weights to root bone ${rootBone} for ${rw_i.length} unweighted vertices. [${rw_i}]`) // ', '.join([str(s) for s in rw_i]))`)\n            } else {\n                console.log(`Adding trivial bone weights to root bone ${rootBone} for ${rw_i.length} unweighted vertices.`)\n            }\n        }\n        if (vs.length > 0) {\n            boneWeights.set(rootBone, [vs, ws])\n        }\n\n        return boneWeights\n    }\n\n    protected _calculate_num_weights() {\n    }\n}\n","import { Bone } from './Bone'\nimport { FileInformation } from './loadSkeleton'\nimport { FileSystemAdapter } from '../filesystem/FileSystemAdapter'\nimport { VertexBoneWeights, VertexBoneMapping } from './VertexBoneWeights'\nimport { vec3 } from 'gl-matrix'\nimport { HumanMesh } from '../mesh/HumanMesh'\n\nexport class Skeleton {\n    scene: HumanMesh\n\n    info: FileInformation\n\n    bones = new Map<string, Bone>(); // Bone lookup list by name\n    boneslist?: Bone[] // Breadth-first ordered list of all bones\n    roots: Bone[] = []; // bones with no parents (aka root bones) of this skeleton, a skeleton can have multiple root bones.\n\n    joint_pos_idxs = new Map<string, Array<number>>(); // Lookup by joint name referencing vertex indices on the human, to determine joint position\n    planes = new Map<string, string[]>(); // Named planes defined between joints, used for calculating bone roll angle\n    plane_map_strategy?: number = 3; // The remapping strategy used by addReferencePlanes() for remapping orientation planes from a reference skeleton\n\n    vertexWeights?: VertexBoneWeights\n    // Source vertex weights, defined on the basemesh, for this skeleton\n    has_custom_weights = false; // True if this skeleton has its own .mhw file\n\n    scale: number = 1;\n\n    // makehuman/shared/skeleton.py:88 fromFile()\n    constructor(scene: HumanMesh, filename: string, data: any) {\n        this.scene = scene\n        this.info = {\n            name: data.name,\n            version: data.version,\n            tags: data.tags,\n            description: data.description,\n            copyright: data.copyright,\n            license: data.license,\n        }\n        this.plane_map_strategy = data.plane_map_strategy\n\n        //\n        // joint_pos_idxs[name] := vertex index\n        //\n        // console.log(Object.getOwnPropertyNames(data.joints).length)\n        for (let joint_name of Object.getOwnPropertyNames(data.joints)) {\n            // console.log(joint_name)\n            const v_idxs = data.joints[joint_name]\n            if (v_idxs && v_idxs.length > 0) {\n                this.joint_pos_idxs.set(joint_name, v_idxs)\n            }\n        }\n        console.log(`Skeleton.construction(): this.joint_pos_idxs.size = ${this.joint_pos_idxs.size}`)\n\n        // planes[name] = ...\n        for (let plane of Object.getOwnPropertyNames(data.planes)) {\n            this.planes.set(plane, data.planes[plane])\n        }\n\n        // Order bones breadth-first (parents preceed children)\n        const breadthfirst_bones_set = new Set<string>()\n        const breadthfirst_bones = new Array<string>()\n        let prev_len = -1 // anti-deadlock\n        while (breadthfirst_bones_set.size != data.bones.length && prev_len != breadthfirst_bones_set.size) {\n            prev_len = breadthfirst_bones_set.size\n            for (let bone_name of Object.getOwnPropertyNames(data.bones)) {\n                const bone_defs = data.bones[bone_name]\n                if (!breadthfirst_bones_set.has(bone_name)) {\n                    const parent = bone_defs[\"parent\"]\n                    if (parent !== null && typeof parent !== \"string\") {\n                        console.log(`Bone '${bone_name}' has invalid parent '${parent}'`)\n                        continue\n                    }\n                    if (parent === null) { // root bone\n                        breadthfirst_bones_set.add(bone_name)\n                        breadthfirst_bones.push(bone_name)\n                    }\n                    else if (breadthfirst_bones_set.has(parent)) { // parent has already been added\n                        breadthfirst_bones_set.add(bone_name)\n                        breadthfirst_bones.push(bone_name)\n                    }\n                }\n            }\n        }\n        if (breadthfirst_bones_set.size !== Object.getOwnPropertyNames(data.bones).length) {\n            let missing = []\n            for (let bname in data.bones) {\n                if (!breadthfirst_bones_set.has(bname)) {\n                    missing.push(bname)\n                }\n            }\n            console.log(`Some bones defined in file '${filename}' could not be added to skeleton '${this.info.name}', because they have an invalid parent bone (${missing})`)\n        }\n\n        console.log(`breadthfirst_bones.length: ${breadthfirst_bones.length}`)\n\n        // for bone_name in breadthfirst_bones:\n        //     bone_defs = skelData[\"bones\"][bone_name]\n        //     rotation_plane = bone_defs.get(\"rotation_plane\", 0) // is 0 the default?\n        //     if rotation_plane == [None, None, None]:\n        //         log.warning(\"Invalid rotation plane specified for bone %s. Please make sure that you edited the .mhskel file by hand to include roll plane joints.\" % bone_name)\n        //         rotation_plane = 0\n        //     self.addBone(bone_name, bone_defs.get(\"parent\", None), bone_defs[\"head\"], bone_defs[\"tail\"], rotation_plane, bone_defs.get(\"reference\",None), bone_defs.get(\"weights_reference\",None))\n        for (let bone_name of breadthfirst_bones) {\n            const bone_defs = data.bones[bone_name]\n            let rotation_plane = bone_defs.rotation_plane\n            // This data was intended to be filled by hand in file exported with \n            //   https://github.com/makehumancommunity/makehuman-utils/blob/master/io_mhrigging_mhskel/export_mh_rigging.py\n            // from Blender\n            // if rotation_plane == [None, None, None]\n            if (typeof rotation_plane !== \"string\") {\n                console.log(`Invalid rotation plane '${JSON.stringify(rotation_plane)}' specified for bone ${bone_name}. Please make sure that you edited the .mhskel file by hand to include roll plane joints.\"`)\n                rotation_plane = null\n            }\n            // console.log(`${bone_name}, parent=${bone_defs.parent}, head=${bone_defs.head}, tail=${bone_defs.tail}, rotation_plane=${rotation_plane}, reference=${bone_defs.reference}, weights_reference=${bone_defs.reference}`)\n            this.addBone(bone_name, bone_defs.parent, bone_defs.head, bone_defs.tail, rotation_plane, bone_defs.reference, bone_defs.weights_reference)\n        }\n\n        this.build()\n\n        const weights_file = data[\"weights_file\"]\n        if (weights_file !== undefined) {\n            // FIXME: copy'n pasted into Proxy\n            const filename = `data/rigs/${weights_file}`\n            const data = FileSystemAdapter.getInstance().readFile(filename)\n            let json\n            try {\n                json = JSON.parse(data)\n            }\n            catch (error) {\n                console.log(`Failed to parse JSON in ${filename}:\\n${data.substring(0, 256)}`)\n                throw error\n            }\n            this.vertexWeights = new VertexBoneWeights(filename, json)\n            this.has_custom_weights = true\n            console.log(`loaded weights...`)\n            //     weights_file = getpath.thoroughFindFile(weights_file, os.path.dirname(getpath.canonicalPath(filepath)), True)\n            //     self.vertexWeights = VertexBoneWeights.fromFile(weights_file, mesh.getVertexCount() if mesh else None, rootBone=self.roots[0].name)\n            //     self.has_custom_weights = True\n        }\n    }\n\n    // line 122: toFile(self, filename, ref_weights=None)\n    // line 192: getVertexWeights(self, referenceWeights=None, force_remap=False)\n    // line 266: hasCustomVertexWeights(self)\n    // line 269: autoBuildWeightReferences(self, referenceSkel)\n    // line 341: addReferencePlanes(self, referenceSkel)\n    // skeleton.py, line 421: getJointPosition(self, joint_name, human, rest_coord=True)\n    // Calculate the position of specified named joint from the current\n    // state of the human mesh. If this skeleton contains no vertex mapping\n    // for that joint name, it falls back to looking for a vertex group in the\n    // human basemesh with that joint name.\n    // okay, so in the .mhskel file, [\"joints\"][joint_name][\"head\"|\"tail\"] will point to a list of\n    // indices into mesh.coord, whose coords surround the head|tail position\n    getJointPosition(joint_name: string, rest_coord = true): number[] {\n        if (this.joint_pos_idxs.has(joint_name)) {\n            // console.log(`Skeleton.getJointPosition(joint_name='${joint_name}', human=${human}, rest_coord=${rest_coord}) -> from skeleton`)\n            const v_idx = this.joint_pos_idxs.get(joint_name)!\n            // \n            let verts\n            if (rest_coord) {\n                const meshCoords = this.scene.getRestposeCoordinates()\n                verts = v_idx.map(i => {\n                    i = i * 3\n                    return [meshCoords[i], meshCoords[i + 1], meshCoords[i + 2]]\n                })\n                // console.log(verts.length)\n                // console.log(verts)\n            } else {\n                throw Error(`NOT IMPLEMENTED YET`)\n                // verts = human.meshData.getCoords(v_idx)\n            }\n            // return verts.mean(axis=0)\n            let x = 0, y = 0, z = 0\n            verts.forEach(v => {\n                x += v[0]\n                y += v[1]\n                z += v[2]\n            })\n            x /= verts.length\n            y /= verts.length\n            z /= verts.length\n            return [x, y, z]\n        }\n        throw Error(`not implemented`)\n        // console.log(`Skeleton.getJointPosition(joint_name='${joint_name}', human=${human}, rest_coord=${rest_coord}) -> from base mesh`)\n        // return _getHumanJointPosition(human, joint_name, rest_coord)\n    }\n\n    // makehuman/shared/skeleton.py:518\n    // Rebuild bone rest matrices and determine local bone orientation\n    // (roll or bone normal). Pass a ref_skel to copy the bone orientation from\n    // the reference skeleton to the bones of this skeleton.\n    build(ref_skel?: any) {\n        this.boneslist = undefined\n        for (const bone of this.getBones()) {\n            bone.build(ref_skel)\n        }\n    }\n\n    update() {\n        for (const bone of this.getBones()) {\n            bone.update()\n        }\n    }\n\n    updateJoints() {\n        for (const bone of this.getBones()) {\n            bone.updateJointPositions()\n        }\n    }\n\n    // line 631\n    // Returns linear list of all bones in breadth-first order.\n    getBones(): Bone[] {\n        if (this.boneslist === undefined) {\n            this.boneslist = this.buildBoneList()\n        }\n        return this.boneslist\n    }\n\n    // makehuman/shared/skeleton.py:518: __cacheGetBones()\n    private buildBoneList(): Bone[] {\n        const result: Bone[] = []\n        let queue = [...this.roots]\n        while (queue.length > 0) {\n            const bone = queue.shift()!\n            bone.index = result.length\n            result.push(bone)\n            queue = queue.concat(...bone!.children)\n        }\n        return result\n    }\n\n    // line 509\n    addBone(\n        name: string,\n        parentName: string,\n        headJoint: string,\n        tailJoint: string,\n        roll: string,\n        reference_bones?: any,\n        weight_reference_bones?: any) {\n        // if name in list(self.bones.keys()):\n        //     raise RuntimeError(\"The skeleton %s already contains a bone named %s.\" % (self.__repr__(), name))\n        // bone = Bone(self, name, parentName, headJoint, tailJoint, roll, reference_bones, weight_reference_bones)\n        // self.bones[name] = bone\n        // if not parentName:\n        //     self.roots.append(bone)\n        // return bone\n        if (name in this.bones) {\n            throw Error(`The skeleton ${this.info.name} already contains a bone named ${name}.`)\n        }\n        const bone = new Bone(this, name, parentName, headJoint, tailJoint, roll, reference_bones, weight_reference_bones)\n        this.bones.set(name, bone)\n        if (!parentName) {\n            this.roots.push(bone)\n        }\n        return bone\n    }\n\n    // line 666\n    getBone(name: string): Bone {\n        const bone = this.bones.get(name)\n        if (bone === undefined) {\n            console.trace(`Skeleton.getBone(${name}): no such bone`)\n            throw Error(`Skeleton.getBone(${name}): no such bone`)\n        }\n        return bone\n    }\n\n    skinMesh(meshCoords: number[], vertBoneMapping: VertexBoneMapping): number[] {\n        const coords = new Array<number>(meshCoords.length).fill(0)\n        for (let [bname, mapping] of vertBoneMapping.entries()) {\n            const [verts, weights] = mapping\n            const bone = this.getBone(bname)\n            for (let i = 0; i < verts.length; ++i) {\n                const vert = verts[i] * 3\n                const weight = weights[i]\n                const vec = vec3.transformMat4(\n                    vec3.create(),\n                    vec3.fromValues(meshCoords[vert], meshCoords[vert + 1], meshCoords[vert + 2]),\n                    bone.matPoseVerts!)\n                coords[vert] += vec[0] * weight\n                coords[vert+1] += vec[1] * weight\n                coords[vert+2] += vec[2] * weight\n            }\n        }\n        return coords\n    }\n}\n","import { TargetRef } from './TargetRef'\n\n// {'data/targets/buttocks/buttocks-volume-decr.target': -0.0, 'data/targets/buttocks/buttocks-volume-incr.target': 0.5}\n\nexport function getTargetWeights(targets: TargetRef[], factors: Map<string, number>, value = 1.0, ignoreNotfound = false) {\n    // console.log(`getTargetWeights(..,..,${value}, ${ignoreNotfound})\"`)\n    const result = new Map<string, number>()\n    if (ignoreNotfound) {\n        targets.forEach((e) => {\n            // console.log([1, 2, 5].reduce( (a, v) => a*v))\n            // for factors in tfactors\n            let mul = 1\n            e.factorDependencies.forEach(factor => {\n                const f = factors.get(factor)\n                if (f !== undefined) {\n                    mul *= f\n                } else {\n                    console.log(`no factor for '${factor}'`)\n                }\n            })\n            result.set(e.targetPath, value * mul) \n        })\n        //     for (tpath, tfactors) in targets:\n        //         result[tpath] = value * reduce(operator.mul, [factors.get(factor, 1.0) for factor in tfactors])\n    } else {\n        targets.forEach((e) => {\n            // console.log([1, 2, 5].reduce( (a, v) => a*v))\n            // for factors in tfactors\n            let mul = 1\n            e.factorDependencies.forEach(factor => {\n                let f = factors.get(factor)\n                if (f === undefined) {\n                    console.log(`no factor for ${factor}`)\n                    f = 1/3\n                }\n                mul *= f || 0\n            })\n            result.set(e.targetPath, value * mul)\n        })\n    }\n    // console.log(result)\n    return result\n}\n","export class Reference {\n    constructor(object, attribute) {\n        this.object = object;\n        this.attribute = attribute.toString();\n    }\n    get() {\n        return this.object[this.attribute];\n    }\n    set(value) {\n        Object.defineProperty(this.object, this.attribute, { value: value });\n    }\n    toString() {\n        return `${this.object[this.attribute]}`;\n    }\n    fromString(value) {\n        const type = typeof this.object[this.attribute];\n        let outValue;\n        switch (type) {\n            case \"string\":\n                outValue = value;\n                break;\n            case \"number\":\n                outValue = Number.parseFloat(value);\n                break;\n            default:\n                throw Error(`Reference.fromString() isn't yet supported for type ${type}`);\n        }\n        Object.defineProperty(this.object, this.attribute, { value: outValue });\n    }\n}\nexport function ref(object, attribute) {\n    return new Reference(object, attribute);\n}\nexport function refs(object, ...attributes) {\n    return attributes.map(a => new Reference(object, a));\n}\nexport class Fragment extends Array {\n    constructor(props) {\n        super(...props?.children);\n        for (let i = 0; i < this.length; ++i) {\n            const e = this[i];\n            if (typeof e === \"string\") {\n                this[i] = document.createTextNode(e);\n            }\n        }\n    }\n    replaceIn(element) {\n        while (element.childNodes.length > 0) {\n            element.removeChild(element.childNodes[element.childNodes.length - 1]);\n        }\n        this.appendTo(element);\n    }\n    appendTo(element) {\n        for (let child of this) {\n            element.appendChild(child);\n        }\n    }\n}\nexport function jsx(nameOrConstructor, props, key) {\n    if (props !== undefined && props.children !== undefined) {\n        props.children = [props.children];\n    }\n    return jsxs(nameOrConstructor, props);\n}\nexport function jsxs(nameOrConstructor, props, key) {\n    let namespace;\n    if (typeof nameOrConstructor !== 'string') {\n        return new nameOrConstructor(props);\n    }\n    const name = nameOrConstructor;\n    switch (name) {\n        case \"svg\":\n        case \"line\":\n        case \"rect\":\n        case \"circle\":\n        case \"path\":\n        case \"text\":\n            namespace = \"http://www.w3.org/2000/svg\";\n            break;\n        default:\n            namespace = \"http://www.w3.org/1999/xhtml\";\n    }\n    const tag = document.createElementNS(namespace, name);\n    setInitialProperties(tag, props, namespace);\n    return tag;\n}\nexport function setInitialProperties(element, props, namespace) {\n    if (props === null || props === undefined)\n        return;\n    for (let [key, value] of Object.entries(props)) {\n        switch (key) {\n            case 'children':\n                break;\n            case 'action':\n                element.setAction(value);\n                break;\n            case 'model':\n                element.setModel(value);\n                break;\n            case 'class':\n                element.classList.add(value);\n                break;\n            case 'style':\n                for (let [skey, svalue] of Object.entries(value)) {\n                    const regex = /[A-Z]/g;\n                    skey = skey.replace(regex, (upperCase) => \"-\" + upperCase.toLowerCase());\n                    element.style.setProperty(skey, svalue);\n                }\n                break;\n            case 'set':\n                Object.defineProperty(props.set.object, props.set.attribute, { value: element });\n                break;\n            default:\n                if (key.substring(0, 2) === \"on\") {\n                    element.addEventListener(key.substr(2), value);\n                }\n                else {\n                    if (typeof value !== \"object\") {\n                        if (namespace === \"http://www.w3.org/2000/svg\") {\n                            const regex = /[A-Z]/g;\n                            key = key.replace(regex, (upperCase) => \"-\" + upperCase.toLowerCase());\n                        }\n                        element.setAttributeNS(null, key, `${value}`);\n                    }\n                }\n        }\n    }\n    if (props.children !== undefined) {\n        for (let child of props.children) {\n            if (typeof child === \"string\") {\n                element.appendChild(document.createTextNode(child));\n            }\n            else {\n                element.appendChild(child);\n            }\n        }\n    }\n}\nexport function createElement(nameOrConstructor, props, ...children) {\n    let key;\n    if (props !== null) {\n        if ('key' in props) {\n            key = props.key;\n            delete props.key;\n        }\n        if (children !== undefined) {\n            props.children = children;\n        }\n    }\n    else {\n        if (children !== undefined)\n            props = { children };\n    }\n    return jsxs(nameOrConstructor, props, key);\n}\n//# sourceMappingURL=jsx-runtime.js.map","export function css(strings, ...values) {\n    let str = strings[0];\n    values.forEach((s, i) => {\n        str = str.concat(s).concat(strings[i + 1]);\n    });\n    return str;\n}\nexport function element(type, children) {\n    const element = document.createElement(type);\n    for (let i = 0; i < children.length; ++i) {\n        let child = children[i];\n        if (child instanceof Array) {\n            children.splice(i, 1, ...child);\n            child = children[i];\n        }\n        if (typeof child === \"string\") {\n            element.appendChild(document.createTextNode(child));\n            continue;\n        }\n        element.appendChild(child);\n    }\n    return element;\n}\nexport function array(times, create) {\n    let a = [];\n    for (let i = 0; i < times; ++i) {\n        const c = create(i);\n        if (c instanceof Array) {\n            a.push(...c);\n        }\n        else {\n            a.push(c);\n        }\n    }\n    return a;\n}\nexport function text(text) { return document.createTextNode(text); }\nexport const div = (...children) => element(\"div\", children);\nexport const span = (...children) => element(\"span\", children);\nexport const slot = (...children) => element(\"slot\", children);\nexport const form = (...children) => element(\"form\", children);\nexport const input = (...children) => element(\"input\", children);\nexport const button = (...children) => element(\"button\", children);\nexport const ul = (...children) => element(\"ul\", children);\nexport const ol = (...children) => element(\"ol\", children);\nexport const li = (...children) => element(\"li\", children);\nexport const table = (...children) => element(\"table\", children);\nexport const thead = (...children) => element(\"thead\", children);\nexport const th = (...children) => element(\"th\", children);\nexport const tbody = (...children) => element(\"tbody\", children);\nexport const td = (...children) => element(\"td\", children);\nexport const tr = (...children) => element(\"tr\", children);\nconst ns = \"http://www.w3.org/2000/svg\";\nexport function svg(child) {\n    const s = document.createElementNS(ns, \"svg\");\n    if (child !== undefined) {\n        s.appendChild(child);\n    }\n    return s;\n}\nexport function path(d) {\n    const p = document.createElementNS(ns, \"path\");\n    if (d !== undefined) {\n        p.setAttributeNS(null, \"d\", d);\n    }\n    return p;\n}\nexport function rect(x, y, width, height, stroke, fill) {\n    const r = document.createElementNS(ns, \"rect\");\n    r.setAttributeNS(null, \"x\", `${x}`);\n    r.setAttributeNS(null, \"y\", `${y}`);\n    r.setAttributeNS(null, \"width\", `${width}`);\n    r.setAttributeNS(null, \"height\", `${height}`);\n    if (stroke !== undefined) {\n        r.setAttributeNS(null, \"stroke\", stroke);\n    }\n    if (fill !== undefined) {\n        r.setAttributeNS(null, \"fill\", fill);\n    }\n    return r;\n}\nexport function line(x1, y1, x2, y2, stroke, fill) {\n    const l = document.createElementNS(ns, \"line\");\n    l.setAttributeNS(null, \"x1\", `${x1}`);\n    l.setAttributeNS(null, \"y1\", `${y1}`);\n    l.setAttributeNS(null, \"x2\", `${x2}`);\n    l.setAttributeNS(null, \"y2\", `${y2}`);\n    if (stroke !== undefined) {\n        l.setAttributeNS(null, \"stroke\", stroke);\n    }\n    if (fill !== undefined) {\n        l.setAttributeNS(null, \"fill\", fill);\n    }\n    return l;\n}\nexport function svgAndUse(ref) {\n    const ns = \"http://www.w3.org/2000/svg\";\n    const s = document.createElementNS(ns, \"svg\");\n    const u = document.createElementNS(ns, \"use\");\n    u.setAttributeNS(ns, \"href\", ref);\n    u.setAttributeNS('http://www.w3.org/1999/xlink', 'xlink:href', ref);\n    s.appendChild(u);\n    return s;\n}\n//# sourceMappingURL=lsx.js.map","import { GenericModel } from \"./GenericModel.js\";\nexport class BooleanModel extends GenericModel {\n    constructor(value) {\n        super(value);\n    }\n}\n//# sourceMappingURL=BooleanModel.js.map","import { Model } from \"./Model.js\";\nexport class TextModel extends Model {\n    constructor(value = \"\") {\n        super();\n        this._value = value;\n    }\n    set promise(promise) {\n        this._value = promise;\n        this.modified.trigger();\n    }\n    get promise() {\n        if (typeof this._value === \"string\") {\n            return () => {\n                return this._value;\n            };\n        }\n        return this._value;\n    }\n    set value(value) {\n        if (this._value === value)\n            return;\n        if (typeof value !== \"string\") {\n            console.trace(`TextModel.set value(value: string): ${typeof value} is not type string`);\n            return;\n        }\n        this._value = value;\n        this.modified.trigger();\n    }\n    get value() {\n        switch (typeof this._value) {\n            case \"number\":\n            case \"string\":\n                this._value = `${this._value}`;\n                break;\n            case \"function\":\n                this._value = this._value();\n                break;\n        }\n        return this._value;\n    }\n}\n//# sourceMappingURL=TextModel.js.map","import { TextModel } from \"./TextModel.js\";\nexport class HtmlModel extends TextModel {\n    constructor(value) {\n        super(value);\n    }\n}\n//# sourceMappingURL=HtmlModel.js.map","import { Model } from \"./Model.js\";\nimport { Signal } from \"../Signal.js\";\nexport class Action extends Model {\n    constructor(parent, title) {\n        super();\n        this.signal = new Signal();\n        this.title = title;\n        this._enabled = true;\n    }\n    set value(placeHolder) {\n        throw Error(\"Action.value can not be assigned a value\");\n    }\n    get value() {\n        throw Error(\"Action.value can not return a value\");\n    }\n    trigger(data) {\n        if (!this._enabled)\n            return;\n        this.signal.trigger(data);\n    }\n}\n//# sourceMappingURL=Action.js.map","export function instantiateTemplate(name) {\n    return tmpl(name);\n}\nexport function tmpl(name) {\n    let t = document.querySelector('template[id=\"' + name + '\"]');\n    if (!t) {\n        throw new Error(\"failed to find template '\" + name + \"'\");\n    }\n    let x = t;\n    let z = x.content;\n    let y = document.importNode(z, true);\n    return y;\n}\nexport function find(node, selector) {\n    return node.querySelector(selector);\n}\nexport function tag(name) { return document.createElement(name); }\nexport function txt(txt) { return document.createTextNode(txt); }\nexport function img(src) {\n    let img = document.createElement(\"img\");\n    img.src = src;\n    return img;\n}\nexport function add(n0, n1) { n0.appendChild(n1); }\nexport function remove(n) {\n    if (!n.parentNode)\n        throw Error(\"element has no parent\");\n    n.parentNode.removeChild(n);\n}\nexport function erase(n) {\n    n.replaceChildren();\n}\nexport function hasFocus(element) {\n    if (!document.hasFocus())\n        return false;\n    let active = document.activeElement;\n    while (active !== null) {\n        if (active === element) {\n            return true;\n        }\n        if (active.shadowRoot === null)\n            break;\n        active = active.shadowRoot.activeElement;\n    }\n    return false;\n}\nexport function grabMouse(event) {\n    let target = event.target;\n    let documentMouseMove = (event) => {\n        target.dispatchEvent(new MouseEvent(\"mousemove\", event));\n        event.stopPropagation();\n    };\n    let documentMouseUp = (event) => {\n        target.dispatchEvent(new MouseEvent(\"mouseup\", event));\n        document.removeEventListener(\"mousemove\", documentMouseMove, { capture: true });\n        document.removeEventListener(\"mouseup\", documentMouseUp, { capture: true });\n        document.body.style.pointerEvents = \"auto\";\n        event.stopPropagation();\n    };\n    document.addEventListener(\"mousemove\", documentMouseMove, { capture: true });\n    document.addEventListener(\"mouseup\", documentMouseUp, { capture: true });\n    document.body.style.pointerEvents = \"none\";\n    event.preventDefault();\n    event.stopPropagation();\n}\nexport function attribute(element, name) {\n    let attribute = element.getAttribute(name);\n    if (attribute === null) {\n        console.log(\"missing attribute '\" + name + \"' in \", element);\n        throw Error(\"missing attribute '\" + name + \"' in \" + element.nodeName);\n    }\n    return attribute;\n}\nexport function attributeOrUndefined(element, name) {\n    let attribute = element.getAttribute(name);\n    return attribute === null ? undefined : attribute;\n}\nexport function isNodeBeforeNode(first, second) {\n    let node;\n    let firstPrevious = first;\n    node = first;\n    let parentsOfFirstNode = new Map();\n    while (true) {\n        firstPrevious = node;\n        node = node.parentNode;\n        if (!node)\n            break;\n        parentsOfFirstNode.set(node, firstPrevious);\n    }\n    let secondPrevious = second;\n    node = second;\n    while (node) {\n        secondPrevious = node;\n        node = node.parentNode;\n        if (!node) {\n            throw Error(`isNodeBeforeNode(first, second): nodes have no common parent`);\n        }\n        let lookup = parentsOfFirstNode.get(node);\n        if (lookup) {\n            firstPrevious = lookup;\n            break;\n        }\n    }\n    for (let child of node.childNodes) {\n        if (child === firstPrevious)\n            return true;\n        if (child === secondPrevious)\n            return false;\n    }\n    throw Error(\"isNodeBeforeNode(first, second): couldn't determine order of nodes\");\n}\nexport function pixelToNumber(pixel) {\n    if (pixel === \"\")\n        return 0;\n    if (pixel.substr(pixel.length - 2) !== \"px\")\n        throw Error(`pixelToNumber('${pixel}') expected 'px' suffix`);\n    return Number.parseFloat(pixel.substr(0, pixel.length - 2));\n}\nexport function getPropertyValue(element, propertyName) {\n    let elementStyle = window.getComputedStyle(element, undefined);\n    let property = elementStyle.getPropertyValue(propertyName);\n    return pixelToNumber(property);\n}\nexport function horizontalPadding(element) {\n    return getPropertyValue(element, \"padding-left\") + getPropertyValue(element, \"padding-right\");\n}\nexport function verticalPadding(element) {\n    return getPropertyValue(element, \"padding-top\") + getPropertyValue(element, \"padding-bottom\");\n}\n//# sourceMappingURL=dom.js.map","import { Controller } from \"./Controller.js\";\nexport let globalController = new Controller();\nexport function bindModel(modelId, model) {\n    globalController.bind(modelId, model);\n}\nexport function action(actionId, action) {\n    return globalController.registerAction(actionId, action);\n}\nexport function unbind() {\n    globalController.clear();\n}\nexport function text(modelId, value) {\n    return globalController.text(modelId, value);\n}\nexport function boolean(modelId, value) {\n    return globalController.boolean(modelId, value);\n}\n//# sourceMappingURL=globalController.js.map","import { BooleanModel } from \"../model/BooleanModel.js\";\nimport { NumberModel } from \"../model/NumberModel.js\";\nimport { HtmlModel } from \"../model/HtmlModel.js\";\nimport { TextModel } from \"../model/TextModel.js\";\nimport { Action } from \"../model/Action.js\";\nimport { Signal } from \"../Signal.js\";\nexport class Controller {\n    constructor() {\n        this.modelId2Models = new Map();\n        this.modelId2Views = new Map();\n        this.view2ModelIds = new Map();\n        this.sigChanged = new Signal();\n    }\n    registerAction(actionId, callback) {\n        let action = new Action(undefined, actionId);\n        action.signal.add(callback);\n        this._registerModel(\"A:\" + actionId, action);\n        return action;\n    }\n    registerModel(modelId, model) {\n        this._registerModel(\"M:\" + modelId, model);\n    }\n    _registerModel(modelId, model) {\n        let modelsForModelId = this.modelId2Models.get(modelId);\n        if (!modelsForModelId) {\n            modelsForModelId = new Set();\n            this.modelId2Models.set(modelId, modelsForModelId);\n        }\n        modelsForModelId.add(model);\n        let viewsForModelId = this.modelId2Views.get(modelId);\n        if (!viewsForModelId)\n            return;\n        for (let view of viewsForModelId) {\n            view.setModel(model);\n        }\n    }\n    registerView(modelId, view) {\n        if (view.controller && view.controller !== this) {\n            console.log(\"error: attempt to register view more than once at different controllers\");\n            return;\n        }\n        view.controller = this;\n        let modelIdsForView = this.view2ModelIds.get(view);\n        if (!modelIdsForView) {\n            modelIdsForView = new Set();\n            this.view2ModelIds.set(view, modelIdsForView);\n        }\n        modelIdsForView.add(modelId);\n        let viewsForModelId = this.modelId2Views.get(modelId);\n        if (!viewsForModelId) {\n            viewsForModelId = new Set();\n            this.modelId2Views.set(modelId, viewsForModelId);\n        }\n        viewsForModelId.add(view);\n        let modelsForView = this.modelId2Models.get(modelId);\n        if (!modelsForView)\n            return;\n        for (let model of modelsForView) {\n            view.setModel(model);\n        }\n    }\n    unregisterView(view) {\n        if (!view.controller)\n            return;\n        if (view.controller !== this)\n            throw Error(\"attempt to unregister view from wrong controller\");\n        let modelIds = this.view2ModelIds.get(view);\n        if (!modelIds)\n            return;\n        for (let modelId of modelIds) {\n            let views = this.modelId2Views.get(modelId);\n            if (!views)\n                continue;\n            views.delete(view);\n            if (views.size === 0) {\n                this.modelId2Views.delete(modelId);\n            }\n            view.setModel(undefined);\n        }\n    }\n    clear() {\n        for (let entry of this.view2ModelIds) {\n            entry[0].setModel(undefined);\n        }\n        this.modelId2Models.clear();\n        this.modelId2Views.clear();\n        this.view2ModelIds.clear();\n    }\n    bind(modelId, model) {\n        this.registerModel(modelId, model);\n    }\n    action(actionId, callback) {\n        return this.registerAction(actionId, callback);\n    }\n    text(modelId, value) {\n        let model = new TextModel(value);\n        this.bind(modelId, model);\n        return model;\n    }\n    html(modelId, value) {\n        let model = new HtmlModel(value);\n        this.bind(modelId, model);\n        return model;\n    }\n    boolean(modelId, value) {\n        let model = new BooleanModel(value);\n        this.bind(modelId, model);\n        return model;\n    }\n    number(modelId, value, options) {\n        let model = new NumberModel(value, options);\n        this.bind(modelId, model);\n        return model;\n    }\n}\n//# sourceMappingURL=Controller.js.map","export class AnimationBase {\n    constructor() {\n        this._stop = false;\n        this._firstFrame = this._firstFrame.bind(this);\n        this._animationFrame = this._animationFrame.bind(this);\n    }\n    start() {\n        this.prepare();\n        if (this._stop === true)\n            return;\n        this.requestAnimationFrame(this._firstFrame);\n    }\n    stop() {\n        this._stop = true;\n        if (this.animator?.current === this) {\n            this.animator.clearCurrent();\n        }\n    }\n    replace(animation) {\n        this.next = animation;\n        this.animationFrame(1);\n        this.lastFrame();\n        animation.prepare();\n    }\n    prepare() { }\n    firstFrame() { }\n    animationFrame(value) { }\n    lastFrame() { }\n    requestAnimationFrame(callback) {\n        window.requestAnimationFrame(callback);\n    }\n    _firstFrame(time) {\n        this.startTime = time;\n        this.firstFrame();\n        if (this._stop)\n            return;\n        this.animationFrame(0);\n        this.requestAnimationFrame(this._animationFrame);\n    }\n    _animationFrame(time) {\n        if (this.next) {\n            this.next._firstFrame(time);\n            return;\n        }\n        let elapsed = AnimationBase.animationFrameCount > 0 ? (time - this.startTime) / AnimationBase.animationFrameCount : 1;\n        elapsed = elapsed > 1 ? 1 : elapsed;\n        const value = this.ease(elapsed);\n        this.animationFrame(value);\n        if (this._stop) {\n            return;\n        }\n        if (value < 1.0) {\n            this.requestAnimationFrame(this._animationFrame.bind(this));\n        }\n        else {\n            this.lastFrame();\n            if (this.animator && this.animator._current === this) {\n                this.animator.clearCurrent();\n            }\n        }\n    }\n    ease(k) {\n        return 0.5 * (1 - Math.cos(Math.PI * k));\n    }\n}\nAnimationBase.animationFrameCount = 468;\nclass AnimationWrapper extends AnimationBase {\n    constructor(animation) {\n        super();\n        this.animation = animation;\n    }\n    prepare() {\n        this.animation.prepare();\n    }\n    firstFrame() {\n        this.animation.firstFrame();\n    }\n    animationFrame(value) {\n        this.animation.animationFrame(value);\n    }\n    lastFrame() {\n        this.animation.lastFrame();\n    }\n}\nexport class Animator {\n    get current() {\n        if (this._current === undefined) {\n            return undefined;\n        }\n        if (this._current instanceof AnimationWrapper) {\n            return this._current.animation;\n        }\n        return this._current;\n    }\n    clearCurrent() {\n        this._current = undefined;\n    }\n    run(animation) {\n        let animationBase;\n        if (!(animation instanceof AnimationBase)) {\n            animationBase = new AnimationWrapper(animation);\n        }\n        else {\n            animationBase = animation;\n        }\n        const previousAnimation = this._current;\n        this._current = animationBase;\n        animationBase.animator = this;\n        if (previousAnimation) {\n            previousAnimation.animator = undefined;\n            previousAnimation.replace(animationBase);\n        }\n        else {\n            if (Animator.halt) {\n                return;\n            }\n            animationBase.start();\n        }\n    }\n}\nAnimator.halt = false;\n//# sourceMappingURL=animation.js.map","import { Model } from \"./Model.js\";\nexport class OptionModelBase extends Model {\n    constructor() {\n        super();\n        this._stringValue = \"\";\n    }\n    set stringValue(v) {\n        if (this._stringValue === v)\n            return;\n        this._stringValue = v;\n        this.modified.trigger();\n    }\n    get stringValue() {\n        return this._stringValue;\n    }\n    isValidStringValue(stringValue) {\n        return false;\n    }\n}\n//# sourceMappingURL=OptionModelBase.js.map","import { OptionModelBase } from \"./OptionModelBase.js\";\nexport class EnumModel extends OptionModelBase {\n    constructor(enumClass, value) {\n        super();\n        this.enumClass = enumClass;\n        if (value !== undefined) {\n            this._value = value;\n        }\n    }\n    get value() {\n        return this._value;\n    }\n    set value(value) {\n        this.setValue(value);\n    }\n    get stringValue() {\n        return this.toString();\n    }\n    set stringValue(value) {\n        this.fromString(value);\n    }\n    getValue() {\n        return this._value;\n    }\n    setValue(value) {\n        if (this._value === value) {\n            return;\n        }\n        this._value = value;\n        this.modified.trigger();\n    }\n    toString() {\n        return this.enumClass[this._value];\n    }\n    fromString(value) {\n        const x = this.enumClass[value];\n        if (x === undefined || typeof this.enumClass[x] !== \"string\") {\n            let allValidValues = \"\";\n            Object.keys(this.enumClass).forEach(key => {\n                const validValue = this.enumClass[key];\n                if (typeof validValue === \"string\") {\n                    if (allValidValues.length !== 0) {\n                        allValidValues = `${allValidValues}, ${validValue}`;\n                    }\n                    else {\n                        allValidValues = validValue;\n                    }\n                }\n            });\n            console.trace(`EnumModel<T>.fromString('${value}'): invalid value, must be one of ${allValidValues}`);\n            return;\n        }\n        if (this._value === x) {\n            return;\n        }\n        this._value = x;\n        this.modified.trigger();\n    }\n    isValidStringValue(value) {\n        const x = this.enumClass[value];\n        return x !== undefined && typeof this.enumClass[x] === \"string\";\n    }\n}\n//# sourceMappingURL=EnumModel.js.map","import { globalController } from \"../controller/globalController.js\";\nimport { setInitialProperties } from \"toad.jsx\";\nexport class View extends HTMLElement {\n    static define(name, view, options) {\n        const element = window.customElements.get(name);\n        if (element === undefined) {\n            window.customElements.define(name, view, options);\n        }\n        else {\n            if (element !== view) {\n                console.trace(`View::define(${name}, ...): attempt to redefine view with different constructor`);\n            }\n        }\n    }\n    constructor(props) {\n        super();\n        setInitialProperties(this, props);\n    }\n    attachStyle(style) {\n        this.shadowRoot.appendChild(document.importNode(style, true));\n    }\n    setModel(model) {\n        console.trace(`Please note that View.setModel(model) has no implementation.`);\n    }\n    getModelId() {\n        if (!this.hasAttribute(\"model\"))\n            throw Error(\"no 'model' attribute\");\n        let modelId = this.getAttribute(\"model\");\n        if (!modelId)\n            throw Error(\"no model id\");\n        return \"M:\" + modelId;\n    }\n    getActionId() {\n        if (!this.hasAttribute(\"action\"))\n            throw Error(\"no 'action' attribute\");\n        let actionId = this.getAttribute(\"action\");\n        if (!actionId)\n            throw Error(\"no action id\");\n        return \"A:\" + actionId;\n    }\n    connectedCallback() {\n        if (this.controller)\n            return;\n        let modelId = \"\";\n        try {\n            modelId = this.getModelId();\n        }\n        catch (error) {\n        }\n        if (modelId != \"\")\n            globalController.registerView(modelId, this);\n    }\n    disconnectedCallback() {\n        if (this.controller)\n            this.controller.unregisterView(this);\n    }\n}\n//# sourceMappingURL=View.js.map","import { View } from \"./View.js\";\nexport class ModelView extends View {\n    constructor(init) {\n        super(init);\n        if (init?.model !== undefined) {\n            this.setModel(init.model);\n        }\n    }\n    updateModel() { }\n    updateView(data) { }\n    setModel(model) {\n        if (model === this.model)\n            return;\n        const view = this;\n        if (this.model)\n            this.model.modified.remove(view);\n        if (model)\n            model.modified.add((data) => view.updateView(data), view);\n        this.model = model;\n        if (this.isConnected) {\n            this.updateView(undefined);\n        }\n    }\n    connectedCallback() {\n        super.connectedCallback();\n        if (this.model)\n            this.updateView(undefined);\n    }\n}\n//# sourceMappingURL=ModelView.js.map","import { TextModel } from \"../model/TextModel.js\";\nimport { globalController } from \"../controller/globalController.js\";\nimport { Action } from \"../model/Action.js\";\nimport { ModelView } from \"./ModelView.js\";\nexport class ActionView extends ModelView {\n    constructor(init) {\n        super(init);\n    }\n    connectedCallback() {\n        if (this.controller) {\n            this.updateView();\n            return;\n        }\n        try {\n            globalController.registerView(this.getActionId(), this);\n        }\n        catch (e) {\n        }\n        try {\n            globalController.registerView(this.getModelId(), this);\n        }\n        catch (e) {\n        }\n        this.updateView();\n    }\n    disconnectedCallback() {\n        super.disconnectedCallback();\n        if (this.controller)\n            this.controller.unregisterView(this);\n    }\n    setModel(model) {\n        if (!model) {\n            if (this.model)\n                this.model.modified.remove(this);\n            if (this.action)\n                this.action.modified.remove(this);\n            this.model = undefined;\n            this.action = undefined;\n            this.updateView();\n            return;\n        }\n        if (model instanceof Action) {\n            this.action = model;\n            this.action.modified.add(() => {\n                this.updateView();\n            }, this);\n        }\n        else if (model instanceof TextModel) {\n            this.model = model;\n            this.model.modified.add(() => {\n                this.updateView();\n            }, this);\n        }\n        else {\n            throw Error(\"unexpected model of type \" + model.constructor.name);\n        }\n        this.updateView();\n    }\n    setAction(value) {\n        if (value instanceof Function) {\n            const action = new Action(undefined, \"\");\n            action.signal.add(value);\n            this.setModel(action);\n        }\n        else {\n            this.setModel(value);\n        }\n    }\n    isEnabled() {\n        return this.action !== undefined && this.action.enabled;\n    }\n}\n//# sourceMappingURL=ActionView.js.map","import { css } from \"../util/lsx.js\";\nexport const style = document.createElement(\"style\");\nstyle.textContent = css `\n:host {\n    display: inline-block;\n}\n\n.tx-text {\n    width: 100%;\n    box-shadow: none;\n    box-sizing: border-box;\n    color: var(--tx-edit-fg-color);\n    background-color: var(--tx-edit-bg-color);\n\n    /* we'll use the border instead of an outline to indicate the focus */\n    outline: none;\n    border-width: var(--tx-border-width);\n    border-style: solid;\n    border-color: var(--tx-border-color);\n    border-radius: var(--tx-border-radius);\n\n    font-weight: var(--tx-edit-font-weight);\n    font-size: var(--tx-edit-font-size);\n    line-height: 18px;\n\n    padding: 4px 8px 4px 8px;\n    text-indent: 0;\n    vertical-align: top;\n    margin: 0;\n    overflow: visible;\n    text-overflow: ellipsis;\n}\n.tx-text:hover {\n    border-color: var(--tx-border-color-hover);\n}\n.tx-text:disabled {\n    color: var(--tx-fg-color-disabled);\n    background-color: var(--tx-bg-color-disabled);\n    border-color: var(--tx-bg-color-disabled);\n}\n.tx-text::placeholder {\n    color: var(--tx-placeholder-fg-color);\n    font-style: italic;\n    font-weight: 300;\n}\n.tx-text:hover::placeholder {\n    color: var(--tx-placeholder-fg-color-hover);\n}\n.tx-text:focus {\n    border-color: var(--tx-outline-color);\n}\n`;\n//# sourceMappingURL=tx-text.js.map","import { NumberModel } from \"../model/NumberModel.js\";\nimport { ModelView } from \"./ModelView.js\";\nimport { style as txText } from \"../style/tx-text.js\";\nexport class Text extends ModelView {\n    constructor(init) {\n        super(init);\n        this.input = document.createElement(\"input\");\n        this.input.classList.add(\"tx-text\");\n        this.input.oninput = () => { this.updateModel(); };\n        this.wheel = this.wheel.bind(this);\n        this.input.onwheel = this.wheel;\n        this.attachShadow({ mode: 'open' });\n        this.attachStyle(txText);\n        this.shadowRoot.appendChild(this.input);\n    }\n    wheel(e) {\n        if (this.model instanceof NumberModel) {\n            if (e.deltaY > 0) {\n                this.model.decrement();\n                e.preventDefault();\n            }\n            if (e.deltaY < 0) {\n                this.model.increment();\n                e.preventDefault();\n            }\n        }\n    }\n    focus() {\n        this.input.focus();\n    }\n    blur() {\n        this.input.blur();\n    }\n    static get observedAttributes() { return ['value']; }\n    attributeChangedCallback(name, oldValue, newValue) {\n        switch (name) {\n            case \"value\":\n                if (this.model && newValue !== undefined) {\n                    this.model.value = newValue;\n                }\n                break;\n        }\n    }\n    updateModel() {\n        if (this.model) {\n            this.model.value = this.input.value;\n        }\n        this.setAttribute(\"value\", this.input.value);\n    }\n    updateView() {\n        if (!this.model)\n            return;\n        const strValue = `${this.model.value}`;\n        if (this.input.value !== strValue) {\n            this.input.value = strValue;\n            this.setAttribute(\"value\", this.input.value);\n        }\n    }\n    get value() {\n        return this.input.value;\n    }\n    set value(value) {\n        this.input.value = value;\n        this.updateModel();\n    }\n}\nText.define(\"tx-text\", Text);\n//# sourceMappingURL=Text.js.map","export let textAreaStyle = document.createElement(\"style\");\ntextAreaStyle.textContent = `\n\n/* try to follow material ui: when active render button labels in black, otherwise in gray */\nsvg .fill {\n  fill: var(--tx-gray-700);\n  stroke: var(--tx-gray-700);\n}\nsvg .stroke {\n  fill: none;\n  stroke: var(--tx-gray-700);\n}\nsvg .strokeFill {\n  fill: var(--tx-gray-200);\n  stroke: var(--tx-gray-700);\n}\n\n/*\nthese don't seem to be in use anymore\n.toolbar.active svg .fill {\n  fill: #000;\n  stroke: #000;\n}\n.toolbar.active svg .stroke {\n  fill: none;\n  stroke: #000;\n}\n.toolbar.active svg .strokeFill {\n  fill: #fff;\n  stroke: #000;\n}\n*/\n\n.toolbar button {\n    background: var(--tx-gray-75);\n    color: var(--tx-gray-800);\n    border: 1px var(--tx-gray-400);\n    border-style: solid solid solid none;\n    padding: 5;\n    margin: 0;\n    vertical-align: middle;\n    height: 22px;\n}\n\n.toolbar button:active:hover {\n    background: linear-gradient(to bottom, var(--tx-gray-600) 0%,var(--tx-gray-50) 100%,var(--tx-gray-500) 100%);\n}\n\n.toolbar button.left {\n    border-style: solid;\n    border-radius: 3px 0 0 3px;\n}\n\n.toolbar button.right {\n    border: 1px var(--tx-gray-400);\n    border-style: solid solid solid none;\n    border-radius: 0 3px 3px 0;\n}\n\n.toolbar button.active {\n    background: linear-gradient(to bottom, var(--tx-gray-600) 0%,var(--tx-gray-50) 100%,var(--tx-gray-500) 100%);\n    border: 1px var(--tx-global-blue-500) solid;\n    color: var(--tx-gray-900);\n}\n\ndiv.textarea {\n  font-family: var(--tx-font-family);\n  font-size: var(--tx-font-size);\n  border: 1px var(--tx-gray-400) solid;\n  border-radius: 3px;\n  margin: 2px;\n  padding: 4px 5px;\n  outline-offset: -2px;\n}\n\ndiv.textarea h1 {\n  font-size: 22px;\n  margin: 0;\n  padding: 4px 0 4px 0;\n}\n\ndiv.textarea h2 {\n  font-size: 18px;\n  margin: 0;\n  padding: 4px 0 4px 0;\n}\n\ndiv.textarea h3 {\n  font-size: 16px;\n  margin: 0;\n  padding: 4px 0 4px 0;\n}\n\ndiv.textarea h4 {\n  font-size: 14px;\n  margin: 0;\n  padding: 4px 0 4px 0;\n}\n\ndiv.textarea div {\n  padding: 2px 0 2px 0;\n}\n`;\n//# sourceMappingURL=textAreaStyle.js.map","import { jsx as _jsx, jsxs as _jsxs } from \"toad.jsx/lib/jsx-runtime\";\nimport { ModelView } from \"./ModelView.js\";\nimport { textAreaStyle } from \"./textAreaStyle.js\";\nexport class TextTool extends ModelView {\n    constructor() {\n        super();\n        TextTool.texttool = this;\n        let toolbar = _jsx(\"div\", { class: \"toolbar\" });\n        this.buttonH1 = _jsx(\"button\", { class: \"left\", children: \"H1\" });\n        this.buttonH1.onclick = () => {\n            document.execCommand(\"formatBlock\", false, \"<h1>\");\n            this.update();\n        };\n        toolbar.appendChild(this.buttonH1);\n        this.buttonH2 = _jsx(\"button\", { children: \"H2\" });\n        this.buttonH2.onclick = () => {\n            document.execCommand(\"formatBlock\", false, \"<h2>\");\n            this.update();\n        };\n        toolbar.appendChild(this.buttonH2);\n        this.buttonH3 = _jsx(\"button\", { children: \"H3\" });\n        this.buttonH3.onclick = () => {\n            document.execCommand(\"formatBlock\", false, \"<h3>\");\n            this.update();\n        };\n        toolbar.appendChild(this.buttonH3);\n        this.buttonH4 = _jsx(\"button\", { class: \"right\", children: \"H4\" });\n        this.buttonH4.onclick = () => {\n            document.execCommand(\"formatBlock\", false, \"<h4>\");\n            this.update();\n        };\n        toolbar.appendChild(this.buttonH4);\n        toolbar.appendChild(document.createTextNode(\" \"));\n        this.buttonBold = _jsx(\"button\", { class: \"left\", children: _jsx(\"b\", { children: \"B\" }) });\n        this.buttonBold.onclick = () => {\n            document.execCommand(\"bold\", false);\n            this.update();\n        };\n        toolbar.appendChild(this.buttonBold);\n        this.buttonItalic = _jsx(\"button\", { children: _jsx(\"i\", { children: \"I\" }) });\n        this.buttonItalic.onclick = () => {\n            document.execCommand(\"italic\", false);\n            this.update();\n        };\n        toolbar.appendChild(this.buttonItalic);\n        this.buttonUnderline = _jsx(\"button\", { children: _jsx(\"u\", { children: \"U\" }) });\n        this.buttonUnderline.onclick = () => {\n            document.execCommand(\"underline\", false);\n            this.update();\n        };\n        toolbar.appendChild(this.buttonUnderline);\n        this.buttonStrikeThrough = _jsx(\"button\", { children: _jsx(\"strike\", { children: \"S\" }) });\n        this.buttonStrikeThrough.onclick = () => {\n            document.execCommand(\"strikeThrough\", false);\n            this.update();\n        };\n        toolbar.appendChild(this.buttonStrikeThrough);\n        this.buttonSubscript = _jsx(\"button\", { children: \"x\\u2082\" });\n        this.buttonSubscript.onclick = () => {\n            document.execCommand(\"subscript\", false);\n            this.update();\n        };\n        toolbar.appendChild(this.buttonSubscript);\n        this.buttonSuperscript = _jsx(\"button\", { class: \"right\", children: \"x\\u00B2\" });\n        this.buttonSuperscript.onclick = () => {\n            document.execCommand(\"superscript\", false);\n            this.update();\n        };\n        toolbar.appendChild(this.buttonSuperscript);\n        toolbar.appendChild(document.createTextNode(\" \"));\n        this.buttonJustifyLeft = _jsx(\"button\", { class: \"left\", children: _jsxs(\"svg\", { viewBox: \"0 0 10 9\", width: \"10\", height: \"9\", children: [_jsx(\"line\", { x1: \"0\", y1: \"0.5\", x2: \"10\", y2: \"0.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"0\", y1: \"2.5\", x2: \"6\", y2: \"2.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"0\", y1: \"4.5\", x2: \"10\", y2: \"4.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"0\", y1: \"6.5\", x2: \"6\", y2: \"6.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"0\", y1: \"8.5\", x2: \"10\", y2: \"8.5\", class: \"stroke\" })] }) });\n        this.buttonJustifyLeft.onclick = () => {\n            document.execCommand(\"justifyLeft\", false);\n            this.update();\n        };\n        toolbar.appendChild(this.buttonJustifyLeft);\n        this.buttonJustifyCenter = _jsx(\"button\", { children: _jsxs(\"svg\", { viewBox: \"0 0 10 9\", width: \"10\", height: \"9\", children: [_jsx(\"line\", { x1: \"0\", y1: \"0.5\", x2: \"10\", y2: \"0.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"2\", y1: \"2.5\", x2: \"8\", y2: \"2.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"0\", y1: \"4.5\", x2: \"10\", y2: \"4.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"2\", y1: \"6.5\", x2: \"8\", y2: \"6.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"0\", y1: \"8.5\", x2: \"10\", y2: \"8.5\", class: \"stroke\" })] }) });\n        this.buttonJustifyCenter.onclick = () => {\n            document.execCommand(\"justifyCenter\", false);\n            this.update();\n        };\n        toolbar.appendChild(this.buttonJustifyCenter);\n        this.buttonJustifyRight = _jsx(\"button\", { class: \"right\", children: _jsxs(\"svg\", { viewBox: \"0 0 10 9\", width: \"10\", height: \"9\", children: [_jsx(\"line\", { x1: \"0\", y1: \"0.5\", x2: \"10\", y2: \"0.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"4\", y1: \"2.5\", x2: \"10\", y2: \"2.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"0\", y1: \"4.5\", x2: \"10\", y2: \"4.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"4\", y1: \"6.5\", x2: \"10\", y2: \"6.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"0\", y1: \"8.5\", x2: \"10\", y2: \"8.5\", class: \"stroke\" })] }) });\n        this.buttonJustifyRight.onclick = () => {\n            document.execCommand(\"justifyRight\", false);\n            this.update();\n        };\n        toolbar.appendChild(this.buttonJustifyRight);\n        this.attachShadow({ mode: 'open' });\n        this.shadowRoot.appendChild(document.importNode(textAreaStyle, true));\n        this.shadowRoot.appendChild(toolbar);\n    }\n    update() {\n        this.buttonH1.classList.toggle(\"active\", document.queryCommandValue(\"formatBlock\") === \"h1\");\n        this.buttonH2.classList.toggle(\"active\", document.queryCommandValue(\"formatBlock\") === \"h2\");\n        this.buttonH3.classList.toggle(\"active\", document.queryCommandValue(\"formatBlock\") === \"h3\");\n        this.buttonH4.classList.toggle(\"active\", document.queryCommandValue(\"formatBlock\") === \"h4\");\n        this.buttonBold.classList.toggle(\"active\", document.queryCommandState(\"bold\"));\n        this.buttonItalic.classList.toggle(\"active\", document.queryCommandState(\"italic\"));\n        this.buttonUnderline.classList.toggle(\"active\", document.queryCommandState(\"underline\"));\n        this.buttonStrikeThrough.classList.toggle(\"active\", document.queryCommandState(\"strikeThrough\"));\n        this.buttonSubscript.classList.toggle(\"active\", document.queryCommandState(\"subscript\"));\n        this.buttonSuperscript.classList.toggle(\"active\", document.queryCommandState(\"superscript\"));\n        this.buttonJustifyLeft.classList.toggle(\"active\", document.queryCommandState(\"justifyLeft\"));\n        this.buttonJustifyCenter.classList.toggle(\"active\", document.queryCommandState(\"justifyCenter\"));\n        this.buttonJustifyRight.classList.toggle(\"active\", document.queryCommandState(\"justifyRight\"));\n    }\n}\nTextTool.define(\"tx-texttool\", TextTool);\n//# sourceMappingURL=TextTool.js.map","import { HtmlModel } from \"../model/HtmlModel.js\";\nimport { TextTool } from \"./TextTool.js\";\nimport { ModelView } from \"./ModelView.js\";\nimport { style as txText } from \"../style/tx-text.js\";\nexport class TextArea extends ModelView {\n    constructor(init) {\n        super(init);\n        let content = document.createElement(\"div\");\n        this.content = content;\n        content.classList.add(\"tx-text\");\n        content.contentEditable = \"true\";\n        content.oninput = (event) => {\n            if (this.model instanceof HtmlModel) {\n                let firstChild = event.target.firstChild;\n                if (firstChild && firstChild.nodeType === 3) {\n                    document.execCommand(\"formatBlock\", false, `<div>`);\n                }\n                else if (content.innerHTML === \"<br>\") {\n                    content.innerHTML = \"\";\n                }\n            }\n            this.updateModel();\n        };\n        content.onkeydown = (event) => {\n            if (!(this.model instanceof HtmlModel)) {\n                return;\n            }\n            if (event.metaKey === true && event.key === \"b\") {\n                event.preventDefault();\n                document.execCommand(\"bold\", false);\n                this.updateTextTool();\n            }\n            else if (event.metaKey === true && event.key === \"i\") {\n                event.preventDefault();\n                document.execCommand(\"italic\", false);\n                this.updateTextTool();\n            }\n            else if (event.metaKey === true && event.key === \"u\") {\n                event.preventDefault();\n                document.execCommand(\"underline\", false);\n                this.updateTextTool();\n            }\n            else if (event.key === \"Tab\") {\n                event.preventDefault();\n            }\n            else if (event.key === \"Enter\" &&\n                event.shiftKey !== true &&\n                document.queryCommandValue(\"formatBlock\") === \"blockquote\") {\n                document.execCommand(\"formatBlock\", false, \"<p>\");\n            }\n        };\n        content.onkeyup = () => {\n            this.updateTextTool();\n        };\n        content.onmouseup = () => {\n            this.updateTextTool();\n        };\n        this.attachShadow({ mode: 'open' });\n        this.attachStyle(txText);\n        this.shadowRoot.appendChild(content);\n    }\n    updateTextTool() {\n        if (TextTool.texttool !== undefined)\n            TextTool.texttool.update();\n    }\n    updateModel() {\n        if (this.model) {\n            this.model.promise = () => {\n                if (this.model instanceof HtmlModel) {\n                    return this.content.innerHTML;\n                }\n                else {\n                    return this.content.innerText;\n                }\n            };\n        }\n    }\n    updateView() {\n        if (!this.model) {\n            return;\n        }\n        if (this.model instanceof HtmlModel) {\n            if (this.content.innerHTML !== this.model.value) {\n                this.content.innerHTML = this.model.value;\n            }\n        }\n        else {\n            if (this.content.innerText !== this.model.value) {\n                this.content.innerText = this.model.value;\n            }\n        }\n    }\n}\nTextArea.define(\"tx-textarea\", TextArea);\n//# sourceMappingURL=TextArea.js.map","import { TextModel } from \"../model/TextModel.js\";\nimport { HtmlModel } from \"../model/HtmlModel.js\";\nimport { NumberModel } from \"../model/NumberModel.js\";\nimport { ModelView } from \"../view/ModelView.js\";\nexport class Display extends ModelView {\n    constructor(init) {\n        super(init);\n    }\n    updateView() {\n        if (this.model === undefined) {\n            this.innerText = \"\";\n            return;\n        }\n        if (this.model instanceof TextModel) {\n            this.innerText = this.model.value;\n            return;\n        }\n        if (this.model instanceof HtmlModel) {\n            this.innerHTML = this.model.value;\n            return;\n        }\n        if (this.model instanceof NumberModel) {\n            this.innerText = `${this.model.value}`;\n            return;\n        }\n    }\n}\nDisplay.define(\"tx-display\", Display);\n//# sourceMappingURL=Display.js.map","import { css } from \"../util/lsx.js\";\nexport const style = document.createElement(\"style\");\nstyle.textContent = css `\n.tx-button {\n    padding: 2px 14px 2px 14px;\n    margin: 0;\n    color: var(--tx-gray-800);\n    transition: background-color 130ms ease-in-out;\n    background-color: var(--tx-gray-300);\n    border: 0 none;\n    height: 28px;\n    border-radius: 16px;\n    box-shadow: none;\n}\n\n:host(.tx-default) > .tx-button {\n    color: var(--tx-gray-50);\n    background-color: var(--tx-gray-800);\n}\n\n/* accent */\n\n:host(.tx-accent) > .tx-button {\n    color: var(--tx-static-white);\n    background-color: var(--tx-static-blue-600);\n}\n\n:host(.tx-accent) > .tx-button:hover, :host(.tx-accent) > .tx-button:active {\n    color: var(--tx-static-white);\n    background-color: var(--tx-static-blue-700);\n}\n:host(.tx-accent) > .tx-button:hover:active {\n    color: var(--tx-static-white);\n    background-color: var(--tx-static-blue-500);\n}\n\n/* negative */\n\n:host(.tx-negative) > .tx-button {\n    color: var(--tx-static-white);\n    background-color: var(--tx-static-red-600);\n}\n:host(.tx-negative) > :hover, :host(.tx-negative) > :active {\n    color: var(--tx-static-white);\n    background-color: var(--tx-static-red-700);\n}\n:host(.tx-negative) > :hover:active {\n    color: var(--tx-static-white);\n    background-color: var(--tx-static-red-500);\n}\n\n.tx-button:hover, .tx-button:active {\n    color: var(--tx-gray-900);\n    background-color: var(--tx-gray-400);\n}\n:host(.tx-default) > .tx-button:hover, :host(.tx-default) > .tx-button:hover:active {\n    color: var(--tx-gray-50);\n    background-color: var(--tx-gray-900);\n}\n\n.tx-button:hover:active {\n    color: var(--tx-gray-900);\n    background-color: var(--tx-gray-500);\n}\n\n.tx-button:hover:active > span {\n    transition: transform 130ms ease-in-out;\n    transform: translate(1px, 1px);\n}\n\n:host(.tx-default) > .tx-button:active {\n    color: var(--tx-gray-50);\n    background-color: var(--tx-gray-900);\n}\n\n.tx-label {\n    font-weight: bold;\n    padding: 4px 0 6px 0;\n    /* override parent flex/grid's align-items property to align in the center */\n    align-self: center;\n    /* adjust sides in container to look centered...? */\n    justify-self: center;\n    /* align children in the center */\n    text-align: center;\n}\n`;\n//# sourceMappingURL=tx-button.js.map","import { HtmlModel } from \"../model/HtmlModel.js\";\nimport { ActionView } from \"./ActionView.js\";\nimport { button, span } from \"../util/lsx.js\";\nimport { style as txButton } from \"../style/tx-button.js\";\nexport class Button extends ActionView {\n    constructor(init) {\n        super(init);\n        this.button = button(this.label = span());\n        this.button.classList.add(\"tx-button\");\n        this.label.classList.add(\"tx-label\");\n        this.button.onclick = () => {\n            if (this.action)\n                this.action.trigger();\n        };\n        this.button.disabled = true;\n        this.attachShadow({ mode: 'open' });\n        this.attachStyle(txButton);\n        this.shadowRoot.appendChild(this.button);\n    }\n    connectedCallback() {\n        super.connectedCallback();\n        if (this.children.length !== 0) {\n            return;\n        }\n        this._observer = new MutationObserver((record, observer) => {\n            if (this._timer !== undefined)\n                clearTimeout(this._timer);\n            this._timer = window.setTimeout(() => {\n                this._timer = undefined;\n                this.updateView();\n            }, 100);\n        });\n        this._observer.observe(this, {\n            childList: true,\n            subtree: true,\n            characterData: true\n        });\n    }\n    updateView() {\n        if (!this.isConnected)\n            return;\n        if (this.model && this.model.value) {\n            if (this.model instanceof HtmlModel)\n                this.label.innerHTML = this.model.value;\n            else\n                this.label.innerText = this.model.value;\n        }\n        else {\n            this.label.innerHTML = this.innerHTML;\n        }\n        this.button.disabled = !this.isEnabled();\n    }\n}\nButton.define(\"tx-button\", Button);\n//# sourceMappingURL=Button.js.map","import { BooleanModel } from \"../model/BooleanModel.js\";\nimport { ModelView } from \"./ModelView.js\";\nexport class BooleanView extends ModelView {\n    setModel(model) {\n        if (model !== undefined && !(model instanceof BooleanModel)) {\n            throw Error(`BooleanView.setModel(): model is not of type BooleanModel`);\n        }\n        super.setModel(model);\n    }\n    updateModel() {\n        if (this.model) {\n            this.model.value = this.input.checked;\n        }\n    }\n    updateView() {\n        if (!this.model || !this.model.enabled) {\n            this.input.setAttribute(\"disabled\", \"\");\n        }\n        else {\n            this.input.removeAttribute(\"disabled\");\n        }\n        if (this.model) {\n            this.input.checked = this.model.value;\n        }\n    }\n}\n//# sourceMappingURL=BooleanView.js.map","import { css } from \"../util/lsx.js\";\nexport const style = document.createElement(\"style\");\nstyle.textContent = css `\n:host(.tx-checkbox) {\n    display: inline-block;\n    position: relative;\n    box-shadow: none;\n    box-sizing: border-box;\n    padding: 0;\n    margin: 2px; /* leave space for the focus ring */\n    border: none 0;\n    height: 14px;\n    width: 14px;\n}\n\n:host(.tx-checkbox) > input {\n    box-sizing: border-box;\n    width: 14px;\n    height: 14px;\n    outline: none;\n    padding: 0;\n    margin: 0;\n    border: 2px solid;\n    border-radius: 2px;\n    border-color: var(--tx-gray-700);\n    /* border-radius: var(--tx-border-radius); */\n    color: var(--tx-edit-fg-color);\n    background-color: var(--tx-edit-bg-color);\n    -webkit-appearance: none;\n}\n\n/* this is a svg 2 feature, works with firefox, chrome and edge, but not safari */\n/* :host(.tx-checkbox) > svg > path {\n    d: path(\"M3.5 9.5a.999.999 0 01-.774-.368l-2.45-3a1 1 0 111.548-1.264l1.657 2.028 4.68-6.01A1 1 0 019.74 2.114l-5.45 7a1 1 0 01-.777.386z\");\n} */\n\n/* focus ring */\n:host(.tx-checkbox) > input:focus-visible {\n    outline: 2px solid;\n    outline-color: var(--tx-outline-color);\n    outline-offset: 2px;\n}\n\n:host(.tx-checkbox) > svg {\n    position: absolute;\n    left: 2px;\n    top: 2px;\n    stroke: none;\n    fill: var(--tx-edit-bg-color);\n    width: 10px;\n    height: 10px;\n    pointer-events: none;\n}\n\n:host(.tx-checkbox) > input:hover {\n    border-color: var(--tx-gray-800);\n}\n.tx-checkbox > input:focus {\n    border-color: var(--tx-outline-color);\n}\n\n:host(.tx-checkbox) > input:checked {\n    background-color: var(--tx-gray-700);\n}\n:host(.tx-checkbox) > input:hover:checked {\n    background-color: var(--tx-gray-800);\n}\n\n:host(.tx-checkbox) > input:disabled {\n    color: var(--tx-gray-400);\n    border-color: var(--tx-gray-400);\n}\n:host(.tx-checkbox) > input:checked:disabled {\n    background-color: var(--tx-gray-400);\n}\n`;\n//# sourceMappingURL=tx-checkbox.js.map","import { BooleanView } from \"./BooleanView.js\";\nimport { input, svg, path } from \"../util/lsx.js\";\nimport { style as txCheckbox } from \"../style/tx-checkbox.js\";\nexport class Checkbox extends BooleanView {\n    constructor(init) {\n        super(init);\n        this.classList.add(\"tx-checkbox\");\n        this.input = input();\n        this.input.type = \"checkbox\";\n        this.input.onchange = () => {\n            this.updateModel();\n        };\n        const checkmark = svg(path(\"M3.5 9.5a.999.999 0 01-.774-.368l-2.45-3a1 1 0 111.548-1.264l1.657 2.028 4.68-6.01A1 1 0 019.74 2.114l-5.45 7a1 1 0 01-.777.386z\"));\n        this.attachShadow({ mode: 'open' });\n        this.attachStyle(txCheckbox);\n        this.shadowRoot.appendChild(this.input);\n        this.shadowRoot.appendChild(checkmark);\n    }\n}\nCheckbox.define(\"tx-checkbox\", Checkbox);\n//# sourceMappingURL=Checkbox.js.map","import { css } from \"../util/lsx.js\";\nexport const style = document.createElement(\"style\");\nstyle.textContent = css `\n.tx-search {\n    display: inline-block;\n    position: relative;\n}\n.tx-search > div {\n    display: inline-flex;\n    position: relative;\n}\n.tx-search > div > svg {\n    display: block;\n    position: absolute;\n    height: 18px;\n    width: 18px;\n    top: 7px;\n    left: 10px;\n    pointer-events: none;\n    overflow: hidden;\n    fill: var(--tx-gray-700);\n}\n.tx-search > div > input {\n    box-sizing: border-box;\n    padding: 3px 12px 5px 35px;\n    margin: 0;\n    border: 1px solid var(--tx-gray-400);\n    border-radius: 4px;\n    -webkit-appearance: none;\n    outline-offset: -2px;\n    outline: none;\n    width: 100%;\n    height: 32px;\n    overflow: visible;\n    background: var(--tx-gray-50);\n\n    color: var(--tx-gray-900);  \n    font-weight: var(--tx-edit-font-weight);\n    font-size: var(--tx-edit-font-size);\n    line-height: 18px;\n}\n/* the button is transparent so that the border of the input field remains visible */\n.tx-search > button {\n    display: inline-flex;\n    position: absolute;\n    box-sizing: border-box;\n    right: 0;\n    top: 0;\n    bottom: 0;\n    width: 32px;\n    padding: 0;\n    margin: 1px;\n    border: none;\n    align-items: center;\n    justify-content: center;\n    overflow: visible;\n    vertical-align: top;\n    cursor: pointer;\n    border-radius: 0 4px 4px 0;\n    text-align: center;\n    outline: none;\n\n    background-color: var(--tx-gray-50);\n    border-radius: 0 4px 4px 0;\n\n}\n.tx-search > button > svg {\n    display: inline-block;\n    pointer-events: none;\n    height: 10px;\n    width: 10px;\n    padding: 0;\n    margin: 0;\n    border: none;\n    fill: var(--tx-gray-700);\n}\n.tx-search > div > input:hover {\n    border-color: var(--tx-gray-500);\n}\n\n.tx-search > div > input:focus {\n    border-color: var(--tx-outline-color);\n}\n.tx-search > button:focus > svg {\n    fill: var(--tx-outline-color);\n}\n\n.tx-search > div > input:disabled {\n    color: var(--tx-gray-700);\n    background-color: var(--tx-gray-200);\n    border-color: var(--tx-gray-200);\n}\n.tx-search > button:disabled {\n    background-color: var(--tx-gray-200);\n}\n.tx-search > button:disabled > svg {\n    fill: var(--tx-gray-400);\n}`;\n//# sourceMappingURL=tx-search.js.map","import { ModelView } from \"./ModelView.js\";\nimport { form, input, button, svg, path, div } from \"../util/lsx.js\";\nimport { style as txSearch } from \"../style/tx-search.js\";\nexport class Search extends ModelView {\n    constructor(init) {\n        super(init);\n        let s0, s1, b, i, p;\n        const f = form(div(s0 = svg(p = path(\"M33.173 30.215L25.4 22.443a12.826 12.826 0 10-2.957 2.957l7.772 7.772a2.1 2.1 0 002.958-2.958zM6 15a9 9 0 119 9 9 9 0 01-9-9z\")), i = input()), b = button(s1 = svg(path(\"M6.548 5L9.63 1.917A1.094 1.094 0 008.084.371L5.001 3.454 1.917.37A1.094 1.094 0 00.371 1.917L3.454 5 .37 8.085A1.094 1.094 0 101.917 9.63l3.084-3.083L8.084 9.63a1.094 1.094 0 101.547-1.546z\"))));\n        s0.setAttributeNS(null, \"width\", \"100%\");\n        s0.setAttributeNS(null, \"height\", \"100%\");\n        p.setAttributeNS(null, \"transform\", \"scale(0.5, 0.5)\");\n        s1.setAttributeNS(null, \"width\", \"100%\");\n        s1.setAttributeNS(null, \"height\", \"100%\");\n        i.type = \"search\";\n        i.placeholder = \"Search\";\n        i.autocomplete = \"off\";\n        f.classList.add(\"tx-search\");\n        this.attachShadow({ mode: 'open' });\n        this.attachStyle(txSearch);\n        this.shadowRoot.appendChild(f);\n    }\n}\nSearch.define(\"tx-search\", Search);\n//# sourceMappingURL=Search.js.map","import { css } from \"../util/lsx.js\";\nexport const style = document.createElement(\"style\");\nstyle.textContent = css `\n/* a div on top serves as the container for elements used for the switch*/\n:host(.tx-switch) {\n    display: inline-flex;\n    align-items: flex-start;\n    position: relative;\n    vertical-align: top;\n}\n/* an invisible checkbox will overlay everything, handling input and state */\n:host(.tx-switch) > input {\n    display: inline-block;\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    box-sizing: absolute;\n    margin: 0;\n    padding: 0;\n    opacity: 0;\n    z-index: 1;\n}\n/* the span provides the visual appearance */\n:host(.tx-switch) > span {\n    display: block;\n    position: relative;\n    left: 0;\n    top: 0;\n    box-sizing: border-box;\n    flex-grow: 0;\n    flex-shrink: 0;\n\n    border: 0px none;\n    border-radius: 7px;\n\n    width: 26px;\n    height: 14px;\n    background: var(--tx-gray-300);\n}\n\n/* focus ring */\n:host(.tx-switch) > input:focus-visible + span {\n    outline: 2px solid;\n    outline-color: var(--tx-outline-color);\n    outline-offset: 2px;\n}\n\n/* this is the knob on the switch */\n:host(.tx-switch) > span:before {\n    display: block;\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 14px;\n    height: 14px;\n    background: var(--tx-gray-75);\n    border: 2px solid var(--tx-gray-700);\n    border-radius: 7px;\n    content: \"\";\n    box-sizing: border-box;\n\n    /* 'transform' usually can be GPU acclerated while 'left' can not */\n    transition: transform 130ms ease-in-out;\n}\n:host(.tx-switch) > input:hover + span:before {\n    border-color: var(--tx-gray-900);\n}\n\n:host(.tx-switch) > input:checked + span:before {\n    /* border-color: var(--tx-gray-700); */\n    transform: translateX(calc(100% - 2px));\n}\n\n:host(.tx-switch) > input:checked + span {\n    background: var(--tx-gray-700);\n}\n:host(.tx-switch) > input:checked:hover + span {\n    background: var(--tx-gray-900);\n}\n:host(.tx-switch) > input:hover + span + label {\n    color: var(--tx-gray-900);\n}\n\n:host(.tx-switch) > input:checked:disabled + span {\n    background: var(--tx-gray-400);\n}\n:host(.tx-switch) > input:disabled + span:before {\n    border-color: var(--tx-gray-400);\n}\n:host(.tx-switch) > input:disabled + span + label {\n    color: var(--tx-gray-400);\n}`;\n//# sourceMappingURL=tx-switch.js.map","import { BooleanView } from \"./BooleanView.js\";\nimport { style as txSwitch } from \"../style/tx-switch.js\";\nimport { input, span } from \"../util/lsx.js\";\nexport class Switch extends BooleanView {\n    constructor(init) {\n        super(init);\n        this.classList.add(\"tx-switch\");\n        this.input = input();\n        this.input.type = \"checkbox\";\n        this.input.onchange = () => {\n            this.updateModel();\n        };\n        this.attachShadow({ mode: 'open' });\n        this.attachStyle(txSwitch);\n        this.shadowRoot.appendChild(this.input);\n        this.shadowRoot.appendChild(span());\n    }\n}\nSwitch.define(\"tx-switch\", Switch);\n//# sourceMappingURL=Switch.js.map","import { css } from \"../util/lsx.js\";\nexport const style = document.createElement(\"style\");\nstyle.textContent = css `\n:host(.tx-radio) {\n    display: inline-flex;\n    align-items: flex-start;\n    position: relative;\n    vertical-align: top;\n}\n/* an invisible radiobutton will overlay everything, handling input and state */\n:host(.tx-radio) > input {\n    display: inline-block;\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    box-sizing: absolute;\n    margin: 0;\n    padding: 0;\n    opacity: 0;\n    z-index: 1;\n}\n\n/* the span provides the visual appearance */\n:host(.tx-radio) > span {\n    display: block;\n    position: relative;\n    left: 0;\n    top: 0;\n    box-sizing: border-box;\n    flex-grow: 0;\n    flex-shrink: 0;\n\n    border: 2px solid var(--tx-gray-700);\n    border-radius: 7px;\n\n    width: 14px;\n    height: 14px;\n    background: none;\n}\n\n/* focus ring */\n:host(.tx-radio) > input:focus-visible + span {\n    outline: 2px solid;\n    outline-color: var(--tx-outline-color);\n    outline-offset: 2px;\n}\n/* this is the knob on the switch */\n:host(.tx-radio) > span:before {\n    display: block;\n    position: absolute;\n    left: 0px;\n    top: 0px;\n    width: 10px;\n    height: 10px;\n    background: var(--tx-gray-75);\n    border: 2px solid var(--tx-gray-75);\n    border-radius: 7px;\n    content: \"\";\n    box-sizing: border-box;\n\n    /* 'transform' usually can be GPU acclerated while 'left' can not */\n    transition: opacity 130ms ease-in-out;\n}\n:host(.tx-radio) > input:checked + span:before {\n    background: var(--tx-gray-700);\n}\n:host(.tx-radio) > input:checked:hover + span:before {\n    background: var(--tx-gray-900);\n}\n:host(.tx-radio) > input:hover + span {\n    border-color: var(--tx-gray-900);\n}\n\n:host(.tx-radio) > input:checked:disabled + span:before {\n    background: var(--tx-gray-500);\n}\n:host(.tx-radio) > input:disabled + span {\n    border-color: var(--tx-gray-500);\n}\n`;\n//# sourceMappingURL=tx-radio.js.map","import { ModelView } from \"./ModelView.js\";\nimport { input, span } from \"../util/lsx.js\";\nimport { style as txRadio } from \"../style/tx-radio.js\";\nexport class RadioButton extends ModelView {\n    constructor(init) {\n        super(init);\n        this.classList.add(\"tx-radio\");\n        this.input = input();\n        this.input.type = \"radio\";\n        this.input.value = this.getAttribute(\"value\");\n        let view = this;\n        this.input.onchange = () => {\n            view.updateModel();\n        };\n        this.attachShadow({ mode: 'open' });\n        this.attachStyle(txRadio);\n        this.shadowRoot.appendChild(this.input);\n        this.shadowRoot.appendChild(span());\n    }\n    updateModel() {\n        if (this.model) {\n            this.model.stringValue = this.input.value;\n        }\n    }\n    updateView() {\n        if (this.model) {\n            let radioGroup = RadioButton.radioGroups.get(this.model);\n            if (radioGroup === undefined) {\n                radioGroup = ++RadioButton.radioGroupCounter;\n                RadioButton.radioGroups.set(this.model, radioGroup);\n            }\n            this.input.name = `radioGroup${radioGroup}`;\n        }\n        else {\n            this.input.name = \"\";\n        }\n        if (!this.model || !this.model.enabled) {\n            this.input.setAttribute(\"disabled\", \"\");\n        }\n        else {\n            this.input.removeAttribute(\"disabled\");\n        }\n        if (this.model) {\n            this.input.checked = this.model.stringValue === this.input.value;\n        }\n    }\n}\nRadioButton.radioGroupCounter = 0;\nRadioButton.radioGroups = new WeakMap();\nRadioButton.define(\"tx-radiobutton\", RadioButton);\n//# sourceMappingURL=RadioButton.js.map","export var MenuState;\n(function (MenuState) {\n    MenuState[MenuState[\"WAIT\"] = 0] = \"WAIT\";\n    MenuState[MenuState[\"DOWN\"] = 1] = \"DOWN\";\n    MenuState[MenuState[\"UP_N_HOLD\"] = 2] = \"UP_N_HOLD\";\n    MenuState[MenuState[\"DOWN_N_HOLD\"] = 3] = \"DOWN_N_HOLD\";\n    MenuState[MenuState[\"DOWN_N_OUTSIDE\"] = 4] = \"DOWN_N_OUTSIDE\";\n    MenuState[MenuState[\"DOWN_N_INSIDE_AGAIN\"] = 5] = \"DOWN_N_INSIDE_AGAIN\";\n})(MenuState || (MenuState = {}));\n//# sourceMappingURL=MenuState.js.map","import { View } from \"../view/View.js\";\nimport { MenuState } from \"./MenuState.js\";\nexport class MenuButtonContainer extends View {\n    constructor(props) {\n        super(props);\n        this.vertical = true;\n        this.closeOnClose = false;\n        this.state = MenuState.WAIT;\n    }\n}\n//# sourceMappingURL=MenuHelper.js.map","import { View } from \"../view/View.js\";\nimport { MenuButtonContainer } from \"./MenuHelper.js\";\nexport class PopupMenu extends MenuButtonContainer {\n    constructor(root, parent) {\n        super();\n        this.vertical = true;\n        this.root = root;\n        this.parentButton = parent;\n        this.popup = document.createElement(\"div\");\n        this.popup.classList.add(\"menu-popup\");\n        let node = root.down;\n        while (node) {\n            if (node.isAvailable()) {\n                node.createWindowAt(this, this.popup);\n            }\n            else {\n                node.deleteWindow();\n            }\n            node = node.next;\n        }\n        this.appendChild(this.popup);\n        this.show();\n    }\n    show() {\n        if (!this.parentButton.master.vertical)\n            placePopupVertical(this.parentButton, this.popup);\n        else\n            placePopupHorizontal(this.parentButton, this.popup);\n        this.style.display = \"\";\n    }\n    hide() {\n        this.style.display = \"none\";\n    }\n}\nexport function placePopupVertical(parent, popup) {\n    let parentBoundary = parent.getBoundingClientRect();\n    popup.style.opacity = \"0\";\n    popup.style.left = parentBoundary.left + \"px\";\n    popup.style.top = (parentBoundary.top + parentBoundary.height) + \"px\";\n    setTimeout(function () {\n        let popupBoundary = popup.getBoundingClientRect();\n        let popupBottom = parentBoundary.top + parentBoundary.height + popupBoundary.height;\n        if (popupBottom > window.innerHeight) {\n            popup.style.top = (parentBoundary.top - popupBoundary.height) + \"px\";\n        }\n        let popupRight = parentBoundary.left + popupBoundary.width;\n        if (popupRight > window.innerWidth) {\n            popup.style.left = (parentBoundary.left + parentBoundary.width - popupBoundary.width) + \"px\";\n        }\n        popup.style.opacity = \"1\";\n    }, 0);\n}\nexport function placePopupHorizontal(parent, popup) {\n    let parentBoundary = parent.getBoundingClientRect();\n    popup.style.opacity = \"0\";\n    popup.style.left = (parentBoundary.left + parentBoundary.width) + \"px\";\n    popup.style.top = parentBoundary.top + \"px\";\n    setTimeout(function () {\n        let popupBoundary = popup.getBoundingClientRect();\n        let popupBottom = parentBoundary.top + popupBoundary.height;\n        if (popupBottom > window.innerHeight) {\n            popup.style.top = (parentBoundary.top + parentBoundary.height - popupBoundary.height) + \"px\";\n        }\n        let popupRight = parentBoundary.left + parentBoundary.width + popupBoundary.width;\n        if (popupRight > window.innerWidth) {\n            popup.style.left = (parentBoundary.left - popupBoundary.width) + \"px\";\n        }\n        popup.style.opacity = \"1\";\n    }, 0);\n}\nView.define(\"tx-popupmenu\", PopupMenu);\n//# sourceMappingURL=PopupMenu.js.map","import { css } from \"../util/lsx.js\";\nexport const style = document.createElement(\"style\");\nstyle.textContent = css `\n:host(.tx-combobox) {\n    display: inline-flex;\n    align-items: flex-start;\n    position: relative;\n    vertical-align: top;\n}\n:host(.tx-combobox) > input {\n    box-sizing: border-box;\n    width: 100%;\n    height: 32px;\n    margin: 0;\n    padding: 3px 32px 5px 11px;\n    vertical-align: top;\n    overflow: visible;\n    outline: none;\n    display: inline-block;\n    border: 1px solid var(--tx-gray-400);\n    border-radius: 4px;\n    background-color: var(--tx-gray-50);\n\n    color: var(--tx-gray-900);  \n    font-weight: var(--tx-edit-font-weight);\n    font-size: var(--tx-edit-font-size);\n    line-height: 18px;\n}\n:host(.tx-combobox) > input::placeholder {\n    color: var(--tx-placeholder-fg-color);\n    font-style: italic;\n    font-weight: 300;\n}\n\n:host(.tx-combobox) > button {\n    position: absolute;\n    right: 0;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    border-style: none;\n    box-sizing: border-box;\n    overflow: visible;\n    margin: 0;\n    text-transform: none;\n\n    width: 32px;\n    height: 32px;\n    background-color: var(--tx-gray-75);\n    border-radius: 0 4px 4px 0;\n    border: 1px solid var(--tx-gray-400);\n}\n:host(.tx-combobox) > button > svg {\n    fill: var(--tx-gray-700);\n    transform: rotate(90deg) translate(5px, 8px);\n}\n\n:host(.tx-combobox) > input:hover {\n    border-color: var(--tx-gray-500);\n}\n:host(.tx-combobox) > button:hover {\n    border-color: var(--tx-gray-500);\n    background-color: var(--tx-gray-50);\n}\n:host(.tx-combobox) > button:hover > svg {\n    fill: var(--tx-gray-900);\n}\n\n:host(.tx-combobox) > input:focus {\n    border-color: var(--tx-outline-color);\n}\n:host(.tx-combobox) > input:focus + button {\n    border-color: var(--tx-outline-color);\n}\n/* spectrum use a 1px focus ring when the focus was set by mouse\n * and a 2px focus ring when the focus was set by keyboard\n * no clue how to do that with css\n *\n/* :host(.tx-combobox) > input:focus-visible {\n    outline: 1px solid var(--tx-outline-color);\n}\n:host(.tx-combobox) > input:focus-visible + button {\n    outline: 1px solid var(--tx-outline-color);\n    border-left: none;\n} */\n\n:host(.tx-combobox) > input:disabled {\n    color: var(--tx-gray-700);\n    background-color: var(--tx-gray-200);\n    border-color: var(--tx-gray-200);\n}\n:host(.tx-combobox) > input:disabled + button {\n    background-color: var(--tx-gray-200);\n    border-color: var(--tx-gray-200);\n}\n:host(.tx-combobox) > input:disabled + button > svg {\n    fill: var(--tx-gray-400);\n}\n`;\n//# sourceMappingURL=tx-combobox.js.map","import { css } from \"../util/lsx.js\";\nexport const style = document.createElement(\"style\");\nstyle.textContent = css `\n.tx-popover {\n    background-color: var(--tx-gray-50);\n    border: 1px solid var(--tx-gray-400);\n    border-radius: 4px;\n    display: inline-flex;\n    flex-direction: column;\n    filter: drop-shadow(rgba(0, 0, 0, 0.5) 0px 1px 4px);\n}\n.tx-menu {\n    display: inline-block;\n    padding: 0;\n    margin: 4px 0 4px 0;\n}\n.tx-menu > li {\n    cursor: pointer;\n    display: flex;\n    border: none;\n    border-left: 2px solid var(--tx-gray-50);\n    border-right: 2px solid var(--tx-gray-50);\n    padding: 7px 11px 7px 10px;\n    margin: 0;\n    font-weight: 500;\n    outline: none;\n}\n.tx-menu > li:hover {\n    background-color: var(--tx-gray-100);\n    border-color: var(--tx-gray-100);\n}\n.tx-menu > li.tx-hover {\n    background-color: var(--tx-gray-100);\n    border-color: var(--tx-gray-100);\n}\n.tx-menu > li:focus {\n    border-left-color: var(--tx-outline-color);\n}\n.tx-menu > li[role=separator] {\n    display: block;\n    box-sizing: content-box;\n    overflow: visible;\n    cursor: default;\n    height: 2px;\n    padding: 0px;\n    margin: 1.5px 7px 1.5px 7px;\n    background-color: var(--tx-gray-100);\n    white-space: pre;\n    list-style-type: none;\n}\n.tx-menu > li.tx-disabled {\n    color: var(--tx-gray-500);\n}\n.tx-menu > li.tx-disabled:hover {\n    background-color: var(--tx-gray-50);\n}`;\n//# sourceMappingURL=tx-menu.js.map","import { ModelView } from \"./ModelView.js\";\nimport { OptionModelBase } from \"../model/OptionModelBase.js\";\nimport { input, button, svg, path, div, ul, li, array, text } from \"../util/lsx.js\";\nimport { placePopupVertical } from \"../menu/PopupMenu.js\";\nimport { TextModel } from \"../model/TextModel.js\";\nimport { globalController } from \"../controller/globalController.js\";\nimport { style as txCombobox } from \"../style/tx-combobox.js\";\nimport { style as txMenu } from \"../style/tx-menu.js\";\nexport class Select extends ModelView {\n    constructor(init) {\n        super(init);\n        this.input = input();\n        this.input.type = \"text\";\n        this.asPopupMenu();\n        let view = this;\n        this.input.oninput = () => {\n            view.updateModel();\n        };\n        this.input.onblur = (ev) => {\n            if (this.hover === undefined) {\n                this.close();\n            }\n        };\n        let s;\n        const b = button(s = svg(path(\"M3 9.95a.875.875 0 01-.615-1.498L5.88 5 2.385 1.547A.875.875 0 013.615.302L7.74 4.377a.876.876 0 010 1.246L3.615 9.698A.872.872 0 013 9.95z\")));\n        this.button = b;\n        b.tabIndex = -1;\n        b.style.outline = \"none\";\n        s.style.width = \"100%\";\n        s.style.height = \"100%\";\n        b.onpointerdown = (ev) => {\n            if (this.popup) {\n                this.close();\n                return;\n            }\n            ev.preventDefault();\n            this.input.focus();\n            this.open();\n            b.setPointerCapture(ev.pointerId);\n        };\n        b.onpointermove = (ev) => {\n            if (this.popup === undefined) {\n                return;\n            }\n            const e = this.shadowRoot.elementFromPoint(ev.clientX, ev.clientY);\n            let newHover;\n            if (e instanceof HTMLLIElement) {\n                newHover = e;\n            }\n            else {\n                newHover = undefined;\n            }\n            if (this.hover !== newHover) {\n                if (this.hover) {\n                    this.hover.classList.remove(\"tx-hover\");\n                }\n                this.hover = newHover;\n                if (this.hover) {\n                    this.hover.classList.add(\"tx-hover\");\n                }\n            }\n        };\n        b.onpointerup = (ev) => {\n            if (this.hover) {\n                const idx = parseInt(this.hover.dataset[\"idx\"]);\n                this.close();\n                this.select(idx);\n                return;\n            }\n            const e = this.shadowRoot.elementFromPoint(ev.clientX, ev.clientY);\n            if (b.contains(e)) {\n                this.input.focus();\n                return;\n            }\n            this.close();\n        };\n        this.keydown = this.keydown.bind(this);\n        this.input.onkeydown = this.keydown;\n        this.wheel = this.wheel.bind(this);\n        this.input.onwheel = this.button.onwheel = this.wheel;\n        this.classList.add(\"tx-combobox\");\n        this.attachShadow({ mode: 'open' });\n        this.attachStyle(txCombobox);\n        this.attachStyle(txMenu);\n        this.shadowRoot.appendChild(this.input);\n        this.shadowRoot.appendChild(b);\n    }\n    connectedCallback() {\n        if (this.controller)\n            return;\n        super.connectedCallback();\n        const text = this.getAttribute(\"text\");\n        if (text !== null) {\n            globalController.registerView(`M:${text}`, this);\n            this.asComboBox();\n            this.updateModel();\n        }\n    }\n    setModel(model) {\n        if (!model) {\n            if (this.text) {\n                this.text.modified.remove(this);\n                this.text = undefined;\n            }\n            super.setModel(model);\n            return;\n        }\n        if (model instanceof OptionModelBase) {\n            super.setModel(model);\n        }\n        if (model instanceof TextModel) {\n            this.text = model;\n            this.text.modified.add(() => {\n                this.input.value = this.text.value;\n            }, this);\n        }\n    }\n    keydown(ev) {\n        if (this.input.readOnly) {\n            ev.preventDefault();\n        }\n        switch (ev.key) {\n            case \"ArrowUp\":\n                this.previousItem();\n                break;\n            case \"ArrowDown\":\n                this.nextItem();\n                break;\n        }\n    }\n    wheel(ev) {\n        ev.preventDefault();\n        this.input.focus();\n        if (ev.deltaY > 0) {\n            this.nextItem();\n        }\n        if (ev.deltaY < 0) {\n            this.previousItem();\n        }\n    }\n    asPopupMenu() {\n        this.input.readOnly = true;\n        for (let property of [\"user-select\", \"-webkit-user-select\", \"-webkit-touch-callout\", \"-khtml-user-select\"]) {\n            this.input.style.setProperty(property, \"none\");\n        }\n    }\n    asComboBox() {\n        this.input.readOnly = false;\n        for (let property of [\"user-select\", \"-webkit-user-select\", \"-webkit-touch-callout\", \"-khtml-user-select\"]) {\n            this.input.style.removeProperty(property);\n        }\n    }\n    updateModel() {\n        if (this.text) {\n            this.text.value = this.input.value;\n        }\n    }\n    updateView() {\n        if (!this.model || !this.model.enabled) {\n            this.input.setAttribute(\"disabled\", \"\");\n        }\n        else {\n            this.input.removeAttribute(\"disabled\");\n        }\n        if (this.model !== undefined) {\n            this.input.value = this.displayName(this.model.stringValue);\n            this.updateModel();\n        }\n    }\n    displayName(value) {\n        for (let i = 0; i < this.children.length; ++i) {\n            const child = this.children[i];\n            if (child.nodeName === \"OPTION\") {\n                const option = child;\n                if (option.value === value) {\n                    return option.text;\n                }\n            }\n        }\n        let all = \"\";\n        for (let i = 0; i < this.children.length; ++i) {\n            const child = this.children[i];\n            if (child.nodeName === \"OPTION\") {\n                const option = child;\n                all = `${all} '${option.value}'`;\n            }\n        }\n        if (all.length === 0) {\n            all = \" empty option list\";\n        }\n        console.log(`'${value}' is not in${all} of <tx-select model=\"${this.getAttribute(\"model\")}\">`);\n        console.trace(this);\n        return \"\";\n    }\n    open() {\n        let view = this;\n        let u;\n        this.popup = div(u = ul(...array(this.children.length, (idx) => {\n            const l = li(text(this.children.item(idx).innerText));\n            l.tabIndex = 0;\n            l.ariaRoleDescription = \"option\";\n            l.dataset[\"idx\"] = `${idx}`;\n            l.onpointerdown = (ev) => {\n                this.button.setPointerCapture(ev.pointerId);\n                this.hover = l;\n                ev.preventDefault();\n            };\n            l.onclick = () => {\n                view.select(idx);\n            };\n            this.children[idx];\n            return l;\n        })));\n        this.popup.classList.add(\"tx-popover\");\n        this.popup.style.position = \"fixed\";\n        this.popup.style.zIndex = \"99\";\n        u.ariaRoleDescription = \"listbox\";\n        u.classList.add(\"tx-menu\");\n        this.shadowRoot.appendChild(this.popup);\n        placePopupVertical(this, this.popup);\n    }\n    close() {\n        this.hover = undefined;\n        if (this.popup !== undefined) {\n            this.shadowRoot.removeChild(this.popup);\n            this.popup = undefined;\n        }\n    }\n    select(index) {\n        if (this.model === undefined) {\n            console.log(`<tx-select model='${this.getAttribute(\"model\")}'> has no model`);\n            return;\n        }\n        this.close();\n        const option = this.children[index];\n        if (!(option instanceof HTMLOptionElement)) {\n            console.log(`<tx-select>: unpexected element <${option.nodeName.toLowerCase()}> instead of <option>`);\n            return;\n        }\n        this.model.stringValue = option.value;\n    }\n    getIndex() {\n        const v = this.model?.stringValue;\n        for (let i = 0; i < this.children.length; ++i) {\n            if (this.children[i].value === v)\n                return i;\n        }\n        return undefined;\n    }\n    nextItem() {\n        let index = this.getIndex();\n        if (index === undefined) {\n            index = 0;\n        }\n        else {\n            ++index;\n        }\n        if (index >= this.children.length) {\n            return;\n        }\n        this.select(index);\n    }\n    previousItem() {\n        let index = this.getIndex();\n        if (index === undefined) {\n            index = this.children.length - 1;\n        }\n        else {\n            --index;\n        }\n        if (index < 0) {\n            return;\n        }\n        this.select(index);\n    }\n}\nSelect.define(\"tx-select\", Select);\n//# sourceMappingURL=Select.js.map","import { css } from \"../util/lsx.js\";\nexport const style = document.createElement(\"style\");\nstyle.textContent = css `\n\n:host(.tx-slider) {\n    height: 14px;\n    position: relative;\n    width: 100%;\n    display: inline-block;\n}\n:host(.tx-slider) > input {\n    position: absolute;\n    top: 4px;\n    -webkit-appearance: none;\n    width: 100%;\n    height: 2px;\n    border: none;\n    background: var(--tx-gray-700); /* track */\n    outline: none;\n}\n\n:host(.tx-slider) > input::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    appearance: none;\n    width: 14px;\n    height: 14px;\n    border: 2px solid var(--tx-gray-700); /* knob border */\n    border-radius: 50%;\n    background: var(--tx-gray-75); /* inside knob */\n    cursor: pointer;\n    box-sizing: border-box;\n}\n:host(.tx-slider) > input::-moz-range-thumb {\n    width: 14px;\n    height: 14px;\n    border: 2px solid var(--tx-gray-700); /* knob border */\n    border-radius: 50%;\n    background: var(--tx-gray-75); /* inside knob */\n    box-sizing: border-box;\n}\n\n/* focus ring */\n:host(.tx-slider) > input:focus::-webkit-slider-thumb {\n    outline: 2px solid;\n    outline-color: var(--tx-outline-color);\n    outline-offset: 2px;\n}\n:host(.tx-slider) > input:focus::-moz-range-thumb {\n    outline: 2px solid;\n    outline-color: var(--tx-outline-color);\n    outline-offset: 2px;\n}\n\n:host(.tx-slider) > input::-moz-focus-outer {\n    border: 0;\n}\n\n:host(.tx-slider) > input:hover {\n    background: var(--tx-gray-800); /* track */\n}\n:host(.tx-slider) > input:hover::-webkit-slider-thumb {\n    border: 2px solid var(--tx-gray-800); /* knob border */\n}\n:host(.tx-slider) > input:hover::-moz-range-thumb {\n    border: 2px solid var(--tx-gray-800); /* knob border */\n}\n\n:host(.tx-slider) > input:disabled {\n    background: var(--tx-gray-500); /* track */\n}\n:host(.tx-slider) > input:disabled::-webkit-slider-thumb {\n    border: 2px solid var(--tx-gray-500); /* knob border */\n}\n:host(.tx-slider) > input:disabled::-moz-range-thumb {\n    border: 2px solid var(--tx-gray-500); /* knob border */\n}\n`;\n//# sourceMappingURL=tx-slider.js.map","import { ModelView } from \"./ModelView.js\";\nimport { style as txSlider } from \"../style/tx-slider.js\";\nexport class Slider extends ModelView {\n    constructor(init) {\n        super(init);\n        this.input = document.createElement(\"input\");\n        this.input.type = \"range\";\n        let view = this;\n        this.input.oninput = () => {\n            view.updateModel();\n        };\n        this.classList.add(\"tx-slider\");\n        this.attachShadow({ mode: 'open' });\n        this.attachStyle(txSlider);\n        this.shadowRoot.appendChild(this.input);\n    }\n    updateModel() {\n        if (this.model)\n            this.model.value = Number.parseFloat(this.input.value);\n    }\n    updateView() {\n        if (!this.model)\n            return;\n        if (this.model.step === undefined && this.model.min !== undefined && this.model.max !== undefined)\n            this.input.step = `${(this.model.max - this.model.min) / 100}`;\n        else\n            this.input.step = String(this.model.step);\n        this.input.min = String(this.model.min);\n        this.input.max = String(this.model.max);\n        this.input.value = String(this.model.value);\n    }\n}\nSlider.define(\"tx-slider\", Slider);\n//# sourceMappingURL=Slider.js.map","import { View } from \"./View.js\";\nexport class GenericTool extends View {\n    static focusIn(view) {\n        const viewParents = new Map();\n        for (let parent = view.parentElement, distance = 0; parent !== null; parent = parent.parentElement, ++distance) {\n            viewParents.set(parent, distance);\n        }\n        let closestToolDistance = Number.MAX_SAFE_INTEGER;\n        let closestParent;\n        let closestToolList = new Array();\n        for (const tool of this.allTools.values()) {\n            if (!tool.canHandle(view))\n                continue;\n            for (let toolParent = tool.parentElement, depth = 0; toolParent !== null; toolParent = toolParent.parentElement, ++depth) {\n                const toolDistance = viewParents.get(toolParent);\n                if (toolDistance === undefined)\n                    continue;\n                if (closestToolDistance < toolDistance)\n                    continue;\n                if (closestToolDistance > toolDistance) {\n                    closestToolList.length = 0;\n                }\n                closestToolDistance = toolDistance;\n                closestParent = toolParent;\n                closestToolList.push(tool);\n            }\n        }\n        if (!closestParent) {\n            return;\n        }\n        let closestTool;\n        const viewIndex = GenericTool.getIndex(view, closestParent);\n        let closestNextSiblingIndex = Number.MIN_SAFE_INTEGER;\n        for (let tool of closestToolList) {\n            const toolIndex = GenericTool.getIndex(tool, closestParent);\n            if (toolIndex < viewIndex && toolIndex > closestNextSiblingIndex) {\n                closestNextSiblingIndex = toolIndex;\n                closestTool = tool;\n            }\n        }\n        this.setActive(closestTool, view);\n    }\n    static getIndex(view, parent) {\n        if (parent === undefined) {\n            console.trace(`GenericTool.getIndex(${view}, ${parent})`);\n        }\n        let element = view;\n        while (element.parentElement !== parent)\n            element = element.parentElement;\n        return Array.from(parent.childNodes).indexOf(element);\n    }\n    static setActive(tool, view) {\n        if (this.activeTool)\n            this.activeTool.deactivate();\n        this.activeTool = tool;\n        this.activeView = view;\n        if (tool)\n            tool.activate();\n    }\n    static focusOut(view) {\n        if (this.activeView === view) {\n            this.setActive(undefined, undefined);\n        }\n    }\n    connectedCallback() {\n        super.connectedCallback();\n        GenericTool.allTools.add(this);\n    }\n    disconnectedCallback() {\n        if (GenericTool.activeTool === this) {\n            GenericTool.setActive(undefined, undefined);\n        }\n        GenericTool.allTools.delete(this);\n        super.disconnectedCallback();\n    }\n}\nGenericTool.allTools = new Set();\nwindow.addEventListener(\"focusin\", (event) => {\n    if (event.target instanceof GenericTool)\n        return;\n    if (event.relatedTarget instanceof View) {\n        GenericTool.focusOut(event.relatedTarget);\n    }\n    if (event.target instanceof View) {\n        GenericTool.focusIn(event.target);\n    }\n});\n//# sourceMappingURL=GenericTool.js.map","import { ModelView } from \"./ModelView.js\";\nlet toolbuttonStyle = document.createElement(\"style\");\ntoolbuttonStyle.textContent = `\n:host {\n    display: inline-block;\n    overflow: hidden;\n    box-sizing: border-box;\n    border: 1px solid #e3dbdb;\n    border-radius: 3px;\n    background: #e3dbdb;\n    width: 32px;\n    height: 32px;\n    margin: 0;\n    padding: 0;\n}\n\n:host([selected]) {\n    background: #ac9393;\n}\n\n:host([disabled]) {\n    opacity: 0.5;\n}\n\n:host([disabled]) img {\n    opacity: 0.5;\n}\n\n:host([checked][disabled]) {\n}\n`;\nexport class ToolButton extends ModelView {\n    constructor(init) {\n        super(init);\n        if (!init) {\n            init = {\n                value: this.getAttribute(\"value\"),\n                img: this.getAttribute(\"img\"),\n                disabled: this.hasAttribute(\"disabled\")\n            };\n        }\n        else {\n            this.setAttribute(\"value\", init.value);\n            this.setAttribute(\"img\", init.img);\n            if (init.disabled === true)\n                this.setAttribute(\"disabled\", \"disabled\");\n        }\n        this.onmousedown = (event) => {\n            if (this.hasAttribute(\"disabled\")) {\n                return;\n            }\n            this.focus();\n            event.preventDefault();\n            if (this.model !== undefined) {\n                this.model.stringValue = this.getValue();\n            }\n        };\n        let img = document.createElement(\"img\");\n        img.src = init.img;\n        this.attachShadow({ mode: 'open' });\n        this.shadowRoot.appendChild(document.importNode(toolbuttonStyle, true));\n        this.shadowRoot.appendChild(img);\n    }\n    getValue() {\n        let value = this.getAttribute(\"value\");\n        if (value === null)\n            throw Error(\"no value\");\n        return value;\n    }\n    connectedCallback() {\n        super.connectedCallback();\n        if (this.model === undefined)\n            this.setAttribute(\"disabled\", \"\");\n    }\n    updateView() {\n        if (this.model === undefined) {\n            this.setAttribute(\"disabled\", \"\");\n            this.removeAttribute(\"selected\");\n            return;\n        }\n        let value = this.getValue();\n        if (this.model.isValidStringValue(value)) {\n            this.removeAttribute(\"disabled\");\n        }\n        else {\n            this.setAttribute(\"disabled\", \"\");\n        }\n        if (this.model.stringValue === value) {\n            this.setAttribute(\"selected\", \"\");\n        }\n        else {\n            this.removeAttribute(\"selected\");\n        }\n    }\n}\nToolButton.define(\"tx-toolbutton\", ToolButton);\n//# sourceMappingURL=ToolButton.js.map","import { HtmlModel } from \"../model/HtmlModel.js\";\nimport { ModelView } from \"./ModelView.js\";\nexport class SlotView extends ModelView {\n    constructor(init) {\n        super(init);\n    }\n    updateView() {\n        if (!this.model)\n            return;\n        let value = this.model.value === undefined ? \"\" : this.model.value;\n        if (this.model instanceof HtmlModel)\n            this.innerHTML = value;\n        else\n            this.innerText = value;\n    }\n}\nSlotView.define(\"tx-slot\", SlotView);\n//# sourceMappingURL=SlotView.js.map","import { ModelView } from \"./ModelView.js\";\nexport class ToadIf extends ModelView {\n    constructor(init) {\n        super(init);\n    }\n    updateView() {\n        if (this.model) {\n            this.style.display = this.model.value ? \"\" : \"none\";\n        }\n    }\n}\nToadIf.define(\"tx-if\", ToadIf);\n//# sourceMappingURL=ToadIf.js.map","import { css } from \"../util/lsx.js\";\nexport const style = document.createElement(\"style\");\nstyle.textContent = css `\n/*\n  tabs, line, content\n*/\n:host(.tx-tabs) {\n    position: relative;\n    display: flex;\n    flex-wrap: nowrap;\n    box-sizing: border-box;\n}\n:host(.tx-tabs:not(.tx-vertical)) {\n    flex-direction: column;\n}\n:host(.tx-tabs.tx-vertical) {\n    flex-direction: row;\n}\n\n/*\n * tabs\n */\n:host(.tx-tabs) > ul {\n    display: flex;\n    flex-wrap: nowrap;\n    list-style: none;\n    box-sizing: border-box;\n    padding: 0;\n    margin: 0;\n}\n:host(.tx-tabs:not(.tx-vertical)) > ul {\n    flex-direction: row;\n    border-bottom: 2px solid var(--tx-gray-200);\n}\n:host(.tx-tabs.tx-vertical) > ul {\n    border-left: 2px solid var(--tx-gray-200);\n    flex-direction: column;\n}\n:host(.tx-tabs) > ul > li {\n    box-sizing: border-box;\n    list-style: none;\n}\n\n/*\n * label\n */\n:host(.tx-tabs) > ul > li > span {\n    display: block;\n    list-style: none;\n    font-weight: 500;\n    margin: 8px 12px 8px 12px;\n    color: var(--tx-gray-700);\n    cursor: pointer;\n}\n:host(.tx-tabs.tx-vertical) > ul > li > span {\n    margin: 0;\n    padding: 12px 8px 12px 8px;\n}\n:host(.tx-tabs) > ul > li > span.active {\n    color: var(--tx-gray-900);\n}\n:host(.tx-tabs) > ul > li > span:hover {\n    color: var(--tx-gray-900);\n}\n\n/*\n * line\n */\n:host(.tx-tabs) > div.line {\n    background-color: var(--tx-gray-900);\n    pointer-events: none;\n}\n:host(.tx-tabs:not(.tx-vertical)) > div.line  {\n    transition: left 0.5s ease-in-out, width 0.5s 0.10s;\n    position: relative; /* below labels */\n    top: 0px;\n    height: 2px;\n    left: 12px;\n    width: 0px;\n}\n:host(.tx-tabs.tx-vertical) > div.line  {\n    transition: top 0.5s ease-in-out, width 0.5s 0.10s;\n    position: absolute; left: 0; /* before labels */\n    height: 0px;\n    width: 2px;\n}\n\n.content {\n    flex-grow: 1;\n}\n\n`;\n//# sourceMappingURL=tx-tabs.js.map","import { View } from \"../view/View.js\";\nimport { ul, li, span, text, div, slot } from \"../util/lsx.js\";\nimport { style as txTabs } from \"../style/tx-tabs.js\";\nimport { ModelView } from \"./ModelView.js\";\nexport class Tabs extends ModelView {\n    constructor(init) {\n        super(init);\n        this.setTab = this.setTab.bind(this);\n        this.classList.add(\"tx-tabs\");\n        if (this.hasAttribute(\"vertical\")) {\n            this.classList.add(\"tx-vertical\");\n        }\n        this.content = div(slot());\n        this.content.classList.add(\"content\");\n        const tabContainer = ul();\n        for (let i = 0; i < this.children.length; ++i) {\n            const child = this.children[i];\n            if (child.nodeName !== \"TX-TAB\") {\n                console.log(`unexpected <${child.nodeName.toLowerCase()}> within <tabs>`);\n                continue;\n            }\n            const tab = child;\n            let tabLabel;\n            tabContainer.appendChild(li(tabLabel = span(text(tab.getAttribute(\"label\")))));\n            tabLabel.onpointerdown = (ev) => {\n                ev.stopPropagation();\n                ev.preventDefault();\n                ev.cancelBubble = true;\n                this.setTab(tabLabel, tab);\n            };\n            if (this.activeTab === undefined) {\n                this.activeTab = tabLabel;\n                this.activePanel = tab;\n            }\n            else {\n                tab.style.display = \"none\";\n            }\n        }\n        this.attachShadow({ mode: 'open' });\n        this.shadowRoot.appendChild(document.importNode(txTabs, true));\n        this.shadowRoot.appendChild(tabContainer);\n        this.shadowRoot.appendChild(this.markerLine = div());\n        this.shadowRoot.appendChild(this.content);\n        this.markerLine.classList.add(\"line\");\n        if (this.activeTab) {\n            this.setTab(this.activeTab, this.activePanel);\n        }\n    }\n    connectedCallback() {\n        super.connectedCallback();\n        this.adjustLine();\n    }\n    setTab(tab, panel) {\n        this.activeTab.classList.remove(\"active\");\n        this.activeTab = tab;\n        this.activeTab.classList.add(\"active\");\n        this.activePanel.style.display = \"none\";\n        this.activePanel = panel;\n        this.activePanel.style.display = \"\";\n        this.adjustLine();\n        if (this.model && panel.value) {\n            this.model.stringValue = panel.value;\n        }\n    }\n    adjustLine() {\n        const line = this.markerLine;\n        const tab = this.activeTab;\n        if (tab !== undefined) {\n            if (this.hasAttribute(\"vertical\")) {\n                line.style.top = `${tab.offsetTop}px`;\n                line.style.height = `${tab.clientHeight}px`;\n            }\n            else {\n                line.style.top = `-2px`;\n                line.style.left = `${tab.offsetLeft}px`;\n                line.style.width = `${tab.clientWidth}px`;\n            }\n        }\n    }\n}\nTabs.define(\"tx-tabs\", Tabs);\nexport class Tab extends View {\n    constructor(init) {\n        super(init);\n        this.label = init?.label;\n        this.value = init?.value;\n    }\n}\nView.define(\"tx-tab\", Tab);\n//# sourceMappingURL=Tab.js.map","export const menuStyle = document.createElement(\"style\");\nmenuStyle.textContent = `\n  :host(.menu-button) {\n    font-family: var(--tx-font-family);\n    font-size: var(--tx-edit-font-size);\n    font-weight: var(--tx-edit-font-weight);\n    padding: 7px;\n    vertical-align: center;\n  \n    background: var(--tx-gray-200);\n    color: var(--tx-gray-900);\n    cursor: default;\n  }\n  :host(.menu-button:hover) {\n    background: var(--tx-gray-300);\n  }\n  :host(.menu-button.active) {\n    background: var(--tx-gray-400);\n    color: var(--tx-gray-900);\n  }\n  :host(.menu-button.disabled) {\n    color: var(--tx-gray-500);\n  }\n  :host(.menu-button.active.disabled) {\n    color: var(--tx-gray-700);\n  }\n  :host(.menu-button.menu-down) {\n    padding-right: 20px;\n    background-image: url(\"data:image/svg+xml;base64,${btoa('<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"14\"><path d=\"M 0 4 l 10 0 l -5 5 Z\" fill=\"#fff\" stroke=\"none\"/></svg>')}\");\n    background-repeat: no-repeat;\n    background-position: right center;\n  }\n  :host(.menu-button.active.menu-down) {\n    background-image: url(\"data:image/svg+xml;base64,${btoa('<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"14\"><path d=\"M 0 4 l 10 0 l -5 5 Z\" fill=\"#fff\" stroke=\"none\"/></svg>')}\");\n    background-repeat: no-repeat;\n    background-position: right center;\n  }\n  :host(.menu-button.menu-side) {\n    padding-right: 20px;\n    background-image: url(\"data:image/svg+xml;base64,${btoa('<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"14\"><path d=\"M 0 2 l 0 10 l 5 -5 Z\" fill=\"#fff\" stroke=\"none\"/></svg>')}\");\n    background-repeat: no-repeat;\n    background-position: right center;\n  }\n  :host(.menu-button.active.menu-side) {\n    background-image: url(\"data:image/svg+xml;base64,${btoa('<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"14\"><path d=\"M 0 2 l 0 10 l 5 -5 Z\" fill=\"#fff\" stroke=\"none\"/></svg>')}\");\n    background-repeat: no-repeat;\n    background-position: right center;\n  }\n  .menu-bar {\n    display: flex;\n    flex-direction: row;\n    justify-content: flex-start;\n    align-items: center;\n    background-color: var(--tx-gray-200);\n  }\n  .menu-popup {\n    position: fixed;\n    display: flex;\n    flex-direction: column;\n    box-shadow: 2px 2px 5px var(--tx-gray-50);\n  }\n`;\n//# sourceMappingURL=menuStyle.js.map","import { Action } from \"../model/Action.js\";\nimport { HtmlModel } from \"../model/HtmlModel.js\";\nimport { TextModel } from \"../model/TextModel.js\";\nimport { ModelView } from \"../view/ModelView.js\";\nimport { globalController } from \"../controller/globalController.js\";\nimport { menuStyle } from \"./menuStyle.js\";\nimport { MenuState } from \"./MenuState.js\";\nimport { PopupMenu } from \"./PopupMenu.js\";\nexport class MenuButton extends ModelView {\n    constructor(master, node) {\n        super();\n        this.master = master;\n        this.node = node;\n        let menuButton = this;\n        this.classList.add(\"menu-button\");\n        if (node.down) {\n            if (master.vertical)\n                this.classList.add(\"menu-side\");\n            else\n                this.classList.add(\"menu-down\");\n        }\n        this.updateView();\n        this.onmousedown = (event) => {\n            event.stopPropagation();\n            let documentMouseUp = function (event) {\n                document.removeEventListener(\"mouseup\", documentMouseUp, { capture: true });\n                event.preventDefault();\n                setTimeout(() => {\n                    if (MenuButton.buttonDown)\n                        menuButton.dispatchEvent(new MouseEvent(\"mouseup\", event));\n                }, 0);\n            };\n            document.addEventListener(\"mouseup\", documentMouseUp, { capture: true });\n            MenuButton.buttonDown = true;\n            if (!this.master)\n                throw Error(\"yikes\");\n            switch (this.master.state) {\n                case MenuState.WAIT:\n                    this.master.state = MenuState.DOWN;\n                    this.activate();\n                    break;\n                case MenuState.UP_N_HOLD:\n                    if (this.master.active !== this) {\n                        this.master.state = MenuState.DOWN;\n                        this.activate();\n                    }\n                    else {\n                        this.master.state = MenuState.DOWN_N_HOLD;\n                    }\n                    break;\n                default:\n                    throw Error(\"unexpected state \" + this.master.state);\n            }\n            return false;\n        };\n        this.onmouseup = (event) => {\n            event.stopPropagation();\n            if (!MenuButton.buttonDown)\n                return;\n            MenuButton.buttonDown = false;\n            if (!this.master)\n                throw Error(\"yikes\");\n            if (!this.node)\n                throw Error(\"yikes\");\n            switch (this.master.state) {\n                case MenuState.DOWN:\n                    if (this.node.isEnabled() && !this.node.down) {\n                        this.trigger();\n                        this.master.state = MenuState.WAIT;\n                    }\n                    else {\n                        this.master.state = MenuState.UP_N_HOLD;\n                        if (MenuButton.documentMouseDown) {\n                            document.removeEventListener(\"mousedown\", MenuButton.documentMouseDown, { capture: false });\n                        }\n                        MenuButton.documentMouseDown = function (event) {\n                            if (MenuButton.documentMouseDown)\n                                document.removeEventListener(\"mousedown\", MenuButton.documentMouseDown, { capture: false });\n                            MenuButton.documentMouseDown = undefined;\n                            let tagName = event.target.tagName;\n                            if (tagName !== \"TOAD-MENUBUTTON\") {\n                                menuButton.collapse();\n                            }\n                        };\n                        document.addEventListener(\"mousedown\", MenuButton.documentMouseDown, { capture: false });\n                    }\n                    break;\n                case MenuState.DOWN_N_HOLD:\n                case MenuState.DOWN_N_OUTSIDE:\n                    this.master.state = MenuState.WAIT;\n                    this.deactivate();\n                    this.collapse();\n                    if (this.master.closeOnClose) {\n                    }\n                    break;\n                case MenuState.DOWN_N_INSIDE_AGAIN:\n                    this.trigger();\n                    break;\n                default:\n                    throw Error(\"unexpected state \" + this.master.state);\n            }\n            return false;\n        };\n        this.onmouseout = (event) => {\n            event.stopPropagation();\n            if (!this.master)\n                throw Error(\"yikes\");\n            MenuButton.inside = undefined;\n            switch (this.master.state) {\n                case MenuState.WAIT:\n                case MenuState.DOWN_N_OUTSIDE:\n                case MenuState.UP_N_HOLD:\n                case MenuState.DOWN_N_HOLD:\n                    break;\n                case MenuState.DOWN:\n                case MenuState.DOWN_N_INSIDE_AGAIN:\n                    this.master.state = MenuState.DOWN_N_OUTSIDE;\n                    this.updateView();\n                    break;\n                default:\n                    throw Error(\"unexpected state\");\n            }\n            return false;\n        };\n        this.onmouseover = (event) => {\n            event.stopPropagation();\n            if (!menuButton.master)\n                throw Error(\"yikes\");\n            MenuButton.inside = menuButton;\n            switch (menuButton.master.state) {\n                case MenuState.WAIT:\n                case MenuState.UP_N_HOLD:\n                case MenuState.DOWN_N_OUTSIDE:\n                case MenuState.DOWN_N_HOLD:\n                case MenuState.DOWN:\n                case MenuState.DOWN_N_INSIDE_AGAIN:\n                    if (!MenuButton.buttonDown)\n                        break;\n                    if (!this.master)\n                        throw Error(\"yikes\");\n                    if (this.master.active)\n                        this.master.active.deactivate();\n                    this.master.state = MenuState.DOWN_N_INSIDE_AGAIN;\n                    this.activate();\n                    break;\n                default:\n                    throw Error(\"unexpected state \" + menuButton.master.state);\n            }\n            return false;\n        };\n        this.attachShadow({ mode: 'open' });\n        if (!this.shadowRoot)\n            throw Error(\"yikes\");\n        this.shadowRoot.appendChild(document.importNode(menuStyle, true));\n        if (!this.node.modelId)\n            this.shadowRoot.appendChild(document.createTextNode(node.label));\n    }\n    connectedCallback() {\n        if (this.controller)\n            return;\n        if (this.node.down === undefined) {\n            let actionId = this.node.title;\n            for (let node = this.node.parent; node; node = node.parent) {\n                if (!node.title.length)\n                    break;\n                actionId = node.title + \"|\" + actionId;\n            }\n            actionId = \"A:\" + actionId;\n            globalController.registerView(actionId, this);\n        }\n        if (this.node.modelId !== undefined) {\n            if (typeof this.node.modelId === \"string\") {\n                let modelId = \"M:\" + this.node.modelId;\n                globalController.registerView(modelId, this);\n            }\n            else {\n                this.setModel(this.node.modelId);\n            }\n        }\n    }\n    disconnectedCallback() {\n        if (this.controller)\n            this.controller.unregisterView(this);\n    }\n    setModel(model) {\n        if (!model) {\n            if (this.action)\n                this.action.modified.remove(this);\n            this.model = undefined;\n            this.action = undefined;\n            this.updateView();\n            return;\n        }\n        if (model instanceof Action) {\n            this.action = model;\n            this.action.modified.add(() => {\n                this.updateView();\n            }, this);\n        }\n        else if (model instanceof TextModel) {\n            this.model = model;\n        }\n        else {\n            throw Error(\"unexpected model of type \" + model.constructor.name);\n        }\n        this.updateView();\n    }\n    updateView() {\n        if (this.model && this.model.value) {\n            if (!this.shadowRoot)\n                throw Error(\"yikes\");\n            let span = document.createElement(\"span\");\n            if (this.model instanceof HtmlModel)\n                span.innerHTML = this.model.value;\n            else\n                span.innerText = this.model.value;\n            if (this.shadowRoot.children.length > 1)\n                this.shadowRoot.removeChild(this.shadowRoot.children[1]);\n            if (this.shadowRoot.children.length > 1)\n                this.shadowRoot.insertBefore(span, this.shadowRoot.children[1]);\n            else\n                this.shadowRoot.appendChild(span);\n        }\n        if (!this.master)\n            throw Error(\"yikes\");\n        let active = false;\n        if (this.master.active == this) {\n            switch (this.master.state) {\n                case MenuState.DOWN:\n                case MenuState.UP_N_HOLD:\n                case MenuState.DOWN_N_HOLD:\n                case MenuState.DOWN_N_INSIDE_AGAIN:\n                    active = true;\n                    break;\n                case MenuState.DOWN_N_OUTSIDE:\n                    if (!this.node)\n                        throw Error(\"yikes\");\n                    active = this.node.down !== undefined && this.node.isEnabled();\n                    break;\n            }\n        }\n        this.classList.toggle(\"active\", active);\n        this.classList.toggle(\"disabled\", !this.isEnabled());\n    }\n    isEnabled() {\n        if (this.node.down !== undefined)\n            return true;\n        return this.action !== undefined && this.action.enabled;\n    }\n    trigger() {\n        this.collapse();\n        if (!this.action)\n            return;\n        this.action.trigger();\n    }\n    collapse() {\n        if (!this.master)\n            throw Error(\"yikes\");\n        if (this.master.parentButton)\n            this.master.parentButton.collapse();\n        else\n            this.deactivate();\n    }\n    openPopup() {\n        if (!this.node)\n            return;\n        if (!this.node.down)\n            return;\n        if (!this.shadowRoot)\n            throw Error(\"yikes\");\n        if (!this.popup) {\n            this.popup = new PopupMenu(this.node, this);\n            this.shadowRoot.appendChild(this.popup);\n        }\n        else {\n            this.popup.show();\n        }\n    }\n    closePopup() {\n        if (!this.popup)\n            return;\n        if (this.popup.active)\n            this.popup.active.deactivate();\n        this.popup.hide();\n    }\n    activate() {\n        if (!this.master)\n            throw Error(\"yikes\");\n        if (!this.node)\n            throw Error(\"yikes\");\n        let oldActive = this.master.active;\n        this.master.active = this;\n        if (oldActive && oldActive !== this) {\n            oldActive.closePopup();\n            oldActive.updateView();\n        }\n        this.updateView();\n        this.openPopup();\n    }\n    deactivate() {\n        if (!this.master)\n            throw Error(\"yikes\");\n        if (this.master.active !== this)\n            return;\n        this.master.active.closePopup();\n        this.master.active = undefined;\n        this.master.state = MenuState.WAIT;\n        this.updateView();\n    }\n}\nMenuButton.define(\"tx-menubutton\", MenuButton);\n//# sourceMappingURL=MenuButton.js.map","import { MenuButton } from \"./MenuButton.js\";\nexport class MenuNode {\n    constructor(title, label, shortcut, type, modelId) {\n        this.title = title;\n        this.label = label;\n        this.shortcut = shortcut;\n        this.type = type ? type : \"entry\";\n        this.modelId = modelId;\n    }\n    isEnabled() {\n        return true;\n    }\n    isAvailable() {\n        return true;\n    }\n    createWindowAt(parent, parentView) {\n        if (this.type == \"spacer\") {\n            let span = document.createElement(\"span\");\n            span.style.flexGrow = \"1\";\n            parentView.appendChild(span);\n            return;\n        }\n        this.view = new MenuButton(parent, this);\n        parentView.appendChild(this.view);\n    }\n    deleteWindow() {\n    }\n}\n//# sourceMappingURL=MenuNode.js.map","import * as dom from \"../util/dom.js\";\nimport { MenuNode } from \"./MenuNode.js\";\nimport { MenuButtonContainer } from \"./MenuHelper.js\";\nimport { menuStyle } from \"./menuStyle.js\";\nexport class Menu extends MenuButtonContainer {\n    constructor(props) {\n        super(props);\n        this.config = props?.config;\n        this.vertical = false;\n        this.root = new MenuNode(\"\", \"\", undefined, undefined);\n    }\n    connectedCallback() {\n        super.connectedCallback();\n        this.tabIndex = 0;\n        if (this.config) {\n            this.config2nodes(this.config, this.root);\n            this.referenceActions();\n            this.createShadowDOM();\n            return;\n        }\n        if (this.children.length === 0) {\n            this._observer = new MutationObserver((record, observer) => {\n                if (this._timer !== undefined)\n                    clearTimeout(this._timer);\n                this._timer = window.setTimeout(() => {\n                    this._timer = undefined;\n                    this.layout2nodes(this.children, this.root);\n                    this.referenceActions();\n                    this.createShadowDOM();\n                }, 100);\n            });\n            this._observer.observe(this, {\n                childList: true,\n                subtree: true\n            });\n        }\n        else {\n            this.layout2nodes(this.children, this.root);\n            this.referenceActions();\n            this.createShadowDOM();\n        }\n    }\n    layout2nodes(children, parent) {\n        let node = parent.down;\n        for (let child of children) {\n            let newnode = undefined;\n            switch (child.nodeName) {\n                case \"TX-MENUSPACER\":\n                    newnode = new MenuNode(\"\", \"\", \"\", \"spacer\");\n                    break;\n                case \"TX-MENUENTRY\":\n                    newnode = new MenuNode(dom.attribute(child, \"name\"), dom.attribute(child, \"label\"), dom.attributeOrUndefined(child, \"shortcut\"), dom.attributeOrUndefined(child, \"type\"), dom.attributeOrUndefined(child, \"model\"));\n                    break;\n            }\n            if (newnode) {\n                newnode.parent = parent;\n                if (!node)\n                    parent.down = newnode;\n                else\n                    node.next = newnode;\n                node = newnode;\n            }\n            if (!node)\n                throw Error(\"yikes\");\n            this.layout2nodes(child.children, node);\n        }\n    }\n    config2nodes(config, parent) {\n        let node = parent.down;\n        for (let child of config) {\n            let newnode = undefined;\n            if (child.space === true) {\n                newnode = new MenuNode(\"\", \"\", \"\", \"spacer\");\n            }\n            else {\n                newnode = new MenuNode(child.name, child.label, child.shortcut, child.type, child.model);\n            }\n            if (newnode) {\n                newnode.parent = parent;\n                if (!node)\n                    parent.down = newnode;\n                else\n                    node.next = newnode;\n                node = newnode;\n            }\n            if (!node)\n                throw Error(\"yikes\");\n            if (child.sub)\n                this.config2nodes(child.sub, node);\n        }\n    }\n    referenceActions() {\n    }\n    findNode(str, parent) {\n        let strpos = str.indexOf(\"|\");\n        let left = strpos == -1 ? str : str.substr(0, strpos);\n        let right = strpos == -1 ? \"\" : str.substr(strpos + 1);\n        if (!parent)\n            parent = this.root;\n        for (let n = parent.down; n; n = n.next) {\n            if (n.title == left) {\n                if (!n.down) {\n                    return n;\n                }\n                return this.findNode(right, n);\n            }\n        }\n        return undefined;\n    }\n    createShadowDOM() {\n        this.view = document.createElement(\"div\");\n        this.view.classList.add(\"menu-bar\");\n        let node = this.root.down;\n        while (node) {\n            if (node.isAvailable()) {\n                node.createWindowAt(this, this.view);\n            }\n            else {\n                node.deleteWindow();\n            }\n            node = node.next;\n        }\n        this.attachShadow({ mode: 'open' });\n        this.shadowRoot.appendChild(document.importNode(menuStyle, true));\n        this.shadowRoot.appendChild(this.view);\n    }\n}\nMenu.define(\"tx-menu\", Menu);\n//# sourceMappingURL=Menu.js.map","import { View } from \"../view/View.js\";\nexport class MenuSpacer extends HTMLElement {\n}\nView.define(\"tx-menuspacer\", MenuSpacer);\n//# sourceMappingURL=MenuSpacer.js.map","import { Model } from \"../../model/Model.js\";\nexport class TableModel extends Model {\n    isEmpty() { return this.colCount === 0 && this.rowCount === 0; }\n}\n//# sourceMappingURL=TableModel.js.map","export var TableEditMode;\n(function (TableEditMode) {\n    TableEditMode[TableEditMode[\"EDIT_CELL\"] = 0] = \"EDIT_CELL\";\n    TableEditMode[TableEditMode[\"SELECT_CELL\"] = 1] = \"SELECT_CELL\";\n    TableEditMode[TableEditMode[\"SELECT_ROW\"] = 2] = \"SELECT_ROW\";\n})(TableEditMode || (TableEditMode = {}));\n//# sourceMappingURL=TableEditMode.js.map","import { TypedTableModel } from \"../model/TypedTableModel.js\";\nexport var EditMode;\n(function (EditMode) {\n    EditMode[EditMode[\"EDIT_ON_FOCUS\"] = 0] = \"EDIT_ON_FOCUS\";\n    EditMode[EditMode[\"EDIT_ON_ENTER\"] = 1] = \"EDIT_ON_ENTER\";\n})(EditMode || (EditMode = {}));\nexport class TableAdapterConfig {\n    constructor() {\n        this.editMode = EditMode.EDIT_ON_FOCUS;\n        this.seamless = false;\n        this.expandColumn = false;\n        this.expandRow = false;\n    }\n}\nexport class TableAdapter {\n    constructor(model) {\n        this.config = new TableAdapterConfig();\n        this.model = model;\n    }\n    get colCount() { return this.model === undefined ? 0 : this.model.colCount; }\n    get rowCount() { return this.model === undefined ? 0 : this.model.rowCount; }\n    getColumnHead(col) { return undefined; }\n    getRowHead(row) { return undefined; }\n    showCell(pos, cell) { }\n    saveCell(pos, cell) { }\n    editCell(pos, cell) { }\n    isViewCompact() { return false; }\n    static register(adapter, model, data) {\n        let typeToModel = TableAdapter.modelToAdapter.get(model);\n        if (typeToModel === undefined) {\n            typeToModel = new Map();\n            TableAdapter.modelToAdapter.set(model, typeToModel);\n        }\n        if (data !== undefined) {\n            if (typeToModel.has(data)) {\n                throw Error(`attempt to redefine existing table adapter`);\n            }\n            typeToModel.set(data, adapter);\n        }\n        else {\n            if (typeToModel.has(null)) {\n                throw Error(`attempt to redefine existing table adapter`);\n            }\n            typeToModel.set(null, adapter);\n        }\n    }\n    static unbind() {\n        TableAdapter.modelToAdapter.clear();\n    }\n    static lookup(model) {\n        let dataType;\n        if (model instanceof TypedTableModel) {\n            dataType = model.nodeClass;\n        }\n        else {\n            dataType = null;\n        }\n        const typeToAdapter = TableAdapter.modelToAdapter.get(Object.getPrototypeOf(model).constructor);\n        let adapter = typeToAdapter?.get(dataType);\n        if (adapter === undefined) {\n            for (let baseClass of TableAdapter.modelToAdapter.keys()) {\n                if (model instanceof baseClass) {\n                    adapter = TableAdapter.modelToAdapter.get(baseClass)?.get(dataType);\n                    break;\n                }\n            }\n        }\n        if (adapter === undefined) {\n            let msg = `TableAdapter.lookup(): Did not find an adapter for model of type ${model.constructor.name}`;\n            msg += `\\n    Requested adapter: model=${model.constructor.name}, type=${dataType?.name}\\n    Available adapters:`;\n            if (TableAdapter.modelToAdapter.size === 0) {\n                msg += \" none.\";\n            }\n            else {\n                for (const [modelX, typeToAdapterX] of TableAdapter.modelToAdapter) {\n                    for (const [typeX, adapterX] of typeToAdapterX) {\n                        msg += `\\n        model=${modelX.name}`;\n                        if (typeX !== undefined && typeX !== null) {\n                            msg += `, type=${typeX.name}`;\n                        }\n                    }\n                }\n            }\n            throw Error(msg);\n        }\n        return adapter;\n    }\n}\nTableAdapter.modelToAdapter = new Map();\n//# sourceMappingURL=TableAdapter.js.map","export var TableEventType;\n(function (TableEventType) {\n    TableEventType[TableEventType[\"INSERT_ROW\"] = 0] = \"INSERT_ROW\";\n    TableEventType[TableEventType[\"REMOVE_ROW\"] = 1] = \"REMOVE_ROW\";\n    TableEventType[TableEventType[\"INSERT_COL\"] = 2] = \"INSERT_COL\";\n    TableEventType[TableEventType[\"REMOVE_COL\"] = 3] = \"REMOVE_COL\";\n    TableEventType[TableEventType[\"CELL_CHANGED\"] = 4] = \"CELL_CHANGED\";\n    TableEventType[TableEventType[\"RESIZE_ROW\"] = 5] = \"RESIZE_ROW\";\n    TableEventType[TableEventType[\"RESIZE_COL\"] = 6] = \"RESIZE_COL\";\n    TableEventType[TableEventType[\"CHANGED\"] = 7] = \"CHANGED\";\n})(TableEventType || (TableEventType = {}));\n//# sourceMappingURL=TableEventType.js.map","export class TablePos {\n    constructor(col, row) {\n        this.col = col;\n        this.row = row;\n    }\n    toString() {\n        return `TablePos { col:${this.col}, row:${this.row} }`;\n    }\n}\n//# sourceMappingURL=TablePos.js.map","import { Model } from \"../../model/Model.js\";\nimport { TableEditMode } from \"../TableEditMode.js\";\nimport { TablePos } from \"../TablePos.js\";\nexport class SelectionModel extends Model {\n    constructor(mode = TableEditMode.EDIT_CELL) {\n        super();\n        this.mode = mode;\n        this._value = new TablePos(0, 0);\n    }\n    set col(col) {\n        if (this._value.col === col)\n            return;\n        this._value.col = col;\n        this.modified.trigger();\n    }\n    get col() {\n        return this._value.col;\n    }\n    set row(row) {\n        if (this._value.row === row)\n            return;\n        this._value.row = row;\n        this.modified.trigger();\n    }\n    get row() {\n        return this._value.row;\n    }\n    set value(value) {\n        if (this._value.col === value.col && this._value.row === value.row)\n            return;\n        this._value = value;\n        this.modified.trigger();\n    }\n    get value() {\n        return this._value;\n    }\n    toString() {\n        return `SelectionModel {enabled: ${this._enabled}, mode: ${TableEditMode[this.mode]}, value: ${this._value}}`;\n    }\n}\n//# sourceMappingURL=SelectionModel.js.map","import { TableModel } from \"./TableModel.js\";\nexport class TypedTableModel extends TableModel {\n    constructor(nodeClass, root) {\n        super();\n        this.nodeClass = nodeClass;\n    }\n}\n//# sourceMappingURL=TypedTableModel.js.map","export class TableFriend {\n    constructor(table) {\n        this.table = table;\n    }\n    get adapter() {\n        return this.table.adapter;\n    }\n    get root() {\n        return this.table.root;\n    }\n    get measure() {\n        return this.table.measure;\n    }\n    getStaging() {\n        const animator = this.table.animator;\n        if (animator.current === undefined)\n            return undefined;\n        const animation = animator.current;\n        return animation.bodyStaging;\n    }\n    getHeadStaging() {\n        const animator = this.table.animator;\n        if (animator.current === undefined)\n            return undefined;\n        const animation = animator.current;\n        return animation.headStaging;\n    }\n    get body() {\n        return this.table.body;\n    }\n    get splitBody() {\n        return this.table.splitBody;\n    }\n    get colHeads() {\n        return this.table.colHeads;\n    }\n    set colHeads(div) {\n        this.table.colHeads = div;\n    }\n    get rowHeads() {\n        return this.table.rowHeads;\n    }\n    set rowHeads(div) {\n        this.table.rowHeads = div;\n    }\n    get colResizeHandles() {\n        return this.table.colResizeHandles;\n    }\n    set colResizeHandles(div) {\n        this.table.colResizeHandles = div;\n    }\n    get rowResizeHandles() {\n        return this.table.rowResizeHandles;\n    }\n    set rowResizeHandles(div) {\n        this.table.rowResizeHandles = div;\n    }\n    set animationDone(animationDone) {\n        this.table.animationDone = animationDone;\n    }\n    get selection() {\n        return this.table.selection;\n    }\n    get style() {\n        return this.table.style;\n    }\n    setCellSize(span, x, y, w, h) {\n        this.table.setCellSize(span, x, y, w, h);\n    }\n    clearAnimation() {\n        this.table.animation = undefined;\n    }\n}\n//# sourceMappingURL=TableFriend.js.map","import { Table } from \"../Table.js\";\nimport { TableFriend } from \"./TableFriend.js\";\nimport { div, span } from \"../../util/lsx.js\";\nexport class TableAnimation extends TableFriend {\n    constructor(table) {\n        super(table);\n    }\n    prepareStagingWithRows() {\n        this.prepareBodyStaging();\n        this.prepareRowHeadStaging();\n        this.table.addStaging(this.bodyStaging, this.headStaging);\n        this.scrollStaging();\n    }\n    prepareStagingWithColumns() {\n        this.prepareBodyStaging();\n        this.prepareColHeadStaging();\n        this.table.addStaging(this.bodyStaging, this.headStaging);\n        this.scrollStaging();\n    }\n    prepareBodyStaging() {\n        this.bodyStaging = div();\n        this.bodyStaging.className = \"staging\";\n        this.bodyStaging.style.left = this.body.style.left;\n        this.bodyStaging.style.top = this.body.style.top;\n    }\n    prepareRowHeadStaging() {\n        if (this.rowHeads === undefined) {\n            return;\n        }\n        this.headStaging = div();\n        this.headStaging.classList.add(\"staging\");\n        this.headStaging.style.top = this.rowHeads.style.top;\n        this.headStaging.style.width = this.rowHeads.style.width;\n    }\n    prepareColHeadStaging() {\n        if (this.colHeads === undefined) {\n            return;\n        }\n        this.headStaging = div();\n        this.headStaging.classList.add(\"staging\");\n        this.headStaging.classList.add(\"colHack\");\n        this.headStaging.style.left = this.colHeads.style.left;\n        this.headStaging.style.height = this.colHeads.style.height;\n    }\n    disposeStaging() {\n        this.table.removeStaging(this.bodyStaging, this.headStaging);\n    }\n    scrollStaging() {\n    }\n    makeRowMask(start, size) {\n        const mask = span();\n        mask.style.boxSizing = `content-box`;\n        mask.style.top = `${start}px`;\n        mask.style.height = `${size}px`;\n        mask.style.left = `0`;\n        mask.style.right = `0`;\n        mask.style.border = 'none';\n        mask.style.backgroundColor = Table.maskColor;\n        return mask;\n    }\n    makeColumnMask(start, size) {\n        const mask = span();\n        mask.style.boxSizing = `content-box`;\n        mask.style.left = `${start}px`;\n        mask.style.width = `${size}px`;\n        mask.style.top = `0`;\n        mask.style.bottom = `0`;\n        mask.style.border = 'none';\n        mask.style.backgroundColor = Table.maskColor;\n        return mask;\n    }\n}\n//# sourceMappingURL=TableAnimation.js.map","import { TableAnimation } from \"./TableAnimation.js\";\nexport class InsertAnimation extends TableAnimation {\n    constructor(table, event) {\n        super(table);\n        this.done = false;\n        this.event = event;\n    }\n    prepare() {\n        this.prepareCellsToBeMeasured();\n        this.prepareStaging();\n    }\n    firstFrame() {\n        this.arrangeInStaging();\n        this.split();\n    }\n    animationFrame(n) {\n        this.animate(this.animationStart + n * this.totalSize);\n    }\n    lastFrame() {\n        this.animate(this.animationStart + this.totalSize);\n        this.join();\n        this.disposeStaging();\n    }\n    join() {\n        if (this.done) {\n            return;\n        }\n        this.done = true;\n        this.joinHeader();\n        this.joinBody();\n        if (this.table.animationDone) {\n            this.table.animationDone();\n        }\n    }\n}\n//# sourceMappingURL=InsertAnimation.js.map","import { TablePos } from \"../TablePos.js\";\nimport { px2float } from \"../Table.js\";\nimport { InsertAnimation } from \"./InsertAnimation.js\";\nimport { span, div } from \"../../util/lsx.js\";\nexport class InsertRowAnimation extends InsertAnimation {\n    constructor(table, event) {\n        super(table, event);\n        this.join = this.join.bind(this);\n        this.initialRowCount = this.adapter.rowCount - event.size;\n        InsertRowAnimation.current = this;\n    }\n    prepareStaging() {\n        this.prepareStagingWithRows();\n    }\n    animate(pos) {\n        this.splitBody.style.top = `${pos}px`;\n        this.mask.style.top = `${pos}px`;\n        if (this.rowHeads !== undefined) {\n            this.splitHead.style.top = `${pos}px`;\n            this.headMask.style.top = `${pos}px`;\n        }\n    }\n    prepareCellsToBeMeasured() {\n        this.table.prepareMinCellSize();\n        let rowHeaders = new Array(this.event.size);\n        for (let row = this.event.index; row < this.event.index + this.event.size; ++row) {\n            const content = this.adapter.getRowHead(row);\n            if (this.rowHeads === undefined && content !== undefined) {\n                this.rowHeads = div();\n                this.rowHeads.className = \"rows\";\n                this.root.appendChild(this.rowHeads);\n                this.rowResizeHandles = div();\n                this.rowResizeHandles.className = \"rows\";\n                this.root.appendChild(this.rowResizeHandles);\n            }\n            rowHeaders[row - this.event.index] = content;\n        }\n        if (this.rowHeads !== undefined) {\n            for (let row = 0; row < this.event.size; ++row) {\n                const cell = span(rowHeaders[row]);\n                cell.className = \"head\";\n                this.measure.appendChild(cell);\n            }\n        }\n        if (this.colHeads === undefined && this.adapter.colCount === this.event.size) {\n            let colHeaders = new Array(this.adapter.colCount);\n            for (let col = 0; col < this.adapter.colCount; ++col) {\n                const content = this.adapter.getColumnHead(col);\n                if (this.colHeads === undefined && content !== undefined) {\n                    this.colHeads = div();\n                    this.colHeads.className = \"cols\";\n                    this.root.appendChild(this.colHeads);\n                    this.colResizeHandles = div();\n                    this.colResizeHandles.className = \"cols\";\n                    this.root.appendChild(this.colResizeHandles);\n                }\n                colHeaders[col] = content;\n            }\n            if (this.colHeads !== undefined) {\n                for (let col = 0; col < this.adapter.colCount; ++col) {\n                    const cell = span(colHeaders[col]);\n                    cell.className = \"head\";\n                    this.measure.appendChild(cell);\n                }\n            }\n        }\n        for (let row = this.event.index; row < this.event.index + this.event.size; ++row) {\n            for (let col = 0; col < this.adapter.colCount; ++col) {\n                const cell = this.table.createCell();\n                this.table.showCell(new TablePos(col, row), cell);\n                this.measure.appendChild(cell);\n            }\n        }\n    }\n    arrangeInStaging() {\n        this.table.calculateMinCellSize();\n        const overlap = this.adapter.config.seamless ? 0 : 1;\n        let top = 0;\n        let idx = this.event.index * this.adapter.colCount;\n        if (this.body.children.length !== 0) {\n            if (idx < this.body.children.length) {\n                let cell = this.body.children[idx];\n                top = px2float(cell.style.top);\n            }\n            else {\n                let cell = this.body.children[this.body.children.length - 1];\n                let b = cell.getBoundingClientRect();\n                top = px2float(cell.style.top) + b.height - overlap;\n            }\n        }\n        let colWidth = new Array(this.adapter.colCount);\n        if (this.body.children.length > 0) {\n            for (let col = 0; col < this.adapter.colCount; ++col) {\n                const cell = this.body.children[col];\n                const bounds = cell.getBoundingClientRect();\n                colWidth[col] = bounds.width;\n                if (this.adapter.config.seamless) {\n                    colWidth[col] += 2;\n                }\n            }\n        }\n        else {\n            colWidth.fill(this.table.minCellWidth);\n        }\n        let rowHeadWidth = this.table.minCellWidth;\n        if (this.rowHeads && this.rowHeads.children.length > 0) {\n            const cell = this.rowHeads.children[0];\n            const bounds = cell.getBoundingClientRect();\n            rowHeadWidth = Math.max(rowHeadWidth, bounds.width);\n            if (this.adapter.config.seamless) {\n                rowHeadWidth += 2;\n            }\n        }\n        let rowHeight = new Array(this.event.size);\n        rowHeight.fill(this.table.minCellHeight);\n        this.totalSize = 0;\n        idx = 0;\n        if (this.rowHeads !== undefined) {\n            for (let row = 0; row < this.event.size; ++row) {\n                const cell = this.measure.children[idx++];\n                const bounds = cell.getBoundingClientRect();\n                rowHeight[row] = Math.max(rowHeight[row], bounds.height);\n                rowHeadWidth = Math.max(rowHeadWidth, bounds.width);\n            }\n        }\n        rowHeadWidth = Math.ceil(rowHeadWidth);\n        let colHeadHeight = 0;\n        if (this.colHeads !== undefined && this.colHeads.children.length === 0 && this.adapter.rowCount == this.event.size) {\n            colHeadHeight = this.table.minCellHeight;\n            for (let col = 0; col < this.adapter.colCount; ++col) {\n                const cell = this.measure.children[idx++];\n                const bounds = cell.getBoundingClientRect();\n                colWidth[col] = Math.max(colWidth[col], bounds.width - this.table.WIDTH_ADJUST);\n                colHeadHeight = Math.max(colHeadHeight, bounds.height - this.table.HEIGHT_ADJUST);\n            }\n        }\n        else {\n            if (this.colHeads !== undefined) {\n                const b = this.colHeads.children[0].getBoundingClientRect();\n                colHeadHeight = b.height - this.table.HEIGHT_ADJUST;\n            }\n        }\n        colHeadHeight = Math.ceil(colHeadHeight);\n        if (this.rowHeads) {\n            if (colHeadHeight === 0) {\n                this.rowHeads.style.top = `0px`;\n            }\n            else {\n                this.rowHeads.style.top = `${colHeadHeight + this.table.HEIGHT_ADJUST - overlap}px`;\n            }\n            this.rowHeads.style.bottom = `0px`;\n            this.rowHeads.style.width = `${rowHeadWidth}px`;\n            this.body.style.left = `${rowHeadWidth - overlap}px`;\n            this.bodyStaging.style.left = `${rowHeadWidth - overlap}px`;\n        }\n        for (let row = 0; row < this.event.size; ++row) {\n            for (let col = 0; col < this.adapter.colCount; ++col) {\n                const cell = this.measure.children[idx++];\n                const bounds = cell.getBoundingClientRect();\n                rowHeight[row] = Math.max(rowHeight[row], bounds.height);\n                if (this.adapter.config.expandColumn) {\n                    colWidth[col] = Math.ceil(Math.max(colWidth[col], bounds.width));\n                }\n                else {\n                    if (row === 0 && this.body.children.length === 0) {\n                        colWidth[col] = Math.ceil(bounds.width);\n                    }\n                }\n            }\n            this.totalSize += rowHeight[row] - overlap;\n        }\n        if (this.adapter.config.expandColumn) {\n            idx = 0;\n            let x = 0;\n            let col = 0;\n            while (idx < this.body.children.length) {\n                const cell = this.body.children[idx];\n                cell.style.left = `${x}px`;\n                cell.style.width = `${colWidth[col] - this.table.WIDTH_ADJUST}px`;\n                x += colWidth[col] - overlap;\n                if (this.adapter.config.seamless) {\n                    x -= 2;\n                }\n                ++col;\n                ++idx;\n                if (col >= this.adapter.colCount) {\n                    x = 0;\n                    col = 0;\n                }\n            }\n        }\n        this.totalSize += overlap;\n        if (this.adapter.config.seamless) {\n            this.totalSize -= 2 * this.event.size;\n        }\n        let y = top;\n        if (this.rowHeads !== undefined) {\n            for (let row = 0; row < this.event.size; ++row) {\n                const cell = this.measure.children[0];\n                this.setCellSize(cell, 0, y, rowHeadWidth, rowHeight[row]);\n                this.headStaging.appendChild(cell);\n                y += rowHeight[row] - overlap;\n                if (this.adapter.config.seamless) {\n                    y -= 2;\n                }\n            }\n        }\n        if (this.colHeads !== undefined && this.colHeads.children.length === 0 && this.adapter.rowCount == this.event.size) {\n            let x = 0;\n            for (let col = 0; col < this.adapter.colCount; ++col) {\n                const cell = this.measure.children[0];\n                cell.style.left = `${x}px`;\n                cell.style.width = `${colWidth[col] - this.table.WIDTH_ADJUST}px`;\n                cell.style.height = `${colHeadHeight}px`;\n                this.colHeads.appendChild(cell);\n                x += colWidth[col] - overlap;\n            }\n            colHeadHeight += this.table.HEIGHT_ADJUST;\n            this.body.style.top = `${colHeadHeight - overlap}px`;\n            this.bodyStaging.style.top = `${colHeadHeight - overlap}px`;\n            this.headStaging.style.top = `${colHeadHeight - overlap}px`;\n            this.rowHeads.style.top = `${colHeadHeight - overlap}px`;\n            this.colHeads.style.left = `${rowHeadWidth - overlap}px`;\n            this.colHeads.style.right = `0px`;\n            this.colHeads.style.height = `${colHeadHeight}px`;\n        }\n        y = top;\n        for (let row = 0; row < this.event.size; ++row) {\n            let x = 0;\n            for (let col = 0; col < this.adapter.colCount; ++col) {\n                const cell = this.measure.children[0];\n                this.setCellSize(cell, x, y, colWidth[col], rowHeight[row]);\n                this.bodyStaging.appendChild(cell);\n                x += colWidth[col] - overlap;\n                if (this.adapter.config.seamless) {\n                    x -= 2;\n                }\n            }\n            y += rowHeight[row] - overlap;\n            if (this.adapter.config.seamless) {\n                y -= 2;\n            }\n        }\n        this.mask = this.makeRowMask(top, this.totalSize);\n        this.bodyStaging.appendChild(this.mask);\n        if (this.rowHeads !== undefined) {\n            this.headMask = this.makeRowMask(top, this.totalSize);\n            this.headStaging.appendChild(this.headMask);\n        }\n        if (this.initialRowCount !== 0) {\n            const overlap = this.adapter.config.seamless ? 0 : 1;\n            this.totalSize -= overlap;\n        }\n    }\n    split() {\n        this.table.splitHorizontalNew(this.event.index);\n        if (this.rowHeads !== undefined) {\n            this.splitHead = this.rowHeads.lastElementChild;\n        }\n        this.animationStart = px2float(this.splitBody.style.top);\n    }\n    joinHeader() {\n        if (this.rowHeads === undefined) {\n            return;\n        }\n        this.headStaging.removeChild(this.headMask);\n        this.rowHeads.removeChild(this.splitHead);\n        while (this.headStaging.children.length > 0) {\n            this.rowHeads.appendChild(this.headStaging.children[0]);\n        }\n        if (this.splitHead.children.length > 0) {\n            let top = px2float(this.splitHead.style.top);\n            while (this.splitHead.children.length > 0) {\n                const cell = this.splitHead.children[0];\n                cell.style.top = `${px2float(cell.style.top) + top}px`;\n                this.rowHeads.appendChild(cell);\n            }\n        }\n    }\n    joinBody() {\n        this.bodyStaging.removeChild(this.mask);\n        this.body.removeChild(this.splitBody);\n        while (this.bodyStaging.children.length > 0) {\n            this.body.appendChild(this.bodyStaging.children[0]);\n        }\n        if (this.splitBody.children.length > 0) {\n            let top = px2float(this.splitBody.style.top);\n            while (this.splitBody.children.length > 0) {\n                const cell = this.splitBody.children[0];\n                cell.style.top = `${px2float(cell.style.top) + top}px`;\n                this.body.appendChild(cell);\n            }\n        }\n    }\n}\n//# sourceMappingURL=InsertRowAnimation.js.map","import { px2float } from \"../Table.js\";\nimport { TableAnimation } from \"./TableAnimation.js\";\nexport class RemoveRowAnimation extends TableAnimation {\n    constructor(table, event) {\n        super(table);\n        this.event = event;\n        this.joinHorizontal = this.joinHorizontal.bind(this);\n        if (this.body.children.length === 0) {\n            this.initialHeight = 0;\n        }\n        else {\n            const bottomCell = this.body.children[this.body.children.length - 1];\n            const top = px2float(bottomCell.style.top);\n            const bounds = bottomCell.getBoundingClientRect();\n            this.initialHeight = top + bounds.height;\n        }\n        this.overlap = this.adapter.config.seamless ? 0 : 1;\n        this.removeAll = this.event.index >= this.adapter.rowCount;\n        RemoveRowAnimation.current = this;\n    }\n    prepare() {\n        this.prepareStagingWithRows();\n        this.arrangeRowsInStaging();\n        this.splitHorizontal();\n    }\n    firstFrame() { }\n    animationFrame(n) {\n        this.splitBody.style.top = `${this.topSplitBody - n * this.animationHeight}px`;\n        this.mask.style.top = `${this.topMask - n * this.animationHeight}px`;\n        if (this.rowHeads !== undefined) {\n            this.splitHead.style.top = `${this.topSplitBody - n * this.animationHeight}px`;\n            this.headMask.style.top = `${this.topMask - n * this.animationHeight}px`;\n        }\n    }\n    lastFrame() {\n        this.joinHorizontal();\n        this.disposeStaging();\n    }\n    arrangeRowsInStaging() {\n        const idx = this.event.index * this.adapter.colCount;\n        const cellCount = this.event.size * this.adapter.colCount;\n        const start = px2float(this.body.children[idx].style.top);\n        for (let i = 0; i < cellCount; ++i) {\n            this.bodyStaging.appendChild(this.body.children[idx]);\n        }\n        let bottomOfStaging;\n        if (idx < this.body.children.length) {\n            bottomOfStaging = px2float(this.body.children[idx].style.top);\n        }\n        else {\n            const cell = this.bodyStaging.children[this.bodyStaging.children.length - 1];\n            bottomOfStaging = px2float(cell.style.top) + px2float(cell.style.height) + this.table.HEIGHT_ADJUST;\n        }\n        this.animationHeight = bottomOfStaging - start;\n        this.mask = this.makeRowMask(bottomOfStaging, this.animationHeight);\n        this.bodyStaging.appendChild(this.mask);\n        if (this.rowHeads === undefined) {\n            return;\n        }\n        for (let i = 0; i < this.event.size; ++i) {\n            this.headStaging.appendChild(this.rowHeads.children[this.event.index]);\n        }\n        this.headMask = this.makeRowMask(bottomOfStaging, this.animationHeight);\n        this.headStaging.appendChild(this.headMask);\n    }\n    splitHorizontal() {\n        this.table.splitHorizontalNew(this.event.index);\n        if (this.rowHeads !== undefined) {\n            this.splitHead = this.rowHeads.lastElementChild;\n        }\n        this.topSplitBody = px2float(this.splitBody.style.top);\n        this.topMask = px2float(this.mask.style.top);\n    }\n    joinHorizontal() {\n        this.bodyStaging.removeChild(this.mask);\n        this.body.removeChild(this.splitBody);\n        this.bodyStaging.replaceChildren();\n        this.moveSplitBodyToBody();\n        if (this.rowHeads) {\n            this.headStaging.removeChild(this.headMask);\n            this.rowHeads.removeChild(this.splitHead);\n            this.headStaging.replaceChildren();\n            this.moveSplitHeadToHead();\n        }\n        if (this.table.animationDone) {\n            this.table.animationDone();\n        }\n    }\n    moveSplitHeadToHead() {\n        if (this.splitHead.children.length === 0) {\n            return;\n        }\n        let top = px2float(this.splitHead.style.top);\n        while (this.splitHead.children.length > 0) {\n            const cell = this.splitHead.children[0];\n            cell.style.top = `${px2float(cell.style.top) + top}px`;\n            this.rowHeads.appendChild(cell);\n        }\n    }\n    moveSplitBodyToBody() {\n        if (this.splitBody.children.length === 0) {\n            return;\n        }\n        let top = px2float(this.splitBody.style.top);\n        while (this.splitBody.children.length > 0) {\n            const cell = this.splitBody.children[0];\n            cell.style.top = `${px2float(cell.style.top) + top}px`;\n            this.body.appendChild(cell);\n        }\n    }\n}\n//# sourceMappingURL=RemoveRowAnimation.js.map","import { TablePos } from \"../TablePos.js\";\nimport { span, div } from \"../../util/lsx.js\";\nimport { px2int, px2float } from \"../Table.js\";\nimport { InsertAnimation } from \"./InsertAnimation.js\";\nexport class InsertColumnAnimation extends InsertAnimation {\n    constructor(table, event) {\n        super(table, event);\n        this.event = event;\n        this.join = this.join.bind(this);\n        this.colCount = this.adapter.colCount;\n        this.rowCount = this.adapter.rowCount;\n        InsertColumnAnimation.current = this;\n    }\n    prepareStaging() {\n        this.prepareStagingWithColumns();\n    }\n    animate(pos) {\n        this.mask.style.left = `${pos}px`;\n        this.splitBody.style.left = `${pos}px`;\n        if (this.colHeads !== undefined) {\n            this.splitHead.style.left = `${pos}px`;\n            this.headMask.style.left = `${pos}px`;\n        }\n    }\n    prepareCellsToBeMeasured() {\n        this.table.prepareMinCellSize();\n        let colHeaders = new Array(this.event.size);\n        for (let col = this.event.index; col < this.event.index + this.event.size; ++col) {\n            const content = this.adapter.getColumnHead(col);\n            if (this.colHeads === undefined && content !== undefined) {\n                this.colHeads = div();\n                this.colHeads.className = \"cols\";\n                this.root.appendChild(this.colHeads);\n                this.colResizeHandles = div();\n                this.colResizeHandles.className = \"cols\";\n                this.root.appendChild(this.colResizeHandles);\n            }\n            colHeaders[col - this.event.index] = content;\n        }\n        if (this.colHeads !== undefined) {\n            for (let row = 0; row < this.event.size; ++row) {\n                const cell = span(colHeaders[row]);\n                cell.className = \"head\";\n                this.measure.appendChild(cell);\n            }\n        }\n        if (this.rowHeads === undefined && this.adapter.rowCount === this.event.size) {\n            let rowHeaders = new Array(this.adapter.rowCount);\n            for (let row = 0; row < this.adapter.rowCount; ++row) {\n                const content = this.adapter.getRowHead(row);\n                if (this.rowHeads === undefined && content !== undefined) {\n                    this.rowHeads = div();\n                    this.rowHeads.className = \"rows\";\n                    this.root.appendChild(this.rowHeads);\n                    this.rowResizeHandles = div();\n                    this.rowResizeHandles.className = \"rows\";\n                    this.root.appendChild(this.rowResizeHandles);\n                }\n                rowHeaders[row] = content;\n            }\n            if (this.rowHeads !== undefined) {\n                for (let row = 0; row < this.adapter.rowCount; ++row) {\n                    const cell = span(rowHeaders[row]);\n                    cell.className = \"head\";\n                    this.measure.appendChild(cell);\n                }\n            }\n        }\n        for (let col = this.event.index; col < this.event.index + this.event.size; ++col) {\n            for (let row = 0; row < this.rowCount; ++row) {\n                const cell = span();\n                this.table.showCell(new TablePos(col, row), cell);\n                this.measure.appendChild(cell);\n            }\n        }\n    }\n    arrangeInStaging() {\n        this.table.calculateMinCellSize();\n        const previousColCount = this.colCount - this.event.size;\n        const overlap = this.adapter.config.seamless ? 0 : 1;\n        let left;\n        let idx = this.event.index;\n        if (idx < previousColCount) {\n            let cell = this.body.children[idx];\n            left = px2int(cell.style.left);\n        }\n        else {\n            if (this.body.children.length === 0) {\n                left = 0;\n            }\n            else {\n                const cell = this.body.children[previousColCount - 1];\n                left = px2int(cell.style.left) + px2int(cell.style.width) + this.table.WIDTH_ADJUST - overlap;\n            }\n        }\n        this.animationStart = left;\n        let rowHeight = new Array(this.adapter.rowCount);\n        if (this.body.children.length !== 0) {\n            for (let row = 0; row < this.adapter.rowCount; ++row) {\n                const cell = this.body.children[row * previousColCount];\n                const bounds = cell.getBoundingClientRect();\n                rowHeight[row] = bounds.height;\n                if (this.adapter.config.seamless) {\n                    rowHeight[row] += 2;\n                }\n            }\n        }\n        else {\n            rowHeight.fill(this.table.minCellHeight);\n        }\n        let colHeadHeight = this.table.minCellHeight;\n        if (this.colHeads && this.colHeads.children.length > 0) {\n            const cell = this.colHeads.children[0];\n            const bounds = cell.getBoundingClientRect();\n            colHeadHeight = bounds.height;\n            if (this.adapter.config.seamless) {\n                colHeadHeight += 2;\n            }\n        }\n        let colWidth = new Array(this.event.size);\n        colWidth.fill(this.table.minCellWidth);\n        this.totalSize = 0;\n        idx = 0;\n        if (this.colHeads !== undefined) {\n            for (let col = 0; col < this.event.size; ++col) {\n                const cell = this.measure.children[idx++];\n                const bounds = cell.getBoundingClientRect();\n                colWidth[col] = Math.max(colWidth[col], bounds.width);\n                colHeadHeight = Math.max(colHeadHeight, bounds.height);\n            }\n        }\n        colHeadHeight = Math.ceil(colHeadHeight);\n        let rowHeadWidth = 0;\n        if (this.rowHeads !== undefined && this.rowHeads.children.length === 0 && this.adapter.colCount == this.event.size) {\n            rowHeadWidth = this.table.minCellWidth;\n            for (let row = 0; row < this.adapter.rowCount; ++row) {\n                const cell = this.measure.children[idx++];\n                const bounds = cell.getBoundingClientRect();\n                rowHeight[row] = Math.max(rowHeight[row], bounds.height - this.table.HEIGHT_ADJUST);\n                rowHeadWidth = Math.max(rowHeadWidth, bounds.width - this.table.WIDTH_ADJUST);\n            }\n        }\n        else {\n            if (this.rowHeads !== undefined) {\n                const b = this.rowHeads.children[0].getBoundingClientRect();\n                rowHeadWidth = b.width - this.table.WIDTH_ADJUST;\n            }\n        }\n        rowHeadWidth = Math.ceil(rowHeadWidth);\n        if (this.colHeads) {\n            if (rowHeadWidth === 0) {\n                this.colHeads.style.left = `0px`;\n            }\n            else {\n                this.colHeads.style.left = `${rowHeadWidth + this.table.WIDTH_ADJUST + 2 - overlap}px`;\n            }\n            this.colHeads.style.right = `0px`;\n            this.colHeads.style.height = `${colHeadHeight}px`;\n            this.body.style.top = `${colHeadHeight - 1}px`;\n            this.bodyStaging.style.top = `${colHeadHeight - 1}px`;\n        }\n        for (let col = 0; col < this.event.size; ++col) {\n            for (let row = 0; row < this.adapter.rowCount; ++row) {\n                const cell = this.measure.children[idx++];\n                const bounds = cell.getBoundingClientRect();\n                colWidth[col] = Math.ceil(Math.max(colWidth[col], bounds.width) - 2);\n                if (this.adapter.config.expandRow) {\n                    rowHeight[col] = Math.ceil(Math.max(rowHeight[row], bounds.height));\n                }\n                else {\n                    if (col === 0 && this.body.children.length === 0) {\n                        rowHeight[row] = Math.ceil(bounds.height);\n                    }\n                }\n            }\n            this.totalSize += colWidth[col] - overlap;\n        }\n        colWidth.forEach((v, i) => colWidth[i] = v + 4);\n        this.totalSize += overlap;\n        if (this.adapter.config.seamless) {\n            this.totalSize -= 2 * this.event.size;\n        }\n        let x = left;\n        if (this.colHeads !== undefined) {\n            for (let col = 0; col < this.event.size; ++col) {\n                const cell = this.measure.children[0];\n                this.setCellSize(cell, x, 0, colWidth[col], colHeadHeight);\n                this.headStaging.appendChild(cell);\n                x += colWidth[col] - overlap;\n                if (this.adapter.config.seamless) {\n                    x -= 2;\n                }\n            }\n        }\n        if (this.rowHeads !== undefined && this.rowHeads.children.length === 0 && this.adapter.colCount == this.event.size) {\n            let y = 0;\n            for (let row = 0; row < this.adapter.rowCount; ++row) {\n                const cell = this.measure.children[0];\n                cell.style.top = `${y}px`;\n                cell.style.height = `${rowHeight[row] - this.table.HEIGHT_ADJUST}px`;\n                cell.style.width = `${rowHeadWidth}px`;\n                this.rowHeads.appendChild(cell);\n                y += rowHeight[row] - overlap;\n            }\n            rowHeadWidth += this.table.WIDTH_ADJUST;\n            this.body.style.left = `${rowHeadWidth - overlap}px`;\n            this.bodyStaging.style.left = `${rowHeadWidth - overlap}px`;\n            this.headStaging.style.left = `${rowHeadWidth - overlap}px`;\n            this.colHeads.style.left = `${rowHeadWidth - overlap}px`;\n            this.rowHeads.style.top = `${colHeadHeight - overlap}px`;\n            this.rowHeads.style.bottom = `0px`;\n            this.rowHeads.style.width = `${rowHeadWidth}px`;\n        }\n        let totalWidth = 0;\n        x = left;\n        for (let col = this.event.index; col < this.event.index + this.event.size; ++col) {\n            let columnWidth = colWidth[col - this.event.index];\n            let y = 0;\n            for (let row = 0; row < this.rowCount; ++row) {\n                const cell = this.measure.children[0];\n                this.setCellSize(cell, x, y, columnWidth, rowHeight[row]);\n                this.bodyStaging.appendChild(cell);\n                y += rowHeight[row] - overlap;\n                if (this.adapter.config.seamless) {\n                    y -= 2;\n                }\n            }\n            x += columnWidth - overlap - 2;\n            if (!this.adapter.config.seamless) {\n                x += 2;\n            }\n            totalWidth += columnWidth - 2;\n        }\n        this.totalSize = totalWidth + 2;\n        this.mask = this.makeColumnMask(left, this.totalSize);\n        this.bodyStaging.appendChild(this.mask);\n        if (this.colHeads !== undefined) {\n            this.headMask = this.makeColumnMask(left, this.totalSize);\n            this.headStaging.appendChild(this.headMask);\n        }\n    }\n    split() {\n        this.table.splitVerticalNew(this.event.index);\n        if (this.colHeads !== undefined) {\n            this.splitHead = this.colHeads.lastElementChild;\n        }\n    }\n    joinHeader() {\n        if (this.colHeads === undefined) {\n            return;\n        }\n        this.headStaging.removeChild(this.headMask);\n        this.colHeads.removeChild(this.splitHead);\n        while (this.headStaging.children.length > 0) {\n            this.colHeads.appendChild(this.headStaging.children[0]);\n        }\n        if (this.splitHead.children.length > 0) {\n            let left = px2float(this.splitHead.style.left);\n            while (this.splitHead.children.length > 0) {\n                const cell = this.splitHead.children[0];\n                cell.style.left = `${px2float(cell.style.left) + left}px`;\n                this.colHeads.appendChild(cell);\n            }\n        }\n    }\n    joinBody() {\n        this.bodyStaging.removeChild(this.mask);\n        this.body.removeChild(this.splitBody);\n        const totalWidth = this.adapter.model.colCount;\n        const bodyWidth = this.event.index;\n        const stagingWidth = this.event.size;\n        const splitWidth = totalWidth - stagingWidth - this.event.index;\n        for (let col = 0; col < stagingWidth; ++col) {\n            for (let row = 0; row < this.rowCount; ++row) {\n                const cell = this.bodyStaging.children[0];\n                const idx = row * (bodyWidth + stagingWidth) + bodyWidth + col;\n                this.bodyInsertAt(cell, idx);\n            }\n        }\n        let left = this.totalSize + this.animationStart;\n        for (let row = 0; row < this.rowCount; ++row) {\n            for (let col = 0; col < splitWidth; ++col) {\n                const cell = this.splitBody.children[0];\n                cell.style.left = `${px2float(cell.style.left) + left}px`;\n                const idx = row * totalWidth + bodyWidth + stagingWidth + col;\n                this.bodyInsertAt(cell, idx);\n            }\n        }\n    }\n    bodyInsertAt(node, idx) {\n        let beforeChild;\n        if (idx < this.body.children.length) {\n            beforeChild = this.body.children[idx];\n        }\n        else {\n            beforeChild = null;\n        }\n        this.body.insertBefore(node, beforeChild);\n    }\n}\n//# sourceMappingURL=InsertColumnAnimation.js.map","import { px2float } from \"../Table.js\";\nimport { TableAnimation } from \"./TableAnimation.js\";\nexport class RemoveColumnAnimation extends TableAnimation {\n    constructor(table, event) {\n        super(table);\n        this.done = false;\n        this.colCount = this.adapter.colCount;\n        this.rowCount = this.adapter.rowCount;\n        this.event = event;\n        this.joinVertical = this.joinVertical.bind(this);\n        if (this.body.children.length === 0) {\n            this.initialWidth = 0;\n        }\n        else {\n            const cell = this.body.children[this.body.children.length - 1];\n            const left = px2float(cell.style.left);\n            const bounds = cell.getBoundingClientRect();\n            this.initialWidth = left + bounds.width;\n        }\n        RemoveColumnAnimation.current = this;\n    }\n    prepare() {\n        this.prepareStagingWithColumns();\n        this.arrangeColumnsInStaging();\n        this.splitVertical();\n    }\n    firstFrame() { }\n    animationFrame(n) {\n        let a = 0;\n        if (this.adapter.config.seamless) {\n            a = 1;\n        }\n        this.splitBody.style.left = `${this.leftSplitBody - n * this.animationWidth + a}px`;\n        this.mask.style.left = `${this.leftMask - n * this.animationWidth}px`;\n        if (this.colHeads !== undefined) {\n            this.splitHead.style.left = `${this.leftSplitBody - n * this.animationWidth + a}px`;\n            this.headMask.style.left = `${this.leftMask - n * this.animationWidth}px`;\n        }\n    }\n    lastFrame() {\n        this.joinVertical();\n        this.disposeStaging();\n    }\n    arrangeColumnsInStaging() {\n        let idx = this.event.index;\n        for (let row = 0; row < this.adapter.rowCount; ++row) {\n            for (let col = 0; col < this.event.size; ++col) {\n                this.bodyStaging.appendChild(this.body.children[idx]);\n            }\n            idx += this.colCount;\n        }\n        const firstCellOfStaging = this.bodyStaging.children[0];\n        const lastCellOfStaging = this.bodyStaging.children[this.bodyStaging.children.length - 1];\n        let rightOfStaging = px2float(lastCellOfStaging.style.left) + px2float(lastCellOfStaging.style.width) + this.table.WIDTH_ADJUST;\n        rightOfStaging -= 1;\n        let w = rightOfStaging - px2float(firstCellOfStaging.style.left);\n        this.animationWidth = w;\n        this.mask = this.makeColumnMask(rightOfStaging, w);\n        this.bodyStaging.appendChild(this.mask);\n        if (this.colHeads === undefined) {\n            return;\n        }\n        for (let i = 0; i < this.event.size; ++i) {\n            this.headStaging.appendChild(this.colHeads.children[this.event.index]);\n        }\n        this.headMask = this.makeColumnMask(rightOfStaging, w);\n        this.headStaging.appendChild(this.headMask);\n    }\n    splitVertical() {\n        this.table.splitVerticalNew(this.event.index);\n        if (this.colHeads !== undefined) {\n            this.splitHead = this.colHeads.lastElementChild;\n        }\n        const left = px2float(this.splitBody.style.left);\n        this.splitBody.style.width = `${this.initialWidth - left - 1}px`;\n        this.leftSplitBody = left;\n        this.leftMask = px2float(this.mask.style.left);\n        if (this.colHeads !== undefined) {\n            this.splitHead.style.left = `${left}px`;\n            this.splitHead.style.width = `${this.initialWidth - left - 1}px`;\n        }\n    }\n    joinVertical() {\n        this.bodyStaging.removeChild(this.mask);\n        this.body.removeChild(this.splitBody);\n        this.bodyStaging.replaceChildren();\n        this.moveSplitBodyToBody();\n        if (this.colHeads) {\n            this.headStaging.removeChild(this.headMask);\n            this.colHeads.removeChild(this.splitHead);\n            this.headStaging.replaceChildren();\n            this.moveSplitHeadToHead();\n        }\n        if (this.table.animationDone) {\n            this.table.animationDone();\n        }\n    }\n    moveSplitHeadToHead() {\n        if (this.splitHead.children.length === 0) {\n            return;\n        }\n        let left = px2float(this.splitHead.style.left);\n        while (this.splitHead.children.length > 0) {\n            const cell = this.splitHead.children[0];\n            cell.style.left = `${px2float(cell.style.left) + left}px`;\n            this.colHeads.appendChild(cell);\n        }\n    }\n    moveSplitBodyToBody() {\n        if (this.splitBody.children.length === 0) {\n            return;\n        }\n        let left = px2float(this.splitBody.style.left);\n        for (let row = 0; row < this.rowCount; ++row) {\n            for (let col = 0; col < this.colCount - this.event.index; ++col) {\n                const cell = this.splitBody.children[0];\n                cell.style.left = `${px2float(cell.style.left) + left}px`;\n                const idx = row * this.adapter.colCount + this.event.index + col;\n                this.bodyInsertAt(cell, idx);\n            }\n        }\n    }\n    bodyInsertAt(node, idx) {\n        let beforeChild;\n        if (idx < this.body.children.length) {\n            beforeChild = this.body.children[idx];\n        }\n        else {\n            beforeChild = null;\n        }\n        this.body.insertBefore(node, beforeChild);\n    }\n}\n//# sourceMappingURL=RemoveColumnAnimation.js.map","let animationFrameCount = 468;\nexport function setAnimationFrameCount(frames) {\n    animationFrameCount = frames;\n}\nexport function scrollIntoView(element) {\n    if (element === undefined)\n        return;\n    const scrollableParent = findScrollableParent(element);\n    if (scrollableParent === undefined)\n        return;\n    const parentRect = scrollableParent.getBoundingClientRect();\n    const clientRect = element.getBoundingClientRect();\n    if (scrollableParent !== document.body) {\n        const { x, y } = calculateScrollGoal(scrollableParent, parentRect, clientRect);\n        smoothScroll(scrollableParent, x, y);\n        if (window.getComputedStyle(scrollableParent).position !== 'fixed') {\n            window.scrollBy({\n                left: parentRect.left,\n                top: parentRect.top,\n                behavior: 'smooth'\n            });\n        }\n    }\n    else {\n        window.scrollBy({\n            left: clientRect.left,\n            top: clientRect.top,\n            behavior: 'smooth'\n        });\n    }\n}\nfunction calculateScrollGoal(scrollableParent, parentRect, clientRect) {\n    const GAP = 16;\n    const clientLeft = clientRect.left + scrollableParent.scrollLeft - parentRect.left - GAP;\n    const clientRight = clientRect.right + scrollableParent.scrollLeft - parentRect.left + GAP;\n    const clientTop = clientRect.top + scrollableParent.scrollTop - parentRect.top - GAP;\n    const clientBottom = clientRect.bottom + scrollableParent.scrollTop - parentRect.top + GAP;\n    const parentWidth = scrollableParent.clientWidth;\n    const parentHeight = scrollableParent.clientHeight;\n    var x = scrollableParent.scrollLeft;\n    var y = scrollableParent.scrollTop;\n    if (clientRight - clientLeft - 2 * GAP > parentWidth)\n        x = clientLeft;\n    else if (clientRight > scrollableParent.scrollLeft + parentWidth)\n        x = clientRight - parentWidth;\n    else if (clientLeft < scrollableParent.scrollLeft)\n        x = clientLeft;\n    if (clientBottom - clientTop - 2 * GAP > parentHeight)\n        y = clientTop;\n    else if (clientBottom > scrollableParent.scrollTop + parentHeight)\n        y = clientBottom - parentHeight;\n    else if (clientTop < scrollableParent.scrollTop)\n        y = clientTop;\n    x = Math.max(0, x);\n    y = Math.max(0, y);\n    return { x, y };\n}\nconst concurrentScroll = new Map();\nfunction smoothScroll(scrollable, x, y) {\n    let activeGoal = concurrentScroll.get(scrollable);\n    if (activeGoal === undefined) {\n        activeGoal = { x: x, y: y };\n        concurrentScroll.set(scrollable, activeGoal);\n    }\n    else {\n        activeGoal.x = x;\n        activeGoal.y = y;\n    }\n    let startX, startY;\n    if (scrollable === document.body) {\n        startX = window.scrollX || window.pageXOffset;\n        startY = window.scrollY || window.pageYOffset;\n    }\n    else {\n        startX = scrollable.scrollLeft;\n        startY = scrollable.scrollTop;\n    }\n    const deltaX = x - startX;\n    const deltaY = y - startY;\n    if (deltaX === 0 && deltaY === 0) {\n        concurrentScroll.delete(scrollable);\n        return;\n    }\n    animate((value) => {\n        if (activeGoal.x !== x || activeGoal.y !== y) {\n            return false;\n        }\n        const nx = startX + value * deltaX;\n        const ny = startY + value * deltaY;\n        if (scrollable === document.body) {\n            window.scrollTo(nx, ny);\n        }\n        else {\n            scrollable.scrollLeft = nx;\n            scrollable.scrollTop = ny;\n        }\n        if (value === 1) {\n            concurrentScroll.delete(scrollable);\n        }\n        return true;\n    });\n}\nlet idSource = 0;\nexport function animate(callback) {\n    setTimeout(() => { window.requestAnimationFrame(animateStep.bind(window, callback, undefined, undefined)); }, 0);\n}\nfunction animateStep(callback, startTime, id) {\n    if (startTime === undefined) {\n        startTime = Date.now();\n        id = ++idSource;\n    }\n    const time = Date.now();\n    let elapsed = animationFrameCount > 0 ? (time - startTime) / animationFrameCount : 1;\n    elapsed = elapsed > 1 ? 1 : elapsed;\n    const value = ease(elapsed);\n    if (callback(value) === false)\n        return;\n    if (value < 1.0) {\n        window.requestAnimationFrame(animateStep.bind(window, callback, startTime, id));\n    }\n}\nfunction ease(k) {\n    return 0.5 * (1 - Math.cos(Math.PI * k));\n}\nvar ROUNDING_TOLERANCE = isMicrosoftBrowser(window.navigator.userAgent) ? 1 : 0;\nfunction isMicrosoftBrowser(userAgent) {\n    const userAgentPatterns = ['MSIE ', 'Trident/', 'Edge/'];\n    return new RegExp(userAgentPatterns.join('|')).test(userAgent);\n}\nexport function findScrollableParent(el) {\n    while (el !== document.body && isScrollable(el) === false) {\n        if (el.parentElement === null)\n            return undefined;\n        el = el.parentElement;\n    }\n    return el;\n}\nexport function isScrollable(el) {\n    const isScrollableY = hasScrollableSpace(el, \"Y\") && canOverflow(el, \"Y\");\n    const isScrollableX = hasScrollableSpace(el, \"X\") && canOverflow(el, \"X\");\n    return isScrollableY || isScrollableX;\n}\nfunction hasScrollableSpace(el, axis) {\n    if (axis === 'X')\n        return el.clientWidth + ROUNDING_TOLERANCE < el.scrollWidth;\n    else\n        return el.clientHeight + ROUNDING_TOLERANCE < el.scrollHeight;\n}\nfunction canOverflow(el, axis) {\n    const style = window.getComputedStyle(el, null);\n    const overflowValue = style['overflow' + axis];\n    return overflowValue === 'auto' || overflowValue === 'scroll';\n}\n//# sourceMappingURL=scrollIntoView.js.map","import { css } from \"../../util/lsx.js\";\nexport const style = document.createElement(\"style\");\nstyle.textContent = css `\n:host {\n    position: relative;\n    display: inline-block;\n    border: 1px solid var(--tx-gray-300);\n    border-radius: 3px;\n    /* outline-offset: -2px; */\n    outline: none;\n    font-family: var(--tx-font-family);\n    font-size: var(--tx-font-size);\n    background: #1e1e1e;\n\n    /* not sure about these */\n    /*\n    width: 100%;\n    width: -moz-available;\n    width: -webkit-fill-available;\n    width: fill-available;\n    height: 100%;\n    height: -moz-available;\n    height: -webkit-fill-available;\n    height: fill-available;\n    */\n\n    min-height: 50px;\n    min-width: 50px;\n}\n\n.staging, .body, .splitBody, .cols, .rows {\n    position: absolute;\n}\n\n.cols {\n    right: 0;\n    top: 0;\n}\n\n.rows {\n    left: 0;\n    bottom: 0;\n}\n\n.staging {\n    overflow: hidden;\n    inset: 0;\n}\n\n.body {\n    overflow: auto;\n    inset: 0;\n}\n\n.cols, .rows {\n    overflow: hidden;\n}\n\n/*\n::-webkit-scrollbar the scrollbar.\n::-webkit-scrollbar-button the buttons on the scrollbar (arrows pointing upwards and downwards).\n::-webkit-scrollbar-thumb the draggable scrolling handle.\n::-webkit-scrollbar-track the track (progress bar) of the scrollbar.\n::-webkit-scrollbar-track-piece the track (progress bar) NOT covered by the handle.\n::-webkit-scrollbar-corner the bottom corner of the scrollbar, where both horizontal and vertical scrollbars meet.\n::-webkit-resizer the draggable resizing handle that appears at the bottom corner of some elements.\n*/\n\n/* TODO: this doesn't support all browsers */\n.body::-webkit-scrollbar {\n    width: 10px;\n    height: 10px;\n}\n.body::-webkit-scrollbar-thumb {\n    border-radius: 5px;\n}\n.body::-webkit-scrollbar-track {\n    background: #1e1e1e;\n}\n.body::-webkit-scrollbar-corner {\n    background: #1e1e1e;\n}\n.body::-webkit-scrollbar-thumb {\n    background: var(--tx-gray-500);\n}\n\n.body > span,\n.splitBody > span,\n.cols > span,\n.rows > span,\n.measure > span,\n.staging > span {\n    position: absolute;\n    box-sizing: content-box;\n    white-space: nowrap;\n    outline: none;\n    border: solid 1px var(--tx-gray-200);\n    padding: 0 2px 0 2px;\n    margin: 0;\n    background-color: #080808;\n    font-weight: 400;\n    overflow: hidden;\n    cursor: default;\n    caret-color: transparent;\n}\n\n.seamless > .body > span,\n.seamless > .body > .splitBody > span,\n.seamless > .cols > span,\n.seamless > .rows > span,\n.seamless > .cols > .splitBody > span,\n.seamless > .rows > .splitBody > span,\n.seamless > .measure > span,\n.seamless > .staging > span {\n    border: none 0px;\n}\n\n.body > span:hover {\n    background: #1a1a1a;\n}\n\n.body > span.error, .splitBody > span.error {\n    border-color: var(--tx-global-red-600);\n    z-index: 1;\n}\n\n.body > span:focus, .splitBody > span:focus {\n    background: #0e2035;\n    border-color: #2680eb;\n    z-index: 2;\n}\n\n.body > span:focus:hover {\n    background: #112d4d;\n}\n\n.body > span.error, .splitBody > span.error {\n    background-color: #522426;\n}\n\n.body > span.error:hover {\n    background: #401111;\n}\n\n.cols > span.handle,\n.rows > span.handle {\n    padding: 0;\n    border: 0 none;\n    opacity: 0;\n    background-color: #08f;\n}\n.fill {\n    opacity: 0;\n}\n\n.cols > span.handle {\n    cursor: col-resize;\n}\n.rows > span.handle {\n    cursor: row-resize;\n}\n\n.staging span.head,\n.cols span.head,\n.rows span.head,\n.measure span.head {\n    background: #1e1e1e;\n    font-weight: 600;\n}\n\n.colHack > span,\n.cols > span {\n    text-align: center;\n}\n\n.measure {\n    position: absolute;\n    opacity: 0;\n}\n\n.body > span.edit, .splitBody > span.edit, .body > span.edit:hover, .splitBody > span.edit:hover {\n    caret-color: currentcolor;\n}\n`;\n//# sourceMappingURL=tx-table.js.map","import { View } from \"../view/View.js\";\nimport { TableModel } from \"./model/TableModel.js\";\nimport { SelectionModel } from \"./model/SelectionModel.js\";\nimport { EditMode, TableAdapter } from \"./adapter/TableAdapter.js\";\nimport { TablePos } from \"./TablePos.js\";\nimport { TableEditMode } from \"./TableEditMode.js\";\nimport { TableEventType } from \"./TableEventType.js\";\nimport { Animator } from \"../util/animation.js\";\nimport { TableAnimation } from \"./private/TableAnimation.js\";\nimport { InsertRowAnimation } from \"./private/InsertRowAnimation.js\";\nimport { RemoveRowAnimation } from \"./private/RemoveRowAnimation.js\";\nimport { InsertColumnAnimation } from \"./private/InsertColumnAnimation.js\";\nimport { RemoveColumnAnimation } from \"./private/RemoveColumnAnimation.js\";\nimport { setInitialProperties } from 'toad.jsx';\nimport { span, div, text } from \"../util/lsx.js\";\nimport { scrollIntoView } from \"../util/scrollIntoView.js\";\nimport { style as txTable } from \"./style/tx-table.js\";\nimport { hasFocus } from \"../util/dom.js\";\nexport function px2int(s) {\n    return parseInt(s.substring(0, s.length - 2));\n}\nexport function px2float(s) {\n    return parseFloat(s.substring(0, s.length - 2));\n}\nfunction isVisible(e) {\n    if (e.isConnected === false) {\n        return false;\n    }\n    if (window.getComputedStyle(e).display === \"none\") {\n        return false;\n    }\n    if (e.parentElement) {\n        return isVisible(e.parentElement);\n    }\n    return true;\n}\nexport class Table extends View {\n    constructor(props) {\n        super();\n        this.WIDTH_ADJUST = 6;\n        this.HEIGHT_ADJUST = 2;\n        this.HANDLE_SIZE = 5;\n        this.HANDLE_SKEW = 3;\n        this.visible = false;\n        this.animator = new Animator();\n        this.arrangeAllMeasuredInGrid = this.arrangeAllMeasuredInGrid.bind(this);\n        this.hostKeyDown = this.hostKeyDown.bind(this);\n        this.cellKeyDown = this.cellKeyDown.bind(this);\n        this.cellFocus = this.cellFocus.bind(this);\n        this.focusIn = this.focusIn.bind(this);\n        this.focusOut = this.focusOut.bind(this);\n        this.pointerDown = this.pointerDown.bind(this);\n        this.handleDown = this.handleDown.bind(this);\n        this.handleMove = this.handleMove.bind(this);\n        this.handleUp = this.handleUp.bind(this);\n        this.setHeadingFillerSizeToScrollbarSize = this.setHeadingFillerSizeToScrollbarSize.bind(this);\n        this.selectionChanged = this.selectionChanged.bind(this);\n        this.modelChanged = this.modelChanged.bind(this);\n        this.root = div(this.body = div());\n        this.root.className = \"root\";\n        this.body.className = \"body\";\n        this.measure = div();\n        this.measure.classList.add(\"measure\");\n        this.onkeydown = this.hostKeyDown;\n        this.addEventListener(\"focusin\", this.focusIn);\n        this.addEventListener(\"focusout\", this.focusOut);\n        this.body.onresize = this.setHeadingFillerSizeToScrollbarSize;\n        this.body.onscroll = () => {\n            if (this.animator.current && this.animator.current instanceof TableAnimation) {\n                this.animator.current.scrollStaging();\n            }\n            this.setHeadingFillerSizeToScrollbarSize();\n            if (this.colHeads) {\n                this.colHeads.scrollLeft = this.body.scrollLeft;\n                this.colResizeHandles.scrollLeft = this.body.scrollLeft;\n            }\n            if (this.rowHeads) {\n                this.rowHeads.scrollTop = this.body.scrollTop;\n                this.rowResizeHandles.scrollTop = this.body.scrollTop;\n            }\n        };\n        this.body.onpointerdown = this.pointerDown;\n        this.attachShadow({ mode: 'open', delegatesFocus: true });\n        this.attachStyle(txTable);\n        this.shadowRoot.appendChild(this.root);\n        this.shadowRoot.appendChild(this.measure);\n        if (props) {\n            setInitialProperties(this, props);\n            if (props.selectionModel)\n                this.setModel(props.selectionModel);\n        }\n        if (Table.observer === undefined) {\n            Table.observer = new MutationObserver((mutations, observer) => {\n                Table.allTables.forEach(table => {\n                    if (isVisible(table)) {\n                        Table.allTables.delete(table);\n                        table.prepareCells();\n                    }\n                });\n            });\n            Table.observer.observe(document.body, {\n                attributes: true,\n                subtree: true\n            });\n        }\n    }\n    connectedCallback() {\n        if (isVisible(this)) {\n            this.prepareCells();\n        }\n        else {\n            Table.allTables.add(this);\n        }\n        super.connectedCallback();\n        if (this.selection === undefined) {\n            this.selection = new SelectionModel(TableEditMode.SELECT_CELL);\n            this.selection.modified.add(this.selectionChanged, this);\n        }\n    }\n    disconnectedCallback() {\n        Table.allTables.delete(this);\n    }\n    addStaging(...elements) {\n        for (const element of elements) {\n            if (element === undefined) {\n                continue;\n            }\n            this.root.insertBefore(element, this.root.children[0]);\n        }\n    }\n    removeStaging(...elements) {\n        for (const element of elements) {\n            if (element === undefined) {\n                continue;\n            }\n            this.root.removeChild(element);\n        }\n    }\n    hostKeyDown(ev) {\n        if (!this.selection)\n            return;\n        switch (this.selection.mode) {\n            case TableEditMode.SELECT_CELL:\n                {\n                    let pos = { col: this.selection.col, row: this.selection.row };\n                    switch (ev.key) {\n                        case \"ArrowRight\":\n                            if (this.editing === undefined && pos.col + 1 < this.adapter.colCount) {\n                                ++pos.col;\n                                ev.preventDefault();\n                                ev.stopPropagation();\n                            }\n                            break;\n                        case \"ArrowLeft\":\n                            if (this.editing === undefined && pos.col > 0) {\n                                --pos.col;\n                                ev.preventDefault();\n                                ev.stopPropagation();\n                            }\n                            break;\n                        case \"ArrowDown\":\n                            if (pos.row + 1 < this.adapter.rowCount) {\n                                ++pos.row;\n                                ev.preventDefault();\n                                ev.stopPropagation();\n                            }\n                            break;\n                        case \"ArrowUp\":\n                            if (pos.row > 0) {\n                                --pos.row;\n                                ev.preventDefault();\n                                ev.stopPropagation();\n                            }\n                            break;\n                        case \"Enter\":\n                            if (this.editing === undefined) {\n                                if (this.adapter?.config.editMode === EditMode.EDIT_ON_ENTER) {\n                                    this.editCell();\n                                }\n                            }\n                            else {\n                                this.saveCell();\n                                if (pos.row + 1 < this.adapter.rowCount) {\n                                    ++pos.row;\n                                    this.selection.value = pos;\n                                    this.editCell();\n                                }\n                            }\n                            ev.preventDefault();\n                            ev.stopPropagation();\n                            break;\n                    }\n                    this.selection.value = pos;\n                }\n                break;\n        }\n    }\n    cellKeyDown(ev) {\n        const cell = ev.target;\n        if (ev.key === \"Enter\") {\n            this.hostKeyDown(ev);\n            ev.preventDefault();\n            return;\n        }\n        if (!cell.classList.contains(\"edit\") && this.editing === undefined) {\n            switch (ev.key) {\n                case \"ArrowDown\":\n                case \"ArrowUp\":\n                case \"ArrowRight\":\n                case \"ArrowLeft\":\n                case \"Tab\":\n                case \"Enter\":\n                    break;\n                default:\n                    if (this.adapter?.config.editMode === EditMode.EDIT_ON_ENTER) {\n                        ev.preventDefault();\n                    }\n            }\n        }\n        else {\n        }\n    }\n    cellFocus(event) {\n        const cell = event.target;\n        if (cell instanceof HTMLElement) {\n            const b = cell.getBoundingClientRect();\n            const p = this.clientPosToTablePos(b.x + b.width / 2, b.y + b.height / 2);\n            if (p !== undefined) {\n                this.selection.value = p;\n            }\n        }\n    }\n    focusIn(event) {\n    }\n    focusOut(event) {\n    }\n    editCell() {\n        if (this.editing !== undefined) {\n            if (this.editing.col === this.selection.value.col &&\n                this.editing.row === this.selection.value.row) {\n                return;\n            }\n            else {\n                console.log(`WARN: Table.editCell(): already editing ANOTHER cell`);\n            }\n        }\n        const col = this.selection.value.col;\n        const row = this.selection.value.row;\n        const cell = this.body.children[col + row * this.adapter.colCount];\n        this.editing = new TablePos(col, row);\n        cell.classList.add(\"edit\");\n        this.adapter.editCell(this.editing, cell);\n    }\n    saveCell() {\n        if (this.editing === undefined) {\n            return;\n        }\n        const col = this.editing.col;\n        const row = this.editing.row;\n        const cell = this.body.children[col + row * this.adapter.colCount];\n        cell.classList.remove(\"edit\");\n        this.adapter.saveCell(this.editing, cell);\n        this.editing = undefined;\n        this.focus();\n    }\n    pointerDown(ev) {\n    }\n    getModel() {\n        return this.model;\n    }\n    setModel(model) {\n        if (model === undefined) {\n            if (this.selection) {\n                this.selection.modified.remove(this);\n            }\n            this.model = undefined;\n            this.selection = new SelectionModel();\n            this.selection.modified.add(this.selectionChanged, this);\n            return;\n        }\n        if (model instanceof SelectionModel) {\n            if (this.selection) {\n                this.selection.modified.remove(this);\n            }\n            this.selection = model;\n            this.selection.modified.add(this.selectionChanged, this);\n            return;\n        }\n        if (model instanceof TableModel) {\n            this.model = model;\n            this.model.modified.add(this.modelChanged, this);\n            const adapter = TableAdapter.lookup(model);\n            try {\n                this.adapter = new adapter(model);\n            }\n            catch (e) {\n                console.log(`Table.setModel(): failed to instantiate table adapter: ${e}`);\n                console.log(`setting TypeScript's target to 'es6' might help`);\n                throw e;\n            }\n            this.prepareCells();\n            return;\n        }\n        if (model instanceof Object) {\n            throw Error(\"Table.setModel(): unexpected model of type \" + model.constructor.name);\n        }\n    }\n    selectionChanged() {\n        if (this.selection === undefined) {\n            return;\n        }\n        this.saveCell();\n        switch (this.selection.mode) {\n            case TableEditMode.EDIT_CELL:\n                {\n                    if (document.activeElement === this) {\n                        const cell = this.body.children[this.selection.col + this.selection.row * this.adapter.colCount];\n                        scrollIntoView(cell);\n                    }\n                }\n                break;\n            case TableEditMode.SELECT_CELL: {\n                if (document.activeElement === this) {\n                    const cell = this.body.children[this.selection.col + this.selection.row * this.adapter.colCount];\n                    if (!hasFocus(cell)) {\n                        cell.focus();\n                    }\n                    scrollIntoView(cell);\n                    if (this.adapter?.config.editMode === EditMode.EDIT_ON_FOCUS) {\n                        this.editCell();\n                    }\n                }\n                break;\n            }\n            case TableEditMode.SELECT_ROW: {\n                break;\n            }\n        }\n    }\n    modelChanged(event) {\n        switch (event.type) {\n            case TableEventType.CELL_CHANGED:\n                {\n                    const cell = this.body.children[event.col + event.row * this.adapter.colCount];\n                    this.showCell(event, cell);\n                }\n                break;\n            case TableEventType.INSERT_ROW:\n                this.animator.run(new InsertRowAnimation(this, event));\n                break;\n            case TableEventType.REMOVE_ROW:\n                this.animator.run(new RemoveRowAnimation(this, event));\n                break;\n            case TableEventType.INSERT_COL:\n                this.animator.run(new InsertColumnAnimation(this, event));\n                break;\n            case TableEventType.REMOVE_COL:\n                this.animator.run(new RemoveColumnAnimation(this, event));\n                break;\n            default:\n                console.log(`Table.modelChanged(): ${event} is not implemented`);\n        }\n    }\n    prepareCells() {\n        if (!this.adapter) {\n            return;\n        }\n        this.visible = isVisible(this);\n        if (!this.visible) {\n            return;\n        }\n        if (this.adapter.colCount === 0 || this.adapter.rowCount === 0) {\n            return;\n        }\n        if (this.adapter.config.seamless) {\n            this.root.classList.add(\"seamless\");\n        }\n        this.prepareMinCellSize();\n        this.prepareColumnHeads();\n        this.prepareRowHeads();\n        this.prepareBody();\n        setTimeout(this.arrangeAllMeasuredInGrid, 0);\n    }\n    arrangeAllMeasuredInGrid() {\n        this.calculateMinCellSize();\n        let { colWidths, colHeadHeight } = this.calculateColumnWidths();\n        let { rowHeights, rowHeadWidth } = this.calculateRowHeights();\n        this.placeColumnHeads(colWidths, colHeadHeight, rowHeadWidth);\n        this.placeRowHeads(rowHeights, colHeadHeight, rowHeadWidth);\n        this.placeBody(rowHeadWidth, colHeadHeight);\n        this.placeBodyCells(colWidths, rowHeights, colHeadHeight, rowHeadWidth);\n        this.setHeadingFillerSizeToScrollbarSize();\n    }\n    prepareMinCellSize() {\n        if (this.minCellHeight !== undefined) {\n            return;\n        }\n        const measureLineHeight = span(text(\"Tg\"));\n        this.measure.appendChild(measureLineHeight);\n    }\n    calculateMinCellSize() {\n        if (this.minCellHeight !== undefined) {\n            return;\n        }\n        const measureLineHeight = this.measure.children[0];\n        const b = measureLineHeight.getBoundingClientRect();\n        this.minCellWidth = Math.ceil(b.width - this.WIDTH_ADJUST);\n        this.minCellHeight = Math.ceil(b.height - this.HEIGHT_ADJUST);\n        this.measure.removeChild(measureLineHeight);\n    }\n    prepareColumnHeads() {\n        const columnHeaders = new Array(this.adapter.colCount);\n        for (let col = 0; col < this.adapter.colCount; ++col) {\n            const content = this.adapter.getColumnHead(col);\n            if (this.colHeads === undefined && content !== undefined) {\n                this.colHeads = div();\n                this.colHeads.className = \"cols\";\n                this.root.appendChild(this.colHeads);\n                this.colResizeHandles = div();\n                this.colResizeHandles.className = \"cols\";\n                this.root.appendChild(this.colResizeHandles);\n            }\n            columnHeaders[col] = content;\n        }\n        if (this.colHeads !== undefined) {\n            for (let col = 0; col < this.adapter.colCount; ++col) {\n                const cell = span(columnHeaders[col]);\n                cell.className = \"head\";\n                this.measure.appendChild(cell);\n            }\n        }\n    }\n    prepareRowHeads() {\n        let rowHeaders = new Array(this.adapter.rowCount);\n        for (let row = 0; row < this.adapter.rowCount; ++row) {\n            const content = this.adapter.getRowHead(row);\n            if (this.rowHeads === undefined && content !== undefined) {\n                this.rowHeads = div();\n                this.rowHeads.className = \"rows\";\n                this.root.appendChild(this.rowHeads);\n                this.rowResizeHandles = div();\n                this.rowResizeHandles.className = \"rows\";\n                this.root.appendChild(this.rowResizeHandles);\n            }\n            rowHeaders[row] = content;\n        }\n        if (this.rowHeads) {\n            for (let row = 0; row < this.adapter.rowCount; ++row) {\n                const cell = span(rowHeaders[row]);\n                cell.className = \"head\";\n                this.measure.appendChild(cell);\n            }\n        }\n    }\n    prepareBody() {\n        for (let row = 0; row < this.adapter.rowCount; ++row) {\n            for (let col = 0; col < this.adapter.colCount; ++col) {\n                const cell = this.createCell();\n                this.showCell(new TablePos(col, row), cell);\n                this.measure.appendChild(cell);\n            }\n        }\n    }\n    createCell() {\n        const cell = span();\n        cell.onfocus = this.cellFocus;\n        cell.onkeydown = this.cellKeyDown;\n        cell.tabIndex = 0;\n        cell.setAttribute(\"contenteditable\", \"\");\n        return cell;\n    }\n    setCellSize(span, x, y, w, h) {\n        span.style.left = `${x}px`;\n        span.style.top = `${y}px`;\n        span.style.width = `${w - this.WIDTH_ADJUST}px`;\n        span.style.height = `${h - this.HEIGHT_ADJUST}px`;\n    }\n    showCell(pos, cell) {\n        this.adapter.showCell(pos, cell);\n        if (cell.children.length !== 0) {\n            cell.style.caretColor = 'currentcolor';\n        }\n    }\n    calculateRowHeights() {\n        let idx = this.colHeads ? this.adapter.colCount : 0;\n        let rowHeadWidth = 0;\n        const rowHeights = Array(this.adapter.rowCount);\n        if (this.rowHeads) {\n            for (let row = 0; row < this.adapter.rowCount; ++row) {\n                const child = this.measure.children[idx++];\n                const bounds = child.getBoundingClientRect();\n                rowHeights[row] = Math.max(bounds.height, this.minCellHeight);\n                rowHeadWidth = Math.max(rowHeadWidth, bounds.width);\n            }\n        }\n        else {\n            rowHeights.fill(this.minCellHeight);\n        }\n        idx = (this.colHeads ? this.adapter.colCount : 0) + (this.rowHeads ? this.adapter.rowCount : 0);\n        for (let row = 0; row < this.adapter.rowCount; ++row) {\n            let rh = rowHeights[row];\n            for (let col = 0; col < this.adapter.colCount; ++col) {\n                const child = this.measure.children[idx + col + row * this.adapter.colCount];\n                const bounds = child.getBoundingClientRect();\n                rh = Math.max(rh, bounds.height);\n            }\n            rowHeights[row] = Math.ceil(rh);\n        }\n        rowHeadWidth = Math.ceil(rowHeadWidth);\n        return { rowHeights, rowHeadWidth };\n    }\n    calculateColumnWidths(withinBody = false) {\n        let colHeadHeight = 0;\n        const colWidths = Array(this.adapter.colCount);\n        if (this.colHeads) {\n            for (let col = 0; col < this.adapter.colCount; ++col) {\n                const child = this.measure.children[col];\n                const bounds = child.getBoundingClientRect();\n                colWidths[col] = Math.max(bounds.width, this.minCellWidth);\n                colHeadHeight = Math.max(colHeadHeight, bounds.height);\n            }\n        }\n        else {\n            colWidths.fill(this.minCellWidth);\n        }\n        colHeadHeight = Math.ceil(colHeadHeight);\n        let idxStart;\n        if (withinBody) {\n            idxStart = 0;\n        }\n        else {\n            idxStart = (this.colHeads ? this.adapter.colCount : 0) + (this.rowHeads ? this.adapter.rowCount : 0);\n        }\n        for (let col = 0; col < this.adapter.colCount; ++col) {\n            let cw = colWidths[col];\n            for (let row = 0; row < this.adapter.rowCount; ++row) {\n                let child;\n                let idx = idxStart + col + row * this.adapter.colCount;\n                if (withinBody) {\n                    child = this.body.children[idx];\n                }\n                else {\n                    child = this.measure.children[idx];\n                }\n                const bounds = child.getBoundingClientRect();\n                cw = Math.max(cw, bounds.width);\n            }\n            colWidths[col] = Math.ceil(cw);\n        }\n        return { colWidths, colHeadHeight };\n    }\n    placeColumnHeads(colWidths, colHeadHeight, rowHeadWidth) {\n        if (this.colHeads === undefined) {\n            return;\n        }\n        const seam = this.adapter.config.seamless ? 0 : 1;\n        let x = 0;\n        for (let col = 0; col < this.adapter.colCount; ++col) {\n            const child = this.measure.children[0];\n            this.setCellSize(child, x, 0, colWidths[col], colHeadHeight);\n            this.colHeads.appendChild(child);\n            x += colWidths[col] - 1 - 1 + seam;\n        }\n        let filler = span();\n        filler.classList.add(\"head\");\n        filler.classList.add(\"fill\");\n        filler.style.left = `${x}px`;\n        filler.style.top = `0`;\n        filler.style.width = `256px`;\n        filler.style.height = `${colHeadHeight}px`;\n        this.colHeads.appendChild(filler);\n        this.colResizeHandles.style.left = `${rowHeadWidth}px`;\n        this.colResizeHandles.style.height = `${colHeadHeight}px`;\n        x = -this.HANDLE_SKEW;\n        for (let col = 0; col < this.adapter.colCount; ++col) {\n            x += colWidths[col] - 1;\n            const handle = this.createHandle(col, x, 0, this.HANDLE_SIZE, colHeadHeight);\n            this.colResizeHandles.appendChild(handle);\n        }\n        x += this.HANDLE_SIZE;\n        filler = span();\n        filler.classList.add(\"head\");\n        filler.classList.add(\"fill\");\n        filler.style.left = `${x}px`;\n        filler.style.top = `0`;\n        filler.style.width = `256px`;\n        filler.style.height = `${colHeadHeight}px`;\n        this.colResizeHandles.appendChild(filler);\n    }\n    placeRowHeads(rowHeights, colHeadHeight, rowHeadWidth) {\n        if (this.rowHeads === undefined) {\n            return;\n        }\n        const seam = this.adapter.config.seamless ? 0 : 1;\n        let y = 0;\n        for (let row = 0; row < this.adapter.rowCount; ++row) {\n            const child = this.measure.children[0];\n            this.setCellSize(child, 0, y, rowHeadWidth, rowHeights[row]);\n            this.rowHeads.appendChild(child);\n            y += rowHeights[row] - 1 - 1 + seam;\n        }\n        let filler = span();\n        filler.classList.add(\"head\");\n        filler.classList.add(\"fill\");\n        filler.style.left = `0`;\n        filler.style.top = `${y}px`;\n        filler.style.width = `${rowHeadWidth}px`;\n        filler.style.height = `256px`;\n        this.rowHeads.appendChild(filler);\n        this.rowResizeHandles.style.top = `${colHeadHeight}px`;\n        this.rowResizeHandles.style.width = `${rowHeadWidth}px`;\n        y = -this.HANDLE_SKEW;\n        for (let row = 0; row < this.adapter.rowCount; ++row) {\n            y += rowHeights[row] - 1;\n            const rowHandle = this.createHandle(row, 0, y, rowHeadWidth, this.HANDLE_SIZE);\n            this.rowResizeHandles.appendChild(rowHandle);\n        }\n        y += this.HANDLE_SIZE;\n        filler = span();\n        filler.classList.add(\"head\");\n        filler.classList.add(\"fill\");\n        filler.style.left = `0`;\n        filler.style.top = `${y}0px`;\n        filler.style.width = `${rowHeadWidth}px`;\n        filler.style.height = `256px`;\n        this.rowResizeHandles.appendChild(filler);\n    }\n    placeBody(rowHeadWidth, colHeadHeight) {\n        if (this.colHeads !== undefined) {\n            if (this.adapter?.config.seamless) {\n                this.colHeads.style.height = `${colHeadHeight - 2}px`;\n                this.colHeads.style.left = `${rowHeadWidth - (this.rowHeads == null ? 0 : 2)}px`;\n            }\n            else {\n                this.colHeads.style.height = `${colHeadHeight}px`;\n                this.colHeads.style.left = `${rowHeadWidth - (this.rowHeads == null ? 0 : 1)}px`;\n            }\n        }\n        if (this.rowHeads !== undefined) {\n            if (this.adapter?.config.seamless) {\n                this.rowHeads.style.width = `${rowHeadWidth - 2}px`;\n                this.rowHeads.style.top = `${colHeadHeight - (this.colHeads == null ? 0 : 2)}px`;\n            }\n            else {\n                this.rowHeads.style.width = `${rowHeadWidth}px`;\n                this.rowHeads.style.top = `${colHeadHeight - (this.colHeads == null ? 0 : 1)}px`;\n            }\n        }\n        --rowHeadWidth;\n        --colHeadHeight;\n        if (this.adapter?.config.seamless) {\n            --rowHeadWidth;\n            --colHeadHeight;\n        }\n        if (rowHeadWidth < 0) {\n            rowHeadWidth = 0;\n        }\n        if (colHeadHeight < 0) {\n            colHeadHeight = 0;\n        }\n        this.body.style.left = `${rowHeadWidth}px`;\n        this.body.style.top = `${colHeadHeight}px`;\n        return { rowHeadWidth, colHeadHeight };\n    }\n    placeBodyCells(colWidths, rowHeights, colHeadHeight, rowHeadWidth) {\n        const seam = this.adapter.config.seamless ? 0 : 1;\n        let y = 0;\n        for (let row = 0; row < this.adapter.rowCount; ++row) {\n            let x = 0;\n            for (let col = 0; col < this.adapter.colCount; ++col) {\n                const child = this.measure.children[0];\n                this.setCellSize(child, x, y, colWidths[col], rowHeights[row]);\n                this.body.appendChild(child);\n                x += colWidths[col] - 2 + seam;\n            }\n            y += rowHeights[row] - 2 + seam;\n        }\n    }\n    createHandle(idx, x, y, w, h) {\n        const handle = span();\n        handle.className = \"handle\";\n        handle.style.left = `${x}px`;\n        handle.style.top = `${y}px`;\n        handle.style.width = `${w}px`;\n        handle.style.height = `${h}px`;\n        handle.dataset[\"idx\"] = `${idx}`;\n        handle.onpointerdown = this.handleDown;\n        handle.onpointermove = this.handleMove;\n        handle.onpointerup = this.handleUp;\n        return handle;\n    }\n    handleDown(ev) {\n        ev.preventDefault();\n        this.handle = ev.target;\n        this.handleIndex = parseInt(this.handle.dataset[\"idx\"]) + 1;\n        this.handle.setPointerCapture(ev.pointerId);\n        const isColumn = this.handle.parentElement === this.colResizeHandles;\n        if (isColumn) {\n            this.deltaHandle = ev.clientX - px2int(this.handle.style.left);\n            this.deltaSplitBody = ev.clientX;\n            this.deltaSplitHead = ev.clientX - px2float(this.body.style.left);\n            const cell = this.colHeads.children[this.handleIndex - 1];\n            this.deltaColumn = ev.clientX - px2float(cell.style.width);\n            this.splitVertical(this.handleIndex);\n        }\n        else {\n            this.deltaHandle = ev.clientY - px2float(this.handle.style.top);\n            this.deltaSplitBody = ev.clientY;\n            this.deltaSplitHead = ev.clientY - px2float(this.body.style.top);\n            const cell = this.rowHeads.children[this.handleIndex - 1];\n            this.deltaColumn = ev.clientY - px2float(cell.style.height);\n            this.splitHorizontal(this.handleIndex);\n        }\n    }\n    handleMove(ev) {\n        if (this.handle === undefined) {\n            return;\n        }\n        const isColumn = this.handle.parentElement === this.colResizeHandles;\n        if (isColumn) {\n            let clientX = ev.clientX;\n            const xLimit = this.deltaColumn + 8;\n            if (clientX < xLimit) {\n                clientX = xLimit;\n            }\n            this.handle.style.left = `${clientX - this.deltaHandle}px`;\n            this.splitHead.style.left = `${clientX - this.deltaSplitHead}px`;\n            this.splitBody.style.left = `${clientX - this.deltaSplitBody}px`;\n            const h = this.handleIndex;\n            this.colHeads.children[h - 1].style.width = `${clientX - this.deltaColumn}px`;\n            for (let row = 0; row < this.adapter.rowCount; ++row) {\n                this.body.children[h - 1 + row * h].style.width = `${clientX - this.deltaColumn}px`;\n            }\n        }\n        else {\n            let clientY = ev.clientY;\n            const yLimit = this.deltaColumn + 8;\n            if (clientY < yLimit) {\n                clientY = yLimit;\n            }\n            this.handle.style.top = `${clientY - this.deltaHandle}px`;\n            this.splitHead.style.top = `${clientY - this.deltaSplitHead}px`;\n            this.splitBody.style.top = `${clientY - this.deltaSplitBody}px`;\n            const h = this.handleIndex;\n            this.rowHeads.children[h - 1].style.height = `${clientY - this.deltaColumn}px`;\n            let idx = (h - 1) * this.adapter.colCount;\n            for (let col = 0; col < this.adapter.colCount; ++col) {\n                this.body.children[idx + col].style.height = `${clientY - this.deltaColumn}px`;\n            }\n        }\n    }\n    handleUp(ev) {\n        if (this.handle === undefined) {\n            return;\n        }\n        this.handleMove(ev);\n        const isColumn = this.handle.parentElement === this.colResizeHandles;\n        if (isColumn) {\n            let clientX = ev.clientX;\n            const xLimit = this.deltaColumn + 8;\n            if (clientX < xLimit) {\n                clientX = xLimit;\n            }\n            this.joinVertical(this.handleIndex, clientX - this.deltaSplitBody);\n        }\n        else {\n            let clientY = ev.clientY;\n            const yLimit = this.deltaColumn + 8;\n            if (clientY < yLimit) {\n                clientY = yLimit;\n            }\n            this.joinHorizontal(this.handleIndex, clientY - this.deltaSplitBody);\n        }\n        this.handle = undefined;\n    }\n    splitVerticalNew(splitCol) {\n        this.splitHeadVertical(splitCol);\n        this.splitBodyVertical(splitCol);\n    }\n    splitHeadVertical(splitCol) {\n        if (this.colHeads === undefined) {\n            return;\n        }\n        const overlap = this.adapter.config.seamless ? 0 : 1;\n        this.splitHead = div();\n        this.splitHead.className = \"splitBody colHack\";\n        this.splitHead.style.top = `0`;\n        this.splitHead.style.bottom = `0`;\n        this.splitHead.style.backgroundColor = Table.splitColor;\n        const idx = splitCol;\n        if (this.body.children.length === 0) {\n            this.splitHead.style.left = `0px`;\n            this.splitHead.style.width = `1px`;\n        }\n        else {\n            if (idx < this.colHeads.children.length) {\n                let cell = this.colHeads.children[idx];\n                let width = 0;\n                const left = px2float(cell.style.left);\n                while (idx < this.colHeads.children.length) {\n                    cell = this.colHeads.children[idx];\n                    const b = cell.getBoundingClientRect();\n                    width += b.width - overlap;\n                    let x = px2float(cell.style.left);\n                    cell.style.left = `${x - left}px`;\n                    this.splitHead.appendChild(cell);\n                }\n                if (this.adapter.config.seamless) {\n                    width += overlap;\n                }\n                this.splitHead.style.left = `${left}px`;\n                this.splitHead.style.width = `${width}px`;\n            }\n            else {\n                let cell = this.colHeads.children[this.body.children.length - 1];\n                let b = cell.getBoundingClientRect();\n                let left = px2float(cell.style.left) + b.width - overlap;\n                this.splitHead.style.left = `${left}px`;\n                this.splitHead.style.width = `1px`;\n            }\n        }\n        this.colHeads.appendChild(this.splitHead);\n    }\n    splitBodyVertical(splitCol) {\n        const overlap = this.adapter.config.seamless ? 0 : 1;\n        this.splitBody = div();\n        this.splitBody.className = \"splitBody\";\n        this.splitBody.style.top = `0`;\n        this.splitBody.style.bottom = `0`;\n        this.splitBody.style.backgroundColor = Table.splitColor;\n        if (this.body.children.length === 0) {\n            this.splitBody.style.left = `0px`;\n            this.splitBody.style.width = `1px`;\n        }\n        else {\n            const previousColCount = this.body.children.length / this.adapter.rowCount;\n            if (splitCol < previousColCount) {\n                let cell = this.body.children[splitCol];\n                const left = px2float(cell.style.left);\n                let width = 0;\n                const colsInBody = this.body.children.length / this.adapter.rowCount;\n                const colsToSplit = colsInBody - splitCol;\n                let idx = splitCol;\n                for (let row = 0; row < this.adapter.rowCount; ++row) {\n                    for (let col = 0; col < colsToSplit; ++col) {\n                        cell = this.body.children[idx];\n                        if (row === 0) {\n                            const b = cell.getBoundingClientRect();\n                            width += b.width - overlap;\n                        }\n                        cell.style.left = `${px2float(cell.style.left) - left}px`;\n                        this.splitBody.appendChild(cell);\n                    }\n                    idx += splitCol;\n                }\n                this.splitBody.style.left = `${left}px`;\n                this.splitBody.style.width = `${width}px`;\n            }\n            else {\n                let cell = this.body.children[this.body.children.length - 1];\n                let boundary = cell.getBoundingClientRect();\n                let left = px2float(cell.style.left) + boundary.width - overlap;\n                this.splitBody.style.left = `${left}px`;\n                this.splitBody.style.width = `1px`;\n            }\n        }\n        this.body.appendChild(this.splitBody);\n    }\n    splitVertical(splitColumn, extra = 0) {\n        if (this.colHeads !== undefined) {\n            this.splitHead = div();\n            this.splitHead.className = \"cols\";\n            this.splitHead.style.left = this.colHeads.style.left;\n            this.splitHead.style.height = this.colHeads.style.height;\n            this.root.appendChild(this.splitHead);\n            setTimeout(() => {\n                this.splitHead.scrollTop = this.colHeads.scrollTop;\n                this.splitHead.scrollLeft = this.colHeads.scrollLeft;\n            }, 0);\n        }\n        this.splitBody = div();\n        this.splitBody.className = \"splitBody\";\n        const b = this.body.getBoundingClientRect();\n        this.splitBody.style.width = `${b.width}px`;\n        this.splitBody.style.height = `${b.height}px`;\n        this.body.appendChild(this.splitBody);\n        const bodyWidth = splitColumn;\n        const splitBodyColumns = this.adapter.colCount - splitColumn + extra;\n        if (this.splitHead !== undefined) {\n            for (let i = 0; i < splitBodyColumns; ++i) {\n                this.splitHead.appendChild(this.colHeads.children[splitColumn]);\n            }\n            this.splitHead.appendChild(this.colHeads.children[this.colHeads.children.length - 1].cloneNode());\n        }\n        let idx = splitColumn;\n        for (let row = 0; row < this.adapter.rowCount; ++row) {\n            for (let col = 0; col < splitBodyColumns; ++col) {\n                this.splitBody.appendChild(this.body.children[idx]);\n            }\n            idx += bodyWidth;\n        }\n    }\n    joinVertical(splitCol, delta, extra = 0, colCount, rowCount) {\n        if (colCount === undefined) {\n            colCount = this.adapter.colCount;\n        }\n        if (rowCount === undefined) {\n            rowCount = this.adapter.rowCount;\n        }\n        const splitBodyColumns = colCount - splitCol + extra;\n        let idx = splitCol - extra;\n        if (this.colHeads !== undefined) {\n            const filler = this.colHeads.children[this.colHeads.children.length - 1];\n            for (let col = 0; col < splitBodyColumns; ++col) {\n                const cell = this.splitHead.children[0];\n                const left = px2float(cell.style.left);\n                cell.style.left = `${left + delta}px`;\n                this.colHeads.insertBefore(cell, filler);\n            }\n            const fillerLeft = filler.style.left;\n            const left = px2float(fillerLeft);\n            filler.style.left = `${left + delta}px`;\n            for (let col = idx; col <= colCount; ++col) {\n                const cell = this.colResizeHandles.children[col];\n                const left = px2float(cell.style.left);\n                cell.style.left = `${left + delta}px`;\n            }\n        }\n        for (let row = 0; row < rowCount; ++row) {\n            let beforeChild = this.body.children[idx];\n            for (let col = 0; col < splitBodyColumns; ++col) {\n                const cell = this.splitBody.children[0];\n                const left = px2float(cell.style.left);\n                cell.style.left = `${left + delta}px`;\n                this.body.insertBefore(cell, beforeChild);\n            }\n            idx += colCount;\n        }\n        if (this.colHeads !== undefined) {\n            this.root.removeChild(this.splitHead);\n            this.splitHead = undefined;\n        }\n        this.body.removeChild(this.splitBody);\n        this.splitBody = undefined;\n    }\n    splitHorizontalNew(splitRow) {\n        this.splitHeadHorizontal(splitRow);\n        this.splitBodyHorizontal(splitRow);\n    }\n    splitHeadHorizontal(splitRow) {\n        if (this.rowHeads === undefined) {\n            return;\n        }\n        const overlap = this.adapter.config.seamless ? 0 : 1;\n        this.splitHead = div();\n        this.splitHead.className = \"splitBody\";\n        this.splitHead.style.left = `0`;\n        this.splitHead.style.right = `0`;\n        this.splitHead.style.backgroundColor = Table.splitColor;\n        const idx = splitRow;\n        if (this.body.children.length === 0) {\n            this.splitHead.style.top = `0px`;\n            this.splitHead.style.height = `1px`;\n        }\n        else {\n            if (idx < this.rowHeads.children.length) {\n                let cell = this.rowHeads.children[idx];\n                let height = 0;\n                const top = px2float(cell.style.top);\n                while (idx < this.rowHeads.children.length) {\n                    cell = this.rowHeads.children[idx];\n                    const b = cell.getBoundingClientRect();\n                    height += b.height - overlap;\n                    let y = px2float(cell.style.top);\n                    cell.style.top = `${y - top}px`;\n                    this.splitHead.appendChild(cell);\n                }\n                if (this.adapter.config.seamless) {\n                    height += overlap;\n                }\n                this.splitHead.style.top = `${top}px`;\n                this.splitHead.style.height = `${height}px`;\n            }\n            else {\n                let cell = this.rowHeads.children[this.body.children.length - 1];\n                let b = cell.getBoundingClientRect();\n                let top = px2float(cell.style.top) + b.height - overlap;\n                this.splitHead.style.top = `${top}px`;\n                this.splitHead.style.height = `1px`;\n            }\n        }\n        this.rowHeads.appendChild(this.splitHead);\n    }\n    splitBodyHorizontal(splitRow) {\n        const overlap = this.adapter.config.seamless ? 0 : 1;\n        this.splitBody = div();\n        this.splitBody.className = \"splitBody\";\n        this.splitBody.style.left = `0`;\n        this.splitBody.style.right = `0`;\n        this.splitBody.style.backgroundColor = Table.splitColor;\n        const idx = splitRow * this.adapter.colCount;\n        if (this.body.children.length === 0) {\n            this.splitBody.style.top = `0px`;\n            this.splitBody.style.height = `1px`;\n        }\n        else {\n            if (idx < this.body.children.length) {\n                let cell = this.body.children[idx];\n                let col = this.adapter.colCount;\n                let height = 0;\n                const top = px2float(cell.style.top);\n                while (idx < this.body.children.length) {\n                    cell = this.body.children[idx];\n                    --col;\n                    if (col === 0) {\n                        const b = cell.getBoundingClientRect();\n                        height += b.height - overlap;\n                        col = this.adapter.colCount;\n                    }\n                    let y = px2float(cell.style.top);\n                    cell.style.top = `${y - top}px`;\n                    this.splitBody.appendChild(cell);\n                }\n                height += overlap;\n                this.splitBody.style.top = `${top}px`;\n                this.splitBody.style.height = `${height}px`;\n            }\n            else {\n                let cellAtBottom = this.body.children[this.body.children.length - 1];\n                let b = cellAtBottom.getBoundingClientRect();\n                let top = px2float(cellAtBottom.style.top) + b.height - overlap;\n                this.splitBody.style.top = `${top}px`;\n                this.splitBody.style.height = `1px`;\n            }\n        }\n        this.body.appendChild(this.splitBody);\n    }\n    splitHorizontal(splitRow, extra = 0, event) {\n        if (this.rowHeads !== undefined) {\n            this.splitHead = div();\n            this.splitHead.className = \"rows\";\n            this.splitHead.style.top = this.rowHeads.style.top;\n            this.splitHead.style.width = this.rowHeads.style.width;\n            this.root.appendChild(this.splitHead);\n            setTimeout(() => {\n                this.splitHead.scrollTop = this.rowHeads.scrollTop;\n                this.splitHead.scrollLeft = this.rowHeads.scrollLeft;\n            }, 0);\n        }\n        this.splitBody = div();\n        this.splitBody.className = \"splitBody\";\n        this.splitBody.style.backgroundColor = 'rgba(255,128,0,0.5)';\n        const b = this.body.getBoundingClientRect();\n        this.splitBody.style.width = `${b.width}px`;\n        this.splitBody.style.height = `${b.height}px`;\n        this.body.appendChild(this.splitBody);\n        const splitBodyRows = this.adapter.rowCount - splitRow + extra;\n        if (this.splitHead !== undefined) {\n            for (let i = 0; i < splitBodyRows; ++i) {\n                this.splitHead.appendChild(this.rowHeads.children[splitRow]);\n            }\n            this.splitHead.appendChild(this.rowHeads.children[this.rowHeads.children.length - 1].cloneNode());\n        }\n        let idx = this.adapter.colCount * splitRow;\n        for (let row = 0; row < splitBodyRows; ++row) {\n            for (let col = 0; col < this.adapter.colCount; ++col) {\n                this.splitBody.appendChild(this.body.children[idx]);\n            }\n        }\n        if (this.splitBody.children.length > 0) {\n            idx = this.splitBody.children.length - 1;\n            const last = this.splitBody.children[idx];\n            const top = px2int(last.style.top);\n            for (let i = 0; i < this.splitBody.children.length; ++i) {\n                const c = this.splitBody.children[i];\n                const y = px2int(c.style.top);\n                c.style.top = `${y - top}px`;\n            }\n            this.splitBody.style.backgroundColor = '#f80';\n            this.splitBody.style.top = `${top}px`;\n            this.splitBody.style.height = `${b.height - top}px`;\n        }\n        else if (event !== undefined && this.body.children.length > 0) {\n            idx = event.index * this.adapter.colCount;\n            const last = this.body.children[idx];\n            const top = px2int(last.style.top);\n            this.splitBody.style.top = `${top}px`;\n            this.splitBody.style.height = `${b.height - top}px`;\n        }\n        else if (this.body.children.length > 0) {\n            const filler = span();\n            idx = this.body.children.length - 2;\n            const last = this.body.children[idx];\n            const bf = this.body.children[idx].getBoundingClientRect();\n            filler.style.border = 'none';\n            filler.style.backgroundColor = '#1e1e1e';\n            const top = px2int(last.style.top) + bf.height;\n            filler.style.top = `${top}px`;\n            filler.style.left = `0px`;\n            filler.style.width = `${b.width - 2}px`;\n            filler.style.height = `${b.height - top}px`;\n            this.splitBody.appendChild(filler);\n        }\n        else {\n        }\n    }\n    joinHorizontal(splitRow, delta, extra = 0, colCount, rowCount) {\n        if (colCount === undefined) {\n            colCount = this.adapter.colCount;\n        }\n        if (rowCount === undefined) {\n            rowCount = this.adapter.rowCount;\n        }\n        const splitBodyRows = rowCount - splitRow + extra;\n        if (this.rowHeads !== undefined) {\n            const filler = this.rowHeads.children[this.rowHeads.children.length - 1];\n            for (let row = 0; row < splitBodyRows; ++row) {\n                const cell = this.splitHead.children[0];\n                const top = px2float(cell.style.top);\n                cell.style.top = `${top + delta}px`;\n                this.rowHeads.insertBefore(cell, filler);\n            }\n            const fillerTop = filler.style.top;\n            const top = px2float(fillerTop);\n            filler.style.top = `${top + delta}px`;\n            let idx = splitRow;\n            for (let row = idx; row <= rowCount; ++row) {\n                const cell = this.rowResizeHandles.children[row];\n                const top = px2float(cell.style.top);\n                cell.style.top = `${top + delta}px`;\n            }\n        }\n        for (let row = 0; row < splitBodyRows; ++row) {\n            for (let col = 0; col < colCount; ++col) {\n                const cell = this.splitBody.children[0];\n                const top = px2float(cell.style.top);\n                cell.style.top = `${top + delta}px`;\n                this.body.appendChild(cell);\n            }\n        }\n        if (this.rowHeads !== undefined) {\n            this.root.removeChild(this.splitHead);\n            this.splitHead = undefined;\n        }\n        this.body.removeChild(this.splitBody);\n        this.splitBody = undefined;\n    }\n    setHeadingFillerSizeToScrollbarSize() {\n        const bounds = this.body.getBoundingClientRect();\n        if (this.colHeads !== undefined) {\n            const w = Math.ceil(bounds.width - this.body.clientWidth);\n            this.colHeads.children[this.colHeads.children.length - 1].style.width = `${w}px`;\n            this.colHeads.style.right = `${w}px`;\n        }\n        if (this.rowHeads !== undefined) {\n            const h = Math.ceil(bounds.height - this.body.clientHeight);\n            this.rowHeads.children[this.rowHeads.children.length - 1].style.height = `${h}px`;\n            this.rowHeads.style.bottom = `${h}px`;\n        }\n    }\n    clientPosToTablePos(x, y) {\n        let col, row;\n        for (col = 0; col < this.adapter.colCount; ++col) {\n            const b = this.body.children[col].getBoundingClientRect();\n            if (b.x <= x && x < b.x + b.width)\n                break;\n        }\n        if (col >= this.adapter.colCount) {\n            return undefined;\n        }\n        let idx = 0;\n        for (row = 0; row < this.adapter.rowCount; ++row) {\n            const b = this.body.children[idx].getBoundingClientRect();\n            if (b.y <= y && y < b.y + b.height)\n                break;\n            idx += this.adapter.colCount;\n        }\n        if (row >= this.adapter.rowCount) {\n            return undefined;\n        }\n        return new TablePos(col, row);\n    }\n}\nTable.maskColor = `#1e1e1e`;\nTable.splitColor = `#1e1e1e`;\nTable.allTables = new Set();\nTable.define(\"tx-table\", Table);\n//# sourceMappingURL=Table.js.map","import { jsx as _jsx, jsxs as _jsxs } from \"toad.jsx/lib/jsx-runtime\";\nimport { View } from \"../view/View.js\";\nimport { GenericTool } from \"../view/GenericTool.js\";\nimport { textAreaStyle } from \"../view/textAreaStyle.js\";\nimport { Table } from \"./Table.js\";\nexport class TableTool extends GenericTool {\n    constructor() {\n        super();\n        this.toolbar = _jsx(\"div\", { class: \"toolbar\" });\n        this.buttonAddRowAbove = _jsx(\"button\", { class: \"left\", title: \"add row above\", children: _jsxs(\"svg\", { style: { display: \"block\" }, viewBox: \"0 0 13 13\", width: \"13\", height: \"13\", children: [_jsx(\"rect\", { x: \"0.5\", y: \"0.5\", width: \"12\", height: \"12\", class: \"strokeFill\" }), _jsx(\"line\", { x1: \"0.5\", y1: \"8.5\", x2: \"12.5\", y2: \"8.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"4.5\", y1: \"8.5\", x2: \"4.5\", y2: \"13.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"8.5\", y1: \"8.5\", x2: \"8.5\", y2: \"13.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"6.5\", y1: \"2\", x2: \"6.5\", y2: \"7\", class: \"stroke\" }), _jsx(\"line\", { x1: \"4\", y1: \"4.5\", x2: \"9\", y2: \"4.5\", class: \"stroke\" })] }) });\n        this.buttonAddRowAbove.onclick = () => {\n            this.lastActiveTable?.focus();\n            const model = this.lastActiveTable?.model;\n            const selection = this.lastActiveTable?.selection;\n            if (selection && isRowEditInterface(model)) {\n                model.insertRow(selection.row);\n            }\n        };\n        this.toolbar.appendChild(this.buttonAddRowAbove);\n        this.buttonAddRowBelow = _jsx(\"button\", { title: \"add row below\", children: _jsxs(\"svg\", { viewBox: \"0 0 13 13\", width: \"13\", height: \"13\", children: [_jsx(\"rect\", { x: \"0.5\", y: \"0.5\", width: \"12\", height: \"12\", class: \"strokeFill\" }), _jsx(\"line\", { x1: \"0.5\", y1: \"4.5\", x2: \"12.5\", y2: \"4.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"4.5\", y1: \"0.5\", x2: \"4.5\", y2: \"4.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"8.5\", y1: \"0.5\", x2: \"8.5\", y2: \"4.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"6.5\", y1: \"6\", x2: \"6.5\", y2: \"11\", class: \"stroke\" }), _jsx(\"line\", { x1: \"4\", y1: \"8.5\", x2: \"9\", y2: \"8.5\", class: \"stroke\" })] }) });\n        this.buttonAddRowBelow.onclick = () => {\n            this.lastActiveTable?.focus();\n            const model = this.lastActiveTable?.model;\n            const selection = this.lastActiveTable?.selection;\n            if (selection && isRowEditInterface(model)) {\n                model.insertRow(selection.row + 1);\n            }\n        };\n        this.toolbar.appendChild(this.buttonAddRowBelow);\n        this.buttonDeleteRow = _jsx(\"button\", { class: \"right\", title: \"delete row\", children: _jsxs(\"svg\", { viewBox: \"0 0 13 13\", width: \"13\", height: \"13\", children: [_jsx(\"rect\", { x: \"0.5\", y: \"0.5\", width: \"12\", height: \"12\", class: \"strokeFill\" }), _jsx(\"line\", { x1: \"0.5\", y1: \"4.5\", x2: \"12.5\", y2: \"4.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"0.5\", y1: \"8.5\", x2: \"12.5\", y2: \"8.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"5.5\", y1: \"3.5\", x2: \"11.5\", y2: \"9.5\", class: \"stroke\", \"stroke-width\": \"1.5\" }), _jsx(\"line\", { x1: \"11.5\", y1: \"3.5\", x2: \"5.5\", y2: \"9.5\", class: \"stroke\", \"stroke-width\": \"1.5\" })] }) });\n        this.buttonDeleteRow.onclick = () => {\n            this.lastActiveTable?.focus();\n            const model = this.lastActiveTable?.model;\n            const selection = this.lastActiveTable?.selection;\n            if (selection && isRowEditInterface(model)) {\n                model.removeRow(selection.row, 1);\n            }\n        };\n        this.toolbar.appendChild(this.buttonDeleteRow);\n        this.toolbar.appendChild(document.createTextNode(\" \"));\n        this.buttonAddColumnLeft = _jsx(\"button\", { class: \"left\", title: \"add column left\", children: _jsxs(\"svg\", { viewBox: \"0 0 13 13\", width: \"13\", height: \"13\", children: [_jsx(\"rect\", { x: \"0.5\", y: \"0.5\", width: \"12\", height: \"12\", class: \"strokeFill\" }), _jsx(\"line\", { x1: \"8.5\", y1: \"0.5\", x2: \"8.5\", y2: \"12.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"8.5\", y1: \"4.5\", x2: \"12.5\", y2: \"4.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"8.5\", y1: \"8.5\", x2: \"12.5\", y2: \"8.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"2\", y1: \"6.5\", x2: \"7\", y2: \"6.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"4.5\", y1: \"4\", x2: \"4.5\", y2: \"9\", class: \"stroke\" })] }) });\n        this.buttonAddColumnLeft.onclick = () => {\n            this.lastActiveTable?.focus();\n            const model = this.lastActiveTable?.model;\n            const selection = this.lastActiveTable?.selection;\n            if (selection && isColumnEditInterface(model)) {\n                model.insertColumn(selection.col);\n            }\n        };\n        this.toolbar.appendChild(this.buttonAddColumnLeft);\n        this.buttonAddColumnRight = _jsx(\"button\", { title: \"add column right\", children: _jsxs(\"svg\", { viewBox: \"0 0 13 13\", width: \"13\", height: \"13\", children: [_jsx(\"rect\", { x: \"0.5\", y: \"0.5\", width: \"12\", height: \"12\", class: \"strokeFill\" }), _jsx(\"line\", { x1: \"4.5\", y1: \"0.5\", x2: \"4.5\", y2: \"12.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"0.5\", y1: \"4.5\", x2: \"4.5\", y2: \"4.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"0.5\", y1: \"8.5\", x2: \"4.5\", y2: \"8.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"6\", y1: \"6.5\", x2: \"11\", y2: \"6.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"8.5\", y1: \"4\", x2: \"8.5\", y2: \"9\", class: \"stroke\" })] }) });\n        this.buttonAddColumnRight.onclick = () => {\n            this.lastActiveTable?.focus();\n            const model = this.lastActiveTable?.model;\n            const selection = this.lastActiveTable?.selection;\n            if (selection && isColumnEditInterface(model)) {\n                model.insertColumn(selection.col + 1);\n            }\n        };\n        this.toolbar.appendChild(this.buttonAddColumnRight);\n        this.buttonDeleteColumn = _jsx(\"button\", { class: \"right\", title: \"delete column\", children: _jsxs(\"svg\", { viewBox: \"0 0 13 13\", width: \"13\", height: \"13\", children: [_jsx(\"rect\", { x: \"0.5\", y: \"0.5\", width: \"12\", height: \"12\", class: \"strokeFill\" }), _jsx(\"line\", { x1: \"4.5\", y1: \"0.5\", x2: \"4.5\", y2: \"12.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"8.5\", y1: \"0.5\", x2: \"8.5\", y2: \"12.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"3.5\", y1: \"5.5\", x2: \"9.5\", y2: \"11.5\", class: \"stroke\", \"stroke-width\": \"1.5\" }), _jsx(\"line\", { x1: \"3.5\", y1: \"11.5\", x2: \"9.5\", y2: \"5.5\", class: \"stroke\", \"stroke-width\": \"1.5\" })] }) });\n        this.buttonDeleteColumn.onclick = () => {\n            this.lastActiveTable?.focus();\n            const model = this.lastActiveTable?.model;\n            const selection = this.lastActiveTable?.selection;\n            if (selection && isColumnEditInterface(model)) {\n                model.removeColumn(selection.col, 1);\n            }\n        };\n        this.toolbar.appendChild(this.buttonDeleteColumn);\n        this.toolbar.appendChild(document.createTextNode(\" \"));\n        this.buttonAddNodeAbove = _jsx(\"button\", { class: \"left\", title: \"add node above\", children: _jsxs(\"svg\", { style: { display: \"block\", border: \"none\" }, viewBox: \"0 0 8 17\", width: \"8\", height: \"17\", children: [_jsx(\"rect\", { x: \"0.5\", y: \"1.5\", width: \"6\", height: \"6\", class: \"strokeFill\" }), _jsx(\"rect\", { x: \"0.5\", y: \"9.5\", width: \"6\", height: \"6\", class: \"fill\" }), _jsx(\"line\", { x1: \"3.5\", y1: \"3\", x2: \"3.5\", y2: \"6\", class: \"stroke\" }), _jsx(\"line\", { x1: \"2\", y1: \"4.5\", x2: \"5\", y2: \"4.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"3.5\", y1: \"0\", x2: \"3.5\", y2: \"1\", class: \"stroke\" }), _jsx(\"line\", { x1: \"3.5\", y1: \"8\", x2: \"3.5\", y2: \"17\", class: \"stroke\" })] }) });\n        this.toolbar.appendChild(this.buttonAddNodeAbove);\n        this.buttonAddNodeBelow = _jsx(\"button\", { title: \"add node below\", children: _jsxs(\"svg\", { style: { display: \"block\", border: \"none\" }, viewBox: \"0 0 8 17\", width: \"8\", height: \"17\", children: [_jsx(\"rect\", { x: \"0.5\", y: \"1.5\", width: \"6\", height: \"6\", class: \"fill\" }), _jsx(\"rect\", { x: \"0.5\", y: \"9.5\", width: \"6\", height: \"6\", class: \"strokeFill\" }), _jsx(\"line\", { x1: \"3.5\", y1: \"11\", x2: \"3.5\", y2: \"14\", class: \"stroke\" }), _jsx(\"line\", { x1: \"2\", y1: \"12.5\", x2: \"5\", y2: \"12.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"3.5\", y1: \"0\", x2: \"3.5\", y2: \"9\", class: \"stroke\" }), _jsx(\"line\", { x1: \"3.5\", y1: \"16\", x2: \"3.5\", y2: \"17\", class: \"stroke\" })] }) });\n        this.toolbar.appendChild(this.buttonAddNodeBelow);\n        this.buttonAddNodeParent = _jsx(\"button\", { title: \"add node parent\", children: _jsxs(\"svg\", { viewBox: \"0 0 13 17\", width: \"13\", height: \"17\", children: [_jsx(\"rect\", { x: \"0.5\", y: \"1.5\", width: \"6\", height: \"6\", class: \"strokeFill\" }), _jsx(\"rect\", { x: \"6.5\", y: \"9.5\", width: \"6\", height: \"6\", class: \"fill\" }), _jsx(\"line\", { x1: \"7\", y1: \"4.5\", x2: \"10\", y2: \"4.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"9.5\", y1: \"4\", x2: \"9.5\", y2: \"9\", class: \"stroke\" }), _jsx(\"line\", { x1: \"3.5\", y1: \"3\", x2: \"3.5\", y2: \"6\", class: \"stroke\" }), _jsx(\"line\", { x1: \"2\", y1: \"4.5\", x2: \"5\", y2: \"4.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"3.5\", y1: \"0\", x2: \"3.5\", y2: \"1\", class: \"stroke\" }), _jsx(\"line\", { x1: \"3.5\", y1: \"8\", x2: \"3.5\", y2: \"17\", class: \"stroke\" })] }) });\n        this.buttonAddNodeParent.onclick = () => {\n        };\n        this.toolbar.appendChild(this.buttonAddNodeParent);\n        this.buttonAddNodeChild = _jsx(\"button\", { title: \"add node child\", children: _jsxs(\"svg\", { viewBox: \"0 0 13 17\", width: \"13\", height: \"17\", children: [_jsx(\"rect\", { x: \"0.5\", y: \"1.5\", width: \"6\", height: \"6\", class: \"fill\" }), _jsx(\"rect\", { x: \"6.5\", y: \"9.5\", width: \"6\", height: \"6\", class: \"strokeFill\" }), _jsx(\"line\", { x1: \"7\", y1: \"4.5\", x2: \"10\", y2: \"4.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"9.5\", y1: \"4\", x2: \"9.5\", y2: \"9\", class: \"stroke\" }), _jsx(\"line\", { x1: \"9.5\", y1: \"11\", x2: \"9.5\", y2: \"14\", class: \"stroke\" }), _jsx(\"line\", { x1: \"8\", y1: \"12.5\", x2: \"11\", y2: \"12.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"3.5\", y1: \"0\", x2: \"3.5\", y2: \"17\", class: \"stroke\" })] }) });\n        this.toolbar.appendChild(this.buttonAddNodeChild);\n        this.buttonDeleteNode = _jsx(\"button\", { class: \"right\", title: \"delete node\", children: _jsxs(\"svg\", { viewBox: \"0 0 10 17\", width: \"10\", height: \"17\", children: [_jsx(\"rect\", { x: \"1.5\", y: \"5.5\", width: \"6\", height: \"6\", class: \"strokeFill\" }), _jsx(\"line\", { x1: \"4.5\", y1: \"2\", x2: \"4.5\", y2: \"5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"4.5\", y1: \"12\", x2: \"4.5\", y2: \"15\", class: \"stroke\" }), _jsx(\"line\", { x1: \"0.5\", y1: \"4.5\", x2: \"8.5\", y2: \"12.5\", class: \"stroke\", \"stroke-width\": \"1.5\" }), _jsx(\"line\", { x1: \"8.5\", y1: \"4.5\", x2: \"0.5\", y2: \"12.5\", class: \"stroke\", \"stroke-width\": \"1.5\" })] }) });\n        this.toolbar.appendChild(this.buttonDeleteNode);\n        this.attachShadow({ mode: 'open' });\n        this.shadowRoot.appendChild(document.importNode(textAreaStyle, true));\n        this.shadowRoot.appendChild(this.toolbar);\n    }\n    canHandle(view) {\n        return view instanceof Table;\n    }\n    activate() {\n        this.lastActiveTable = GenericTool.activeView;\n        this.toolbar.classList.add(\"active\");\n    }\n    deactivate() {\n        this.lastActiveTable = undefined;\n        this.toolbar.classList.remove(\"active\");\n    }\n}\nView.define(\"tx-tabletool\", TableTool);\nfunction isRowEditInterface(model) {\n    return model !== undefined && 'insertRow' in model && \"removeRow\" in model;\n}\nfunction isColumnEditInterface(model) {\n    return model !== undefined && 'insertColumn' in model && \"removeColumn\" in model;\n}\n//# sourceMappingURL=TableTool.js.map","import { TableAdapter } from \"./TableAdapter.js\";\nclass AbstractTypedTableAdapter extends TableAdapter {\n}\nexport class TypedTableAdapter extends AbstractTypedTableAdapter {\n}\n//# sourceMappingURL=TypedTableAdapter.js.map","import { TableEventType } from \"./TableEventType.js\";\nexport class TableEvent {\n    constructor(type, index, size) {\n        this.type = type;\n        this.index = index;\n        this.size = size;\n    }\n    get col() {\n        return this.index;\n    }\n    get row() {\n        return this.size;\n    }\n    toString() {\n        return `TableEvent {type: ${TableEventType[this.type]}, index: ${this.index}, size: ${this.size}}`;\n    }\n}\n//# sourceMappingURL=TableEvent.js.map","import { TypedTableModel } from \"./TypedTableModel.js\";\nimport { TableEvent } from \"../TableEvent.js\";\nimport { TableEventType } from \"../TableEventType.js\";\nexport class RowInfo {\n    constructor(node, depth, open = true) {\n        this.node = node;\n        this.depth = depth;\n        this.open = open;\n    }\n}\nexport class TreeModel extends TypedTableModel {\n    constructor(nodeClass, root) {\n        super(nodeClass);\n        this.rows = new Array();\n        if (root !== undefined) {\n            this.createRowInfoHelper(this.rows, root, 0);\n        }\n    }\n    get colCount() { return 1; }\n    get rowCount() { return this.rows.length; }\n    getRow(node) {\n        for (let i = 0; i < this.rows.length; ++i) {\n            if (this.rows[i].node === node) {\n                return i;\n            }\n        }\n        return undefined;\n    }\n    addSiblingBefore(row) {\n        const nn = this.createNode();\n        if (this.rows.length === 0) {\n            row = 0;\n            this.setRoot(nn);\n            this.rows.push(new RowInfo(nn, 0));\n        }\n        else {\n            if (row === 0) {\n                this.setNext(nn, this.getRoot());\n                this.setRoot(nn);\n                this.rows.unshift(new RowInfo(nn, 0));\n            }\n            else {\n                this.setNext(nn, this.rows[row].node);\n                if (this.getNext(this.rows[row - 1].node) === this.rows[row].node)\n                    this.setNext(this.rows[row - 1].node, nn);\n                else\n                    this.setDown(this.rows[row - 1].node, nn);\n                this.rows.splice(row, 0, new RowInfo(nn, this.rows[row].depth));\n            }\n        }\n        this.modified.trigger(new TableEvent(TableEventType.INSERT_ROW, row, 1));\n        return row;\n    }\n    addSiblingAfter(row) {\n        const nn = this.createNode();\n        if (this.rows.length === 0) {\n            row = 0;\n            this.setRoot(nn);\n            this.rows.push(new RowInfo(nn, 0));\n        }\n        else {\n            this.setNext(nn, this.getNext(this.rows[row].node));\n            this.setNext(this.rows[row].node, nn);\n            const count = this.nodeCount(this.getDown(this.rows[row].node));\n            const depth = this.rows[row].depth;\n            row += count + 1;\n            this.rows.splice(row, 0, new RowInfo(nn, depth));\n        }\n        this.modified.trigger(new TableEvent(TableEventType.INSERT_ROW, row, 1));\n        return row;\n    }\n    addChildAfter(row) {\n        const nn = this.createNode();\n        if (this.rows.length === 0) {\n            this.setRoot(nn);\n            this.rows.push(new RowInfo(nn, 0));\n            this.modified.trigger(new TableEvent(TableEventType.INSERT_ROW, 0, 1));\n        }\n        else {\n            const down = this.getDown(this.rows[row].node);\n            const subtreeSize = this.nodeCount(down);\n            for (let i = 0; i < subtreeSize; ++i)\n                ++this.rows[row + 1 + i].depth;\n            this.setDown(nn, down);\n            this.setDown(this.rows[row].node, nn);\n            this.rows.splice(row + 1, 0, new RowInfo(nn, this.rows[row].depth + 1));\n            this.modified.trigger(new TableEvent(TableEventType.INSERT_ROW, row + 1, 1));\n        }\n        return row;\n    }\n    addParentBefore(row) {\n        const nn = this.createNode();\n        if (row === 0) {\n            for (let i = 0; i < this.rows.length; ++i)\n                ++this.rows[row + i].depth;\n            this.setDown(nn, this.getRoot());\n            this.setRoot(nn);\n            this.rows.unshift(new RowInfo(nn, 0));\n        }\n        else {\n            const depth = this.rows[row].depth;\n            const subtreeSize = this.nodeCount(this.getDown(this.rows[row].node)) + 1;\n            for (let i = 0; i < subtreeSize; ++i)\n                ++this.rows[row + i].depth;\n            this.setDown(nn, this.rows[row].node);\n            this.setNext(nn, this.getNext(this.rows[row].node));\n            this.setNext(this.rows[row].node, undefined);\n            if (this.getNext(this.rows[row - 1].node) === this.rows[row].node)\n                this.setNext(this.rows[row - 1].node, nn);\n            else\n                this.setDown(this.rows[row - 1].node, nn);\n            this.rows.splice(row, 0, new RowInfo(nn, depth));\n        }\n        this.modified.trigger(new TableEvent(TableEventType.INSERT_ROW, row, 1));\n        return row;\n    }\n    deleteAt(row) {\n        let down = this.getDown(this.rows[row].node);\n        if (down !== undefined) {\n            const subtreeSize = this.nodeCount(down) + 1;\n            for (let i = 0; i < subtreeSize; ++i)\n                --this.rows[row + i].depth;\n            this.append(down, this.getNext(this.rows[row].node));\n            this.setNext(this.rows[row].node, undefined);\n            if (row === 0) {\n                this.setRoot(down);\n            }\n            else {\n                this.setNext(this.rows[row - 1].node, down);\n            }\n        }\n        else {\n            if (row === 0) {\n                const next = this.getNext(this.rows[row].node);\n                this.setNext(this.rows[row].node, undefined);\n                this.setRoot(next);\n            }\n            else {\n                const next = this.getNext(this.rows[row].node);\n                this.setNext(this.rows[row].node, undefined);\n                if (this.getNext(this.rows[row - 1].node) === this.rows[row].node)\n                    this.setNext(this.rows[row - 1].node, next);\n                else\n                    this.setDown(this.rows[row - 1].node, next);\n            }\n        }\n        this.rows.splice(row, 1);\n        this.modified.trigger(new TableEvent(TableEventType.REMOVE_ROW, row, 1));\n        return row;\n    }\n    init() { }\n    toggleAt(row) {\n        if (this.rows[row].open) {\n            this.closeAt(row);\n        }\n        else {\n            this.openAt(row);\n        }\n    }\n    isOpen(row) {\n        return this.rows[row].open;\n    }\n    openAt(row) {\n        let r = this.rows[row];\n        if (r.open || this.getDown(r.node) === undefined)\n            return;\n        r.open = true;\n        const newRows = this.createRowInfo(row);\n        this.rows.splice(row + 1, 0, ...newRows);\n        this.modified.trigger(new TableEvent(TableEventType.INSERT_ROW, row + 1, newRows.length));\n    }\n    closeAt(row) {\n        let r = this.rows[row];\n        if (!r.open || this.getDown(r.node) === undefined)\n            return;\n        const count = this.getVisibleChildCount(row);\n        r.open = false;\n        this.rows.splice(row + 1, count);\n        this.modified.trigger(new TableEvent(TableEventType.REMOVE_ROW, row + 1, count));\n    }\n    collapse() {\n        let row = 0;\n        while (row < this.rowCount) {\n            this.closeAt(row);\n            ++row;\n        }\n        for (let rowinfo of this.rows) {\n            rowinfo.open = false;\n        }\n    }\n    createRowInfo(row) {\n        const newRows = new Array();\n        let r = this.rows[row];\n        if (r.open && this.getDown(r.node)) {\n            this.createRowInfoHelper(newRows, this.getDown(r.node), r.depth + 1);\n        }\n        return newRows;\n    }\n    createRowInfoHelper(newRows, node, depth) {\n        const rowInfo = new RowInfo(node, depth, false);\n        newRows.push(rowInfo);\n        if (rowInfo.open && this.getDown(node)) {\n            this.createRowInfoHelper(newRows, this.getDown(node), rowInfo.depth + 1);\n        }\n        if (this.getNext(node)) {\n            this.createRowInfoHelper(newRows, this.getNext(node), rowInfo.depth);\n        }\n    }\n    getVisibleChildCount(row) {\n        let r = this.rows[row];\n        let count = 1;\n        if (r.open && this.getDown(r.node)) {\n            const rows = this.getVisibleChildCountHelper(row + 1);\n            row += rows;\n            count += rows;\n        }\n        return count - 1;\n    }\n    getVisibleChildCountHelper(row) {\n        let r = this.rows[row];\n        let count = 1;\n        if (r.open && this.getDown(r.node)) {\n            const rows = this.getVisibleChildCountHelper(row + 1);\n            row += rows;\n            count += rows;\n        }\n        if (this.getNext(r.node)) {\n            const rows = this.getVisibleChildCountHelper(row + 1);\n            row += rows;\n            count += rows;\n        }\n        return count;\n    }\n    append(chain, node) {\n        if (node === undefined)\n            return;\n        let p = chain;\n        let next;\n        while (true) {\n            next = this.getNext(p);\n            if (next === undefined)\n                break;\n            p = next;\n        }\n        this.setNext(p, node);\n    }\n    nodeCount(node) {\n        if (node === undefined)\n            return 0;\n        return 1 + this.nodeCount(this.getDown(node)) + this.nodeCount(this.getNext(node));\n    }\n}\n//# sourceMappingURL=TreeModel.js.map","import { TypedTableAdapter } from \"./TypedTableAdapter.js\";\nimport { svg, rect, line, span, text } from \"../../util/lsx.js\";\nexport class TreeAdapter extends TypedTableAdapter {\n    constructor(model) {\n        super(model);\n        this.config.seamless = true;\n    }\n    treeCell(pos, cell, label) {\n        this._showCell(pos, cell);\n        const labelNode = span(text(label));\n        labelNode.style.verticalAlign = \"middle\";\n        labelNode.style.padding = \"2px\";\n        cell.appendChild(labelNode);\n    }\n    showCell(pos, cell) {\n        this._showCell(pos, cell);\n    }\n    _showCell(pos, cell) {\n        if (this.model === undefined) {\n            console.log(\"no model\");\n            return;\n        }\n        const rowinfo = this.model.rows[pos.row];\n        const rs = 8;\n        const sx = rs + 4;\n        const height = sx;\n        const dx = 3.5;\n        const dy = Math.round(height / 2 - rs / 2) - 0.5;\n        const rx = 3;\n        const width = rowinfo.depth * sx + sx + dx;\n        const svgNode = svg();\n        svgNode.setAttributeNS(null, `width`, `${width}`);\n        svgNode.setAttributeNS(null, `height`, `${sx}`);\n        svgNode.style.verticalAlign = \"middle\";\n        svgNode.style.background = \"none\";\n        const d = rowinfo.depth;\n        if (this.model.getDown(rowinfo.node) !== undefined) {\n            const x0 = d * sx + dx;\n            const box = rect(x0, dy, rs, rs, \"#000\", \"#fff\");\n            box.style.cursor = \"pointer\";\n            svgNode.appendChild(box);\n            const minus = line(x0 + (rs >> 2), dy + (rs >> 1), x0 + rs - (rs >> 2), dy + (rs >> 1), \"#000\");\n            minus.style.cursor = \"pointer\";\n            svgNode.appendChild(minus);\n            const plus = line(x0 + (rs >> 1), dy + (rs >> 2), x0 + (rs >> 1), dy + rs - (rs >> 2), \"#000\");\n            plus.style.cursor = \"pointer\";\n            plus.style.display = rowinfo.open ? \"none\" : \"\";\n            svgNode.appendChild(plus);\n            svgNode.appendChild(line(x0 + rs, dy + (rs >> 1), x0 + rs + rx, dy + (rs >> 1), \"#f80\"));\n            svgNode.onpointerdown = (event) => {\n                event.preventDefault();\n                event.stopPropagation();\n                const rowNumber = this.model.getRow(rowinfo.node);\n                if (rowNumber === undefined) {\n                    console.log(\"  ==> couldn't find row number for node\");\n                    return;\n                }\n                const bounds = svgNode.getBoundingClientRect();\n                const x = event.clientX - bounds.left;\n                const y = event.clientY - bounds.top;\n                if (x0 <= x && x <= x0 + rs && dy <= y && y <= dy + rs) {\n                    this.model?.toggleAt(rowNumber);\n                    plus.style.display = this.model.isOpen(rowNumber) ? \"none\" : \"\";\n                }\n            };\n        }\n        else {\n            svgNode.appendChild(line(d * sx + dx + (rs >> 1) - 0.5, 0, d * sx + dx + (rs >> 1), dy + (rs >> 1), \"#f80\"));\n            svgNode.appendChild(line(d * sx + dx + (rs >> 1), dy + (rs >> 1), d * sx + dx + rs + rx, dy + (rs >> 1), \"#f80\"));\n        }\n        let lines = \"\";\n        for (let i = 0; i <= d; ++i) {\n            const x = i * sx + dx + (rs >> 1) + 2;\n            for (let j = pos.row + 1; j < this.model.rowCount; ++j) {\n                if (this.model.rows[j].depth < i)\n                    break;\n                if (i === this.model.rows[j].depth) {\n                    if (i !== d) {\n                        lines += `<line x1='${x}' y1='0' x2='${x}' y2='100%' stroke='%23f80' />`;\n                    }\n                    else {\n                        if (this.model.getNext(rowinfo.node) !== undefined) {\n                            lines += `<line x1='${x}' y1='0' x2='${x}' y2='100%' stroke='%23f80' />`;\n                        }\n                    }\n                    break;\n                }\n            }\n        }\n        if (this.model.getDown(rowinfo.node) === undefined || this.model.getNext(rowinfo.node) === undefined) {\n            const x = d * sx + dx + (rs >> 1) + 2;\n            lines += `<line x1='${x}' y1='0' x2='${x}' y2='${rs >> 1}' stroke='%23f80' />`;\n        }\n        cell.style.background = `url(\\\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' style='background: %23000;'>${lines}</svg>\\\")`;\n        cell.style.backgroundRepeat = \"repeat-y\";\n        cell.replaceChildren(svgNode);\n    }\n}\n//# sourceMappingURL=TreeAdapter.js.map","import { TreeModel } from \"./TreeModel.js\";\nexport class TreeNodeModel extends TreeModel {\n    constructor(nodeClass, root) {\n        super(nodeClass, root);\n        this.root = root;\n    }\n    createNode() { return new this.nodeClass(); }\n    deleteNode(node) { }\n    getRoot() { return this.root; }\n    setRoot(node) { this.root = node; }\n    getDown(node) { return node.down; }\n    setDown(node, down) { node.down = down; }\n    getNext(node) { return node.next; }\n    setNext(node, next) { node.next = next; }\n}\n//# sourceMappingURL=TreeNodeModel.js.map","import { TargetRef } from './TargetRef'\nimport { Human } from './Human'\nimport { getTargetWeights } from './getTargetWeights'\n\nimport { NumberModel } from 'toad.js'\n\n// from apps/humanmodifier.py\nexport abstract class Modifier {\n    human?: Human\n\n    groupName: string\n    name: string\n    description: string\n    value: number\n    defaultValue: number\n    model?: NumberModel\n\n    // eventType\n\n    targets: TargetRef[]\n\n    verts?: number[]\n    faces?: number[]\n\n    macroVariable?: string\n    macroDependencies?: Set<String>\n\n    constructor(groupName: string, name: string) {\n        this.groupName = groupName.replace('/', '-')\n        this.name = name.replace('/', '-')\n        this.description = ''\n\n        this.value = 0\n        this.defaultValue = 0\n        this.targets = []\n    }\n\n    // set/add/link/assign modifier to human\n    setHuman(human: Human) {\n        this.human = human\n        human.addModifier(this)\n    }\n\n    get fullName(): string {\n        return `${this.groupName}/${this.name}`\n    }\n\n    getMin() {\n        return 0.0\n    }\n\n    getMax() {\n        return 1.0\n    }\n\n    setValue(value: number, {skipDependencies = false} = {}) {\n        // console.log(`Modifier.setValue(${value}) // modifier ${this.fullName}`)\n        const clampedValue = this.clampValue(value)\n        const factors = this.getFactors(clampedValue)\n        const tWeights = getTargetWeights(this.targets, factors, clampedValue)\n        for(let x of tWeights)\n            this.human!.setDetail(x[0], x[1])\n\n        if (skipDependencies)\n            return\n\n        // Update dependent modifiers\n        this.propagateUpdate(false)\n    }\n\n    resetValue(): number {\n        const oldValue = this.getValue()\n        this.setValue(this.getDefaultValue())\n        return oldValue\n    }\n\n    propagateUpdate(realtime = false) {\n        console.log('please note: Modifier.propagateUpdate is not implemented')\n        // let f\n        // if (realtime)\n        //     f = realtimeDependencyUpdates\n        // else\n        //     f = None\n\n        // for (const dependentModifierGroup of self.human.getModifiersAffectedBy(this, filter = f)) {\n        //     // Only updating one modifier in a group should suffice to update the\n        //     // targets affected by the entire group.\n        //     const m = this.human.getModifiersByGroup(dependentModifierGroup)[0]\n        //     if (realtime)\n        //         m.updateValue(m.getValue(), skipUpdate = True)\n        //     else\n        //         m.setValue(m.getValue(), skipDependencies = True)\n        // }\n    }\n\n    abstract clampValue(value: number): number\n    abstract getFactors(value: number): Map<string, number>\n\n    getValue(): number {\n        // return sum([self.human.getDetail(target[0]) for target in self.targets])\n        let sum = 0\n        for(let target of this.targets)\n            sum += this.human!.getDetail(target.targetPath)\n        return sum\n    }\n\n    getDefaultValue(): number {\n        return this.defaultValue\n    }\n\n    buildLists() {\n        if (this.verts !== undefined || this.faces !== undefined)\n            return\n        for (const target in this.targets) {\n\n        }        \n    }\n\n    updateValue(value: number, {updateNormals = 1, skipUpdate = false} = {} ) {\n        // console.log(`Modifier.updateValue() is not implemented // ${this.fullName}`)\n        // if (this.verts === undefined && this.faces === undefined)\n        //     this.buildLists()\n\n        //    # Update detail state\n        //    old_detail = [self.human.getDetail(target[0]) for target in self.targets]\n        this.setValue(value, {skipDependencies: true})\n        //    new_detail = [self.human.getDetail(target[0]) for target in self.targets]\n\n        //    # Apply changes\n        //    for target, old, new in zip(self.targets, old_detail, new_detail):\n        //        if new == old:\n        //            continue\n        //        if self.human.isPosed():\n        //            # Apply target with pose transformation\n        //            animatedMesh = self.human\n        //        else:\n        //            animatedMesh = None\n        //        algos3d.loadTranslationTarget(self.human.meshData, target[0], new - old, None, 0, 0, animatedMesh=animatedMesh)\n\n        //    if skipUpdate:\n        //        # Used for dependency updates (avoid dependency loops and double updates to human)\n        //        return\n\n        //    # Update dependent modifiers\n        //    self.propagateUpdate(realtime = True)\n\n        //    # Update vertices\n        //    if updateNormals:\n        //        self.human.meshData.calcNormals(1, 1, self.verts, self.faces)\n        //    self.human.meshData.update()\n        //    event = events3d.HumanEvent(self.human, self.eventType)\n        //    event.modifier = self.fullName\n        //    self.human.callEvent('onChanging', event)\n    }\n\n    getSymmetrySide(): string|undefined {\n        throw Error('Not implemented')\n    }\n\n    getSymmetricOpposite(): string|undefined {\n        throw Error('Not implemented')\n    }\n\n    getSimilar(): any {\n        throw Error('Not implemented')\n    }\n\n    isMacro() {\n        return this.macroVariable !== undefined\n    }\n\n    getModel() {\n        if (this.model === undefined) {\n            this.model = new NumberModel(this.getDefaultValue(), { min: this.getMin(), max: this.getMax(), step: 0.05 })\n        }\n        return this.model\n    }\n}\n\n\n","import { Modifier } from './Modifier'\nimport { getTargetWeights } from \"./getTargetWeights\"\n// import { Target } from '../target/Target'\nimport { TargetRef } from './TargetRef'\n\n// 2 targets from the TargetFactory, value in [0, 1] or [-1, 1]\nexport class ManagedTargetModifier extends Modifier {\n    left?: string\n    right?: string\n\n    lTargets?: TargetRef[]\n    cTargets?: TargetRef[]\n    rTargets?: TargetRef[]\n\n    constructor(groupName: string, name: string) {\n        super(groupName, name)\n    }\n\n    override clampValue(value: number): number {\n        value = Math.min(value)\n        if (this.left !== undefined)\n            value = Math.max(-1.0, value)\n\n        else\n            value = Math.max(0.0, value)\n        return value\n    }\n\n    override setValue(value: number, { skipDependencies = false } = {}) {\n        // console.log(`ManagedTargetModifier.setValue(${value})`)\n        value = this.clampValue(value)\n        const factors = this.getFactors(value)\n        // console.log(factors)\n        const targetWeights = getTargetWeights(this.targets, factors)\n        // console.log(targetWeights)\n  \n        for(const weight of targetWeights) {\n            // console.log(`ManagedTargetModifier.setValue(${value}) -> human.setDetail(${weight[0]}, ${weight[1]})`)\n            this.human!.setDetail(weight[0], weight[1])\n        }\n\n        if (skipDependencies)\n            return\n\n        // Update dependent modifiers\n        this.propagateUpdate(false)\n    }\n\n    // ADD A UNIT TEST FOR THIS ONE\n    override getValue(): number {\n        // console.log(`ManagedTargetModifier.getValue() '${this.fullName}'`)\n        if (this.rTargets) {\n            let sum = 0\n            for(let target of this.rTargets)\n                sum += this.human!.getDetail(target.targetPath) // FIXME: this is just a guess\n            return sum\n        }\n        let sum = 0\n        for(let target of this.lTargets!)\n            sum += this.human!.getDetail(target.targetPath) // FIXME: this is just a guess\n        return sum\n    }\n\n    // return map of all Human's *Val attributes\n    override getFactors(value: number): Map<string, number> {\n        const result = new Map<string, number>()\n        const desc = Object.getOwnPropertyDescriptors(this.human)\n        for(const name in desc) {\n            if (!name.endsWith(\"Val\"))\n                continue\n            result.set(\n                name.substring(0, name.length - 3), // name without the 'Val' suffix\n                desc[name].value.value)             // NumberModel.value\n        }\n        return result\n    }\n}\n","export class TargetRef {\n    targetPath: string // tPath\n    factorDependencies: string[] // fFactors\n    constructor(targetPath: string, factorDependencies: string[]) {\n        this.targetPath = targetPath\n        this.factorDependencies = factorDependencies\n    }\n}\n","import { TargetFactory } from '../target/TargetFactory'\nimport { TargetRef } from './TargetRef'\n\n// static method of ManagedTargetModifiers\n// findTargets('buttocks-buttocks-volume-decr') -> [('data/targets/buttocks/buttocks-volume-decr.target', ['buttocks-buttocks-volume-decr'])]\n// findTargets('buttocks-buttocks-volume-incr') -> [('data/targets/buttocks/buttocks-volume-incr.target', ['buttocks-buttocks-volume-incr'])]\nexport function findTargets(path: string | undefined): TargetRef[] {\n    if (path === undefined)\n        return []\n    const targetsList = TargetFactory.getInstance().getTargetsByGroup(path)\n    if (targetsList === undefined)\n        throw Error(`findTargets(): failed to get targetsList for ${path}`)\n    // console.log(targetsList)\n    const result = []\n    for (const component of targetsList) {\n        const targetgroup = component.tuple()\n        const factordependencies = component.getVariables()\n        factordependencies.push(targetgroup)\n        result.push(\n            new TargetRef(component.path!, factordependencies)\n        )\n    }\n    return result\n}","import { ManagedTargetModifier } from './ManagedTargetModifier'\nimport { findTargets } from './findTargets'\nimport { findMacroDependencies } from './findMacroDependencies'\nimport { validCategories, valueToCategory } from '../target/Component'\n\nexport class MacroModifier extends ManagedTargetModifier {\n    constructor(groupName: string, name: string) {\n        // e.g. macrodetails/Gender\n        super(groupName, name)\n        this.defaultValue = 0.5\n        this.targets = findTargets(groupName)\n        this.macroDependencies = findMacroDependencies(groupName)\n        this.macroVariable = this.getMacroVariable()\n        if (this.macroVariable) {\n            // MacroModifier is not dependent on variable it controls itself\n            this.macroDependencies.delete(this.macroVariable)\n        }\n    }\n\n    protected getMacroVariable(): string | undefined {\n        if (this.name) {\n            let v = this.name.toLowerCase()\n            if (validCategories.indexOf(v) !== -1)\n                return v\n            if (valueToCategory.has(v))\n                return valueToCategory.get(v)\n        }\n        return undefined\n    }\n\n    override getValue(): number {\n        return this.getModel().value\n    }\n\n    override setValue(value: number, { skipDependencies = false } = {}): void {\n        // console.log(`MacroModifier(${this.fullName}).setValue(${value})`)\n        value = this.clampValue(value)\n        this.getModel().value = value\n        super.setValue(value, { skipDependencies }) \n    }\n\n    override clampValue(value: number): number {\n        return Math.max(0.0, Math.min(1.0, value))\n    }\n\n    override getFactors(value: number): Map<string, number> {\n        const factors = super.getFactors(value)\n        factors.set(this.groupName, 1.0)\n        return factors\n    }\n\n    override buildLists(): void {\n    }\n\n    override getModel() {\n        if (this.model !== undefined) {\n            return this.model\n        }\n        if (this.human === undefined) {\n            throw Error(`MacroModifier.getModel(): can only be called after human has been set`)\n        }\n        switch (this.name) {\n            case \"Gender\":\n                this.model = this.human.gender\n                break\n            case \"Age\":\n                this.model = this.human.age\n                break\n            case \"Muscle\":\n                this.model = this.human.muscle\n                break\n            case \"Weight\":\n                this.model = this.human.weight\n                break\n            case \"Height\":\n                this.model = this.human.height\n                break\n            case \"BodyProportions\":\n                this.model = this.human.bodyProportions\n                break\n            case \"BreastSize\":\n                this.model = this.human.breastSize\n                break\n            case \"BreastFirmness\":\n                this.model = this.human.breastFirmness\n                break\n            case \"African\":\n                this.model = this.human.africanVal\n                break\n            case \"Asian\":\n                this.model = this.human.asianVal\n                break\n            case \"Caucasian\":\n                this.model = this.human.caucasianVal\n                break\n            default:\n                throw Error(`MacroModifier.getModel(): not implemented for name '${this.name}'`)\n        }\n        return this.model\n    }\n}\n","import { TargetFactory } from '../target/TargetFactory'\n\nexport function findMacroDependencies(path: string | undefined) {\n    const result = new Set<string>()\n    if (path === undefined) {\n        return result\n    }\n\n    // most calls will just yield and empty set, e.g.\n    //   findMacroDependencies(head-head-age-decr) -> nothin'\n    // only the following will deliver results:\n    //   findMacroDependencies(breast) -> 'age' 'gender' 'breastfirmness' 'weight' 'breastsize' 'muscle'\n    //   findMacroDependencies(macrodetails) -> 'age' 'race' 'gender'\n    //   findMacroDependencies(macrodetails-universal) -> 'muscle' 'age' 'gender' 'weight'\n    //   findMacroDependencies(macrodetails-height) -> 'age' 'gender' 'weight' 'height' 'muscle' \n    //   findMacroDependencies(macrodetails-proportions) -> 'age' 'gender' 'weight' 'bodyproportions' 'muscle'    \n    TargetFactory.getInstance().groups.get(path)?.forEach( target => {\n        target.data.forEach( (value, key) => {\n            if (value !== undefined) {\n                result.add(key)\n            }\n        })\n    })\n    return result\n}","import { MacroModifier } from './MacroModifier'\n\nexport class EthnicModifier extends MacroModifier { \n    constructor(groupName: string, name: string) {\n        super(groupName, name)\n        this.defaultValue = 1/3\n    }\n}\n","import { ManagedTargetModifier } from './ManagedTargetModifier'\nimport { Target } from '../target/Target'\nimport { Component } from '../target/Component'\nimport { findTargets } from './findTargets'\n\n// 1 to 3 targets from the TargetFactory, value in [0, 1] or [-1, 1]\nexport class UniversalModifier extends ManagedTargetModifier {\n    targetName: string\n    center?: string\n\n    constructor(groupName: string, targetName: string, leftExt?: string, rightExt?: string, centerExt?: string) {\n        // console.log(`UniversalModifier('${groupName}', '${targetName}', '${leftExt}', '${rightExt}', '${centerExt}')`)\n        let fullTargetName = `${groupName}-${targetName}`\n        let name: string\n        let left: string | undefined\n        let center: string | undefined\n        let right: string\n        if (leftExt !== undefined && rightExt !== undefined) {\n            left = `${fullTargetName}-${leftExt}`\n            right = `${fullTargetName}-${rightExt}`\n\n            if (centerExt !== undefined) {\n                center = `${fullTargetName}-${centerExt}`\n                fullTargetName = `${fullTargetName}-${leftExt}|${centerExt}|${rightExt}`\n                name = `${targetName}-${leftExt}|${centerExt}|${rightExt}`\n            } else {\n                center = undefined\n                fullTargetName = `${fullTargetName}-${leftExt}|${rightExt}`\n                name = `${targetName}-${leftExt}|${rightExt}`\n            }\n        } else {\n            left = undefined\n            right = fullTargetName\n            center = undefined\n            name = targetName\n        }\n        super(groupName, name)\n        this.targetName = fullTargetName\n        this.left = left\n        this.center = center\n        this.right = right\n\n        // this load's the target's from the target factory\n        this.lTargets = findTargets(this.left)\n        this.rTargets = findTargets(this.right)\n        this.cTargets = findTargets(this.center)\n\n        // self.macroDependencies = self.findMacroDependencies(self.left)\n        // self.macroDependencies.update(self.findMacroDependencies(self.right))\n        // self.macroDependencies.update(self.findMacroDependencies(self.center))\n        // self.macroDependencies = list(self.macroDependencies)\n\n        // self.targets = self.l_targets + self.r_targets + self.c_targets\n        for(const targets of [this.lTargets, this.rTargets, this.cTargets])\n            if (targets !== undefined)\n                for(const target of targets)\n                    this.targets.push(target)\n    }\n\n    override getMin(): number {\n        if (this.left !== undefined)\n            return -1.0\n        else\n            return 0.0\n    }\n\n    override getFactors(value: number): Map<string, number> {\n        const factors = super.getFactors(value)\n\n        if (this.left !== undefined)\n            factors.set(this.left, -Math.min(value, 0))\n        if (this.center !== undefined)\n            factors.set(this.center, 1.0 - Math.abs(value))\n        factors.set(this.right!, Math.max(0, value))\n\n        return factors\n    }\n\n    // override setValue(value: number) {\n    //     value = this.clampValue(value)\n\n    //     console.log(`UniversalModifier.setValue(${value}) // modifier ${this.fullName}`)\n\n    //     // const factors = this.getFactors(value)\n    //     // const tWeights = this.getTargetWeights(this.targets, factors)\n        \n\n    //     // value = self.clampValue(value)\n    //     // factors = self.getFactors(value)\n\n    //     // tWeights = getTargetWeights(self.targets, factors)\n    //     // for tpath, tWeight in tWeights.items():\n    //     //     self.human.setDetail(tpath, tWeight)\n\n    //     // if skipDependencies:\n    //     //     return\n\n    //     // # Update dependent modifiers\n    //     // self.propagateUpdate(realtime = False)\n    // }\n\n    // override getValue(): number {\n    //     throw Error('Not implemented')\n    //     // right = sum([self.human.getDetail(target[0]) for target in self.r_targets])\n    //     // if right:\n    //     //     return right\n    //     // else:\n    //     //     return -sum([self.human.getDetail(target[0]) for target in self.l_targets])\n    // }\n}\n","import { EthnicModifier } from './EthnicModifier'\nimport { MacroModifier } from './MacroModifier'\nimport { UniversalModifier } from './UniversalModifier'\nimport { Modifier } from './Modifier'\nimport { Human } from './Human'\nimport { FileSystemAdapter } from '../filesystem/FileSystemAdapter'\n\n// {\n//     \"group\": \"<groupname>\",\n//     \"modifiers\": [\n//         { \"target\": ... } |\n//         { \"target\": ..., \"min\": ..., \"max\": ... } |\n//         { \"macrovar\": ...} |\n//         { \"macrovar\": ..., \"modifierType\": ...}, ...\n//     ]\n// }, ...\n\n// from apps/humanmodifier.py\nexport function loadModifiers(human: Human, filename: string): Modifier[] {\n    return parseModifiers(\n        human,\n        FileSystemAdapter.getInstance().readFile(filename),\n        filename)\n}\n\nexport function parseModifiers(human: Human, data: string, filename = 'memory'): Modifier[] {\n    const classesMapping = new Map<string, any>([\n        // ['Modifier', Modifier],\n        // ['SimpleModifier', SimpleModifier],\n        // ['ManagedTargetModifier', ManagedTargetModifier],\n        // ['UniversalModifier', UniversalModifier],\n        // ['MacroModifier', MacroModifier],\n        ['EthnicModifier', EthnicModifier]\n    ])\n    const json = JSON.parse(data)\n    const modifiers = new Array<Modifier>()\n    const lookup = new Map<string, Modifier>()\n\n    for (const modifierGroup of json) {\n        const groupName = modifierGroup.group\n\n        for (const modifierDef of modifierGroup.modifiers) {\n            let modifierClass: new (...args: any[]) => Modifier\n            let modifier: Modifier\n            if ('modifierType' in modifierDef) {\n                modifierClass = classesMapping.get(modifierDef.modifierType)\n                if (modifierClass === undefined) {\n                    throw Error(`failed to instantiate modifer ${modifierDef.modifierType}`)\n                }\n            } else if ('macrovar' in modifierDef) {\n                modifierClass = MacroModifier\n            } else {\n                modifierClass = UniversalModifier\n            }\n\n            if ('macrovar' in modifierDef) {\n                modifier = new modifierClass(groupName, modifierDef.macrovar)\n                if (!modifier.isMacro()) {\n                    console.log(`Expected modifier ${modifierClass.name} to be a macro modifier, but identifies as a regular one. Please check variable category definitions in class Component.`)\n                }\n            } else {\n                //             modifier = modifierClass(groupName, mDef['target'], mDef.get('min',None), mDef.get('max',None), mDef.get('mid',None))\n                if (modifierClass !== UniversalModifier)\n                    throw Error()\n                modifier = new (modifierClass as typeof UniversalModifier)(groupName, modifierDef.target, modifierDef.min, modifierDef.max, modifierDef.mid)\n            }\n\n            if ('defaultValue' in modifierDef) {\n                modifier.defaultValue = modifierDef.defaultValue\n            }\n\n            if (modifier.fullName === undefined) {\n                console.log(`ERROR: modifier has no fullName`)\n                console.log(modifier)\n            }\n            modifiers.push(modifier)\n            lookup.set(modifier.fullName, modifier)\n            // console.log(modifier.fullName)\n        }\n    }\n\n\n    for (const modifier of modifiers) {\n        modifier.setHuman(human)\n    }\n\n    console.log(`Loaded ${modifiers.length} modifiers from file ${filename}`)\n\n    // # Attempt to load modifier descriptions\n    // _tmp = os.path.splitext(filename)\n    // descFile = _tmp[0]+'_desc'+_tmp[1]\n    // hasDesc = OrderedDict([(key,False) for key in lookup.keys()])\n    // if os.path.isfile(descFile):\n    //     data = json.load(io.open(descFile, 'r', encoding='utf-8'), object_pairs_hook=OrderedDict)\n    //     dCount = 0\n    //     for mName, mDesc in data.items():\n    //         try:\n    //             mod = lookup[mName]\n    //             mod.description = mDesc\n    //             dCount += 1\n    //             hasDesc[mName] = True\n    //         except:\n    //             log.warning(\"Loaded description for %s but modifier does not exist!\", mName)\n    //     log.message(\"Loaded %s modifier descriptions from file %s\", dCount, descFile)\n    // for mName, mHasDesc in hasDesc.items():\n    //     if not mHasDesc:\n    //         log.warning(\"No description defined for modifier %s!\", mName)\n    return modifiers\n}\n","import { FileSystemAdapter } from '../filesystem/FileSystemAdapter'\nimport { Human } from './Human'\nimport { NumberModel } from 'toad.js/model/NumberModel'\nimport { TreeNode } from 'toad.js/table/model/TreeNode'\n\nexport interface Category {\n    sortOrder: number\n    label?: string\n    cameraView: string\n    showMacroStats?: boolean\n    modifiers: any\n}\n\nexport interface ModifierSpec {\n    mod: string\n    label: string\n    cam?: string\n    enabledCondition?: string\n}\n\nexport class SliderNode implements TreeNode {\n    static count = 0\n    label: string\n    category?: Category\n    modifierSpec?: ModifierSpec\n    model?: NumberModel\n    next?: SliderNode\n    down?: SliderNode\n    constructor(human?: Human, label?: string, modifierSpec?: ModifierSpec) {\n        SliderNode.count++\n        this.label = label || ''\n        this.modifierSpec = modifierSpec\n\n        if (modifierSpec) {\n            // modifier.mod can have values like\n            //   buttocks/buttocks-buttocks-volume-decr|incr-decr|incr\n            //   stomach/stomach-pregnant-decr|incr\n            // human.getModifier(modifier.mod) locates the Modifier for that name\n            // for this to work, modifiers need to have been added with human.addModifier(...)\n\n            // in apps/gui/guimodifier.py loadModifierTaskViews\n\n            // class Modifier has getMin() & getMax() to get the range\n            const modifier = human!.getModifier(modifierSpec.mod)\n            if (modifier !== undefined) {\n                this.model = modifier.getModel()\n                this.model.modified.add(() => {\n                    // modifier.setValue(this.model!.value)\n                    modifier.updateValue(this.model!.value)\n                    // self.modifier.updateValue(value, G.app.getSetting('realtimeNormalUpdates'))\n                    human!.updateProxyMesh(true)\n                })\n                // } else {\n                //     console.log(`SliderNode(): no modifier '${modifierSpec.mod}' found for slider`)\n            }\n        }\n    }\n}\n\nfunction capitalize(s: string): string {\n    return s[0].toUpperCase() + s.slice(1)\n}\n\nexport function labelFromModifier(groupName: string, name: string): string {\n    const tlabel = name.split('-')\n\n    if (tlabel[tlabel.length - 1].indexOf('|') !== -1)\n        tlabel.pop()\n\n    if (tlabel.length > 1 && tlabel[0] === groupName)\n        tlabel.shift()\n\n    tlabel[0] = capitalize(tlabel[0])\n\n    return tlabel.join(' ')\n}\n\n/*\n * loadSliders() loads data/modifiers/modeling_sliders.json, which contains the ui tree\n * listing containing the \"Main\", \"Gender\", \"Face\", \"Torso\", \"Arms and legs\" tabs, containing\n * a slider for each modifier.\n *\n * (the original is located in apps/gui/guimodifier.py)\n */\nexport function loadSliders(human: Human, filename: string): SliderNode {\n    const root = parseSliders(\n        human,\n        FileSystemAdapter.getInstance().readFile(filename),\n        filename)\n    console.log(`Loaded ${SliderNode.count} slider nodes from file ${filename}`)\n    return root\n}\n\nexport function parseSliders(human: Human, data: string, filename = 'memory'): SliderNode {\n    const json = JSON.parse(data)\n    let rootNode: SliderNode | undefined\n    let lastTabNode: SliderNode | undefined\n    for (const [tabKey, tabValue] of Object.entries(json).sort(\n        (a: [string, any], b: [string, any]): number => a[1].sortOrder - b[1].sortOrder)\n    ) {\n        const tab = tabValue as Category\n\n        let label = tabKey\n        if (tab.label !== undefined)\n            label = tab.label\n\n        const tabNode = new SliderNode(human, label)\n        tabNode.category = tab\n        if (lastTabNode)\n            lastTabNode.next = tabNode\n        else\n            rootNode = tabNode\n        lastTabNode = tabNode\n\n        let lastCategoryNode: SliderNode | undefined\n        for (const [categoryKey, categoryValue] of Object.entries(tab.modifiers)) {\n            const categoryNode = new SliderNode(human, capitalize(categoryKey))\n            if (lastCategoryNode)\n                lastCategoryNode.next = categoryNode\n            else\n                lastTabNode.down = categoryNode\n            lastCategoryNode = categoryNode\n            let lastSliderNode: SliderNode | undefined\n            for (const modifier of categoryValue as ModifierSpec[]) {\n                let label = modifier.label\n                if (label === undefined) {\n                    const name = modifier.mod.split('/')\n                    label = labelFromModifier(name[0], name[1])\n                }\n                const sliderNode = new SliderNode(human, label, modifier)\n                if (lastSliderNode)\n                    lastSliderNode.next = sliderNode\n                else\n                    lastCategoryNode.down = sliderNode\n                lastSliderNode = sliderNode\n            }\n        }\n    }\n    if (rootNode === undefined)\n        throw Error('No sliders found.')\n    return rootNode\n}\n","export class Group {\n    name: string\n    startIndex: number\n    length: number\n    constructor(name: string, start: number) {\n        this.name = name\n        this.startIndex = start\n        this.length = 0\n    }\n}\n\nexport abstract class Mesh {\n    abstract vertex: number[]\n    abstract indices: number[]\n    abstract groups: Group[]\n    abstract getFaceGroup(name: string): Group | undefined\n}\n\n// core/module3d.py\n// line 940: createFaceGroup\n// line 1084: getFaceGroup\n\n// line 47\nexport interface FaceGroup {\n    // object\n    name: string\n    idx: number\n    // color\n    // colorID\n}","import { StringToLine } from '../lib/StringToLine'\nimport { FileSystemAdapter } from '../filesystem/FileSystemAdapter'\nimport { Mesh, Group, FaceGroup } from './Mesh'\n\n// makehuman/shared/wavefront.py\nexport class WavefrontObj implements Mesh {\n    name = \"\"\n\n    // TODO: have a look at what WebGL needs\n\n    vertex: number[]  // x,y,z (coord in makehuman)\n    indices: number[] // quads of vertex indices (fvert in makehuman?)\n\n    texture: number[] // u,v (texco in makehuman)\n    \n    normal: number[]  // x,y,z\n    groups: Group[]   // name, startIndex, length\n    material: Group[] // name, startIndex, length\n\n    faceGroups = new Map<string, FaceGroup>()\n\n    constructor() {\n        this.vertex = []\n        this.texture = []\n        this.normal = []\n        this.indices = []\n        this.groups = []\n        this.material = []\n    }\n\n    toString(): string {\n        return `WavefrontObj {name: '${this.name}', vertices: ${this.vertex.length / 3}, quads: ${this.indices.length / 6}, groups: ${this.groups.length}} `\n    }\n\n    load(filename: string, data?: string) {\n        this.name = filename\n        if (data === undefined) {\n            data = FileSystemAdapter.getInstance().readFile(filename)\n        }\n        const vertex: number[] = []\n        const texture: number[] = []\n        const normal: number[] = []\n        const indices: number[] = []\n        const uvIndices0: number[] = []\n        const uvIndices: number[] = []\n        const reader = new StringToLine(data)\n\n        let lineNumber = 0\n        for (let line of reader) {\n            ++lineNumber\n            // console.log(line)\n            line = line.trim()\n            if (line.length === 0)\n                continue\n            if (line[0] === '#') {\n                // TODO: might want to parse # basemesh <name>\n                continue\n            }\n            const tokens = line.split(/\\s+/)\n            switch (tokens[0]) {\n                // vertex data\n                case 'v': // vertex X Y Z [W]\n                    if (tokens.length < 4)\n                        throw Error(`Too few arguments in ${line}`)\n                    if (tokens.length > 5)\n                        throw Error(`Too many arguments in ${line}`)\n                    vertex.push(parseFloat(tokens[1]))\n                    vertex.push(parseFloat(tokens[2]))\n                    vertex.push(parseFloat(tokens[3]))\n                    if (tokens.length === 5)\n                        throw Error('Can\\'t handle vertex with weight yet...')\n                    //     vertex.push(parseFloat(tokens[4]))\n                    // else\n                    //     vertex.push(1)\n                    break\n                case 'vt': // vectex texture U V\n                    if (tokens.length < 3)\n                        throw Error(`Too few arguments in ${line}`)\n                    if (tokens.length > 4)\n                        throw Error(`Too many arguments in ${line}`)\n                    texture.push(parseFloat(tokens[1]))\n                    texture.push(parseFloat(tokens[2]))\n                    break\n                case 'vn': // vertex normal I J K\n                    if (tokens.length < 4)\n                        throw Error(`Too few arguments in ${line}`)\n                    if (tokens.length > 5)\n                        throw Error(`Too many arguments in ${line}`)\n                    normal.push(parseFloat(tokens[1]))\n                    normal.push(parseFloat(tokens[2]))\n                    normal.push(parseFloat(tokens[3]))\n                    if (tokens.length === 5)\n                        throw Error('Can\\'t handle vertex with weight yet...')\n                    //     vertex.push(parseFloat(tokens[4]))\n                    // else\n                    //     vertex.push(1)\n                    break\n                case 'vp': break // vertext parameter space U V W\n\n                // free-form curve/surface attributes\n                case 'deg': break\n                case 'bmat': break\n                case 'step': break\n                case 'cstype': break\n\n                // elements\n                case 'p': break // point\n                case 'l': break // line\n                case 'f': // face( vertex[/[texture][/normal]])+\n                    if (tokens.length !== 5)\n                        throw Error(`can't handle faces which are not quads yet (line ${lineNumber}: '${line}'}`)\n                    // CONVERT QUAD INTO TRIANGLE FOR WEBGL\n                    // 0   1\n                    //\n                    // 3   2\n                    for (let i = 1; i < tokens.length; ++i) {\n                        const split = tokens[i].split('/')\n                        indices.push(parseInt(split[0], 10) - 1)\n                        uvIndices0.push(parseInt(split[0], 10) - 1)\n                        uvIndices.push(parseInt(split[1], 10) - 1)\n                    }\n                    const idx = indices.length - 4\n                    indices.push(indices[idx + 0])\n                    indices.push(indices[idx + 2])\n                    break\n                case 'curv': break // curve\n                case 'curv2': break // 2d curve\n                case 'surf': break // surface\n\n                // free-form curve/surface body statements\n                case 'parm': break\n                case 'trim': break\n                case 'hole': break\n                case 'scrv': break\n                case 'sp': break\n                case 'end': break\n\n                // connectivity between free-form surfaces\n                case 'con': break\n\n                // grouping\n                case 'g': // <groupname>+ the following elements belong to that group    \n                    this.groups.push(new Group(tokens[1], indices.length))\n                    break\n                case 's': break\n                case 'mg': break\n                case 'o': // <object name>\n                    this.name = tokens[1]\n                    break\n\n                // display/render attributes\n                case 'bevel': break\n                case 'c_interp': break\n                case 'd_interp': break\n                case 'lod': break\n                case 'usemtl': // <materialname>\n                    this.material.push(new Group(tokens[1], indices.length))\n                    break\n                case 'mtllib': break\n                case 'shadow_obj': break\n                case 'trace_obj': break\n                case 'ctech': break\n                case 'stech': break\n\n                default:\n                    throw Error(`Unknown keyword '${tokens[0]}' in Wavefront OBJ file in line '${line}' of length ${line.length}'.`)\n            }\n        }\n        this.vertex = vertex\n        // this.texture = texture\n        this.normal = normal\n        this.indices = indices\n\n        this.texture = new Array(uvIndices.length * 2)\n        for(let i=0; i<uvIndices.length; ++i) {\n            this.texture[uvIndices0[i]*2] =  texture[uvIndices[i]*2]\n            this.texture[uvIndices0[i]*2+1] =  texture[uvIndices[i]*2+1]\n        }\n\n        // set group's lengths\n        if (this.groups.length > 0) {\n            for (let i = 0; i < this.groups.length - 1; ++i) {\n                this.groups[i].length = this.groups[i + 1].startIndex - this.groups[i].startIndex\n            }\n            this.groups[this.groups.length - 1].length = indices.length - this.groups[this.groups.length - 1].startIndex\n        }\n\n        if (this.material.length > 0) {\n            for (let i = 0; i < this.material.length - 1; ++i) {\n                this.material[i].length = this.material[i + 1].startIndex - this.material[i].startIndex\n            }\n            this.material[this.material.length - 1].length = indices.length - this.material[this.material.length - 1].startIndex\n        }\n\n        this.logStatistics(filename)\n    }\n\n    getFaceGroup(name: string): Group | undefined {\n        // the facegroups are not groups\n        // and they might be either stored in one of these:\n        //   makehuman/data/rigs/default_weights.mhw\n        //   makehuman/data/poses/benchmark.bvh\n        //   makehuman/data/poses/tpose.bvh\n        //   makehuman/data/poseunits/face-poseunits.bvh\n        // or maybe the code i have here is correct but the weight must be read as part of the rig?\n\n        // return undefined\n        const x = this.groups\n            .filter(g => g.name === name)\n        if (x.length !== 1) {\n            return undefined\n        }\n        return x[0]\n    }\n\n    logStatistics(filename: string) {\n        let groupNames = \"\"\n        let joints = 0\n        let helpers = 0\n        this.groups.forEach(g => {\n            if (g.name.startsWith(\"joint-\")) {\n                ++joints\n            } else\n                if (g.name.startsWith(\"helper-\")) {\n                    ++helpers\n                } else {\n                    if (groupNames.length === 0) {\n                        groupNames = g.name\n                    } else {\n                        groupNames = `${groupNames}, ${g.name}`\n                    }\n                }\n        })\n        if (groupNames.length !== 0) {\n            groupNames = ` and ${groupNames}`\n        }\n        console.log(`Loaded ${this.groups.length} groups (${joints} joints, ${helpers} helpers${groupNames}), ${this.material.length} materials, ${this.vertex.length / 3} vertices, ${this.texture.length/2} uvs, ${this.normal.length/3} normals. ${this.indices.length / 3} triangles from file '${filename}'`)\n    }\n}\n","import { RenderMode } from 'render/RenderMode'\nimport { Proxy } from 'proxy/Proxy'\nimport { Human } from '../modifier/Human'\nimport { getTarget } from '../target/TargetFactory'\nimport { Group } from './Mesh'\nimport { Skeleton } from '../skeleton/Skeleton'\nimport { WavefrontObj } from './WavefrontObj'\n\nlet epsilon = 0.000000001\n\nexport function isZero(a: number): boolean {\n    return Math.abs(a) <= epsilon\n}\n\n// FIXME: the name doesn't tell enough, alternatives(?): HowMuchToUpdate, WhatsChanged, ChangeType, ModelChangeExtend...\nexport enum Update {\n    NONE,\n    MORPH,\n    POSE\n}\n\nexport class HumanMesh {\n    human: Human\n    baseMesh: WavefrontObj\n    vertexMorphed: number[]\n    vertexRigged: number[]\n    skeleton!: Skeleton\n\n    proxies = new Map<string, Proxy>\n\n    updateRequired = Update.NONE\n\n    constructor(human: Human) {\n        this.human = human\n\n        const obj = new WavefrontObj() // TODO: provide as argument\n        obj.load('data/3dobjs/base.obj')\n\n        this.baseMesh = obj\n        this.vertexRigged = this.vertexMorphed = obj.vertex\n    }\n\n    getRestposeCoordinates() {\n        return this.vertexMorphed\n    }\n\n    update(): void {\n        if (this.updateRequired === Update.NONE) {\n            return\n        }\n\n        if (this.updateRequired === Update.MORPH) {\n            // morph\n            this.vertexMorphed = [...this.baseMesh.vertex]\n            this.human.targetsDetailStack.forEach((value, targetName) => {\n                if (isNaN(value)) {\n                    // console.log(`HumanMesh.update(): ignoring target ${targetName} with value NaN`)\n                    return\n                }\n\n                if (isZero(value) || isNaN(value))\n                    return\n                // console.log(`HumanMesh.update(): apply target ${targetName} with value ${value}`)\n                const target = getTarget(targetName)\n                target.apply(this.vertexMorphed, value)\n            })\n            this.skeleton.updateJoints()\n            this.skeleton.build()\n            this.skeleton.update()\n        }\n\n        // skin/pose\n        this.vertexRigged = this.skeleton.skinMesh(this.vertexMorphed, this.skeleton.vertexWeights!._data)\n\n        this.updateRequired = Update.NONE\n    }\n}\n","export enum RenderMode {\n    DEBUG,\n    POLYGON,\n    WIREFRAME\n}\n","export enum BaseMeshGroup {\n    SKIN = 0,\n    PANTS_HELPER = 1,\n    // 2 to 124 are the joints\n    SKIRT = 126,\n    HAIR = 127,\n    EYEBALL0 = 128,\n    EYEBALL1 = 129,\n    PENIS = 130,\n    TEETH_TOP = 131,\n    TEETH_BOTTOM = 132,\n    TOUNGE = 169,\n    CUBE = 171\n}\n","import { HumanMesh } from './HumanMesh'\nimport { BaseMeshGroup } from './BaseMeshGroup'\nimport { Bone } from '../skeleton/Bone'\nimport { calculateNormals } from '../lib/calculateNormals'\nimport { OrderedMap } from '../lib/OrderedMap'\nimport { vec3, vec4, mat4 } from 'gl-matrix'\nimport { zipForEach } from 'lib/zipForEach'\nimport { Group } from './Mesh'\nimport { VertexBoneWeights } from 'skeleton/VertexBoneWeights'\n\n// Export the human as COLLAborative Design Activity (COLLADA) suitable for import in Blender\n// https://en.wikipedia.org/wiki/COLLADA\n\nexport interface Material {\n    vertex: number[]\n    indices: number[]\n    vertexWeights: VertexBoneWeights\n    start: number\n    length: number\n    name: string\n    r: number\n    g: number\n    b: number\n}\n\nexport function exportCollada(scene: HumanMesh) {\n    let s = scene\n    // s = testCube\n    const geometry = new Geometry()\n\n    const proxy = scene.proxies.get(\"Teeth\")!\n\n\n    const materials: Material[] = [\n        {\n            vertex: scene.vertexMorphed,\n            indices: scene.baseMesh.indices,\n            vertexWeights: scene.skeleton.vertexWeights!,\n            start: scene.baseMesh.groups[BaseMeshGroup.SKIN].startIndex,\n            length: scene.baseMesh.groups[BaseMeshGroup.SKIN].length,\n            name: \"skin\", r: 1, g: 0.5, b: 0.5\n        }, {\n            vertex: scene.vertexMorphed,\n            indices: scene.baseMesh.indices,\n            vertexWeights: scene.skeleton.vertexWeights!,\n            start: scene.baseMesh.groups[BaseMeshGroup.EYEBALL0].startIndex,\n            length: scene.baseMesh.groups[BaseMeshGroup.EYEBALL0].length,\n            name: \"eyeL\", r: 0.0, g: 1.0, b: 0.5\n        }, {\n            vertex: scene.vertexMorphed,\n            indices: scene.baseMesh.indices,\n            vertexWeights: scene.skeleton.vertexWeights!,\n            start: scene.baseMesh.groups[BaseMeshGroup.EYEBALL1].startIndex,\n            length: scene.baseMesh.groups[BaseMeshGroup.EYEBALL1].length,\n            name: \"eyeR\", r: 1.0, g: 0.0, b: 0.0\n        }, {\n            vertex: proxy.getCoords(scene.vertexMorphed),\n            indices: proxy.mesh.indices,\n            vertexWeights: proxy.getVertexWeights(scene.skeleton.vertexWeights!),\n            start: 0,\n            length: proxy.mesh.indices.length,\n            name: \"teeth\", r: 1.0, g: 1.0, b: 1.0\n        }, {\n            vertex: scene.vertexMorphed,\n            indices: scene.baseMesh.indices,\n            vertexWeights: scene.skeleton.vertexWeights!,\n            start: scene.baseMesh.groups[BaseMeshGroup.TOUNGE].startIndex,\n            length: scene.baseMesh.groups[BaseMeshGroup.TOUNGE].length,\n            name: \"tounge\", r: 1, g: 0.0, b: 0.0\n        }\n    ]\n\n    return colladaHead() +\n        colladaEffects(materials) +\n        colladaMaterials(materials) +\n        colladaGeometries(s, geometry, materials) + // mesh\n        colladaControllers(s, geometry, materials) + // weights\n        colladaVisualScenes(s, materials) + // skeleton\n        colladaScene() +\n        colladaTail()\n}\n\nconst sceneName = `Scene`\nconst objectName = `Human`\nconst meshName = `${objectName}-mesh`\nconst meshPositionsName = `${meshName}-positions`\nconst meshPositionsArrayName = `${meshPositionsName}-array`\nconst meshVerticesName = `${meshName}-vertices`\n\nconst armatureName = `Armature`\nconst armatureLongName = `${armatureName}_${objectName}`\nconst skinName = `${armatureLongName}-skin`\nconst skinJointsName = `${skinName}-joints`\nconst skinJointsArrayName = `${skinJointsName}-array`\nconst skinWeightsName = `${skinName}-weights`\nconst skinWeightsArrayName = `${skinWeightsName}-array`\nconst skinIbmName = `${skinName}-bind_poses`\nconst skinIbmArrayName = `${skinIbmName}-array`\n\n// TODO: try to export with meter=\"1\" and Z_UP so that blender doesn't scale and rotate\n//       the human. this will simplify the workflow in blender after the import\nfunction colladaHead() {\n    return `<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<COLLADA xmlns=\"http://www.collada.org/2005/11/COLLADASchema\" version=\"1.4.1\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">\n  <asset>\n    <contributor>\n      <author>makehuman.js user</author>\n      <authoring_tool>https://github.com/markandre13/makehuman.js</authoring_tool>\n    </contributor>\n    <created>${new Date().toISOString()}</created>\n    <modified>${new Date().toISOString()}</modified>\n    <unit name=\"meter\" meter=\"0.1\"/>\n    <up_axis>Y_UP</up_axis>\n  </asset>\n  <library_images/>\\n`\n}\n\nfunction colladaTail() { return `</COLLADA>` }\n\nfunction colladaEffects(materials: Material[]) {\n    let out = `  <library_effects>\\n`\n    materials.forEach(m => {\n        out += `    <effect id=\"${m.name}-effect\">\n      <profile_COMMON>\n        <technique sid=\"common\">\n          <lambert>\n            <emission>\n              <color sid=\"emission\">0 0 0 1</color>\n            </emission>\n            <diffuse>\n              <color sid=\"diffuse\">${m.r} ${m.g} ${m.b} 1</color>\n            </diffuse>\n            <reflectivity>\n              <float sid=\"specular\">0.0</float>\n            </reflectivity>\n          </lambert>\n        </technique>\n      </profile_COMMON>\n    </effect>\\n`\n    })\n    out += `  </library_effects>\\n`\n    return out\n}\n\nfunction colladaMaterials(materials: Material[]) {\n    let out = `  <library_materials>\\n`\n    materials.forEach(m => {\n        out += `    <material id=\"${m.name}-material\" name=\"${m.name}\">\n      <instance_effect url=\"#${m.name}-effect\"/>\n    </material>\\n`\n    })\n    out += `  </library_materials>\\n`\n    return out\n}\n\nfunction colladaGeometries(scene: HumanMesh, geometry: Geometry, materials: Material[]) {\n\n    for (let m of materials) {\n        prepareMesh(\n            m.vertex,\n            m.indices,\n            m.start,\n            m.length,\n            geometry)\n    }\n\n    // prepareGeometry(scene.vertexMorphed, scene.baseMesh.indices, materials, geometry)\n\n    let out = `  <library_geometries>\n    <geometry id=\"${meshName}\" name=\"${objectName}\">\n      <mesh>\n        <source id=\"${meshPositionsName}\">\n          <float_array id=\"${meshPositionsArrayName}\" count=\"${geometry.vertex.length}\">${geometry.vertex.join(\" \")}</float_array>\n          <technique_common>\n            <accessor source=\"#${meshPositionsArrayName}\" count=\"${geometry.vertex.length / 3}\" stride=\"3\">\n              <param name=\"X\" type=\"float\"/>\n              <param name=\"Y\" type=\"float\"/>\n              <param name=\"Z\" type=\"float\"/>\n            </accessor>\n          </technique_common>\n        </source>\n        <vertices id=\"${meshVerticesName}\">\n          <input semantic=\"POSITION\" source=\"#${meshPositionsName}\"/>\n        </vertices>\\n`\n    for (let m = 0; m < materials.length; ++m) {\n        out += `        <polylist material=\"${materials[m].name}-material\" count=\"${geometry.indices[m].length / 4}\">\n          <input semantic=\"VERTEX\" source=\"#${meshVerticesName}\" offset=\"0\"/>\n          <vcount>${\"4 \".repeat(geometry.indices[m].length / 4)}</vcount>\n          <p>${geometry.indices[m].join(\" \")}</p>\n        </polylist>\\n`\n    }\n    out += `      </mesh>\n    </geometry>\n  </library_geometries>\\n`\n    return out\n}\n\nfunction colladaControllers(scene: HumanMesh, geometry: Geometry, materials: Material[]) {\n\n    const allBoneNames = scene.skeleton.boneslist!.map(bone => bone.name)\n\n    let ibmAll = \"\"\n    scene.skeleton.boneslist!.forEach((bone) => {\n        ibmAll += ibm(bone) + \" \"\n    })\n    ibmAll = ibmAll.trimEnd()\n\n    const { boneWeightPairs, weightMap } = prepareControllerInit(geometry)\n    for (const m of materials) {\n        prepareControllerAddBoneWeights(\n            m.vertex,\n            m.vertexWeights,\n            scene.skeleton.bones,\n            geometry,\n            boneWeightPairs, weightMap\n        )\n\n    }\n\n    const weights = prepareControllerFlatWeightMap(weightMap)\n    const flatBoneWeightList = prepareControllerFlatBoneWeight(boneWeightPairs)\n\n    return `  <library_controllers>\n    <controller id=\"${skinName}\" name=\"${armatureName}\">\n      <skin source=\"#${meshName}\">\n        <bind_shape_matrix>${mat2txt(identity)}</bind_shape_matrix>\n        <source id=\"${skinJointsName}\">\n          <Name_array id=\"${skinJointsArrayName}\" count=\"3\">${allBoneNames.join(\" \").replace(/\\./g, \"_\")}</Name_array>\n          <technique_common>\n            <accessor source=\"#${skinJointsArrayName}\" count=\"${allBoneNames.length}\" stride=\"1\">\n              <param name=\"JOINT\" type=\"name\"/>\n            </accessor>\n          </technique_common>\n        </source>\n        <source id=\"${skinIbmName}\">\n          <float_array id=\"${skinIbmArrayName}\" count=\"${allBoneNames.length * 16}\">${ibmAll}</float_array>\n          <technique_common>\n            <accessor source=\"#${skinIbmArrayName}\" count=\"${allBoneNames.length}\" stride=\"16\">\n              <param name=\"TRANSFORM\" type=\"float4x4\"/>\n            </accessor>\n          </technique_common>\n        </source>\n        <source id=\"${skinWeightsName}\">\n          <float_array id=\"${skinWeightsArrayName}\" count=\"${weights.length}\">${weights.join(\" \")}</float_array>\n          <technique_common>\n            <accessor source=\"#${skinWeightsArrayName}\" count=\"${weights.length}\" stride=\"1\">\n              <param name=\"WEIGHT\" type=\"float\"/>\n            </accessor>\n          </technique_common>\n        </source>\n        <joints>\n          <input semantic=\"JOINT\" source=\"#${skinJointsName}\"/>\n          <input semantic=\"INV_BIND_MATRIX\" source=\"#${skinIbmName}\"/>\n        </joints>\n        <vertex_weights count=\"${boneWeightPairs.length}\">\n          <input semantic=\"JOINT\" source=\"#${skinJointsName}\" offset=\"0\"/>\n          <input semantic=\"WEIGHT\" source=\"#${skinWeightsName}\" offset=\"1\"/>\n          <vcount>${boneWeightPairs.map(e => e.length).join(\" \")}</vcount>\n          <v>${flatBoneWeightList.join(\" \")}</v>\n        </vertex_weights>\n      </skin>\n    </controller>\n  </library_controllers>\\n`\n}\n\nfunction colladaVisualScenes(scene: HumanMesh, materials: Material[]) {\n    let out = `  <library_visual_scenes>\n    <visual_scene id=\"${sceneName}\" name=\"${sceneName}\">\n      <node id=\"${armatureName}\" name=\"${armatureName}\" type=\"NODE\">\n        <matrix sid=\"transform\">${mat2txt(identity)}</matrix>\n${dumpBone(armatureName, scene.skeleton.roots[0])}\\n`\n    // what varies...\n    // node: id, name\n    // instance_controller: url\n    //   ouch: this means each controller as a complete list of bone names and IBMs...\n    //   (yeah, checked even with a collada export from blender...\n    //   WRONG! we can just have a separate polylist per material within <mesh> and that's it!\n    //   see ~/Documents/Blender/experiments/colored-2-bone-cube.dae\n    //   real treat will be to grab all the meshes, including proxy meshes, and merge them)\n    // instance_material: symbol, target\n    out += `        <node id=\"${objectName}\" name=\"${objectName}\" type=\"NODE\">\n          <matrix sid=\"transform\">${mat2txt(identity)}</matrix>\n          <instance_controller url=\"#${skinName}\">\n            <skeleton>#${armatureName}_${scene.skeleton.roots[0].name}</skeleton>\n            <bind_material>\n              <technique_common>\\n`\n    for (let m = 0; m < materials.length; ++m) {\n        out += `                <instance_material symbol=\"${materials[m].name}-material\" target=\"#${materials[m].name}-material\"/>\\n`\n    }\n\n    out += `              </technique_common>\n            </bind_material>\n          </instance_controller>\n        </node>\\n`\n    out += `      </node>\n    </visual_scene>\n  </library_visual_scenes>\\n`\n    return out\n}\n\nfunction colladaScene() {\n    return `  <scene>\n    <instance_visual_scene url=\"#${sceneName}\"/>\n  </scene>\\n`\n}\n\n// const epsilon = Number.EPSILON * 2.0\nconst epsilon = 0.000000001\n\nexport class Geometry {\n    vertex: number[] = []\n    indices: number[][] = []\n    weights: number[] = []\n    private indexMap = new Map<number[], Map<number, number>>()\n\n    getIndex(vertex: number[], index: number) {\n        return this.indexMap.get(vertex)?.get(index)\n    }\n\n    addPoint(vertex: number[], origIndex: number): number {\n        let indexMap = this.indexMap.get(vertex)\n        if (indexMap === undefined) {\n            indexMap = new Map<number, number>()\n            this.indexMap.set(vertex, indexMap)\n        }\n\n        let newIndex = indexMap.get(origIndex)\n        if (newIndex !== undefined) {\n            return newIndex\n        }\n\n        newIndex = this.vertex.length / 3\n        indexMap.set(origIndex, newIndex)\n\n        const ptr = origIndex * 3\n        const p = [vertex[ptr], vertex[ptr + 1], vertex[ptr + 2]]\n        this.vertex.push(...p)\n\n        return newIndex\n    }\n    addMesh() {\n        this.indices.push([])\n    }\n    addQuad(vertex: number[], indices: number[], startIndex: number) {\n        const currentMesh = this.indices[this.indices.length - 1]\n        currentMesh.push(this.addPoint(vertex, indices[startIndex]))\n        currentMesh.push(this.addPoint(vertex, indices[startIndex + 1]))\n        currentMesh.push(this.addPoint(vertex, indices[startIndex + 2]))\n        currentMesh.push(this.addPoint(vertex, indices[startIndex + 3]))\n    }\n    getQuad(mesh: number, quad: number) {\n        const p0 = this.indices[mesh][quad * 4] * 3\n        const p1 = this.indices[mesh][quad * 4 + 1] * 3\n        const p2 = this.indices[mesh][quad * 4 + 2] * 3\n        const p3 = this.indices[mesh][quad * 4 + 3] * 3\n\n        return [[\n            this.vertex[p0],\n            this.vertex[p0 + 1],\n            this.vertex[p0 + 2]\n        ],\n        [\n            this.vertex[p1],\n            this.vertex[p1 + 1],\n            this.vertex[p1 + 2]\n        ],\n        [\n            this.vertex[p2],\n            this.vertex[p2 + 1],\n            this.vertex[p2 + 2]\n        ],\n        [\n            this.vertex[p3],\n            this.vertex[p3 + 1],\n            this.vertex[p3 + 2]\n        ]]\n    }\n}\n\nexport function prepareGeometry(vertex: number[], indices: number[], materials: Material[], geometry: Geometry) {\n    for (let m = 0; m < materials.length; ++m) {\n        prepareMesh(vertex, indices, materials[m].start, materials[m].length, geometry)\n    }\n}\n\nexport function prepareMesh(vertex: number[], indices: number[], startCoord: number, length: number, geometry: Geometry) {\n    const indexEnd = startCoord + length\n    geometry.addMesh()\n    // the mesh is in quads but converted to triangles for OpenGL. when exporting, revert to quads\n    for (let i = startCoord; i < indexEnd; i += 6) {\n        geometry.addQuad(vertex, indices, i)\n    }\n}\n\n// IN:\n//   vertexWeights = {\n//     <boneName>: [\n//       [vertexIndex, ...],\n//       [weight, ...]\n//     ], ...\n//   }\n//   geometry\n//   scene.skeleton.bones\n// OUT:\n//   boneWeightPairs = [\n//     <vertexIndex>: [\n//       [boneIndex, weightIndex], ...\n//     ]\n//   ]\n//   weights = [\n//     weightIndex: weight, ...\n//   ]\nexport function prepareControllers(vertex: number[], vertexWeights: VertexBoneWeights, boneMap: Map<string, Bone>, geometry: Geometry) {\n    const { boneWeightPairs, weightMap } = prepareControllerInit(geometry)\n    prepareControllerAddBoneWeights(vertex, vertexWeights, boneMap, geometry, boneWeightPairs, weightMap)\n    const weights = prepareControllerFlatWeightMap(weightMap)\n\n    return { weights, boneWeightPairs }\n}\n\nexport function prepareControllerInit(geometry: Geometry) {\n    let boneWeightPairs = new Array<Array<Array<number>>>(geometry.vertex.length / 3)\n    for (let i = 0; i < boneWeightPairs.length; ++i) {\n        boneWeightPairs[i] = []\n    }\n    const weightMap = new Map<number, number>()\n    return { boneWeightPairs, weightMap }\n}\n\nexport function prepareControllerAddBoneWeights(vertex: number[], vertexWeights: VertexBoneWeights,\n    boneMap: Map<string, Bone>,\n    geometry: Geometry,\n    boneWeightPairs: Array<Array<Array<number>>>,\n    weightMap: Map<number, number>\n) {\n    vertexWeights!._data.forEach((boneData, boneName) => {\n        const boneIndices = boneData[0] as number[]\n        const boneWeights = boneData[1] as number[]\n        zipForEach(boneIndices, boneWeights, (_index, weight) => {\n            const index = geometry.getIndex(vertex, _index)\n            if (index === undefined) {\n                // vertex is not used\n                return\n            }\n            let weightIndex = weightMap.get(weight)\n            if (weightIndex === undefined) {\n                weightIndex = weightMap.size\n                weightMap.set(weight, weightIndex)\n            }\n            boneWeightPairs[index].push([boneMap.get(boneName)!.index, weightIndex])\n        })\n    })\n}\n\nexport function prepareControllerFlatWeightMap(weightMap: Map<number, number>) {\n    const weights = new Array<number>(weightMap.size)\n    weightMap.forEach((index, weight) => { weights[index] = weight })\n    return weights\n}\n\nexport function prepareControllerFlatBoneWeight(boneWeightPairs: Array<Array<Array<number>>>) {\n    const flatBoneWeightList: number[] = []\n    boneWeightPairs.forEach(vertexData => {\n        vertexData.forEach(boneWeightPair =>\n            boneWeightPair.forEach(value =>\n                flatBoneWeightList.push(value)\n            )\n        )\n    })\n    return flatBoneWeightList\n}\n\nconst identity = mat4.identity(mat4.create())\n\n// create the \"bind shape matrix\" from the collada spec\nfunction bsm(bone: Bone) {\n    return mat2txt(bone.matRestRelative!)\n}\n\n// create the \"inverse bind pose matrix\" from the collada spec\nfunction ibm(bone: Bone) {\n    return mat2txt(mat4.invert(mat4.create(), bone.matRestGlobal!))\n}\n\n// output mat4 in collada format (translation on the right instead of bottom)\nfunction mat2txt(m: mat4) {\n    const map = [0, 4, 8, 12, 1, 5, 9, 13, 2, 6, 10, 14, 3, 7, 11, 15]\n    let out = \"\"\n    for (let i = 0; i < 16; ++i) {\n        const x = m[map[i]]\n        out += `${x} `\n    }\n    return out.trimEnd()\n}\n\nfunction dumpBone(armatureName: string, bone: Bone, indent: number = 4, connectWithParent: boolean = false) {\n    const is = indentToString(indent)\n    let out = ``\n    out += `${is}<node id=\"${armatureName}_${bone.name.replace(/\\./g, \"_\")}\" name=\"${bone.name}\" sid=\"${bone.name.replace(/\\./g, \"_\")}\" type=\"JOINT\">\\n`\n    out += `${is}  <matrix sid=\"transform\">${bsm(bone)}</matrix>\\n`\n    out += `${is}  <extra>\\n`\n    out += `${is}    <technique profile=\"blender\">\\n`\n\n    const childrenToConnectWith = new Set<Bone>()\n    const tail = vec4.transformMat4(vec4.create(), bone.yvector4!, bone.matRestGlobal!)\n    for (let child of bone.children) {\n        const childHead = vec4.transformMat4(vec4.create(), vec4.fromValues(0, 0, 0, 1), child.matRestGlobal!)\n        if (vec4.equals(tail, childHead)) {\n            childrenToConnectWith.add(child)\n        }\n    }\n\n    if (connectWithParent) {\n        out += `${is}      <connect sid=\"connect\" type=\"bool\">1</connect>\\n`\n    }\n    out += `${is}      <layer sid=\"layer\" type=\"string\">0</layer>\\n`\n    if (childrenToConnectWith.size === 0) {\n        const head = vec4.transformMat4(vec4.create(), vec4.fromValues(0, 0, 0, 1), bone.matRestGlobal!)\n        const boneGlobalVec = vec4.sub(vec4.create(), tail, head)\n        out += `${is}      <tip_x sid=\"tip_x\" type=\"float\">${boneGlobalVec[0]}</tip_x>\\n`\n        out += `${is}      <tip_y sid=\"tip_y\" type=\"float\">${boneGlobalVec[1]}</tip_y>\\n`\n        out += `${is}      <tip_z sid=\"tip_z\" type=\"float\">${boneGlobalVec[2]}</tip_z>\\n`\n    }\n    out += `${is}    </technique>\\n`\n    out += `${is}  </extra>\\n`\n    for (let child of bone.children) {\n        out += dumpBone(armatureName, child, indent + 1, childrenToConnectWith.has(child))\n    }\n    out += `${is}</node>\\n`\n    return out\n}\n\nfunction indentToString(indent: number): string {\n    let indentStr = \"\"\n    for (let i = 0; i < indent; ++i) {\n        indentStr += \"  \"\n    }\n    return indentStr\n}","export function zipForEach<A, B>(a: Array<A>, b: Array<B>, block: (a: A, b: B) => void) {\n    if (a.length !== b.length) {\n        throw Error(`lengths must be equal but are ${a.length} and ${b.length}`)\n    }\n    for(let i=0; i<a.length; ++i) {\n        block(a[i], b[i])\n    }\n}","import { TablePos } from 'toad.js/table/TablePos'\nimport { TreeNode } from 'toad.js/table/model/TreeNode'\nimport { TreeNodeModel } from 'toad.js/table/model/TreeNodeModel'\nimport { TreeAdapter } from 'toad.js/table/adapter/TreeAdapter'\n\nimport { Bone } from \"../skeleton/Bone\"\nimport { Text } from \"toad.js/view/Text\"\nimport { NumberModel } from 'toad.js/model/NumberModel'\nimport { Fragment } from 'toad.jsx/lib/jsx-runtime'\nimport { Signal } from 'toad.js/Signal'\nimport { mat4 } from 'gl-matrix'\n\nexport class PoseNode implements TreeNode {\n    static count = 0\n    bone!: Bone\n    next?: PoseNode\n    down?: PoseNode\n\n    x: NumberModel\n    y: NumberModel\n    z: NumberModel\n\n    updateBone() {\n        let out = mat4.create()\n        let tmp = mat4.create()\n        mat4.fromXRotation(out, this.x.value / 360 * 2 * Math.PI)\n        mat4.fromYRotation(tmp, this.y.value / 360 * 2 * Math.PI)\n        mat4.multiply(out, out, tmp)\n        mat4.fromZRotation(tmp, this.z.value / 360 * 2 * Math.PI)\n        mat4.multiply(out, out, tmp)\n        this.bone.matPose = out\n        // this.bone.update()\n        this.bone.skeleton.boneslist!.forEach(bone => bone.update())\n    }\n\n    find(boneName: string): PoseNode | undefined {\n        if (this.bone.name === boneName) {\n            return this\n        }\n        const next = this.next?.find(boneName)\n        if (next) {\n            return next\n        }\n        const down = this.down?.find(boneName)\n        if (down) {\n            return down\n        }\n        return undefined\n    }\n\n    constructor(bone: Bone | undefined = undefined, signal: Signal<PoseNode> | undefined = undefined) {\n        this.x = new NumberModel(0, { min: -180, max: 180, step: 5 })\n        this.y = new NumberModel(0, { min: -180, max: 180, step: 5 })\n        this.z = new NumberModel(0, { min: -180, max: 180, step: 5 })\n\n        if (bone === undefined || signal === undefined) {\n            return\n        }\n\n        const update = () => {\n            this.updateBone()\n            signal.trigger(this)\n        }\n\n        this.x.modified.add(update)\n        this.y.modified.add(update)\n        this.z.modified.add(update)\n\n        this.bone = bone\n\n        // TODO: reduce nesting\n        // E.g. instead of\n        //     spine05\n        //       spine04\n        //         spine03\n        //           spine02\n        //             spine01\n        //               neck01\n        //               clavicle.R\n        //               clavicle.L\n        //             breast.R\n        //             breast.L\n        // arrange it as\n        //     spine05\n        //       spine04\n        //       spine03\n        //       spine02\n        //         spine01\n        //           neck01\n        //           clavicle.R\n        //           clavicle.L\n        //         breast.R\n        //         breast.L\n        bone.children.forEach(childBone => {\n            if (this.down === undefined) {\n                this.down = new PoseNode(childBone, signal)\n            } else {\n                const next = this.down\n                this.down = new PoseNode(childBone, signal)\n                this.down.next = next\n            }\n        })\n    }\n}\n\n// this tells <toad-table> how to render TreeNodeModel<PoseNode>\nexport class PoseTreeAdapter extends TreeAdapter<PoseNode> {\n\n    constructor(model: TreeNodeModel<PoseNode>) {\n        super(model)\n        this.config.expandColumn = true\n    }\n\n    override get colCount(): number {\n        return 2\n    }\n\n    override showCell(pos: TablePos, cell: HTMLSpanElement) {\n        if (this.model === undefined) {\n            console.log(\"no model\")\n            return\n        }\n        const node = this.model.rows[pos.row].node\n        switch (pos.col) {\n            case 0:\n                this.treeCell(pos, cell, node.bone.name)\n                break\n            case 1:\n                const x = <>\n                    <Text model={node.x} style={{ width: '50px' }} />\n                    <Text model={node.y} style={{ width: '50px' }} />\n                    <Text model={node.z} style={{ width: '50px' }} />\n                </> as Fragment\n                cell.replaceChildren(...x)\n                break\n        }\n    }\n}\n\n\n","import { TablePos } from 'toad.js/table/TablePos'\nimport { TreeNodeModel } from 'toad.js/table/model/TreeNodeModel'\nimport { TreeAdapter } from 'toad.js/table/adapter/TreeAdapter'\n\nimport { Text } from 'toad.js/view/Text'\nimport { Slider } from 'toad.js/view/Slider'\nimport { Fragment } from \"toad.jsx\"\n\nimport { SliderNode } from '../modifier/loadSliders'\n\n// this tells <toad-table> how to render TreeNodeModel<SliderNode>\nexport class SliderTreeAdapter extends TreeAdapter<SliderNode> {\n    constructor(model: TreeNodeModel<SliderNode>) {\n        super(model)\n        this.config.expandColumn = true\n    }\n\n    override get colCount(): number {\n        return 2\n    }\n\n    override showCell(pos: TablePos, cell: HTMLSpanElement) {\n        if (this.model === undefined) {\n            console.log(\"no model\")\n            return\n        }\n        const node = this.model.rows[pos.row].node\n        switch (pos.col) {\n            case 0:\n                this.treeCell(pos, cell, node.label)\n                break\n            case 1:\n                if (node.model) {\n                    const x = <>\n                        <Text model={node.model} style={{ width: '50px' }} />\n                        <Slider model={node.model} style={{width: '200px' }}/>\n                    </> as Fragment\n                    cell.replaceChildren(...x)\n                }\n                break\n        }\n    }\n}\n","import { mat4 } from 'gl-matrix'\n\nexport abstract class AbstractShader {\n    protected gl: WebGL2RenderingContext\n    protected program: WebGLProgram\n\n    protected vertexPosition: number\n    protected vertexNormal: number\n    protected textureCoord?: number\n\n    protected projectionMatrix: WebGLUniformLocation\n    protected modelViewMatrix: WebGLUniformLocation\n    protected normalMatrix: WebGLUniformLocation\n\n    constructor(gl: WebGL2RenderingContext, vertexShaderSrc: string, fragmentShaderSrc: string) {\n        const program = gl.createProgram()\n        if (program === null) {\n            throw Error('Unable to create WebGLProgram')\n        }\n        const vertexShader = AbstractShader.compileShader(gl, gl.VERTEX_SHADER, vertexShaderSrc)\n        const fragmentShader = AbstractShader.compileShader(gl, gl.FRAGMENT_SHADER, fragmentShaderSrc)\n        gl.attachShader(program, vertexShader)\n        gl.attachShader(program, fragmentShader)\n        gl.linkProgram(program)\n\n        if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n            throw Error(`Unable to initialize WebGLProgram: ${gl.getProgramInfoLog(program)}`)\n        }\n        this.gl = gl\n        this.program = program\n\n        this.vertexPosition = gl.getAttribLocation(this.program, 'aVertexPosition')\n        this.vertexNormal = gl.getAttribLocation(this.program, 'aVertexNormal')\n\n        this.projectionMatrix = AbstractShader.getUniformLocation(gl, this.program, 'uProjectionMatrix')\n        this.modelViewMatrix = AbstractShader.getUniformLocation(gl, this.program, 'uModelViewMatrix')\n        this.normalMatrix = AbstractShader.getUniformLocation(gl, this.program, 'uNormalMatrix')\n    }\n\n    bind(indices: WebGLBuffer, vertices: WebGLBuffer, normales: WebGLBuffer, texture?: WebGLBuffer) {\n        const numComponents = 3, type = this.gl.FLOAT, normalize = false, stride = 0, offset = 0\n        this.gl.bindBuffer(this.gl.ARRAY_BUFFER, vertices)\n        this.gl.vertexAttribPointer(this.vertexPosition, numComponents, type, normalize, stride, offset)\n        this.gl.enableVertexAttribArray(this.vertexPosition)\n\n        this.gl.bindBuffer(this.gl.ARRAY_BUFFER, normales)\n        this.gl.vertexAttribPointer(this.vertexNormal, numComponents, type, normalize, stride, offset)\n        this.gl.enableVertexAttribArray(this.vertexNormal)\n\n        this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER, indices)\n    }\n\n    init(projectionMatrix: mat4, modelViewMatrix: mat4, normalMatrix: mat4) {\n        this.gl.useProgram(this.program)\n        this.gl.uniformMatrix4fv(this.projectionMatrix, false, projectionMatrix)\n        this.gl.uniformMatrix4fv(this.modelViewMatrix, false, modelViewMatrix)\n        this.gl.uniformMatrix4fv(this.normalMatrix, false, normalMatrix)\n    }\n\n    static compileShader(gl: WebGL2RenderingContext, type: GLenum, source: string): WebGLShader {\n        const shader = gl.createShader(type)\n        if (shader === null)\n            throw Error('Unable to create WebGLShader')\n        gl.shaderSource(shader, source)\n        gl.compileShader(shader)\n        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n            gl.deleteShader(shader)\n            throw Error(`An error occurred compiling the ${type} WebGLShader: ${gl.getShaderInfoLog(shader)}`)\n        }\n        return shader\n    }\n\n    static getUniformLocation(gl: WebGL2RenderingContext, program: WebGLProgram, name: string): WebGLUniformLocation {\n        const location = gl.getUniformLocation(program, name)\n        if (location === null)\n            throw Error(`Internal Error: Failed to get uniform location for ${name}`)\n        return location\n    }\n}\n\n\n","import { AbstractShader } from './AbstractShader'\n\nexport class RGBAShader extends AbstractShader {\n    protected _color: WebGLUniformLocation\n    constructor(gl: WebGL2RenderingContext) {\n        super(gl, rgbaVertexShaderSrc, rgbaFragmentShaderSrc)\n        this._color = AbstractShader.getUniformLocation(gl, this.program, 'uColor')\n    }\n    // set RGBA color\n    color(rgba: number[]) {\n        this.gl.uniform4fv(this._color, rgba)\n    }\n}\nconst rgbaVertexShaderSrc = `\n// this is our input per vertex\nattribute vec4 aVertexPosition;\nattribute vec3 aVertexNormal;\n\n// input for all vertices (uniform for the whole shader program)\nuniform mat4 uNormalMatrix;\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nuniform vec4 uColor;\n\n// data exchanged with other graphic pipeline stages\nvarying lowp vec4 vColor;\nvarying highp vec3 vLighting;\n\nvoid main(void) {\n  gl_Position = uProjectionMatrix * uModelViewMatrix * aVertexPosition;\n\n  highp vec3 ambientLight = vec3(0.3, 0.3, 0.3);\n  highp vec3 directionalLightColor = vec3(1, 1, 1);\n  highp vec3 directionalVector = normalize(vec3(0.85, 0.8, 0.75));\n\n  highp vec4 transformedNormal = uNormalMatrix * vec4(aVertexNormal, 1.0);\n\n  highp float directional = max(dot(transformedNormal.xyz, directionalVector), 0.0);\n  vLighting = ambientLight + (directionalLightColor * directional);\n\n  vColor = uColor;\n}`\nconst rgbaFragmentShaderSrc = `\nvarying lowp vec4 vColor;\nvarying highp vec3 vLighting;\nvoid main(void) {\n  gl_FragColor = vec4(vec3(vColor[0],vColor[1],vColor[2]) * vLighting, vColor[3]);\n}`\n","import { AbstractShader } from './AbstractShader'\n\nexport class TextureShader extends AbstractShader {\n    protected uSampler: WebGLUniformLocation\n    constructor(gl: WebGL2RenderingContext) {\n        super(gl, textureVertexShaderSrc, textureFragmentShaderSrc)\n        this.textureCoord = gl.getAttribLocation(this.program, \"aTextureCoord\")\n        this.uSampler = gl.getUniformLocation(this.program, \"uSampler\")!\n    }\n\n    // set texture\n    texture(texture: WebGLTexture) {\n        this.gl.activeTexture(this.gl.TEXTURE0)\n        this.gl.bindTexture(this.gl.TEXTURE_2D, texture)\n        this.gl.uniform1i(this.uSampler, 0)\n    }\n    override bind(indices: WebGLBuffer, vertices: WebGLBuffer, normales: WebGLBuffer, texture?: WebGLBuffer): void {\n        super.bind(indices, vertices, normales, texture)\n        if (texture) {\n            const num = 2 // every coordinate composed of 2 values\n            const type = this.gl.FLOAT // the data in the buffer is 32-bit float\n            const normalize = false // don't normalize\n            const stride = 0 // how many bytes to get from one set to the next\n            const offset = 0 // how many bytes inside the buffer to start from\n            this.gl.bindBuffer(this.gl.ARRAY_BUFFER, texture!)\n            this.gl.vertexAttribPointer(\n                this.textureCoord!,\n                num,\n                type,\n                normalize,\n                stride,\n                offset\n            )\n            this.gl.enableVertexAttribArray(this.textureCoord!)\n        }\n    }\n}\nconst textureVertexShaderSrc = `\n// this is our input per vertex\nattribute vec4 aVertexPosition;\nattribute vec3 aVertexNormal;\nattribute vec2 aTextureCoord;\n\n// input for all vertices (uniform for the whole shader program)\nuniform mat4 uNormalMatrix;\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\n// data exchanged with other graphic pipeline stages\nvarying highp vec2 vTextureCoord;\nvarying highp vec3 vLighting;\n\nvoid main(void) {\n  gl_Position = uProjectionMatrix * uModelViewMatrix * aVertexPosition;\n  highp vec3 ambientLight = vec3(0.3, 0.3, 0.3);\n  highp vec3 directionalLightColor = vec3(1, 1, 1);\n  highp vec3 directionalVector = normalize(vec3(0.85, 0.8, 0.75));\n  highp vec4 transformedNormal = uNormalMatrix * vec4(aVertexNormal, 1.0);\n  highp float directional = max(dot(transformedNormal.xyz, directionalVector), 0.0);\n\n  // out\n  vLighting = ambientLight + (directionalLightColor * directional);\n  vTextureCoord = aTextureCoord;\n}`\nconst textureFragmentShaderSrc = `\nvarying highp vec2 vTextureCoord;\nvarying highp vec3 vLighting;\nuniform sampler2D uSampler;\nvoid main(void) {\n  highp vec4 texelColor = texture2D(uSampler, vTextureCoord);\n  gl_FragColor = vec4(texelColor.rgb * vLighting, texelColor.a);\n}`\n","import { vec3 } from 'gl-matrix'\n\nexport function calculateNormals(vertex: number[], indices: number[]): number[] {\n\n    function addNormal(index: number, normal: vec3) {\n        normals[index] += normal[0]\n        normals[index + 1] += normal[1]\n        normals[index + 2] += normal[2]\n    }\n\n    const normals = new Array<number>(vertex.length)\n    normals.fill(0)\n    \n    // add vectors\n    for (let i = 0; i < indices.length;) {\n        const i1 = indices[i++] * 3\n        const i2 = indices[i++] * 3\n        const i3 = indices[i++] * 3\n\n        const p1 = vec3.fromValues(vertex[i1], vertex[i1 + 1], vertex[i1 + 2])\n        const p2 = vec3.fromValues(vertex[i2], vertex[i2 + 1], vertex[i2 + 2])\n        const p3 = vec3.fromValues(vertex[i3], vertex[i3 + 1], vertex[i3 + 2])\n\n        const u = vec3.create()\n        vec3.subtract(u, p2, p1)\n\n        const v = vec3.create()\n        vec3.subtract(v, p3, p1)\n\n        const n = vec3.create()\n        vec3.cross(n, u, v)\n\n        addNormal(i1, n)\n        addNormal(i2, n)\n        addNormal(i3, n)\n    }\n\n    // normalize\n    for(let normalIndex = 0; normalIndex < vertex.length; normalIndex += 3) {\n        const normal = vec3.fromValues(normals[normalIndex], normals[normalIndex + 1], normals[normalIndex + 2])\n        vec3.normalize(normal, normal)\n        normals[normalIndex] = normal[0]\n        normals[normalIndex + 1] = normal[1]\n        normals[normalIndex + 2] = normal[2]\n    }\n    return normals\n}\n","import { calculateNormals } from '../lib/calculateNormals'\nimport { AbstractShader } from './shader/AbstractShader'\n\n/**\n * I am a mesh which can be rendered by OpenGL.\n */\nexport class RenderMesh {\n    gl: WebGL2RenderingContext\n    vertex: WebGLBuffer\n    normal: WebGLBuffer\n    indices: WebGLBuffer\n    texture?: WebGLBuffer\n    length: number\n\n    constructor(gl: WebGL2RenderingContext, vertex: number[], index: number[], texture?: number[]) {\n        this.gl = gl\n        this.vertex = this.createBuffer(gl.ARRAY_BUFFER, gl.STATIC_DRAW, Float32Array, vertex)\n        this.indices = this.createBuffer(gl.ELEMENT_ARRAY_BUFFER, gl.STATIC_DRAW, Uint16Array, index)\n        this.normal = this.createBuffer(gl.ARRAY_BUFFER, gl.STATIC_DRAW, Float32Array, calculateNormals(vertex, index))\n        if (texture !== undefined) {\n            this.texture = this.createBuffer(gl.ARRAY_BUFFER, gl.STATIC_DRAW, Float32Array, texture)\n        }\n        this.length = index.length\n    }\n\n    update(vertex: number[], index: number[]) {\n        this.updateBuffer(this.vertex, this.gl.ARRAY_BUFFER, this.gl.STATIC_DRAW, Float32Array, vertex)\n        this.updateBuffer(this.normal, this.gl.ARRAY_BUFFER, this.gl.STATIC_DRAW, Float32Array, calculateNormals(vertex, index))\n    }\n\n    draw(programInfo: AbstractShader, mode: number) {\n        this.bind(programInfo)\n        this.drawSubset(mode, 0, this.length)\n    }\n\n    bind(programInfo: AbstractShader): void {\n        programInfo.bind(this.indices, this.vertex, this.normal, this.texture)\n    }\n\n    drawSubset(mode: number, offset: number, length: number) {\n        this.gl.drawElements(mode, length, this.gl.UNSIGNED_SHORT, offset)\n    }\n\n    protected createBuffer(target: GLenum, usage: GLenum, type: Float32ArrayConstructor | Uint16ArrayConstructor, data: number[]): WebGLBuffer {\n        const buffer = this.gl.createBuffer()\n        if (buffer === null)\n            throw Error('Failed to create new WebGLBuffer')\n        this.updateBuffer(buffer, target, usage, type, data)\n        return buffer\n    }\n\n    protected updateBuffer(buffer: WebGLBuffer, target: GLenum, usage: GLenum, type: Float32ArrayConstructor | Uint16ArrayConstructor, data: number[]): WebGLBuffer {\n        this.gl.bindBuffer(target, buffer)\n        this.gl.bufferData(target, new type(data), usage)\n        return buffer\n    }\n}\n","import { mat4, vec4 } from 'gl-matrix'\nimport { EnumModel } from 'toad.js'\nimport { BaseMeshGroup } from '../mesh/BaseMeshGroup'\nimport { HumanMesh, Update } from '../mesh/HumanMesh'\nimport { RenderMode } from './RenderMode'\nimport { RGBAShader } from \"./shader/RGBAShader\"\nimport { TextureShader } from \"./shader/TextureShader\"\nimport { Buffers } from './Buffers'\nimport { RenderMesh } from './RenderMesh'\n\nlet cubeRotation = 0.0\n\nexport function render(canvas: HTMLCanvasElement, scene: HumanMesh, mode: EnumModel<RenderMode>): void {\n    const gl = (canvas.getContext('webgl2') || canvas.getContext('experimental-webgl')) as WebGL2RenderingContext\n    if (gl == null) {\n        throw Error('Unable to initialize WebGL. Your browser or machine may not support it.')\n    }\n    // Flip image pixels into the bottom-to-top order that WebGL expects.\n    gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true)\n\n    const programRGBA = new RGBAShader(gl)\n    const programTex = new TextureShader(gl)\n\n    const buffers = createAllBuffers(gl, scene)\n    const texture = loadTexture(gl, \"data/skins/textures/young_caucasian_female_special_suit.png\")!\n\n    let then = 0\n\n    // Draw the scene repeatedly\n    function render(now: number) {\n        now *= 0.001  // convert to seconds\n        const deltaTime = now - then\n        then = now\n\n        if (scene.updateRequired !== Update.NONE) {\n            updateBuffers(scene, buffers)\n        }\n\n        drawScene(gl, programRGBA, programTex, texture, buffers, deltaTime, scene, mode.value)\n\n        requestAnimationFrame(render)\n    }\n    requestAnimationFrame(render)\n}\n\nfunction drawScene(\n    gl: WebGL2RenderingContext,\n    programRGBA: RGBAShader,\n    programTex: TextureShader,\n    texture: WebGLTexture,\n    buffers: Buffers,\n    deltaTime: number,\n    scene: HumanMesh,\n    renderMode: RenderMode): void {\n\n    const canvas = gl.canvas as HTMLCanvasElement\n    prepareCanvas(canvas)\n    prepareViewport(gl, canvas)\n    const projectionMatrix = createProjectionMatrix(canvas)\n    const modelViewMatrix = createModelViewMatrix(renderMode)\n    const normalMatrix = createNormalMatrix(modelViewMatrix)\n\n    programRGBA.init(projectionMatrix, modelViewMatrix, normalMatrix)\n\n    //\n    // BASEMESH\n    //\n\n    buffers.base.bind(programRGBA)\n    let skin\n    switch (renderMode) {\n        case RenderMode.POLYGON:\n            skin = [BaseMeshGroup.SKIN, [1.0, 0.8, 0.7, 1], gl.TRIANGLES]\n            break\n        case RenderMode.DEBUG:\n        case RenderMode.WIREFRAME:\n            skin = [BaseMeshGroup.SKIN, [1.0 / 5, 0.8 / 5, 0.7 / 5, 1], gl.LINES]\n            break\n        default:\n            throw Error(`Illegal render mode ${renderMode}`)\n    }\n\n    for (let x of [\n        skin,\n        [BaseMeshGroup.EYEBALL0, [0.0, 0.5, 1, 1], gl.TRIANGLES],\n        [BaseMeshGroup.EYEBALL1, [0.0, 0.5, 1, 1], gl.TRIANGLES],\n        [BaseMeshGroup.TEETH_TOP, [1.0, 0.0, 0, 1], gl.TRIANGLES],\n        [BaseMeshGroup.TEETH_BOTTOM, [1.0, 0.0, 0, 1], gl.TRIANGLES],\n        [BaseMeshGroup.TOUNGE, [1.0, 0.0, 0, 1], gl.TRIANGLES],\n        [BaseMeshGroup.CUBE, [1.0, 0.0, 0.5, 1], gl.LINE_STRIP],\n    ]) {\n        const idx = x[0] as number\n        const rgba = x[1] as number[]\n        const mode = x[2] as number\n\n        if (idx === BaseMeshGroup.SKIN && renderMode === RenderMode.POLYGON) {\n            continue\n        }\n\n        if (idx === BaseMeshGroup.SKIN && buffers.proxies.has(\"Proxymeshes\")) {\n            continue\n        }\n        if ((idx === BaseMeshGroup.EYEBALL0 || idx === BaseMeshGroup.EYEBALL1) && buffers.proxies.has(\"Eyes\")) {\n            continue\n        }\n        if ((idx === BaseMeshGroup.TEETH_TOP || idx === BaseMeshGroup.TEETH_BOTTOM) && buffers.proxies.has(\"Teeth\")) {\n            continue\n        }\n        if (idx === BaseMeshGroup.TOUNGE && buffers.proxies.has(\"Tongue\")) {\n            continue\n        }\n\n        programRGBA.color(rgba)\n        let offset = scene.baseMesh.groups[idx].startIndex * 2 // index is a word, hence 2 bytes\n        let length = scene.baseMesh.groups[idx].length\n\n        buffers.base.drawSubset(mode, offset, length)\n    }\n\n    //\n    // SKELETON\n    //\n    if (renderMode !== RenderMode.POLYGON) {\n        programRGBA.color([1, 1, 1, 1])\n        const offset = buffers.skeletonIndex\n        const count = scene.skeleton.boneslist!.length * 2\n        buffers.base.drawSubset(gl.LINES, offset, count)\n    }\n\n    //\n    // JOINTS\n    //\n    if (renderMode !== RenderMode.POLYGON) {\n        programRGBA.color([1, 1, 1, 1])\n        const offset = scene.baseMesh.groups[2].startIndex * 2\n        const count = scene.baseMesh.groups[2].length * 124\n        buffers.base.drawSubset(gl.TRIANGLES, offset, count)\n    }\n\n    //\n    // PROXIES\n    //\n\n    let glMode: number\n    switch (renderMode) {\n        case RenderMode.POLYGON:\n            glMode = gl.TRIANGLES\n            break\n        case RenderMode.WIREFRAME:\n        case RenderMode.DEBUG:\n            glMode = gl.LINES\n            break\n    }\n\n    buffers.proxies.forEach((renderMesh, name) => {\n        let rgba: number[] = [0.5, 0.5, 0.5, 1]\n        switch (name) {\n            case \"Proxymeshes\":\n                rgba = [1.0, 0.8, 0.7, 1]\n                if (renderMode === RenderMode.WIREFRAME) {\n                    rgba = [rgba[0] / 5, rgba[1] / 5, rgba[2] / 5, 1]\n                }\n                break\n            case \"Eyes\":\n                rgba = [0.0, 0.5, 1, 1]\n                break\n            case \"Teeth\":\n                rgba = [1.0, 1.0, 1.0, 1]\n                break\n            case \"Tongue\":\n                rgba = [1.0, 0.0, 0, 1]\n                break\n        }\n        programRGBA.color(rgba)\n        renderMesh.draw(programRGBA, glMode)\n    })\n\n    //\n    // TEXTURED CUBE\n    //\n    if (renderMode !== RenderMode.WIREFRAME) {\n\n        programTex.init(projectionMatrix, modelViewMatrix, normalMatrix)\n        programTex.texture(texture)\n\n        // buffers.texCube.draw(programTex, gl.TRIANGLES)\n\n        let offset = scene.baseMesh.groups[BaseMeshGroup.SKIN].startIndex * 2 // index is a word, hence 2 bytes\n        let length = scene.baseMesh.groups[BaseMeshGroup.SKIN].length\n        buffers.base.bind(programTex)\n        buffers.base.drawSubset(gl.TRIANGLES, offset, length)\n    }\n\n    cubeRotation += deltaTime\n}\n\nfunction prepareCanvas(canvas: HTMLCanvasElement) {\n    if (canvas.width !== canvas.clientWidth || canvas.height !== canvas.clientHeight) {\n        canvas.width = canvas.clientWidth\n        canvas.height = canvas.clientHeight\n    }\n}\n\nfunction prepareViewport(gl: WebGL2RenderingContext, canvas: HTMLCanvasElement) {\n    gl.viewport(0, 0, canvas.width, canvas.height)\n    gl.clearColor(0.0, 0.0, 0.0, 1.0)\n    gl.clearDepth(1.0)\n    gl.enable(gl.DEPTH_TEST)\n    gl.depthFunc(gl.LEQUAL)\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT)\n}\n\nfunction createModelViewMatrix(renderMode: RenderMode) {\n    const modelViewMatrix = mat4.create()\n    if (renderMode === RenderMode.DEBUG) {\n        mat4.translate(modelViewMatrix, modelViewMatrix, [1.0, -7.0, -5.0])\n        mat4.rotate(modelViewMatrix, modelViewMatrix, -Math.PI / 2, [0, 1, 0])\n    } else {\n        mat4.translate(modelViewMatrix, modelViewMatrix, [-0.0, 0.0, -25.0]) // move the model (cube) away\n        mat4.rotate(modelViewMatrix, modelViewMatrix, cubeRotation * .7, [0, 1, 0])\n    }\n    return modelViewMatrix\n}\n\nfunction createProjectionMatrix(canvas: HTMLCanvasElement) {\n    const fieldOfView = 45 * Math.PI / 180    // in radians\n    const aspect = canvas.width / canvas.height\n    const zNear = 0.1\n    const zFar = 100.0\n    const projectionMatrix = mat4.create()\n    mat4.perspective(projectionMatrix, fieldOfView, aspect, zNear, zFar)\n    return projectionMatrix\n}\n\nfunction createNormalMatrix(modelViewMatrix: mat4) {\n    const normalMatrix = mat4.create()\n    mat4.invert(normalMatrix, modelViewMatrix)\n    mat4.transpose(normalMatrix, normalMatrix)\n    return normalMatrix\n}\n\n// render the skeleton using matRestGlobal\nfunction renderSkeletonGlobal(scene: HumanMesh) {\n    const skel = scene.skeleton\n    const v = vec4.fromValues(0, 0, 0, 1)\n    const vertex = new Array<number>(skel.boneslist!.length * 6)\n    const indices = new Array<number>(skel.boneslist!.length * 2)\n    skel.boneslist!.forEach((bone, index) => {\n        const m = bone.matPoseGlobal ? bone.matPoseGlobal : bone.matRestGlobal!\n        const a = vec4.transformMat4(vec4.create(), v, m)\n        const b = vec4.transformMat4(vec4.create(), bone.yvector4!, m)\n        const vi = index * 6\n        const ii = index * 2\n        vertex[vi] = a[0]\n        vertex[vi + 1] = a[1]\n        vertex[vi + 2] = a[2]\n        vertex[vi + 3] = b[0]\n        vertex[vi + 4] = b[1]\n        vertex[vi + 5] = b[2]\n        indices[ii] = index * 2\n        indices[ii + 1] = index * 2 + 1\n    })\n    return { vertex, indices }\n}\n\nfunction createAllBuffers(gl: WebGL2RenderingContext, scene: HumanMesh): Buffers {\n    const { vx, ix, ux, skeletonIndex } = buildBase(scene)\n    const base = new RenderMesh(gl, vx, ix, ux)\n    const texCube = createTexturedCubeRenderer(gl)\n\n    let proxies = new Map<string, RenderMesh>()\n    scene.proxies.forEach((proxy, name) => {\n        proxies.set(name, new RenderMesh(gl, proxy.getCoords(scene.vertexRigged), proxy.mesh.indices))\n    })\n\n    return { base, texCube, skeletonIndex, proxies }\n}\n\nfunction updateBuffers(scene: HumanMesh, buffers: Buffers) {\n    scene.update()\n\n    const { vx, ix } = buildBase(scene)\n    buffers.base.update(vx, ix)\n\n    buffers.proxies.forEach((renderMesh, name) => {\n        const proxy = scene.proxies.get(name)!\n        const vertexMorphed = proxy.getCoords(scene.vertexMorphed)\n        const vertexWeights = proxy.getVertexWeights(scene.skeleton.vertexWeights!)\n        const vertexRigged = scene.skeleton.skinMesh(vertexMorphed, vertexWeights!._data)\n        renderMesh.update(vertexRigged, proxy.mesh.indices)\n    })\n}\n\nfunction buildBase(scene: HumanMesh) {\n    let skeleton = renderSkeletonGlobal(scene)\n\n    let vx = scene.vertexRigged\n    let ix = scene.baseMesh.indices\n    let ux = scene.baseMesh.texture\n\n    const skeletonIndex = ix.length * 2\n\n    const vertexOffset = scene.vertexRigged.length / 3\n    vx = vx.concat(skeleton.vertex)\n    ix = ix.concat(skeleton.indices.map(v => v + vertexOffset))\n    return { vx, ix, ux, skeletonIndex }\n}\n\n//\n// Initialize a texture and load an image.\n// When the image finished loading copy it into the texture.\n//\nfunction loadTexture(gl: WebGLRenderingContext, url: string) {\n    const texture = gl.createTexture()\n    gl.bindTexture(gl.TEXTURE_2D, texture)\n\n    // Because images have to be downloaded over the internet\n    // they might take a moment until they are ready.\n    // Until then put a single pixel in the texture so we can\n    // use it immediately. When the image has finished downloading\n    // we'll update the texture with the contents of the image.\n    const level = 0\n    const internalFormat = gl.RGBA\n    const width = 1\n    const height = 1\n    const border = 0\n    const srcFormat = gl.RGBA\n    const srcType = gl.UNSIGNED_BYTE\n    const pixel = new Uint8Array([0, 0, 255, 255]) // opaque blue\n    gl.texImage2D(\n        gl.TEXTURE_2D,\n        level,\n        internalFormat,\n        width,\n        height,\n        border,\n        srcFormat,\n        srcType,\n        pixel\n    )\n\n    const image = new Image()\n    image.onload = () => {\n        console.log(`texture \"${url}\" has been loaded`)\n        gl.bindTexture(gl.TEXTURE_2D, texture)\n        gl.texImage2D(\n            gl.TEXTURE_2D,\n            level,\n            internalFormat,\n            srcFormat,\n            srcType,\n            image\n        )\n\n        // WebGL1 has different requirements for power of 2 images\n        // vs non power of 2 images so check if the image is a\n        // power of 2 in both dimensions.\n        if (isPowerOf2(image.width) && isPowerOf2(image.height)) {\n            // Yes, it's a power of 2. Generate mips.\n            gl.generateMipmap(gl.TEXTURE_2D)\n        } else {\n            // No, it's not a power of 2. Turn off mips and set\n            // wrapping to clamp to edge\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE)\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE)\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR)\n        }\n    }\n    image.src = url\n\n    return texture\n}\n\nfunction isPowerOf2(value: number) {\n    return (value & (value - 1)) === 0\n}\n\nfunction createTexturedCubeRenderer(gl: WebGL2RenderingContext): RenderMesh {\n    const positions = [\n        // Front face\n        -1.0, -1.0, 1.0, 1.0, -1.0, 1.0, 1.0, 1.0, 1.0, -1.0, 1.0, 1.0,\n        // Back face\n        -1.0, -1.0, -1.0, -1.0, 1.0, -1.0, 1.0, 1.0, -1.0, 1.0, -1.0, -1.0,\n        // Top face\n        -1.0, 1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0,\n        // Bottom face\n        -1.0, -1.0, -1.0, 1.0, -1.0, -1.0, 1.0, -1.0, 1.0, -1.0, -1.0, 1.0,\n        // Right face\n        1.0, -1.0, -1.0, 1.0, 1.0, -1.0, 1.0, 1.0, 1.0, 1.0, -1.0, 1.0,\n        // Left face\n        -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, -1.0, 1.0, 1.0, -1.0, 1.0, -1.0,\n    ]\n\n    const indices = [\n        0, 1, 2, 0, 2, 3, // front\n        4, 5, 6, 4, 6, 7, // back\n        8, 9, 10, 8, 10, 11, // top\n        12, 13, 14, 12, 14, 15, // bottom\n        16, 17, 18, 16, 18, 19, // right\n        20, 21, 22, 20, 22, 23, // left\n    ]\n\n    return new RenderMesh(gl, positions, indices, [\n        // Front\n        0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0,\n        // Back\n        0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0,\n        // Top\n        0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0,\n        // Bottom\n        0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0,\n        // Right\n        0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0,\n        // Left\n        0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0,\n    ])\n\n}\n","// DEFLATE is a complex format; to read this code, you should probably check the RFC first:\n// https://tools.ietf.org/html/rfc1951\n// You may also wish to take a look at the guide I made about this program:\n// https://gist.github.com/101arrowz/253f31eb5abc3d9275ab943003ffecad\n// Some of the following code is similar to that of UZIP.js:\n// https://github.com/photopea/UZIP.js\n// However, the vast majority of the codebase has diverged from UZIP.js to increase performance and reduce bundle size.\n// Sometimes 0 will appear where -1 would be more appropriate. This is because using a uint\n// is better for memory in most engines (I *think*).\nvar ch2 = {};\nvar wk = (function (c, id, msg, transfer, cb) {\n    var w = new Worker(ch2[id] || (ch2[id] = URL.createObjectURL(new Blob([\n        c + ';addEventListener(\"error\",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'\n    ], { type: 'text/javascript' }))));\n    w.onmessage = function (e) {\n        var d = e.data, ed = d.$e$;\n        if (ed) {\n            var err = new Error(ed[0]);\n            err['code'] = ed[1];\n            err.stack = ed[2];\n            cb(err, null);\n        }\n        else\n            cb(null, d);\n    };\n    w.postMessage(msg, transfer);\n    return w;\n});\n\n// aliases for shorter compressed code (most minifers don't do this)\nvar u8 = Uint8Array, u16 = Uint16Array, u32 = Uint32Array;\n// fixed length extra bits\nvar fleb = new u8([0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 0, /* unused */ 0, 0, /* impossible */ 0]);\n// fixed distance extra bits\n// see fleb note\nvar fdeb = new u8([0, 0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 11, 12, 12, 13, 13, /* unused */ 0, 0]);\n// code length index map\nvar clim = new u8([16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15]);\n// get base, reverse index map from extra bits\nvar freb = function (eb, start) {\n    var b = new u16(31);\n    for (var i = 0; i < 31; ++i) {\n        b[i] = start += 1 << eb[i - 1];\n    }\n    // numbers here are at max 18 bits\n    var r = new u32(b[30]);\n    for (var i = 1; i < 30; ++i) {\n        for (var j = b[i]; j < b[i + 1]; ++j) {\n            r[j] = ((j - b[i]) << 5) | i;\n        }\n    }\n    return [b, r];\n};\nvar _a = freb(fleb, 2), fl = _a[0], revfl = _a[1];\n// we can ignore the fact that the other numbers are wrong; they never happen anyway\nfl[28] = 258, revfl[258] = 28;\nvar _b = freb(fdeb, 0), fd = _b[0], revfd = _b[1];\n// map of value to reverse (assuming 16 bits)\nvar rev = new u16(32768);\nfor (var i = 0; i < 32768; ++i) {\n    // reverse table algorithm from SO\n    var x = ((i & 0xAAAA) >>> 1) | ((i & 0x5555) << 1);\n    x = ((x & 0xCCCC) >>> 2) | ((x & 0x3333) << 2);\n    x = ((x & 0xF0F0) >>> 4) | ((x & 0x0F0F) << 4);\n    rev[i] = (((x & 0xFF00) >>> 8) | ((x & 0x00FF) << 8)) >>> 1;\n}\n// create huffman tree from u8 \"map\": index -> code length for code index\n// mb (max bits) must be at most 15\n// TODO: optimize/split up?\nvar hMap = (function (cd, mb, r) {\n    var s = cd.length;\n    // index\n    var i = 0;\n    // u16 \"map\": index -> # of codes with bit length = index\n    var l = new u16(mb);\n    // length of cd must be 288 (total # of codes)\n    for (; i < s; ++i) {\n        if (cd[i])\n            ++l[cd[i] - 1];\n    }\n    // u16 \"map\": index -> minimum code for bit length = index\n    var le = new u16(mb);\n    for (i = 0; i < mb; ++i) {\n        le[i] = (le[i - 1] + l[i - 1]) << 1;\n    }\n    var co;\n    if (r) {\n        // u16 \"map\": index -> number of actual bits, symbol for code\n        co = new u16(1 << mb);\n        // bits to remove for reverser\n        var rvb = 15 - mb;\n        for (i = 0; i < s; ++i) {\n            // ignore 0 lengths\n            if (cd[i]) {\n                // num encoding both symbol and bits read\n                var sv = (i << 4) | cd[i];\n                // free bits\n                var r_1 = mb - cd[i];\n                // start value\n                var v = le[cd[i] - 1]++ << r_1;\n                // m is end value\n                for (var m = v | ((1 << r_1) - 1); v <= m; ++v) {\n                    // every 16 bit value starting with the code yields the same result\n                    co[rev[v] >>> rvb] = sv;\n                }\n            }\n        }\n    }\n    else {\n        co = new u16(s);\n        for (i = 0; i < s; ++i) {\n            if (cd[i]) {\n                co[i] = rev[le[cd[i] - 1]++] >>> (15 - cd[i]);\n            }\n        }\n    }\n    return co;\n});\n// fixed length tree\nvar flt = new u8(288);\nfor (var i = 0; i < 144; ++i)\n    flt[i] = 8;\nfor (var i = 144; i < 256; ++i)\n    flt[i] = 9;\nfor (var i = 256; i < 280; ++i)\n    flt[i] = 7;\nfor (var i = 280; i < 288; ++i)\n    flt[i] = 8;\n// fixed distance tree\nvar fdt = new u8(32);\nfor (var i = 0; i < 32; ++i)\n    fdt[i] = 5;\n// fixed length map\nvar flm = /*#__PURE__*/ hMap(flt, 9, 0), flrm = /*#__PURE__*/ hMap(flt, 9, 1);\n// fixed distance map\nvar fdm = /*#__PURE__*/ hMap(fdt, 5, 0), fdrm = /*#__PURE__*/ hMap(fdt, 5, 1);\n// find max of array\nvar max = function (a) {\n    var m = a[0];\n    for (var i = 1; i < a.length; ++i) {\n        if (a[i] > m)\n            m = a[i];\n    }\n    return m;\n};\n// read d, starting at bit p and mask with m\nvar bits = function (d, p, m) {\n    var o = (p / 8) | 0;\n    return ((d[o] | (d[o + 1] << 8)) >> (p & 7)) & m;\n};\n// read d, starting at bit p continuing for at least 16 bits\nvar bits16 = function (d, p) {\n    var o = (p / 8) | 0;\n    return ((d[o] | (d[o + 1] << 8) | (d[o + 2] << 16)) >> (p & 7));\n};\n// get end of byte\nvar shft = function (p) { return ((p + 7) / 8) | 0; };\n// typed array slice - allows garbage collector to free original reference,\n// while being more compatible than .slice\nvar slc = function (v, s, e) {\n    if (s == null || s < 0)\n        s = 0;\n    if (e == null || e > v.length)\n        e = v.length;\n    // can't use .constructor in case user-supplied\n    var n = new (v.BYTES_PER_ELEMENT == 2 ? u16 : v.BYTES_PER_ELEMENT == 4 ? u32 : u8)(e - s);\n    n.set(v.subarray(s, e));\n    return n;\n};\n/**\n * Codes for errors generated within this library\n */\nexport var FlateErrorCode = {\n    UnexpectedEOF: 0,\n    InvalidBlockType: 1,\n    InvalidLengthLiteral: 2,\n    InvalidDistance: 3,\n    StreamFinished: 4,\n    NoStreamHandler: 5,\n    InvalidHeader: 6,\n    NoCallback: 7,\n    InvalidUTF8: 8,\n    ExtraFieldTooLong: 9,\n    InvalidDate: 10,\n    FilenameTooLong: 11,\n    StreamFinishing: 12,\n    InvalidZipData: 13,\n    UnknownCompressionMethod: 14\n};\n// error codes\nvar ec = [\n    'unexpected EOF',\n    'invalid block type',\n    'invalid length/literal',\n    'invalid distance',\n    'stream finished',\n    'no stream handler',\n    ,\n    'no callback',\n    'invalid UTF-8 data',\n    'extra field too long',\n    'date not in range 1980-2099',\n    'filename too long',\n    'stream finishing',\n    'invalid zip data'\n    // determined by unknown compression method\n];\n;\nvar err = function (ind, msg, nt) {\n    var e = new Error(msg || ec[ind]);\n    e.code = ind;\n    if (Error.captureStackTrace)\n        Error.captureStackTrace(e, err);\n    if (!nt)\n        throw e;\n    return e;\n};\n// expands raw DEFLATE data\nvar inflt = function (dat, buf, st) {\n    // source length\n    var sl = dat.length;\n    if (!sl || (st && st.f && !st.l))\n        return buf || new u8(0);\n    // have to estimate size\n    var noBuf = !buf || st;\n    // no state\n    var noSt = !st || st.i;\n    if (!st)\n        st = {};\n    // Assumes roughly 33% compression ratio average\n    if (!buf)\n        buf = new u8(sl * 3);\n    // ensure buffer can fit at least l elements\n    var cbuf = function (l) {\n        var bl = buf.length;\n        // need to increase size to fit\n        if (l > bl) {\n            // Double or set to necessary, whichever is greater\n            var nbuf = new u8(Math.max(bl * 2, l));\n            nbuf.set(buf);\n            buf = nbuf;\n        }\n    };\n    //  last chunk         bitpos           bytes\n    var final = st.f || 0, pos = st.p || 0, bt = st.b || 0, lm = st.l, dm = st.d, lbt = st.m, dbt = st.n;\n    // total bits\n    var tbts = sl * 8;\n    do {\n        if (!lm) {\n            // BFINAL - this is only 1 when last chunk is next\n            final = bits(dat, pos, 1);\n            // type: 0 = no compression, 1 = fixed huffman, 2 = dynamic huffman\n            var type = bits(dat, pos + 1, 3);\n            pos += 3;\n            if (!type) {\n                // go to end of byte boundary\n                var s = shft(pos) + 4, l = dat[s - 4] | (dat[s - 3] << 8), t = s + l;\n                if (t > sl) {\n                    if (noSt)\n                        err(0);\n                    break;\n                }\n                // ensure size\n                if (noBuf)\n                    cbuf(bt + l);\n                // Copy over uncompressed data\n                buf.set(dat.subarray(s, t), bt);\n                // Get new bitpos, update byte count\n                st.b = bt += l, st.p = pos = t * 8, st.f = final;\n                continue;\n            }\n            else if (type == 1)\n                lm = flrm, dm = fdrm, lbt = 9, dbt = 5;\n            else if (type == 2) {\n                //  literal                            lengths\n                var hLit = bits(dat, pos, 31) + 257, hcLen = bits(dat, pos + 10, 15) + 4;\n                var tl = hLit + bits(dat, pos + 5, 31) + 1;\n                pos += 14;\n                // length+distance tree\n                var ldt = new u8(tl);\n                // code length tree\n                var clt = new u8(19);\n                for (var i = 0; i < hcLen; ++i) {\n                    // use index map to get real code\n                    clt[clim[i]] = bits(dat, pos + i * 3, 7);\n                }\n                pos += hcLen * 3;\n                // code lengths bits\n                var clb = max(clt), clbmsk = (1 << clb) - 1;\n                // code lengths map\n                var clm = hMap(clt, clb, 1);\n                for (var i = 0; i < tl;) {\n                    var r = clm[bits(dat, pos, clbmsk)];\n                    // bits read\n                    pos += r & 15;\n                    // symbol\n                    var s = r >>> 4;\n                    // code length to copy\n                    if (s < 16) {\n                        ldt[i++] = s;\n                    }\n                    else {\n                        //  copy   count\n                        var c = 0, n = 0;\n                        if (s == 16)\n                            n = 3 + bits(dat, pos, 3), pos += 2, c = ldt[i - 1];\n                        else if (s == 17)\n                            n = 3 + bits(dat, pos, 7), pos += 3;\n                        else if (s == 18)\n                            n = 11 + bits(dat, pos, 127), pos += 7;\n                        while (n--)\n                            ldt[i++] = c;\n                    }\n                }\n                //    length tree                 distance tree\n                var lt = ldt.subarray(0, hLit), dt = ldt.subarray(hLit);\n                // max length bits\n                lbt = max(lt);\n                // max dist bits\n                dbt = max(dt);\n                lm = hMap(lt, lbt, 1);\n                dm = hMap(dt, dbt, 1);\n            }\n            else\n                err(1);\n            if (pos > tbts) {\n                if (noSt)\n                    err(0);\n                break;\n            }\n        }\n        // Make sure the buffer can hold this + the largest possible addition\n        // Maximum chunk size (practically, theoretically infinite) is 2^17;\n        if (noBuf)\n            cbuf(bt + 131072);\n        var lms = (1 << lbt) - 1, dms = (1 << dbt) - 1;\n        var lpos = pos;\n        for (;; lpos = pos) {\n            // bits read, code\n            var c = lm[bits16(dat, pos) & lms], sym = c >>> 4;\n            pos += c & 15;\n            if (pos > tbts) {\n                if (noSt)\n                    err(0);\n                break;\n            }\n            if (!c)\n                err(2);\n            if (sym < 256)\n                buf[bt++] = sym;\n            else if (sym == 256) {\n                lpos = pos, lm = null;\n                break;\n            }\n            else {\n                var add = sym - 254;\n                // no extra bits needed if less\n                if (sym > 264) {\n                    // index\n                    var i = sym - 257, b = fleb[i];\n                    add = bits(dat, pos, (1 << b) - 1) + fl[i];\n                    pos += b;\n                }\n                // dist\n                var d = dm[bits16(dat, pos) & dms], dsym = d >>> 4;\n                if (!d)\n                    err(3);\n                pos += d & 15;\n                var dt = fd[dsym];\n                if (dsym > 3) {\n                    var b = fdeb[dsym];\n                    dt += bits16(dat, pos) & ((1 << b) - 1), pos += b;\n                }\n                if (pos > tbts) {\n                    if (noSt)\n                        err(0);\n                    break;\n                }\n                if (noBuf)\n                    cbuf(bt + 131072);\n                var end = bt + add;\n                for (; bt < end; bt += 4) {\n                    buf[bt] = buf[bt - dt];\n                    buf[bt + 1] = buf[bt + 1 - dt];\n                    buf[bt + 2] = buf[bt + 2 - dt];\n                    buf[bt + 3] = buf[bt + 3 - dt];\n                }\n                bt = end;\n            }\n        }\n        st.l = lm, st.p = lpos, st.b = bt, st.f = final;\n        if (lm)\n            final = 1, st.m = lbt, st.d = dm, st.n = dbt;\n    } while (!final);\n    return bt == buf.length ? buf : slc(buf, 0, bt);\n};\n// starting at p, write the minimum number of bits that can hold v to d\nvar wbits = function (d, p, v) {\n    v <<= p & 7;\n    var o = (p / 8) | 0;\n    d[o] |= v;\n    d[o + 1] |= v >>> 8;\n};\n// starting at p, write the minimum number of bits (>8) that can hold v to d\nvar wbits16 = function (d, p, v) {\n    v <<= p & 7;\n    var o = (p / 8) | 0;\n    d[o] |= v;\n    d[o + 1] |= v >>> 8;\n    d[o + 2] |= v >>> 16;\n};\n// creates code lengths from a frequency table\nvar hTree = function (d, mb) {\n    // Need extra info to make a tree\n    var t = [];\n    for (var i = 0; i < d.length; ++i) {\n        if (d[i])\n            t.push({ s: i, f: d[i] });\n    }\n    var s = t.length;\n    var t2 = t.slice();\n    if (!s)\n        return [et, 0];\n    if (s == 1) {\n        var v = new u8(t[0].s + 1);\n        v[t[0].s] = 1;\n        return [v, 1];\n    }\n    t.sort(function (a, b) { return a.f - b.f; });\n    // after i2 reaches last ind, will be stopped\n    // freq must be greater than largest possible number of symbols\n    t.push({ s: -1, f: 25001 });\n    var l = t[0], r = t[1], i0 = 0, i1 = 1, i2 = 2;\n    t[0] = { s: -1, f: l.f + r.f, l: l, r: r };\n    // efficient algorithm from UZIP.js\n    // i0 is lookbehind, i2 is lookahead - after processing two low-freq\n    // symbols that combined have high freq, will start processing i2 (high-freq,\n    // non-composite) symbols instead\n    // see https://reddit.com/r/photopea/comments/ikekht/uzipjs_questions/\n    while (i1 != s - 1) {\n        l = t[t[i0].f < t[i2].f ? i0++ : i2++];\n        r = t[i0 != i1 && t[i0].f < t[i2].f ? i0++ : i2++];\n        t[i1++] = { s: -1, f: l.f + r.f, l: l, r: r };\n    }\n    var maxSym = t2[0].s;\n    for (var i = 1; i < s; ++i) {\n        if (t2[i].s > maxSym)\n            maxSym = t2[i].s;\n    }\n    // code lengths\n    var tr = new u16(maxSym + 1);\n    // max bits in tree\n    var mbt = ln(t[i1 - 1], tr, 0);\n    if (mbt > mb) {\n        // more algorithms from UZIP.js\n        // TODO: find out how this code works (debt)\n        //  ind    debt\n        var i = 0, dt = 0;\n        //    left            cost\n        var lft = mbt - mb, cst = 1 << lft;\n        t2.sort(function (a, b) { return tr[b.s] - tr[a.s] || a.f - b.f; });\n        for (; i < s; ++i) {\n            var i2_1 = t2[i].s;\n            if (tr[i2_1] > mb) {\n                dt += cst - (1 << (mbt - tr[i2_1]));\n                tr[i2_1] = mb;\n            }\n            else\n                break;\n        }\n        dt >>>= lft;\n        while (dt > 0) {\n            var i2_2 = t2[i].s;\n            if (tr[i2_2] < mb)\n                dt -= 1 << (mb - tr[i2_2]++ - 1);\n            else\n                ++i;\n        }\n        for (; i >= 0 && dt; --i) {\n            var i2_3 = t2[i].s;\n            if (tr[i2_3] == mb) {\n                --tr[i2_3];\n                ++dt;\n            }\n        }\n        mbt = mb;\n    }\n    return [new u8(tr), mbt];\n};\n// get the max length and assign length codes\nvar ln = function (n, l, d) {\n    return n.s == -1\n        ? Math.max(ln(n.l, l, d + 1), ln(n.r, l, d + 1))\n        : (l[n.s] = d);\n};\n// length codes generation\nvar lc = function (c) {\n    var s = c.length;\n    // Note that the semicolon was intentional\n    while (s && !c[--s])\n        ;\n    var cl = new u16(++s);\n    //  ind      num         streak\n    var cli = 0, cln = c[0], cls = 1;\n    var w = function (v) { cl[cli++] = v; };\n    for (var i = 1; i <= s; ++i) {\n        if (c[i] == cln && i != s)\n            ++cls;\n        else {\n            if (!cln && cls > 2) {\n                for (; cls > 138; cls -= 138)\n                    w(32754);\n                if (cls > 2) {\n                    w(cls > 10 ? ((cls - 11) << 5) | 28690 : ((cls - 3) << 5) | 12305);\n                    cls = 0;\n                }\n            }\n            else if (cls > 3) {\n                w(cln), --cls;\n                for (; cls > 6; cls -= 6)\n                    w(8304);\n                if (cls > 2)\n                    w(((cls - 3) << 5) | 8208), cls = 0;\n            }\n            while (cls--)\n                w(cln);\n            cls = 1;\n            cln = c[i];\n        }\n    }\n    return [cl.subarray(0, cli), s];\n};\n// calculate the length of output from tree, code lengths\nvar clen = function (cf, cl) {\n    var l = 0;\n    for (var i = 0; i < cl.length; ++i)\n        l += cf[i] * cl[i];\n    return l;\n};\n// writes a fixed block\n// returns the new bit pos\nvar wfblk = function (out, pos, dat) {\n    // no need to write 00 as type: TypedArray defaults to 0\n    var s = dat.length;\n    var o = shft(pos + 2);\n    out[o] = s & 255;\n    out[o + 1] = s >>> 8;\n    out[o + 2] = out[o] ^ 255;\n    out[o + 3] = out[o + 1] ^ 255;\n    for (var i = 0; i < s; ++i)\n        out[o + i + 4] = dat[i];\n    return (o + 4 + s) * 8;\n};\n// writes a block\nvar wblk = function (dat, out, final, syms, lf, df, eb, li, bs, bl, p) {\n    wbits(out, p++, final);\n    ++lf[256];\n    var _a = hTree(lf, 15), dlt = _a[0], mlb = _a[1];\n    var _b = hTree(df, 15), ddt = _b[0], mdb = _b[1];\n    var _c = lc(dlt), lclt = _c[0], nlc = _c[1];\n    var _d = lc(ddt), lcdt = _d[0], ndc = _d[1];\n    var lcfreq = new u16(19);\n    for (var i = 0; i < lclt.length; ++i)\n        lcfreq[lclt[i] & 31]++;\n    for (var i = 0; i < lcdt.length; ++i)\n        lcfreq[lcdt[i] & 31]++;\n    var _e = hTree(lcfreq, 7), lct = _e[0], mlcb = _e[1];\n    var nlcc = 19;\n    for (; nlcc > 4 && !lct[clim[nlcc - 1]]; --nlcc)\n        ;\n    var flen = (bl + 5) << 3;\n    var ftlen = clen(lf, flt) + clen(df, fdt) + eb;\n    var dtlen = clen(lf, dlt) + clen(df, ddt) + eb + 14 + 3 * nlcc + clen(lcfreq, lct) + (2 * lcfreq[16] + 3 * lcfreq[17] + 7 * lcfreq[18]);\n    if (flen <= ftlen && flen <= dtlen)\n        return wfblk(out, p, dat.subarray(bs, bs + bl));\n    var lm, ll, dm, dl;\n    wbits(out, p, 1 + (dtlen < ftlen)), p += 2;\n    if (dtlen < ftlen) {\n        lm = hMap(dlt, mlb, 0), ll = dlt, dm = hMap(ddt, mdb, 0), dl = ddt;\n        var llm = hMap(lct, mlcb, 0);\n        wbits(out, p, nlc - 257);\n        wbits(out, p + 5, ndc - 1);\n        wbits(out, p + 10, nlcc - 4);\n        p += 14;\n        for (var i = 0; i < nlcc; ++i)\n            wbits(out, p + 3 * i, lct[clim[i]]);\n        p += 3 * nlcc;\n        var lcts = [lclt, lcdt];\n        for (var it = 0; it < 2; ++it) {\n            var clct = lcts[it];\n            for (var i = 0; i < clct.length; ++i) {\n                var len = clct[i] & 31;\n                wbits(out, p, llm[len]), p += lct[len];\n                if (len > 15)\n                    wbits(out, p, (clct[i] >>> 5) & 127), p += clct[i] >>> 12;\n            }\n        }\n    }\n    else {\n        lm = flm, ll = flt, dm = fdm, dl = fdt;\n    }\n    for (var i = 0; i < li; ++i) {\n        if (syms[i] > 255) {\n            var len = (syms[i] >>> 18) & 31;\n            wbits16(out, p, lm[len + 257]), p += ll[len + 257];\n            if (len > 7)\n                wbits(out, p, (syms[i] >>> 23) & 31), p += fleb[len];\n            var dst = syms[i] & 31;\n            wbits16(out, p, dm[dst]), p += dl[dst];\n            if (dst > 3)\n                wbits16(out, p, (syms[i] >>> 5) & 8191), p += fdeb[dst];\n        }\n        else {\n            wbits16(out, p, lm[syms[i]]), p += ll[syms[i]];\n        }\n    }\n    wbits16(out, p, lm[256]);\n    return p + ll[256];\n};\n// deflate options (nice << 13) | chain\nvar deo = /*#__PURE__*/ new u32([65540, 131080, 131088, 131104, 262176, 1048704, 1048832, 2114560, 2117632]);\n// empty\nvar et = /*#__PURE__*/ new u8(0);\n// compresses data into a raw DEFLATE buffer\nvar dflt = function (dat, lvl, plvl, pre, post, lst) {\n    var s = dat.length;\n    var o = new u8(pre + s + 5 * (1 + Math.ceil(s / 7000)) + post);\n    // writing to this writes to the output buffer\n    var w = o.subarray(pre, o.length - post);\n    var pos = 0;\n    if (!lvl || s < 8) {\n        for (var i = 0; i <= s; i += 65535) {\n            // end\n            var e = i + 65535;\n            if (e >= s) {\n                // write final block\n                w[pos >> 3] = lst;\n            }\n            pos = wfblk(w, pos + 1, dat.subarray(i, e));\n        }\n    }\n    else {\n        var opt = deo[lvl - 1];\n        var n = opt >>> 13, c = opt & 8191;\n        var msk_1 = (1 << plvl) - 1;\n        //    prev 2-byte val map    curr 2-byte val map\n        var prev = new u16(32768), head = new u16(msk_1 + 1);\n        var bs1_1 = Math.ceil(plvl / 3), bs2_1 = 2 * bs1_1;\n        var hsh = function (i) { return (dat[i] ^ (dat[i + 1] << bs1_1) ^ (dat[i + 2] << bs2_1)) & msk_1; };\n        // 24576 is an arbitrary number of maximum symbols per block\n        // 424 buffer for last block\n        var syms = new u32(25000);\n        // length/literal freq   distance freq\n        var lf = new u16(288), df = new u16(32);\n        //  l/lcnt  exbits  index  l/lind  waitdx  bitpos\n        var lc_1 = 0, eb = 0, i = 0, li = 0, wi = 0, bs = 0;\n        for (; i < s; ++i) {\n            // hash value\n            // deopt when i > s - 3 - at end, deopt acceptable\n            var hv = hsh(i);\n            // index mod 32768    previous index mod\n            var imod = i & 32767, pimod = head[hv];\n            prev[imod] = pimod;\n            head[hv] = imod;\n            // We always should modify head and prev, but only add symbols if\n            // this data is not yet processed (\"wait\" for wait index)\n            if (wi <= i) {\n                // bytes remaining\n                var rem = s - i;\n                if ((lc_1 > 7000 || li > 24576) && rem > 423) {\n                    pos = wblk(dat, w, 0, syms, lf, df, eb, li, bs, i - bs, pos);\n                    li = lc_1 = eb = 0, bs = i;\n                    for (var j = 0; j < 286; ++j)\n                        lf[j] = 0;\n                    for (var j = 0; j < 30; ++j)\n                        df[j] = 0;\n                }\n                //  len    dist   chain\n                var l = 2, d = 0, ch_1 = c, dif = (imod - pimod) & 32767;\n                if (rem > 2 && hv == hsh(i - dif)) {\n                    var maxn = Math.min(n, rem) - 1;\n                    var maxd = Math.min(32767, i);\n                    // max possible length\n                    // not capped at dif because decompressors implement \"rolling\" index population\n                    var ml = Math.min(258, rem);\n                    while (dif <= maxd && --ch_1 && imod != pimod) {\n                        if (dat[i + l] == dat[i + l - dif]) {\n                            var nl = 0;\n                            for (; nl < ml && dat[i + nl] == dat[i + nl - dif]; ++nl)\n                                ;\n                            if (nl > l) {\n                                l = nl, d = dif;\n                                // break out early when we reach \"nice\" (we are satisfied enough)\n                                if (nl > maxn)\n                                    break;\n                                // now, find the rarest 2-byte sequence within this\n                                // length of literals and search for that instead.\n                                // Much faster than just using the start\n                                var mmd = Math.min(dif, nl - 2);\n                                var md = 0;\n                                for (var j = 0; j < mmd; ++j) {\n                                    var ti = (i - dif + j + 32768) & 32767;\n                                    var pti = prev[ti];\n                                    var cd = (ti - pti + 32768) & 32767;\n                                    if (cd > md)\n                                        md = cd, pimod = ti;\n                                }\n                            }\n                        }\n                        // check the previous match\n                        imod = pimod, pimod = prev[imod];\n                        dif += (imod - pimod + 32768) & 32767;\n                    }\n                }\n                // d will be nonzero only when a match was found\n                if (d) {\n                    // store both dist and len data in one Uint32\n                    // Make sure this is recognized as a len/dist with 28th bit (2^28)\n                    syms[li++] = 268435456 | (revfl[l] << 18) | revfd[d];\n                    var lin = revfl[l] & 31, din = revfd[d] & 31;\n                    eb += fleb[lin] + fdeb[din];\n                    ++lf[257 + lin];\n                    ++df[din];\n                    wi = i + l;\n                    ++lc_1;\n                }\n                else {\n                    syms[li++] = dat[i];\n                    ++lf[dat[i]];\n                }\n            }\n        }\n        pos = wblk(dat, w, lst, syms, lf, df, eb, li, bs, i - bs, pos);\n        // this is the easiest way to avoid needing to maintain state\n        if (!lst && pos & 7)\n            pos = wfblk(w, pos + 1, et);\n    }\n    return slc(o, 0, pre + shft(pos) + post);\n};\n// CRC32 table\nvar crct = /*#__PURE__*/ (function () {\n    var t = new Int32Array(256);\n    for (var i = 0; i < 256; ++i) {\n        var c = i, k = 9;\n        while (--k)\n            c = ((c & 1) && -306674912) ^ (c >>> 1);\n        t[i] = c;\n    }\n    return t;\n})();\n// CRC32\nvar crc = function () {\n    var c = -1;\n    return {\n        p: function (d) {\n            // closures have awful performance\n            var cr = c;\n            for (var i = 0; i < d.length; ++i)\n                cr = crct[(cr & 255) ^ d[i]] ^ (cr >>> 8);\n            c = cr;\n        },\n        d: function () { return ~c; }\n    };\n};\n// Alder32\nvar adler = function () {\n    var a = 1, b = 0;\n    return {\n        p: function (d) {\n            // closures have awful performance\n            var n = a, m = b;\n            var l = d.length | 0;\n            for (var i = 0; i != l;) {\n                var e = Math.min(i + 2655, l);\n                for (; i < e; ++i)\n                    m += n += d[i];\n                n = (n & 65535) + 15 * (n >> 16), m = (m & 65535) + 15 * (m >> 16);\n            }\n            a = n, b = m;\n        },\n        d: function () {\n            a %= 65521, b %= 65521;\n            return (a & 255) << 24 | (a >>> 8) << 16 | (b & 255) << 8 | (b >>> 8);\n        }\n    };\n};\n;\n// deflate with opts\nvar dopt = function (dat, opt, pre, post, st) {\n    return dflt(dat, opt.level == null ? 6 : opt.level, opt.mem == null ? Math.ceil(Math.max(8, Math.min(13, Math.log(dat.length))) * 1.5) : (12 + opt.mem), pre, post, !st);\n};\n// Walmart object spread\nvar mrg = function (a, b) {\n    var o = {};\n    for (var k in a)\n        o[k] = a[k];\n    for (var k in b)\n        o[k] = b[k];\n    return o;\n};\n// worker clone\n// This is possibly the craziest part of the entire codebase, despite how simple it may seem.\n// The only parameter to this function is a closure that returns an array of variables outside of the function scope.\n// We're going to try to figure out the variable names used in the closure as strings because that is crucial for workerization.\n// We will return an object mapping of true variable name to value (basically, the current scope as a JS object).\n// The reason we can't just use the original variable names is minifiers mangling the toplevel scope.\n// This took me three weeks to figure out how to do.\nvar wcln = function (fn, fnStr, td) {\n    var dt = fn();\n    var st = fn.toString();\n    var ks = st.slice(st.indexOf('[') + 1, st.lastIndexOf(']')).replace(/\\s+/g, '').split(',');\n    for (var i = 0; i < dt.length; ++i) {\n        var v = dt[i], k = ks[i];\n        if (typeof v == 'function') {\n            fnStr += ';' + k + '=';\n            var st_1 = v.toString();\n            if (v.prototype) {\n                // for global objects\n                if (st_1.indexOf('[native code]') != -1) {\n                    var spInd = st_1.indexOf(' ', 8) + 1;\n                    fnStr += st_1.slice(spInd, st_1.indexOf('(', spInd));\n                }\n                else {\n                    fnStr += st_1;\n                    for (var t in v.prototype)\n                        fnStr += ';' + k + '.prototype.' + t + '=' + v.prototype[t].toString();\n                }\n            }\n            else\n                fnStr += st_1;\n        }\n        else\n            td[k] = v;\n    }\n    return [fnStr, td];\n};\nvar ch = [];\n// clone bufs\nvar cbfs = function (v) {\n    var tl = [];\n    for (var k in v) {\n        if (v[k].buffer) {\n            tl.push((v[k] = new v[k].constructor(v[k])).buffer);\n        }\n    }\n    return tl;\n};\n// use a worker to execute code\nvar wrkr = function (fns, init, id, cb) {\n    var _a;\n    if (!ch[id]) {\n        var fnStr = '', td_1 = {}, m = fns.length - 1;\n        for (var i = 0; i < m; ++i)\n            _a = wcln(fns[i], fnStr, td_1), fnStr = _a[0], td_1 = _a[1];\n        ch[id] = wcln(fns[m], fnStr, td_1);\n    }\n    var td = mrg({}, ch[id][1]);\n    return wk(ch[id][0] + ';onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage=' + init.toString() + '}', id, td, cbfs(td), cb);\n};\n// base async inflate fn\nvar bInflt = function () { return [u8, u16, u32, fleb, fdeb, clim, fl, fd, flrm, fdrm, rev, ec, hMap, max, bits, bits16, shft, slc, err, inflt, inflateSync, pbf, gu8]; };\nvar bDflt = function () { return [u8, u16, u32, fleb, fdeb, clim, revfl, revfd, flm, flt, fdm, fdt, rev, deo, et, hMap, wbits, wbits16, hTree, ln, lc, clen, wfblk, wblk, shft, slc, dflt, dopt, deflateSync, pbf]; };\n// gzip extra\nvar gze = function () { return [gzh, gzhl, wbytes, crc, crct]; };\n// gunzip extra\nvar guze = function () { return [gzs, gzl]; };\n// zlib extra\nvar zle = function () { return [zlh, wbytes, adler]; };\n// unzlib extra\nvar zule = function () { return [zlv]; };\n// post buf\nvar pbf = function (msg) { return postMessage(msg, [msg.buffer]); };\n// get u8\nvar gu8 = function (o) { return o && o.size && new u8(o.size); };\n// async helper\nvar cbify = function (dat, opts, fns, init, id, cb) {\n    var w = wrkr(fns, init, id, function (err, dat) {\n        w.terminate();\n        cb(err, dat);\n    });\n    w.postMessage([dat, opts], opts.consume ? [dat.buffer] : []);\n    return function () { w.terminate(); };\n};\n// auto stream\nvar astrm = function (strm) {\n    strm.ondata = function (dat, final) { return postMessage([dat, final], [dat.buffer]); };\n    return function (ev) { return strm.push(ev.data[0], ev.data[1]); };\n};\n// async stream attach\nvar astrmify = function (fns, strm, opts, init, id) {\n    var t;\n    var w = wrkr(fns, init, id, function (err, dat) {\n        if (err)\n            w.terminate(), strm.ondata.call(strm, err);\n        else {\n            if (dat[1])\n                w.terminate();\n            strm.ondata.call(strm, err, dat[0], dat[1]);\n        }\n    });\n    w.postMessage(opts);\n    strm.push = function (d, f) {\n        if (!strm.ondata)\n            err(5);\n        if (t)\n            strm.ondata(err(4, 0, 1), null, !!f);\n        w.postMessage([d, t = f], [d.buffer]);\n    };\n    strm.terminate = function () { w.terminate(); };\n};\n// read 2 bytes\nvar b2 = function (d, b) { return d[b] | (d[b + 1] << 8); };\n// read 4 bytes\nvar b4 = function (d, b) { return (d[b] | (d[b + 1] << 8) | (d[b + 2] << 16) | (d[b + 3] << 24)) >>> 0; };\nvar b8 = function (d, b) { return b4(d, b) + (b4(d, b + 4) * 4294967296); };\n// write bytes\nvar wbytes = function (d, b, v) {\n    for (; v; ++b)\n        d[b] = v, v >>>= 8;\n};\n// gzip header\nvar gzh = function (c, o) {\n    var fn = o.filename;\n    c[0] = 31, c[1] = 139, c[2] = 8, c[8] = o.level < 2 ? 4 : o.level == 9 ? 2 : 0, c[9] = 3; // assume Unix\n    if (o.mtime != 0)\n        wbytes(c, 4, Math.floor(new Date(o.mtime || Date.now()) / 1000));\n    if (fn) {\n        c[3] = 8;\n        for (var i = 0; i <= fn.length; ++i)\n            c[i + 10] = fn.charCodeAt(i);\n    }\n};\n// gzip footer: -8 to -4 = CRC, -4 to -0 is length\n// gzip start\nvar gzs = function (d) {\n    if (d[0] != 31 || d[1] != 139 || d[2] != 8)\n        err(6, 'invalid gzip data');\n    var flg = d[3];\n    var st = 10;\n    if (flg & 4)\n        st += d[10] | (d[11] << 8) + 2;\n    for (var zs = (flg >> 3 & 1) + (flg >> 4 & 1); zs > 0; zs -= !d[st++])\n        ;\n    return st + (flg & 2);\n};\n// gzip length\nvar gzl = function (d) {\n    var l = d.length;\n    return ((d[l - 4] | d[l - 3] << 8 | d[l - 2] << 16) | (d[l - 1] << 24)) >>> 0;\n};\n// gzip header length\nvar gzhl = function (o) { return 10 + ((o.filename && (o.filename.length + 1)) || 0); };\n// zlib header\nvar zlh = function (c, o) {\n    var lv = o.level, fl = lv == 0 ? 0 : lv < 6 ? 1 : lv == 9 ? 3 : 2;\n    c[0] = 120, c[1] = (fl << 6) | (fl ? (32 - 2 * fl) : 1);\n};\n// zlib valid\nvar zlv = function (d) {\n    if ((d[0] & 15) != 8 || (d[0] >>> 4) > 7 || ((d[0] << 8 | d[1]) % 31))\n        err(6, 'invalid zlib data');\n    if (d[1] & 32)\n        err(6, 'invalid zlib data: preset dictionaries not supported');\n};\nfunction AsyncCmpStrm(opts, cb) {\n    if (!cb && typeof opts == 'function')\n        cb = opts, opts = {};\n    this.ondata = cb;\n    return opts;\n}\n// zlib footer: -4 to -0 is Adler32\n/**\n * Streaming DEFLATE compression\n */\nvar Deflate = /*#__PURE__*/ (function () {\n    function Deflate(opts, cb) {\n        if (!cb && typeof opts == 'function')\n            cb = opts, opts = {};\n        this.ondata = cb;\n        this.o = opts || {};\n    }\n    Deflate.prototype.p = function (c, f) {\n        this.ondata(dopt(c, this.o, 0, 0, !f), f);\n    };\n    /**\n     * Pushes a chunk to be deflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Deflate.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            err(5);\n        if (this.d)\n            err(4);\n        this.d = final;\n        this.p(chunk, final || false);\n    };\n    return Deflate;\n}());\nexport { Deflate };\n/**\n * Asynchronous streaming DEFLATE compression\n */\nvar AsyncDeflate = /*#__PURE__*/ (function () {\n    function AsyncDeflate(opts, cb) {\n        astrmify([\n            bDflt,\n            function () { return [astrm, Deflate]; }\n        ], this, AsyncCmpStrm.call(this, opts, cb), function (ev) {\n            var strm = new Deflate(ev.data);\n            onmessage = astrm(strm);\n        }, 6);\n    }\n    return AsyncDeflate;\n}());\nexport { AsyncDeflate };\nexport function deflate(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bDflt,\n    ], function (ev) { return pbf(deflateSync(ev.data[0], ev.data[1])); }, 0, cb);\n}\n/**\n * Compresses data with DEFLATE without any wrapper\n * @param data The data to compress\n * @param opts The compression options\n * @returns The deflated version of the data\n */\nexport function deflateSync(data, opts) {\n    return dopt(data, opts || {}, 0, 0);\n}\n/**\n * Streaming DEFLATE decompression\n */\nvar Inflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates an inflation stream\n     * @param cb The callback to call whenever data is inflated\n     */\n    function Inflate(cb) {\n        this.s = {};\n        this.p = new u8(0);\n        this.ondata = cb;\n    }\n    Inflate.prototype.e = function (c) {\n        if (!this.ondata)\n            err(5);\n        if (this.d)\n            err(4);\n        var l = this.p.length;\n        var n = new u8(l + c.length);\n        n.set(this.p), n.set(c, l), this.p = n;\n    };\n    Inflate.prototype.c = function (final) {\n        this.d = this.s.i = final || false;\n        var bts = this.s.b;\n        var dt = inflt(this.p, this.o, this.s);\n        this.ondata(slc(dt, bts, this.s.b), this.d);\n        this.o = slc(dt, this.s.b - 32768), this.s.b = this.o.length;\n        this.p = slc(this.p, (this.s.p / 8) | 0), this.s.p &= 7;\n    };\n    /**\n     * Pushes a chunk to be inflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the final chunk\n     */\n    Inflate.prototype.push = function (chunk, final) {\n        this.e(chunk), this.c(final);\n    };\n    return Inflate;\n}());\nexport { Inflate };\n/**\n * Asynchronous streaming DEFLATE decompression\n */\nvar AsyncInflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates an asynchronous inflation stream\n     * @param cb The callback to call whenever data is deflated\n     */\n    function AsyncInflate(cb) {\n        this.ondata = cb;\n        astrmify([\n            bInflt,\n            function () { return [astrm, Inflate]; }\n        ], this, 0, function () {\n            var strm = new Inflate();\n            onmessage = astrm(strm);\n        }, 7);\n    }\n    return AsyncInflate;\n}());\nexport { AsyncInflate };\nexport function inflate(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bInflt\n    ], function (ev) { return pbf(inflateSync(ev.data[0], gu8(ev.data[1]))); }, 1, cb);\n}\n/**\n * Expands DEFLATE data with no wrapper\n * @param data The data to decompress\n * @param out Where to write the data. Saves memory if you know the decompressed size and provide an output buffer of that length.\n * @returns The decompressed version of the data\n */\nexport function inflateSync(data, out) {\n    return inflt(data, out);\n}\n// before you yell at me for not just using extends, my reason is that TS inheritance is hard to workerize.\n/**\n * Streaming GZIP compression\n */\nvar Gzip = /*#__PURE__*/ (function () {\n    function Gzip(opts, cb) {\n        this.c = crc();\n        this.l = 0;\n        this.v = 1;\n        Deflate.call(this, opts, cb);\n    }\n    /**\n     * Pushes a chunk to be GZIPped\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Gzip.prototype.push = function (chunk, final) {\n        Deflate.prototype.push.call(this, chunk, final);\n    };\n    Gzip.prototype.p = function (c, f) {\n        this.c.p(c);\n        this.l += c.length;\n        var raw = dopt(c, this.o, this.v && gzhl(this.o), f && 8, !f);\n        if (this.v)\n            gzh(raw, this.o), this.v = 0;\n        if (f)\n            wbytes(raw, raw.length - 8, this.c.d()), wbytes(raw, raw.length - 4, this.l);\n        this.ondata(raw, f);\n    };\n    return Gzip;\n}());\nexport { Gzip };\n/**\n * Asynchronous streaming GZIP compression\n */\nvar AsyncGzip = /*#__PURE__*/ (function () {\n    function AsyncGzip(opts, cb) {\n        astrmify([\n            bDflt,\n            gze,\n            function () { return [astrm, Deflate, Gzip]; }\n        ], this, AsyncCmpStrm.call(this, opts, cb), function (ev) {\n            var strm = new Gzip(ev.data);\n            onmessage = astrm(strm);\n        }, 8);\n    }\n    return AsyncGzip;\n}());\nexport { AsyncGzip };\nexport function gzip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bDflt,\n        gze,\n        function () { return [gzipSync]; }\n    ], function (ev) { return pbf(gzipSync(ev.data[0], ev.data[1])); }, 2, cb);\n}\n/**\n * Compresses data with GZIP\n * @param data The data to compress\n * @param opts The compression options\n * @returns The gzipped version of the data\n */\nexport function gzipSync(data, opts) {\n    if (!opts)\n        opts = {};\n    var c = crc(), l = data.length;\n    c.p(data);\n    var d = dopt(data, opts, gzhl(opts), 8), s = d.length;\n    return gzh(d, opts), wbytes(d, s - 8, c.d()), wbytes(d, s - 4, l), d;\n}\n/**\n * Streaming GZIP decompression\n */\nvar Gunzip = /*#__PURE__*/ (function () {\n    /**\n     * Creates a GUNZIP stream\n     * @param cb The callback to call whenever data is inflated\n     */\n    function Gunzip(cb) {\n        this.v = 1;\n        Inflate.call(this, cb);\n    }\n    /**\n     * Pushes a chunk to be GUNZIPped\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Gunzip.prototype.push = function (chunk, final) {\n        Inflate.prototype.e.call(this, chunk);\n        if (this.v) {\n            var s = this.p.length > 3 ? gzs(this.p) : 4;\n            if (s >= this.p.length && !final)\n                return;\n            this.p = this.p.subarray(s), this.v = 0;\n        }\n        if (final) {\n            if (this.p.length < 8)\n                err(6, 'invalid gzip data');\n            this.p = this.p.subarray(0, -8);\n        }\n        // necessary to prevent TS from using the closure value\n        // This allows for workerization to function correctly\n        Inflate.prototype.c.call(this, final);\n    };\n    return Gunzip;\n}());\nexport { Gunzip };\n/**\n * Asynchronous streaming GZIP decompression\n */\nvar AsyncGunzip = /*#__PURE__*/ (function () {\n    /**\n     * Creates an asynchronous GUNZIP stream\n     * @param cb The callback to call whenever data is deflated\n     */\n    function AsyncGunzip(cb) {\n        this.ondata = cb;\n        astrmify([\n            bInflt,\n            guze,\n            function () { return [astrm, Inflate, Gunzip]; }\n        ], this, 0, function () {\n            var strm = new Gunzip();\n            onmessage = astrm(strm);\n        }, 9);\n    }\n    return AsyncGunzip;\n}());\nexport { AsyncGunzip };\nexport function gunzip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bInflt,\n        guze,\n        function () { return [gunzipSync]; }\n    ], function (ev) { return pbf(gunzipSync(ev.data[0])); }, 3, cb);\n}\n/**\n * Expands GZIP data\n * @param data The data to decompress\n * @param out Where to write the data. GZIP already encodes the output size, so providing this doesn't save memory.\n * @returns The decompressed version of the data\n */\nexport function gunzipSync(data, out) {\n    return inflt(data.subarray(gzs(data), -8), out || new u8(gzl(data)));\n}\n/**\n * Streaming Zlib compression\n */\nvar Zlib = /*#__PURE__*/ (function () {\n    function Zlib(opts, cb) {\n        this.c = adler();\n        this.v = 1;\n        Deflate.call(this, opts, cb);\n    }\n    /**\n     * Pushes a chunk to be zlibbed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Zlib.prototype.push = function (chunk, final) {\n        Deflate.prototype.push.call(this, chunk, final);\n    };\n    Zlib.prototype.p = function (c, f) {\n        this.c.p(c);\n        var raw = dopt(c, this.o, this.v && 2, f && 4, !f);\n        if (this.v)\n            zlh(raw, this.o), this.v = 0;\n        if (f)\n            wbytes(raw, raw.length - 4, this.c.d());\n        this.ondata(raw, f);\n    };\n    return Zlib;\n}());\nexport { Zlib };\n/**\n * Asynchronous streaming Zlib compression\n */\nvar AsyncZlib = /*#__PURE__*/ (function () {\n    function AsyncZlib(opts, cb) {\n        astrmify([\n            bDflt,\n            zle,\n            function () { return [astrm, Deflate, Zlib]; }\n        ], this, AsyncCmpStrm.call(this, opts, cb), function (ev) {\n            var strm = new Zlib(ev.data);\n            onmessage = astrm(strm);\n        }, 10);\n    }\n    return AsyncZlib;\n}());\nexport { AsyncZlib };\nexport function zlib(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bDflt,\n        zle,\n        function () { return [zlibSync]; }\n    ], function (ev) { return pbf(zlibSync(ev.data[0], ev.data[1])); }, 4, cb);\n}\n/**\n * Compress data with Zlib\n * @param data The data to compress\n * @param opts The compression options\n * @returns The zlib-compressed version of the data\n */\nexport function zlibSync(data, opts) {\n    if (!opts)\n        opts = {};\n    var a = adler();\n    a.p(data);\n    var d = dopt(data, opts, 2, 4);\n    return zlh(d, opts), wbytes(d, d.length - 4, a.d()), d;\n}\n/**\n * Streaming Zlib decompression\n */\nvar Unzlib = /*#__PURE__*/ (function () {\n    /**\n     * Creates a Zlib decompression stream\n     * @param cb The callback to call whenever data is inflated\n     */\n    function Unzlib(cb) {\n        this.v = 1;\n        Inflate.call(this, cb);\n    }\n    /**\n     * Pushes a chunk to be unzlibbed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Unzlib.prototype.push = function (chunk, final) {\n        Inflate.prototype.e.call(this, chunk);\n        if (this.v) {\n            if (this.p.length < 2 && !final)\n                return;\n            this.p = this.p.subarray(2), this.v = 0;\n        }\n        if (final) {\n            if (this.p.length < 4)\n                err(6, 'invalid zlib data');\n            this.p = this.p.subarray(0, -4);\n        }\n        // necessary to prevent TS from using the closure value\n        // This allows for workerization to function correctly\n        Inflate.prototype.c.call(this, final);\n    };\n    return Unzlib;\n}());\nexport { Unzlib };\n/**\n * Asynchronous streaming Zlib decompression\n */\nvar AsyncUnzlib = /*#__PURE__*/ (function () {\n    /**\n     * Creates an asynchronous Zlib decompression stream\n     * @param cb The callback to call whenever data is deflated\n     */\n    function AsyncUnzlib(cb) {\n        this.ondata = cb;\n        astrmify([\n            bInflt,\n            zule,\n            function () { return [astrm, Inflate, Unzlib]; }\n        ], this, 0, function () {\n            var strm = new Unzlib();\n            onmessage = astrm(strm);\n        }, 11);\n    }\n    return AsyncUnzlib;\n}());\nexport { AsyncUnzlib };\nexport function unzlib(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bInflt,\n        zule,\n        function () { return [unzlibSync]; }\n    ], function (ev) { return pbf(unzlibSync(ev.data[0], gu8(ev.data[1]))); }, 5, cb);\n}\n/**\n * Expands Zlib data\n * @param data The data to decompress\n * @param out Where to write the data. Saves memory if you know the decompressed size and provide an output buffer of that length.\n * @returns The decompressed version of the data\n */\nexport function unzlibSync(data, out) {\n    return inflt((zlv(data), data.subarray(2, -4)), out);\n}\n// Default algorithm for compression (used because having a known output size allows faster decompression)\nexport { gzip as compress, AsyncGzip as AsyncCompress };\n// Default algorithm for compression (used because having a known output size allows faster decompression)\nexport { gzipSync as compressSync, Gzip as Compress };\n/**\n * Streaming GZIP, Zlib, or raw DEFLATE decompression\n */\nvar Decompress = /*#__PURE__*/ (function () {\n    /**\n     * Creates a decompression stream\n     * @param cb The callback to call whenever data is decompressed\n     */\n    function Decompress(cb) {\n        this.G = Gunzip;\n        this.I = Inflate;\n        this.Z = Unzlib;\n        this.ondata = cb;\n    }\n    /**\n     * Pushes a chunk to be decompressed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Decompress.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            err(5);\n        if (!this.s) {\n            if (this.p && this.p.length) {\n                var n = new u8(this.p.length + chunk.length);\n                n.set(this.p), n.set(chunk, this.p.length);\n            }\n            else\n                this.p = chunk;\n            if (this.p.length > 2) {\n                var _this_1 = this;\n                var cb = function () { _this_1.ondata.apply(_this_1, arguments); };\n                this.s = (this.p[0] == 31 && this.p[1] == 139 && this.p[2] == 8)\n                    ? new this.G(cb)\n                    : ((this.p[0] & 15) != 8 || (this.p[0] >> 4) > 7 || ((this.p[0] << 8 | this.p[1]) % 31))\n                        ? new this.I(cb)\n                        : new this.Z(cb);\n                this.s.push(this.p, final);\n                this.p = null;\n            }\n        }\n        else\n            this.s.push(chunk, final);\n    };\n    return Decompress;\n}());\nexport { Decompress };\n/**\n * Asynchronous streaming GZIP, Zlib, or raw DEFLATE decompression\n */\nvar AsyncDecompress = /*#__PURE__*/ (function () {\n    /**\n   * Creates an asynchronous decompression stream\n   * @param cb The callback to call whenever data is decompressed\n   */\n    function AsyncDecompress(cb) {\n        this.G = AsyncGunzip;\n        this.I = AsyncInflate;\n        this.Z = AsyncUnzlib;\n        this.ondata = cb;\n    }\n    /**\n     * Pushes a chunk to be decompressed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    AsyncDecompress.prototype.push = function (chunk, final) {\n        Decompress.prototype.push.call(this, chunk, final);\n    };\n    return AsyncDecompress;\n}());\nexport { AsyncDecompress };\nexport function decompress(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return (data[0] == 31 && data[1] == 139 && data[2] == 8)\n        ? gunzip(data, opts, cb)\n        : ((data[0] & 15) != 8 || (data[0] >> 4) > 7 || ((data[0] << 8 | data[1]) % 31))\n            ? inflate(data, opts, cb)\n            : unzlib(data, opts, cb);\n}\n/**\n * Expands compressed GZIP, Zlib, or raw DEFLATE data, automatically detecting the format\n * @param data The data to decompress\n * @param out Where to write the data. Saves memory if you know the decompressed size and provide an output buffer of that length.\n * @returns The decompressed version of the data\n */\nexport function decompressSync(data, out) {\n    return (data[0] == 31 && data[1] == 139 && data[2] == 8)\n        ? gunzipSync(data, out)\n        : ((data[0] & 15) != 8 || (data[0] >> 4) > 7 || ((data[0] << 8 | data[1]) % 31))\n            ? inflateSync(data, out)\n            : unzlibSync(data, out);\n}\n// flatten a directory structure\nvar fltn = function (d, p, t, o) {\n    for (var k in d) {\n        var val = d[k], n = p + k, op = o;\n        if (Array.isArray(val))\n            op = mrg(o, val[1]), val = val[0];\n        if (val instanceof u8)\n            t[n] = [val, op];\n        else {\n            t[n += '/'] = [new u8(0), op];\n            fltn(val, n, t, o);\n        }\n    }\n};\n// text encoder\nvar te = typeof TextEncoder != 'undefined' && /*#__PURE__*/ new TextEncoder();\n// text decoder\nvar td = typeof TextDecoder != 'undefined' && /*#__PURE__*/ new TextDecoder();\n// text decoder stream\nvar tds = 0;\ntry {\n    td.decode(et, { stream: true });\n    tds = 1;\n}\ncatch (e) { }\n// decode UTF8\nvar dutf8 = function (d) {\n    for (var r = '', i = 0;;) {\n        var c = d[i++];\n        var eb = (c > 127) + (c > 223) + (c > 239);\n        if (i + eb > d.length)\n            return [r, slc(d, i - 1)];\n        if (!eb)\n            r += String.fromCharCode(c);\n        else if (eb == 3) {\n            c = ((c & 15) << 18 | (d[i++] & 63) << 12 | (d[i++] & 63) << 6 | (d[i++] & 63)) - 65536,\n                r += String.fromCharCode(55296 | (c >> 10), 56320 | (c & 1023));\n        }\n        else if (eb & 1)\n            r += String.fromCharCode((c & 31) << 6 | (d[i++] & 63));\n        else\n            r += String.fromCharCode((c & 15) << 12 | (d[i++] & 63) << 6 | (d[i++] & 63));\n    }\n};\n/**\n * Streaming UTF-8 decoding\n */\nvar DecodeUTF8 = /*#__PURE__*/ (function () {\n    /**\n     * Creates a UTF-8 decoding stream\n     * @param cb The callback to call whenever data is decoded\n     */\n    function DecodeUTF8(cb) {\n        this.ondata = cb;\n        if (tds)\n            this.t = new TextDecoder();\n        else\n            this.p = et;\n    }\n    /**\n     * Pushes a chunk to be decoded from UTF-8 binary\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    DecodeUTF8.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            err(5);\n        final = !!final;\n        if (this.t) {\n            this.ondata(this.t.decode(chunk, { stream: true }), final);\n            if (final) {\n                if (this.t.decode().length)\n                    err(8);\n                this.t = null;\n            }\n            return;\n        }\n        if (!this.p)\n            err(4);\n        var dat = new u8(this.p.length + chunk.length);\n        dat.set(this.p);\n        dat.set(chunk, this.p.length);\n        var _a = dutf8(dat), ch = _a[0], np = _a[1];\n        if (final) {\n            if (np.length)\n                err(8);\n            this.p = null;\n        }\n        else\n            this.p = np;\n        this.ondata(ch, final);\n    };\n    return DecodeUTF8;\n}());\nexport { DecodeUTF8 };\n/**\n * Streaming UTF-8 encoding\n */\nvar EncodeUTF8 = /*#__PURE__*/ (function () {\n    /**\n     * Creates a UTF-8 decoding stream\n     * @param cb The callback to call whenever data is encoded\n     */\n    function EncodeUTF8(cb) {\n        this.ondata = cb;\n    }\n    /**\n     * Pushes a chunk to be encoded to UTF-8\n     * @param chunk The string data to push\n     * @param final Whether this is the last chunk\n     */\n    EncodeUTF8.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            err(5);\n        if (this.d)\n            err(4);\n        this.ondata(strToU8(chunk), this.d = final || false);\n    };\n    return EncodeUTF8;\n}());\nexport { EncodeUTF8 };\n/**\n * Converts a string into a Uint8Array for use with compression/decompression methods\n * @param str The string to encode\n * @param latin1 Whether or not to interpret the data as Latin-1. This should\n *               not need to be true unless decoding a binary string.\n * @returns The string encoded in UTF-8/Latin-1 binary\n */\nexport function strToU8(str, latin1) {\n    if (latin1) {\n        var ar_1 = new u8(str.length);\n        for (var i = 0; i < str.length; ++i)\n            ar_1[i] = str.charCodeAt(i);\n        return ar_1;\n    }\n    if (te)\n        return te.encode(str);\n    var l = str.length;\n    var ar = new u8(str.length + (str.length >> 1));\n    var ai = 0;\n    var w = function (v) { ar[ai++] = v; };\n    for (var i = 0; i < l; ++i) {\n        if (ai + 5 > ar.length) {\n            var n = new u8(ai + 8 + ((l - i) << 1));\n            n.set(ar);\n            ar = n;\n        }\n        var c = str.charCodeAt(i);\n        if (c < 128 || latin1)\n            w(c);\n        else if (c < 2048)\n            w(192 | (c >> 6)), w(128 | (c & 63));\n        else if (c > 55295 && c < 57344)\n            c = 65536 + (c & 1023 << 10) | (str.charCodeAt(++i) & 1023),\n                w(240 | (c >> 18)), w(128 | ((c >> 12) & 63)), w(128 | ((c >> 6) & 63)), w(128 | (c & 63));\n        else\n            w(224 | (c >> 12)), w(128 | ((c >> 6) & 63)), w(128 | (c & 63));\n    }\n    return slc(ar, 0, ai);\n}\n/**\n * Converts a Uint8Array to a string\n * @param dat The data to decode to string\n * @param latin1 Whether or not to interpret the data as Latin-1. This should\n *               not need to be true unless encoding to binary string.\n * @returns The original UTF-8/Latin-1 string\n */\nexport function strFromU8(dat, latin1) {\n    if (latin1) {\n        var r = '';\n        for (var i = 0; i < dat.length; i += 16384)\n            r += String.fromCharCode.apply(null, dat.subarray(i, i + 16384));\n        return r;\n    }\n    else if (td)\n        return td.decode(dat);\n    else {\n        var _a = dutf8(dat), out = _a[0], ext = _a[1];\n        if (ext.length)\n            err(8);\n        return out;\n    }\n}\n;\n// deflate bit flag\nvar dbf = function (l) { return l == 1 ? 3 : l < 6 ? 2 : l == 9 ? 1 : 0; };\n// skip local zip header\nvar slzh = function (d, b) { return b + 30 + b2(d, b + 26) + b2(d, b + 28); };\n// read zip header\nvar zh = function (d, b, z) {\n    var fnl = b2(d, b + 28), fn = strFromU8(d.subarray(b + 46, b + 46 + fnl), !(b2(d, b + 8) & 2048)), es = b + 46 + fnl, bs = b4(d, b + 20);\n    var _a = z && bs == 4294967295 ? z64e(d, es) : [bs, b4(d, b + 24), b4(d, b + 42)], sc = _a[0], su = _a[1], off = _a[2];\n    return [b2(d, b + 10), sc, su, fn, es + b2(d, b + 30) + b2(d, b + 32), off];\n};\n// read zip64 extra field\nvar z64e = function (d, b) {\n    for (; b2(d, b) != 1; b += 4 + b2(d, b + 2))\n        ;\n    return [b8(d, b + 12), b8(d, b + 4), b8(d, b + 20)];\n};\n// extra field length\nvar exfl = function (ex) {\n    var le = 0;\n    if (ex) {\n        for (var k in ex) {\n            var l = ex[k].length;\n            if (l > 65535)\n                err(9);\n            le += l + 4;\n        }\n    }\n    return le;\n};\n// write zip header\nvar wzh = function (d, b, f, fn, u, c, ce, co) {\n    var fl = fn.length, ex = f.extra, col = co && co.length;\n    var exl = exfl(ex);\n    wbytes(d, b, ce != null ? 0x2014B50 : 0x4034B50), b += 4;\n    if (ce != null)\n        d[b++] = 20, d[b++] = f.os;\n    d[b] = 20, b += 2; // spec compliance? what's that?\n    d[b++] = (f.flag << 1) | (c < 0 && 8), d[b++] = u && 8;\n    d[b++] = f.compression & 255, d[b++] = f.compression >> 8;\n    var dt = new Date(f.mtime == null ? Date.now() : f.mtime), y = dt.getFullYear() - 1980;\n    if (y < 0 || y > 119)\n        err(10);\n    wbytes(d, b, (y << 25) | ((dt.getMonth() + 1) << 21) | (dt.getDate() << 16) | (dt.getHours() << 11) | (dt.getMinutes() << 5) | (dt.getSeconds() >>> 1)), b += 4;\n    if (c != -1) {\n        wbytes(d, b, f.crc);\n        wbytes(d, b + 4, c < 0 ? -c - 2 : c);\n        wbytes(d, b + 8, f.size);\n    }\n    wbytes(d, b + 12, fl);\n    wbytes(d, b + 14, exl), b += 16;\n    if (ce != null) {\n        wbytes(d, b, col);\n        wbytes(d, b + 6, f.attrs);\n        wbytes(d, b + 10, ce), b += 14;\n    }\n    d.set(fn, b);\n    b += fl;\n    if (exl) {\n        for (var k in ex) {\n            var exf = ex[k], l = exf.length;\n            wbytes(d, b, +k);\n            wbytes(d, b + 2, l);\n            d.set(exf, b + 4), b += 4 + l;\n        }\n    }\n    if (col)\n        d.set(co, b), b += col;\n    return b;\n};\n// write zip footer (end of central directory)\nvar wzf = function (o, b, c, d, e) {\n    wbytes(o, b, 0x6054B50); // skip disk\n    wbytes(o, b + 8, c);\n    wbytes(o, b + 10, c);\n    wbytes(o, b + 12, d);\n    wbytes(o, b + 16, e);\n};\n/**\n * A pass-through stream to keep data uncompressed in a ZIP archive.\n */\nvar ZipPassThrough = /*#__PURE__*/ (function () {\n    /**\n     * Creates a pass-through stream that can be added to ZIP archives\n     * @param filename The filename to associate with this data stream\n     */\n    function ZipPassThrough(filename) {\n        this.filename = filename;\n        this.c = crc();\n        this.size = 0;\n        this.compression = 0;\n    }\n    /**\n     * Processes a chunk and pushes to the output stream. You can override this\n     * method in a subclass for custom behavior, but by default this passes\n     * the data through. You must call this.ondata(err, chunk, final) at some\n     * point in this method.\n     * @param chunk The chunk to process\n     * @param final Whether this is the last chunk\n     */\n    ZipPassThrough.prototype.process = function (chunk, final) {\n        this.ondata(null, chunk, final);\n    };\n    /**\n     * Pushes a chunk to be added. If you are subclassing this with a custom\n     * compression algorithm, note that you must push data from the source\n     * file only, pre-compression.\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    ZipPassThrough.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            err(5);\n        this.c.p(chunk);\n        this.size += chunk.length;\n        if (final)\n            this.crc = this.c.d();\n        this.process(chunk, final || false);\n    };\n    return ZipPassThrough;\n}());\nexport { ZipPassThrough };\n// I don't extend because TypeScript extension adds 1kB of runtime bloat\n/**\n * Streaming DEFLATE compression for ZIP archives. Prefer using AsyncZipDeflate\n * for better performance\n */\nvar ZipDeflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates a DEFLATE stream that can be added to ZIP archives\n     * @param filename The filename to associate with this data stream\n     * @param opts The compression options\n     */\n    function ZipDeflate(filename, opts) {\n        var _this_1 = this;\n        if (!opts)\n            opts = {};\n        ZipPassThrough.call(this, filename);\n        this.d = new Deflate(opts, function (dat, final) {\n            _this_1.ondata(null, dat, final);\n        });\n        this.compression = 8;\n        this.flag = dbf(opts.level);\n    }\n    ZipDeflate.prototype.process = function (chunk, final) {\n        try {\n            this.d.push(chunk, final);\n        }\n        catch (e) {\n            this.ondata(e, null, final);\n        }\n    };\n    /**\n     * Pushes a chunk to be deflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    ZipDeflate.prototype.push = function (chunk, final) {\n        ZipPassThrough.prototype.push.call(this, chunk, final);\n    };\n    return ZipDeflate;\n}());\nexport { ZipDeflate };\n/**\n * Asynchronous streaming DEFLATE compression for ZIP archives\n */\nvar AsyncZipDeflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates a DEFLATE stream that can be added to ZIP archives\n     * @param filename The filename to associate with this data stream\n     * @param opts The compression options\n     */\n    function AsyncZipDeflate(filename, opts) {\n        var _this_1 = this;\n        if (!opts)\n            opts = {};\n        ZipPassThrough.call(this, filename);\n        this.d = new AsyncDeflate(opts, function (err, dat, final) {\n            _this_1.ondata(err, dat, final);\n        });\n        this.compression = 8;\n        this.flag = dbf(opts.level);\n        this.terminate = this.d.terminate;\n    }\n    AsyncZipDeflate.prototype.process = function (chunk, final) {\n        this.d.push(chunk, final);\n    };\n    /**\n     * Pushes a chunk to be deflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    AsyncZipDeflate.prototype.push = function (chunk, final) {\n        ZipPassThrough.prototype.push.call(this, chunk, final);\n    };\n    return AsyncZipDeflate;\n}());\nexport { AsyncZipDeflate };\n// TODO: Better tree shaking\n/**\n * A zippable archive to which files can incrementally be added\n */\nvar Zip = /*#__PURE__*/ (function () {\n    /**\n     * Creates an empty ZIP archive to which files can be added\n     * @param cb The callback to call whenever data for the generated ZIP archive\n     *           is available\n     */\n    function Zip(cb) {\n        this.ondata = cb;\n        this.u = [];\n        this.d = 1;\n    }\n    /**\n     * Adds a file to the ZIP archive\n     * @param file The file stream to add\n     */\n    Zip.prototype.add = function (file) {\n        var _this_1 = this;\n        if (!this.ondata)\n            err(5);\n        // finishing or finished\n        if (this.d & 2)\n            this.ondata(err(4 + (this.d & 1) * 8, 0, 1), null, false);\n        else {\n            var f = strToU8(file.filename), fl_1 = f.length;\n            var com = file.comment, o = com && strToU8(com);\n            var u = fl_1 != file.filename.length || (o && (com.length != o.length));\n            var hl_1 = fl_1 + exfl(file.extra) + 30;\n            if (fl_1 > 65535)\n                this.ondata(err(11, 0, 1), null, false);\n            var header = new u8(hl_1);\n            wzh(header, 0, file, f, u, -1);\n            var chks_1 = [header];\n            var pAll_1 = function () {\n                for (var _i = 0, chks_2 = chks_1; _i < chks_2.length; _i++) {\n                    var chk = chks_2[_i];\n                    _this_1.ondata(null, chk, false);\n                }\n                chks_1 = [];\n            };\n            var tr_1 = this.d;\n            this.d = 0;\n            var ind_1 = this.u.length;\n            var uf_1 = mrg(file, {\n                f: f,\n                u: u,\n                o: o,\n                t: function () {\n                    if (file.terminate)\n                        file.terminate();\n                },\n                r: function () {\n                    pAll_1();\n                    if (tr_1) {\n                        var nxt = _this_1.u[ind_1 + 1];\n                        if (nxt)\n                            nxt.r();\n                        else\n                            _this_1.d = 1;\n                    }\n                    tr_1 = 1;\n                }\n            });\n            var cl_1 = 0;\n            file.ondata = function (err, dat, final) {\n                if (err) {\n                    _this_1.ondata(err, dat, final);\n                    _this_1.terminate();\n                }\n                else {\n                    cl_1 += dat.length;\n                    chks_1.push(dat);\n                    if (final) {\n                        var dd = new u8(16);\n                        wbytes(dd, 0, 0x8074B50);\n                        wbytes(dd, 4, file.crc);\n                        wbytes(dd, 8, cl_1);\n                        wbytes(dd, 12, file.size);\n                        chks_1.push(dd);\n                        uf_1.c = cl_1, uf_1.b = hl_1 + cl_1 + 16, uf_1.crc = file.crc, uf_1.size = file.size;\n                        if (tr_1)\n                            uf_1.r();\n                        tr_1 = 1;\n                    }\n                    else if (tr_1)\n                        pAll_1();\n                }\n            };\n            this.u.push(uf_1);\n        }\n    };\n    /**\n     * Ends the process of adding files and prepares to emit the final chunks.\n     * This *must* be called after adding all desired files for the resulting\n     * ZIP file to work properly.\n     */\n    Zip.prototype.end = function () {\n        var _this_1 = this;\n        if (this.d & 2) {\n            this.ondata(err(4 + (this.d & 1) * 8, 0, 1), null, true);\n            return;\n        }\n        if (this.d)\n            this.e();\n        else\n            this.u.push({\n                r: function () {\n                    if (!(_this_1.d & 1))\n                        return;\n                    _this_1.u.splice(-1, 1);\n                    _this_1.e();\n                },\n                t: function () { }\n            });\n        this.d = 3;\n    };\n    Zip.prototype.e = function () {\n        var bt = 0, l = 0, tl = 0;\n        for (var _i = 0, _a = this.u; _i < _a.length; _i++) {\n            var f = _a[_i];\n            tl += 46 + f.f.length + exfl(f.extra) + (f.o ? f.o.length : 0);\n        }\n        var out = new u8(tl + 22);\n        for (var _b = 0, _c = this.u; _b < _c.length; _b++) {\n            var f = _c[_b];\n            wzh(out, bt, f, f.f, f.u, -f.c - 2, l, f.o);\n            bt += 46 + f.f.length + exfl(f.extra) + (f.o ? f.o.length : 0), l += f.b;\n        }\n        wzf(out, bt, this.u.length, tl, l);\n        this.ondata(null, out, true);\n        this.d = 2;\n    };\n    /**\n     * A method to terminate any internal workers used by the stream. Subsequent\n     * calls to add() will fail.\n     */\n    Zip.prototype.terminate = function () {\n        for (var _i = 0, _a = this.u; _i < _a.length; _i++) {\n            var f = _a[_i];\n            f.t();\n        }\n        this.d = 2;\n    };\n    return Zip;\n}());\nexport { Zip };\nexport function zip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    var r = {};\n    fltn(data, '', r, opts);\n    var k = Object.keys(r);\n    var lft = k.length, o = 0, tot = 0;\n    var slft = lft, files = new Array(lft);\n    var term = [];\n    var tAll = function () {\n        for (var i = 0; i < term.length; ++i)\n            term[i]();\n    };\n    var cbd = function (a, b) {\n        mt(function () { cb(a, b); });\n    };\n    mt(function () { cbd = cb; });\n    var cbf = function () {\n        var out = new u8(tot + 22), oe = o, cdl = tot - o;\n        tot = 0;\n        for (var i = 0; i < slft; ++i) {\n            var f = files[i];\n            try {\n                var l = f.c.length;\n                wzh(out, tot, f, f.f, f.u, l);\n                var badd = 30 + f.f.length + exfl(f.extra);\n                var loc = tot + badd;\n                out.set(f.c, loc);\n                wzh(out, o, f, f.f, f.u, l, tot, f.m), o += 16 + badd + (f.m ? f.m.length : 0), tot = loc + l;\n            }\n            catch (e) {\n                return cbd(e, null);\n            }\n        }\n        wzf(out, o, files.length, cdl, oe);\n        cbd(null, out);\n    };\n    if (!lft)\n        cbf();\n    var _loop_1 = function (i) {\n        var fn = k[i];\n        var _a = r[fn], file = _a[0], p = _a[1];\n        var c = crc(), size = file.length;\n        c.p(file);\n        var f = strToU8(fn), s = f.length;\n        var com = p.comment, m = com && strToU8(com), ms = m && m.length;\n        var exl = exfl(p.extra);\n        var compression = p.level == 0 ? 0 : 8;\n        var cbl = function (e, d) {\n            if (e) {\n                tAll();\n                cbd(e, null);\n            }\n            else {\n                var l = d.length;\n                files[i] = mrg(p, {\n                    size: size,\n                    crc: c.d(),\n                    c: d,\n                    f: f,\n                    m: m,\n                    u: s != fn.length || (m && (com.length != ms)),\n                    compression: compression\n                });\n                o += 30 + s + exl + l;\n                tot += 76 + 2 * (s + exl) + (ms || 0) + l;\n                if (!--lft)\n                    cbf();\n            }\n        };\n        if (s > 65535)\n            cbl(err(11, 0, 1), null);\n        if (!compression)\n            cbl(null, file);\n        else if (size < 160000) {\n            try {\n                cbl(null, deflateSync(file, p));\n            }\n            catch (e) {\n                cbl(e, null);\n            }\n        }\n        else\n            term.push(deflate(file, p, cbl));\n    };\n    // Cannot use lft because it can decrease\n    for (var i = 0; i < slft; ++i) {\n        _loop_1(i);\n    }\n    return tAll;\n}\n/**\n * Synchronously creates a ZIP file. Prefer using `zip` for better performance\n * with more than one file.\n * @param data The directory structure for the ZIP archive\n * @param opts The main options, merged with per-file options\n * @returns The generated ZIP archive\n */\nexport function zipSync(data, opts) {\n    if (!opts)\n        opts = {};\n    var r = {};\n    var files = [];\n    fltn(data, '', r, opts);\n    var o = 0;\n    var tot = 0;\n    for (var fn in r) {\n        var _a = r[fn], file = _a[0], p = _a[1];\n        var compression = p.level == 0 ? 0 : 8;\n        var f = strToU8(fn), s = f.length;\n        var com = p.comment, m = com && strToU8(com), ms = m && m.length;\n        var exl = exfl(p.extra);\n        if (s > 65535)\n            err(11);\n        var d = compression ? deflateSync(file, p) : file, l = d.length;\n        var c = crc();\n        c.p(file);\n        files.push(mrg(p, {\n            size: file.length,\n            crc: c.d(),\n            c: d,\n            f: f,\n            m: m,\n            u: s != fn.length || (m && (com.length != ms)),\n            o: o,\n            compression: compression\n        }));\n        o += 30 + s + exl + l;\n        tot += 76 + 2 * (s + exl) + (ms || 0) + l;\n    }\n    var out = new u8(tot + 22), oe = o, cdl = tot - o;\n    for (var i = 0; i < files.length; ++i) {\n        var f = files[i];\n        wzh(out, f.o, f, f.f, f.u, f.c.length);\n        var badd = 30 + f.f.length + exfl(f.extra);\n        out.set(f.c, f.o + badd);\n        wzh(out, o, f, f.f, f.u, f.c.length, f.o, f.m), o += 16 + badd + (f.m ? f.m.length : 0);\n    }\n    wzf(out, o, files.length, cdl, oe);\n    return out;\n}\n/**\n * Streaming pass-through decompression for ZIP archives\n */\nvar UnzipPassThrough = /*#__PURE__*/ (function () {\n    function UnzipPassThrough() {\n    }\n    UnzipPassThrough.prototype.push = function (data, final) {\n        this.ondata(null, data, final);\n    };\n    UnzipPassThrough.compression = 0;\n    return UnzipPassThrough;\n}());\nexport { UnzipPassThrough };\n/**\n * Streaming DEFLATE decompression for ZIP archives. Prefer AsyncZipInflate for\n * better performance.\n */\nvar UnzipInflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates a DEFLATE decompression that can be used in ZIP archives\n     */\n    function UnzipInflate() {\n        var _this_1 = this;\n        this.i = new Inflate(function (dat, final) {\n            _this_1.ondata(null, dat, final);\n        });\n    }\n    UnzipInflate.prototype.push = function (data, final) {\n        try {\n            this.i.push(data, final);\n        }\n        catch (e) {\n            this.ondata(e, null, final);\n        }\n    };\n    UnzipInflate.compression = 8;\n    return UnzipInflate;\n}());\nexport { UnzipInflate };\n/**\n * Asynchronous streaming DEFLATE decompression for ZIP archives\n */\nvar AsyncUnzipInflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates a DEFLATE decompression that can be used in ZIP archives\n     */\n    function AsyncUnzipInflate(_, sz) {\n        var _this_1 = this;\n        if (sz < 320000) {\n            this.i = new Inflate(function (dat, final) {\n                _this_1.ondata(null, dat, final);\n            });\n        }\n        else {\n            this.i = new AsyncInflate(function (err, dat, final) {\n                _this_1.ondata(err, dat, final);\n            });\n            this.terminate = this.i.terminate;\n        }\n    }\n    AsyncUnzipInflate.prototype.push = function (data, final) {\n        if (this.i.terminate)\n            data = slc(data, 0);\n        this.i.push(data, final);\n    };\n    AsyncUnzipInflate.compression = 8;\n    return AsyncUnzipInflate;\n}());\nexport { AsyncUnzipInflate };\n/**\n * A ZIP archive decompression stream that emits files as they are discovered\n */\nvar Unzip = /*#__PURE__*/ (function () {\n    /**\n     * Creates a ZIP decompression stream\n     * @param cb The callback to call whenever a file in the ZIP archive is found\n     */\n    function Unzip(cb) {\n        this.onfile = cb;\n        this.k = [];\n        this.o = {\n            0: UnzipPassThrough\n        };\n        this.p = et;\n    }\n    /**\n     * Pushes a chunk to be unzipped\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Unzip.prototype.push = function (chunk, final) {\n        var _this_1 = this;\n        if (!this.onfile)\n            err(5);\n        if (!this.p)\n            err(4);\n        if (this.c > 0) {\n            var len = Math.min(this.c, chunk.length);\n            var toAdd = chunk.subarray(0, len);\n            this.c -= len;\n            if (this.d)\n                this.d.push(toAdd, !this.c);\n            else\n                this.k[0].push(toAdd);\n            chunk = chunk.subarray(len);\n            if (chunk.length)\n                return this.push(chunk, final);\n        }\n        else {\n            var f = 0, i = 0, is = void 0, buf = void 0;\n            if (!this.p.length)\n                buf = chunk;\n            else if (!chunk.length)\n                buf = this.p;\n            else {\n                buf = new u8(this.p.length + chunk.length);\n                buf.set(this.p), buf.set(chunk, this.p.length);\n            }\n            var l = buf.length, oc = this.c, add = oc && this.d;\n            var _loop_2 = function () {\n                var _a;\n                var sig = b4(buf, i);\n                if (sig == 0x4034B50) {\n                    f = 1, is = i;\n                    this_1.d = null;\n                    this_1.c = 0;\n                    var bf = b2(buf, i + 6), cmp_1 = b2(buf, i + 8), u = bf & 2048, dd = bf & 8, fnl = b2(buf, i + 26), es = b2(buf, i + 28);\n                    if (l > i + 30 + fnl + es) {\n                        var chks_3 = [];\n                        this_1.k.unshift(chks_3);\n                        f = 2;\n                        var sc_1 = b4(buf, i + 18), su_1 = b4(buf, i + 22);\n                        var fn_1 = strFromU8(buf.subarray(i + 30, i += 30 + fnl), !u);\n                        if (sc_1 == 4294967295) {\n                            _a = dd ? [-2] : z64e(buf, i), sc_1 = _a[0], su_1 = _a[1];\n                        }\n                        else if (dd)\n                            sc_1 = -1;\n                        i += es;\n                        this_1.c = sc_1;\n                        var d_1;\n                        var file_1 = {\n                            name: fn_1,\n                            compression: cmp_1,\n                            start: function () {\n                                if (!file_1.ondata)\n                                    err(5);\n                                if (!sc_1)\n                                    file_1.ondata(null, et, true);\n                                else {\n                                    var ctr = _this_1.o[cmp_1];\n                                    if (!ctr)\n                                        file_1.ondata(err(14, 'unknown compression type ' + cmp_1, 1), null, false);\n                                    d_1 = sc_1 < 0 ? new ctr(fn_1) : new ctr(fn_1, sc_1, su_1);\n                                    d_1.ondata = function (err, dat, final) { file_1.ondata(err, dat, final); };\n                                    for (var _i = 0, chks_4 = chks_3; _i < chks_4.length; _i++) {\n                                        var dat = chks_4[_i];\n                                        d_1.push(dat, false);\n                                    }\n                                    if (_this_1.k[0] == chks_3 && _this_1.c)\n                                        _this_1.d = d_1;\n                                    else\n                                        d_1.push(et, true);\n                                }\n                            },\n                            terminate: function () {\n                                if (d_1 && d_1.terminate)\n                                    d_1.terminate();\n                            }\n                        };\n                        if (sc_1 >= 0)\n                            file_1.size = sc_1, file_1.originalSize = su_1;\n                        this_1.onfile(file_1);\n                    }\n                    return \"break\";\n                }\n                else if (oc) {\n                    if (sig == 0x8074B50) {\n                        is = i += 12 + (oc == -2 && 8), f = 3, this_1.c = 0;\n                        return \"break\";\n                    }\n                    else if (sig == 0x2014B50) {\n                        is = i -= 4, f = 3, this_1.c = 0;\n                        return \"break\";\n                    }\n                }\n            };\n            var this_1 = this;\n            for (; i < l - 4; ++i) {\n                var state_1 = _loop_2();\n                if (state_1 === \"break\")\n                    break;\n            }\n            this.p = et;\n            if (oc < 0) {\n                var dat = f ? buf.subarray(0, is - 12 - (oc == -2 && 8) - (b4(buf, is - 16) == 0x8074B50 && 4)) : buf.subarray(0, i);\n                if (add)\n                    add.push(dat, !!f);\n                else\n                    this.k[+(f == 2)].push(dat);\n            }\n            if (f & 2)\n                return this.push(buf.subarray(i), final);\n            this.p = buf.subarray(i);\n        }\n        if (final) {\n            if (this.c)\n                err(13);\n            this.p = null;\n        }\n    };\n    /**\n     * Registers a decoder with the stream, allowing for files compressed with\n     * the compression type provided to be expanded correctly\n     * @param decoder The decoder constructor\n     */\n    Unzip.prototype.register = function (decoder) {\n        this.o[decoder.compression] = decoder;\n    };\n    return Unzip;\n}());\nexport { Unzip };\nvar mt = typeof queueMicrotask == 'function' ? queueMicrotask : typeof setTimeout == 'function' ? setTimeout : function (fn) { fn(); };\nexport function unzip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    var term = [];\n    var tAll = function () {\n        for (var i = 0; i < term.length; ++i)\n            term[i]();\n    };\n    var files = {};\n    var cbd = function (a, b) {\n        mt(function () { cb(a, b); });\n    };\n    mt(function () { cbd = cb; });\n    var e = data.length - 22;\n    for (; b4(data, e) != 0x6054B50; --e) {\n        if (!e || data.length - e > 65558) {\n            cbd(err(13, 0, 1), null);\n            return tAll;\n        }\n    }\n    ;\n    var lft = b2(data, e + 8);\n    if (lft) {\n        var c = lft;\n        var o = b4(data, e + 16);\n        var z = o == 4294967295 || c == 65535;\n        if (z) {\n            var ze = b4(data, e - 12);\n            z = b4(data, ze) == 0x6064B50;\n            if (z) {\n                c = lft = b4(data, ze + 32);\n                o = b4(data, ze + 48);\n            }\n        }\n        var fltr = opts && opts.filter;\n        var _loop_3 = function (i) {\n            var _a = zh(data, o, z), c_1 = _a[0], sc = _a[1], su = _a[2], fn = _a[3], no = _a[4], off = _a[5], b = slzh(data, off);\n            o = no;\n            var cbl = function (e, d) {\n                if (e) {\n                    tAll();\n                    cbd(e, null);\n                }\n                else {\n                    if (d)\n                        files[fn] = d;\n                    if (!--lft)\n                        cbd(null, files);\n                }\n            };\n            if (!fltr || fltr({\n                name: fn,\n                size: sc,\n                originalSize: su,\n                compression: c_1\n            })) {\n                if (!c_1)\n                    cbl(null, slc(data, b, b + sc));\n                else if (c_1 == 8) {\n                    var infl = data.subarray(b, b + sc);\n                    if (sc < 320000) {\n                        try {\n                            cbl(null, inflateSync(infl, new u8(su)));\n                        }\n                        catch (e) {\n                            cbl(e, null);\n                        }\n                    }\n                    else\n                        term.push(inflate(infl, { size: su }, cbl));\n                }\n                else\n                    cbl(err(14, 'unknown compression type ' + c_1, 1), null);\n            }\n            else\n                cbl(null, null);\n        };\n        for (var i = 0; i < c; ++i) {\n            _loop_3(i);\n        }\n    }\n    else\n        cbd(null, {});\n    return tAll;\n}\n/**\n * Synchronously decompresses a ZIP archive. Prefer using `unzip` for better\n * performance with more than one file.\n * @param data The raw compressed ZIP file\n * @param opts The ZIP extraction options\n * @returns The decompressed files\n */\nexport function unzipSync(data, opts) {\n    var files = {};\n    var e = data.length - 22;\n    for (; b4(data, e) != 0x6054B50; --e) {\n        if (!e || data.length - e > 65558)\n            err(13);\n    }\n    ;\n    var c = b2(data, e + 8);\n    if (!c)\n        return {};\n    var o = b4(data, e + 16);\n    var z = o == 4294967295 || c == 65535;\n    if (z) {\n        var ze = b4(data, e - 12);\n        z = b4(data, ze) == 0x6064B50;\n        if (z) {\n            c = b4(data, ze + 32);\n            o = b4(data, ze + 48);\n        }\n    }\n    var fltr = opts && opts.filter;\n    for (var i = 0; i < c; ++i) {\n        var _a = zh(data, o, z), c_2 = _a[0], sc = _a[1], su = _a[2], fn = _a[3], no = _a[4], off = _a[5], b = slzh(data, off);\n        o = no;\n        if (!fltr || fltr({\n            name: fn,\n            size: sc,\n            originalSize: su,\n            compression: c_2\n        })) {\n            if (!c_2)\n                files[fn] = slc(data, b, b + sc);\n            else if (c_2 == 8)\n                files[fn] = inflateSync(data.subarray(b, b + sc), new u8(su));\n            else\n                err(14, 'unknown compression type ' + c_2);\n        }\n    }\n    return files;\n}\n","import { fileURLToPath } from 'url'\nimport { AbstractFileSystemAdapter } from './AbstractFileSystemAdapter'\nimport { unzlibSync } from 'fflate'\n\ninterface FileInfo {\n    file: string\n    isDir: boolean\n    dir?: string[]\n}\n\nexport class HTTPFSAdapter implements AbstractFileSystemAdapter {\n\n    static path2info = new Map<string, FileInfo>()\n\n    readFile(pathname: string): string {\n        if (pathname.endsWith(\".z\")) {\n            // console.log(`load compressed file ${pathname}`)\n            const req = new XMLHttpRequest()\n            req.overrideMimeType('text/plain; charset=x-user-defined')\n            req.open('GET', pathname, false)\n            req.send(null)\n            if (req.status > 400) {\n                throw new Error(`Request failed for '${pathname}': ${req.statusText}`)\n            }\n            const ab = new ArrayBuffer(req.responseText.length)\n            const ua = new Uint8Array(ab)\n            for (let i = 0; i < req.responseText.length; ++i) {\n                ua[i] = req.responseText.charCodeAt(i)\n            }\n            const dec = new TextDecoder(\"utf-8\")\n            return dec.decode(unzlibSync(ua))\n        }\n        if (pathname.endsWith(\"/directory.json\")) {\n            // console.log(`load uncompressed file ${pathname}`)\n            const req = new XMLHttpRequest()\n            req.open('GET', pathname, false)\n            req.send(null)\n            if (req.status < 400)\n                return req.responseText\n            throw new Error(`Request failed for '${pathname}': ${req.statusText}`)\n        }\n        return this.readFile(`${pathname}.z`)\n    }\n    isFile(pathname: string): boolean {\n        // console.log(`HTTPJSFSAdapter.isFile('${pathname}')`)\n        let info = HTTPFSAdapter.path2info.get(pathname)\n        if (info === undefined) {\n            try {\n                this.listDir(pathname)\n            }\n            catch(e) {\n                console.log(`failed to load directory ${pathname}`)\n                HTTPFSAdapter.path2info.forEach( (value, key) => console.log(key, value))\n                throw Error()\n            }\n            info = HTTPFSAdapter.path2info.get(pathname)\n        }\n        if (info === undefined) {\n            throw Error(`HTTPJSFSAdapter.isFile('${pathname}')`)\n        }\n        return !info.isDir\n    }\n    isDir(pathname: string): boolean {\n        // console.log(`HTTPJSFSAdapter.isDir('${pathname}')`)\n        const info = HTTPFSAdapter.path2info.get(pathname)\n        if (info === undefined) {\n            throw Error(`HTTPJSFSAdapter.isFile('${pathname}')`)\n        }\n        return info.isDir\n    }\n    listDir(pathname: string): string[] {\n        // console.log(`HTTPJSFSAdapter.listDir('${pathname}')`)\n\n        let info = HTTPFSAdapter.path2info.get(pathname)\n        if (info !== undefined && info.dir !== undefined) {\n            return info.dir\n        }\n\n        if (info === undefined)\n            info = { file: '', isDir: true, dir: undefined }\n\n        const d = this.readFile(`data/${pathname}/directory.json`)\n        const j = JSON.parse(d)\n        info.dir = []\n        for (const x of j) {\n            const fullfile = `${pathname}/${x.file}`\n            // console.log(`${pathname}/${x.file}`)\n            info.dir.push(x.file)\n            if (!x.isDir)\n                HTTPFSAdapter.path2info.set(fullfile, { file: x.file, isDir: false })\n        }\n        HTTPFSAdapter.path2info.set(pathname, info)\n        return info.dir\n    }\n    realPath(pathname: string): string {\n        // console.log(`HTTPJSFSAdapter.realPath('${pathname}')`)\n        // throw Error()\n        return pathname\n    }\n    joinPath(pathname1: string, pathname2: string): string {\n        // console.log(`HTTPJSFSAdapter.joinPath('${pathname1}', '${pathname2}')`)\n        return `${pathname1}/${pathname2}`\n    }\n}\n","import { Human } from './modifier/Human'\nimport { TargetFactory } from './target/TargetFactory'\nimport { loadSkeleton } from './skeleton/loadSkeleton'\nimport { loadModifiers } from './modifier/loadModifiers'\nimport { loadSliders, SliderNode } from './modifier/loadSliders'\nimport { HumanMesh, Update } from './mesh/HumanMesh'\nimport { RenderMode } from './render/RenderMode'\nimport { exportCollada } from 'mesh/Collada'\nimport { loadProxy } from 'proxy/Proxy'\n\nimport { PoseNode, PoseTreeAdapter } from 'ui/poseView'\nimport { SliderTreeAdapter } from 'ui/morphView'\nimport { render } from './render/render'\n\nimport { FileSystemAdapter } from './filesystem/FileSystemAdapter'\nimport { HTTPFSAdapter } from './filesystem/HTTPFSAdapter'\n\nimport { Table } from 'toad.js/table/Table'\nimport { TreeNodeModel } from 'toad.js/table/model/TreeNodeModel'\nimport { TreeAdapter } from \"toad.js/table/adapter/TreeAdapter\"\nimport { EnumModel } from \"toad.js/model/EnumModel\"\nimport { Fragment, ref } from \"toad.jsx\"\nimport { Tab, Tabs } from 'toad.js/view/Tab'\nimport { Text } from \"toad.js/view/Text\"\nimport { Slider } from \"toad.js/view/Slider\"\nimport { BooleanModel, Button, Checkbox, Signal } from 'toad.js'\n\nwindow.onload = () => { main() }\n\nexport function main() {\n    try {\n        run()\n    }\n    catch (e) {\n        console.log(e)\n        if (e instanceof Error)\n            alert(`${e.name}: ${e.message}`)\n        else\n            alert(e)\n    }\n}\n\n// core/mhmain.py\n//   class MHApplication\n//     startupSequence()\nfunction run() {\n    console.log('loading assets...')\n    FileSystemAdapter.setInstance(new HTTPFSAdapter())\n\n    const human = new Human()\n    const scene = new HumanMesh(human)\n    human.scene = scene\n\n    // scene.proxies.set(\"Proxymeshes\", loadProxy(human, \"data/proxymeshes/proxy741/proxy741.proxy\", \"Proxymeshes\"))\n    // scene.proxies.set(\"Proxymeshes\", loadProxy(human, \"data/proxymeshes/female_generic/female_generic.proxy\", \"Proxymeshes\"))\n    // scene.proxies.set(\"Eyes\", loadProxy(human, \"data/eyes/high-poly/high-poly.mhclo\", \"Eyes\"))\n    // scene.proxies.set(\"Teeth\", loadProxy(human, \"data/teeth/teeth_base/teeth_base.mhclo\", \"Teeth\"))\n    // scene.proxies.set(\"Tongue\", loadProxy(human, \"data/tongue/tongue01/tongue01.mhclo\", \"Tongue\"))\n\n    human.modified.add(() => scene.updateRequired = Update.MORPH)\n\n    const skeleton = loadSkeleton(scene, 'data/rigs/default.mhskel')\n    scene.skeleton = skeleton\n\n    // humanmodifier.loadModifiers(getpath.getSysDataPath('modifiers/modeling_modifiers.json'), app.selectedHuman)\n    loadModifiers(human, 'data/modifiers/modeling_modifiers.json')\n    loadModifiers(human, 'data/modifiers/measurement_modifiers.json')\n\n    // guimodifier.loadModifierTaskViews(getpath.getSysDataPath('modifiers/modeling_sliders.json'), app.selectedHuman, category)\n    const sliderNodes = loadSliders(human, 'data/modifiers/modeling_sliders.json')\n\n    loadMacroTargets()\n\n    // TargetFactory.getInstance()\n    // const vertexCopy = [scene.vertex]\n\n    console.log('everything is loaded...')\n\n    TreeAdapter.register(SliderTreeAdapter, TreeNodeModel, SliderNode)\n    TreeAdapter.register(PoseTreeAdapter, TreeNodeModel, PoseNode)\n\n    const renderMode = new EnumModel<RenderMode>(RenderMode, RenderMode.POLYGON)\n\n    const morphControls = new TreeNodeModel(SliderNode, sliderNodes)\n\n    const poseChanged = new Signal<PoseNode>()\n    poseChanged.add((poseNode) => {\n        // console.log(`Bone ${poseNode.bone.name} changed to ${poseNode.x.value}, ${poseNode.y.value}, ${poseNode.z.value}`)\n        if (scene.updateRequired === Update.NONE) {\n            scene.updateRequired = Update.POSE\n        }\n    })\n    const poseNodes = new PoseNode(skeleton.roots[0], poseChanged)\n    const poseControls = new TreeNodeModel(PoseNode, poseNodes)\n\n    const teethProxy = new BooleanModel(true)\n    const toungeProxy = new BooleanModel(false)\n    const eyesProxy = new BooleanModel(true)\n    const skinProxy = new BooleanModel(true)\n\n    teethProxy.modified.add(() => {\n        console.log(`teeth proxy changed to ${teethProxy.value}`)\n    })\n\n    const jaw = poseNodes.find(\"jaw\")!\n\n    const download = makeDownloadAnchor()\n    const refCanvas = new class { canvas!: HTMLCanvasElement }\n    const mainScreen = <>\n        <Tabs model={renderMode} style={{ position: 'absolute', left: 0, width: '500px', top: 0, bottom: 0 }}>\n            {/* <Tab label=\"Debug\" value=\"DEBUG\">\n                <p>\n                jaw <Text model={jaw.x} style={{ width: '50px'}}/><Slider model={jaw.x} style={{ width: '200px' }}/>\n                </p>\n                <p>\n                    <Button action={() => downloadBaseMesh(scene, download)}>Export morphed and rigged base mesh</Button>\n                </p>\n            </Tab> */}\n            <Tab label=\"Morph\" value=\"POLYGON\">\n                <Table model={morphControls} style={{ width: '100%', height: '100%' }} />\n            </Tab>\n            <Tab label=\"Pose\" value=\"WIREFRAME\">\n                <Table model={poseControls} style={{ width: '100%', height: '100%' }} />\n            </Tab>\n            <Tab label=\"Export\" value=\"WIREFRAME\">\n                <div style={{ padding: \"10px\" }}>\n                    WiP: Only the base mesh is exported.<br />\n                    Upcoming: Proxy meshes:\n                    <table>\n                        <tr>\n                            <td><Checkbox model={teethProxy} /></td><td>Teeth</td>\n                        </tr>\n                        <tr>\n                            <td><Checkbox model={toungeProxy} /></td><td>Tounge</td>\n                        </tr>\n                        <tr>\n                            <td><Checkbox model={eyesProxy} /></td><td>Eyes</td>\n                        </tr>\n                        <tr>\n                            <td><Checkbox model={skinProxy} /></td><td>Skin</td>\n                        </tr>\n                    </table>\n                    <Button action={() => downloadCollada(scene, download)}>Export Collada</Button>\n                </div>\n            </Tab>\n        </Tabs>\n        <div style={{ position: 'absolute', left: '500px', right: 0, top: 0, bottom: 0, overflow: 'hidden' }}>\n            <canvas set={ref(refCanvas, 'canvas')} style={{ width: '100%', height: '100%' }} />\n        </div>\n    </> as Fragment\n    mainScreen.appendTo(document.body)\n    render(refCanvas.canvas, scene, renderMode)\n}\n\nfunction makeDownloadAnchor() {\n    const download = document.createElement(\"a\")\n    download.type = \"text/plain\"\n    download.style.display = \"hidden\"\n    download.download = \"makehuman.dae\"\n    return download\n}\n\nfunction downloadCollada(scene: HumanMesh, download: HTMLAnchorElement) {\n    download.download = \"makehuman.dae\"\n    download.href = URL.createObjectURL(new Blob([exportCollada(scene)], { type: 'text/plain' }))\n    download.dispatchEvent(new MouseEvent(\"click\"))\n}\n\nfunction downloadBaseMesh(scene: HumanMesh, download: HTMLAnchorElement) {\n    download.download = \"vertex.json\"\n    download.href = URL.createObjectURL(new Blob([JSON.stringify(scene.vertexRigged)], { type: 'text/plain' }))\n    download.dispatchEvent(new MouseEvent(\"click\"))\n}\n\n//\n// more makehuman stuff i need to figure out:\n//\n\nfunction loadMacroTargets() {\n    const targetFactory = TargetFactory.getInstance()\n    // for target in targets.getTargets().findTargets('macrodetails'):\n    for (const target of targetFactory.findTargets('macrodetails')) {\n        //         #log.debug('Preloading target %s', getpath.getRelativePath(target.path))\n        //         algos3d.getTarget(self.selectedHuman.meshData, target.path)\n        // console.log(target.path)\n        // target.getTarget()\n    }\n}\n"],"names":["Reference","constructor","object","attribute","this","toString","get","set","value","Object","defineProperty","fromString","type","outValue","Number","parseFloat","Error","ref","Fragment","Array","props","super","children","i","length","e","document","createTextNode","replaceIn","element","childNodes","removeChild","appendTo","child","appendChild","jsx","nameOrConstructor","key","undefined","jsxs","namespace","name","tag","createElementNS","entries","setAction","setModel","classList","add","skey","svalue","regex","replace","upperCase","toLowerCase","style","setProperty","substring","addEventListener","substr","setAttributeNS","setInitialProperties","SignalLink","callback","id","Signal","callbacks","push","remove","splice","count","lock","locked","unlock","triggered","data","trigger","Model","_enabled","modified","enabled","GenericModel","_value","NumberModel","options","min","max","step","increment","decrement","Human","age","gender","weight","muscle","height","breastSize","breastFirmness","bodyProportions","caucasianVal","asianVal","africanVal","maleVal","femaleVal","oldVal","babyVal","youngVal","childVal","maxweightVal","minweightVal","averageweightVal","maxmuscleVal","minmuscleVal","averagemuscleVal","maxheightVal","minheightVal","averageheightVal","maxcupVal","mincupVal","averagecupVal","maxfirmnessVal","minfirmnessVal","averagefirmnessVal","idealproportionsVal","uncommonproportionsVal","regularproportionsVal","flag","_setDependendValues","_setGenderVals","_setAgeVals","_setMuscleVals","_setWeightVals","_setHeightVals","_setBreastSizeVals","_setBreastFirmnessVals","_setBodyProportionVals","_setEthnicVals","modifiers","Map","modifierGroups","targetsDetailStack","getModifier","getModifiersByGroup","groupName","group","console","log","addModifier","modifier","has","fullName","setDetail","targetName","delete","getDetail","setDefaultValues","Math","exclude","_setEthnicValsCore","remaining","otherTotal","abs","updateProxyMesh","fitToPosed","StringToLineIterator","index","next","done","nextIndex","indexOf","result","StringToLine","Symbol","iterator","FileSystemAdapter","static","instance","Target","verts","load","filename","getInstance","readFile","reader","line","trim","tokens","split","parseInt","apply","scale","dataIndex","vertexIndex","categoryData","race","breastsize","breastfirmness","bodyproportions","validCategories","valueToCategory","category","hasOwnProperty","Component","parent","slice","isRoot","createChild","update","setData","addKey","tuple","s","getVariables","orig","finish","pathname","path","TargetFactory","rootComponent","images","targets","groups","loadTargetDirectory","size","walkTargets","buildIndex","findTargets","partialGroup","entry","concat","getTargetsByGroup","root","base","fs","directoryPath","realPath","dir","listDir","sort","p","joinPath","isFile","endsWith","item","parts","part","isDir","nextRoot","a","target","component","includes","targetBuffer","EPSILON","ARRAY_TYPE","Float32Array","create","out","glMatrix.ARRAY_TYPE","identity","invert","a00","a01","a02","a03","a10","a11","a12","a13","a20","a21","a22","a23","a30","a31","a32","a33","b00","b01","b02","b03","b04","b05","b06","b07","b08","b09","b10","b11","det","multiply","b","b0","b1","b2","b3","translate","v","x","y","z","rotate","rad","axis","c","t","b12","b20","b21","b22","len","hypot","glMatrix.EPSILON","sin","cos","arguments","sqrt","perspective","fovy","aspect","near","far","nf","f","tan","Infinity","mul","fromValues","subtract","normalize","cross","ax","ay","az","bx","by","bz","transformMat4","m","w","sub","vec","Bone","skeleton","parentName","headJoint","tailJoint","roll","reference_bones","weight_reference_bones","headPos","tailPos","updateJointPositions","getBone","level","matPose","mat4.identity","mat4.create","planes","in_rest","getJointPosition","build","ref_skel","head3","vec3.fromValues","tail3","normal","get_normal","matRestGlobal","head","tail","bone_direction","vec3.subtract","vec3.create","vec3.normalize","norm","z_axis","vec3.cross","x_axis","m00","m01","m02","m03","m10","m11","m12","m13","m20","m21","m22","m23","m30","m31","m32","m33","getMatrix","vec3.distance","matRestRelative","mat4.mul","mat4.invert","yvector4","vec4.fromValues","matPoseGlobal","mat4.multiply","matPoseVerts","plane_name","skel","plane_defs","warn","joint_names","j1","j2","j3","p1","vec3.scale","a2vec3","p2","p3","pvec","yvec","VertexBoneWeights","info","version","description","copyright","license","_data","_build_vertex_weights_data","weights","_calculate_num_weights","vertexWeightsDict","vertexCount","rootBone","vcount","bone_name","getOwnPropertyNames","forEach","vertex_index","_vertexCount","totalWeightPerVertex","fill","vertex_weight","boneWeights","bname","vgroup","v_lookup","vn","wn","v_idx","i_s","map","filter","vs","ws","rw_i","Skeleton","scene","bones","roots","joint_pos_idxs","plane_map_strategy","has_custom_weights","tags","joint_name","joints","v_idxs","plane","breadthfirst_bones_set","Set","breadthfirst_bones","prev_len","bone_defs","missing","rotation_plane","JSON","stringify","addBone","reference","weights_reference","weights_file","json","parse","error","vertexWeights","rest_coord","meshCoords","getRestposeCoordinates","boneslist","bone","getBones","updateJoints","buildBoneList","queue","shift","trace","skinMesh","vertBoneMapping","coords","mapping","vert","vec3.transformMat4","loadSkeleton","parseSkeleton","getTargetWeights","factors","ignoreNotfound","factorDependencies","factor","targetPath","css","strings","values","str","createElement","text","div","span","input","button","ul","li","ns","svg","d","x1","y1","x2","y2","stroke","l","BooleanModel","TextModel","promise","HtmlModel","Action","title","signal","placeHolder","getAttribute","nodeName","attributeOrUndefined","globalController","modelId2Models","modelId2Views","view2ModelIds","sigChanged","registerAction","actionId","action","_registerModel","registerModel","modelId","model","modelsForModelId","viewsForModelId","view","registerView","controller","modelIdsForView","modelsForView","unregisterView","modelIds","views","clear","bind","html","boolean","number","AnimationBase","_stop","_firstFrame","_animationFrame","start","prepare","requestAnimationFrame","stop","animator","current","clearCurrent","animation","animationFrame","lastFrame","firstFrame","window","time","startTime","elapsed","animationFrameCount","ease","_current","k","PI","AnimationWrapper","Animator","run","animationBase","previousAnimation","halt","OptionModelBase","_stringValue","stringValue","isValidStringValue","EnumModel","enumClass","setValue","getValue","allValidValues","keys","validValue","View","HTMLElement","customElements","define","attachStyle","shadowRoot","importNode","getModelId","hasAttribute","getActionId","connectedCallback","disconnectedCallback","ModelView","init","updateModel","updateView","isConnected","ActionView","Function","isEnabled","textContent","Text","oninput","wheel","onwheel","attachShadow","mode","txText","deltaY","preventDefault","focus","blur","observedAttributes","attributeChangedCallback","oldValue","newValue","setAttribute","strValue","textAreaStyle","TextTool","texttool","toolbar","_jsx","class","buttonH1","onclick","execCommand","buttonH2","buttonH3","buttonH4","buttonBold","buttonItalic","buttonUnderline","buttonStrikeThrough","buttonSubscript","buttonSuperscript","buttonJustifyLeft","_jsxs","viewBox","width","buttonJustifyCenter","buttonJustifyRight","toggle","queryCommandValue","queryCommandState","TextArea","content","contentEditable","event","firstChild","nodeType","innerHTML","onkeydown","metaKey","updateTextTool","shiftKey","onkeyup","onmouseup","innerText","Display","Button","label","disabled","txButton","_observer","MutationObserver","record","observer","_timer","clearTimeout","setTimeout","observe","childList","subtree","characterData","BooleanView","checked","removeAttribute","Checkbox","onchange","checkmark","txCheckbox","Search","s0","s1","form","placeholder","autocomplete","txSearch","Switch","txSwitch","RadioButton","txRadio","radioGroup","radioGroups","radioGroupCounter","MenuState","WeakMap","MenuButtonContainer","vertical","closeOnClose","state","WAIT","PopupMenu","parentButton","popup","node","down","isAvailable","createWindowAt","deleteWindow","show","master","parentBoundary","getBoundingClientRect","opacity","left","top","popupBoundary","innerHeight","innerWidth","placePopupHorizontal","placePopupVertical","display","hide","Select","asPopupMenu","onblur","ev","hover","close","tabIndex","outline","onpointerdown","open","setPointerCapture","pointerId","onpointermove","elementFromPoint","clientX","clientY","newHover","HTMLLIElement","onpointerup","idx","dataset","select","contains","keydown","txCombobox","txMenu","asComboBox","readOnly","previousItem","nextItem","property","removeProperty","displayName","option","all","u","times","array","ariaRoleDescription","position","zIndex","HTMLOptionElement","getIndex","Slider","txSlider","String","GenericTool","viewParents","parentElement","distance","closestParent","closestTool","closestToolDistance","MAX_SAFE_INTEGER","closestToolList","tool","allTools","canHandle","toolParent","depth","toolDistance","viewIndex","closestNextSiblingIndex","MIN_SAFE_INTEGER","toolIndex","setActive","from","activeTool","deactivate","activeView","activate","relatedTarget","focusOut","focusIn","toolbuttonStyle","ToolButton","img","onmousedown","src","SlotView","ToadIf","Tabs","setTab","slot","tabContainer","tab","tabLabel","stopPropagation","cancelBubble","activeTab","activePanel","txTabs","markerLine","adjustLine","panel","offsetTop","clientHeight","offsetLeft","clientWidth","Tab","menuStyle","btoa","MenuButton","menuButton","documentMouseUp","removeEventListener","capture","buttonDown","dispatchEvent","MouseEvent","DOWN","UP_N_HOLD","active","DOWN_N_HOLD","documentMouseDown","tagName","collapse","DOWN_N_OUTSIDE","DOWN_N_INSIDE_AGAIN","onmouseout","inside","onmouseover","insertBefore","openPopup","closePopup","oldActive","MenuNode","shortcut","parentView","flexGrow","Menu","config","config2nodes","referenceActions","createShadowDOM","layout2nodes","newnode","dom.attribute","dom.attributeOrUndefined","space","findNode","strpos","right","n","MenuSpacer","TableModel","isEmpty","colCount","rowCount","TableEditMode","EditMode","TableEventType","TablePos","col","row","SelectionModel","EDIT_CELL","TypedTableModel","nodeClass","TableAdapterConfig","editMode","EDIT_ON_FOCUS","seamless","expandColumn","expandRow","TableAdapter","getColumnHead","getRowHead","showCell","pos","cell","saveCell","editCell","isViewCompact","adapter","typeToModel","modelToAdapter","dataType","typeToAdapter","getPrototypeOf","baseClass","msg","modelX","typeToAdapterX","typeX","adapterX","TableFriend","table","measure","getStaging","bodyStaging","getHeadStaging","headStaging","body","splitBody","colHeads","rowHeads","colResizeHandles","rowResizeHandles","animationDone","selection","setCellSize","h","clearAnimation","TableAnimation","prepareStagingWithRows","prepareBodyStaging","prepareRowHeadStaging","addStaging","scrollStaging","prepareStagingWithColumns","prepareColHeadStaging","className","disposeStaging","removeStaging","makeRowMask","mask","boxSizing","border","backgroundColor","Table","maskColor","makeColumnMask","bottom","InsertAnimation","prepareCellsToBeMeasured","prepareStaging","arrangeInStaging","animate","animationStart","totalSize","join","joinHeader","joinBody","InsertRowAnimation","initialRowCount","splitHead","headMask","prepareMinCellSize","rowHeaders","colHeaders","createCell","calculateMinCellSize","overlap","px2float","colWidth","bounds","minCellWidth","rowHeadWidth","rowHeight","minCellHeight","ceil","colHeadHeight","WIDTH_ADJUST","HEIGHT_ADJUST","splitHorizontalNew","lastElementChild","RemoveRowAnimation","joinHorizontal","initialHeight","bottomCell","removeAll","arrangeRowsInStaging","splitHorizontal","topSplitBody","animationHeight","topMask","cellCount","bottomOfStaging","replaceChildren","moveSplitBodyToBody","moveSplitHeadToHead","InsertColumnAnimation","previousColCount","px2int","totalWidth","columnWidth","splitVerticalNew","bodyWidth","stagingWidth","splitWidth","bodyInsertAt","beforeChild","RemoveColumnAnimation","joinVertical","initialWidth","arrangeColumnsInStaging","splitVertical","leftSplitBody","animationWidth","leftMask","firstCellOfStaging","lastCellOfStaging","rightOfStaging","scrollIntoView","scrollableParent","el","isScrollable","findScrollableParent","parentRect","clientRect","GAP","clientLeft","scrollLeft","clientRight","clientTop","scrollTop","clientBottom","parentWidth","parentHeight","calculateScrollGoal","scrollable","startX","startY","activeGoal","concurrentScroll","scrollX","pageXOffset","scrollY","pageYOffset","deltaX","nx","ny","scrollTo","animateStep","smoothScroll","getComputedStyle","scrollBy","behavior","idSource","Date","now","userAgent","ROUNDING_TOLERANCE","navigator","RegExp","test","isScrollableY","hasScrollableSpace","canOverflow","isScrollableX","scrollWidth","scrollHeight","overflowValue","isVisible","HANDLE_SIZE","HANDLE_SKEW","visible","arrangeAllMeasuredInGrid","hostKeyDown","cellKeyDown","cellFocus","pointerDown","handleDown","handleMove","handleUp","setHeadingFillerSizeToScrollbarSize","selectionChanged","modelChanged","onresize","onscroll","delegatesFocus","txTable","selectionModel","mutations","allTables","prepareCells","attributes","SELECT_CELL","elements","editing","EDIT_ON_ENTER","clientPosToTablePos","getModel","lookup","activeElement","hasFocus","SELECT_ROW","CELL_CHANGED","INSERT_ROW","REMOVE_ROW","INSERT_COL","REMOVE_COL","prepareColumnHeads","prepareRowHeads","prepareBody","colWidths","calculateColumnWidths","rowHeights","calculateRowHeights","placeColumnHeads","placeRowHeads","placeBody","placeBodyCells","measureLineHeight","columnHeaders","onfocus","caretColor","rh","withinBody","idxStart","cw","seam","filler","handle","createHandle","rowHandle","handleIndex","deltaHandle","deltaSplitBody","deltaSplitHead","deltaColumn","xLimit","yLimit","splitCol","splitHeadVertical","splitBodyVertical","splitColor","colsToSplit","boundary","splitColumn","extra","splitBodyColumns","cloneNode","delta","splitRow","splitHeadHorizontal","splitBodyHorizontal","cellAtBottom","splitBodyRows","last","bf","isRowEditInterface","isColumnEditInterface","buttonAddRowAbove","lastActiveTable","insertRow","buttonAddRowBelow","buttonDeleteRow","removeRow","buttonAddColumnLeft","insertColumn","buttonAddColumnRight","buttonDeleteColumn","removeColumn","buttonAddNodeAbove","buttonAddNodeBelow","buttonAddNodeParent","buttonAddNodeChild","buttonDeleteNode","AbstractTypedTableAdapter","TypedTableAdapter","TableEvent","RowInfo","TreeModel","rows","createRowInfoHelper","getRow","addSiblingBefore","nn","createNode","setRoot","setNext","getRoot","unshift","getNext","setDown","addSiblingAfter","nodeCount","getDown","addChildAfter","subtreeSize","addParentBefore","deleteAt","append","toggleAt","closeAt","openAt","isOpen","r","newRows","createRowInfo","getVisibleChildCount","rowinfo","rowInfo","getVisibleChildCountHelper","chain","TreeAdapter","treeCell","_showCell","labelNode","verticalAlign","padding","sx","rs","dx","dy","round","svgNode","background","x0","box","rect","cursor","minus","plus","rowNumber","lines","j","backgroundRepeat","TreeNodeModel","deleteNode","Modifier","defaultValue","setHuman","human","getMin","getMax","skipDependencies","clampedValue","clampValue","getFactors","tWeights","propagateUpdate","resetValue","getDefaultValue","realtime","sum","buildLists","faces","updateValue","updateNormals","skipUpdate","getSymmetrySide","getSymmetricOpposite","getSimilar","isMacro","macroVariable","ManagedTargetModifier","targetWeights","rTargets","lTargets","desc","getOwnPropertyDescriptors","TargetRef","targetsList","targetgroup","factordependencies","MacroModifier","macroDependencies","_a","findMacroDependencies","getMacroVariable","EthnicModifier","UniversalModifier","leftExt","rightExt","centerExt","center","fullTargetName","cTargets","loadModifiers","classesMapping","modifierGroup","modifierDef","modifierClass","modifierType","macrovar","mid","parseModifiers","SliderNode","modifierSpec","mod","capitalize","toUpperCase","labelFromModifier","tlabel","pop","loadSliders","rootNode","lastTabNode","tabKey","tabValue","sortOrder","tabNode","lastCategoryNode","categoryKey","categoryValue","categoryNode","lastSliderNode","sliderNode","parseSliders","Group","startIndex","WavefrontObj","faceGroups","vertex","texture","indices","material","uvIndices0","uvIndices","lineNumber","logStatistics","getFaceGroup","g","groupNames","helpers","startsWith","Update","RenderMode","BaseMeshGroup","HumanMesh","proxies","updateRequired","NONE","obj","baseMesh","vertexRigged","vertexMorphed","MORPH","isNaN","getTarget","exportCollada","geometry","Geometry","proxy","materials","SKIN","EYEBALL0","EYEBALL1","getCoords","mesh","getVertexWeights","TOUNGE","toISOString","colladaEffects","colladaMaterials","prepareMesh","meshName","objectName","meshPositionsName","meshPositionsArrayName","meshVerticesName","repeat","colladaGeometries","allBoneNames","ibmAll","mat2txt","ibm","trimEnd","boneWeightPairs","weightMap","prepareControllerInit","prepareControllerAddBoneWeights","prepareControllerFlatWeightMap","flatBoneWeightList","vertexData","boneWeightPair","prepareControllerFlatBoneWeight","skinName","armatureName","skinJointsName","skinJointsArrayName","skinIbmName","skinIbmArrayName","skinWeightsName","skinWeightsArrayName","colladaControllers","sceneName","dumpBone","colladaVisualScenes","indexMap","addPoint","origIndex","newIndex","ptr","addMesh","addQuad","currentMesh","getQuad","quad","p0","startCoord","indexEnd","boneMap","boneData","boneName","block","zipForEach","_index","weightIndex","indent","connectWithParent","is","indentStr","indentToString","bsm","childrenToConnectWith","vec4.transformMat4","vec4.create","childHead","a0","a1","a2","a3","boneGlobalVec","vec4.sub","PoseNode","updateBone","tmp","mat4.fromXRotation","mat4.fromYRotation","mat4.fromZRotation","find","_b","childBone","PoseTreeAdapter","_Fragment","SliderTreeAdapter","AbstractShader","gl","vertexShaderSrc","fragmentShaderSrc","program","createProgram","vertexShader","compileShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","vertexPosition","getAttribLocation","vertexNormal","projectionMatrix","getUniformLocation","modelViewMatrix","normalMatrix","vertices","normales","FLOAT","bindBuffer","ARRAY_BUFFER","vertexAttribPointer","enableVertexAttribArray","ELEMENT_ARRAY_BUFFER","useProgram","uniformMatrix4fv","source","shader","createShader","shaderSource","getShaderParameter","COMPILE_STATUS","deleteShader","getShaderInfoLog","location","RGBAShader","rgbaVertexShaderSrc","rgbaFragmentShaderSrc","_color","color","rgba","uniform4fv","TextureShader","textureVertexShaderSrc","textureFragmentShaderSrc","textureCoord","uSampler","activeTexture","TEXTURE0","bindTexture","TEXTURE_2D","uniform1i","num","stride","offset","calculateNormals","addNormal","normals","i1","i2","i3","normalIndex","RenderMesh","createBuffer","STATIC_DRAW","Uint16Array","updateBuffer","draw","programInfo","drawSubset","drawElements","UNSIGNED_SHORT","usage","buffer","bufferData","cubeRotation","render","canvas","getContext","pixelStorei","UNPACK_FLIP_Y_WEBGL","programRGBA","programTex","buffers","vx","ix","ux","skeletonIndex","buildBase","texCube","createTexturedCubeRenderer","createAllBuffers","url","createTexture","internalFormat","RGBA","srcFormat","srcType","UNSIGNED_BYTE","pixel","Uint8Array","texImage2D","image","Image","onload","isPowerOf2","generateMipmap","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","LINEAR","loadTexture","then","deltaTime","renderMesh","updateBuffers","renderMode","prepareCanvas","viewport","clearColor","clearDepth","enable","DEPTH_TEST","depthFunc","LEQUAL","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","prepareViewport","fieldOfView","zNear","zFar","mat4.perspective","createProjectionMatrix","DEBUG","mat4.translate","mat4.rotate","createModelViewMatrix","mat4.transpose","createNormalMatrix","skin","glMode","POLYGON","TRIANGLES","WIREFRAME","LINES","TEETH_TOP","TEETH_BOTTOM","CUBE","LINE_STRIP","drawScene","vi","ii","renderSkeletonGlobal","vertexOffset","u8","u16","u32","Uint32Array","fleb","fdeb","clim","freb","eb","fl","revfl","fd","rev","hMap","cd","mb","co","le","rvb","sv","r_1","flt","fdt","flrm","fdrm","bits","o","bits16","ec","err","ind","nt","code","captureStackTrace","inflt","dat","buf","st","sl","noBuf","noSt","cbuf","bl","nbuf","final","bt","lm","dm","lbt","dbt","tbts","subarray","hLit","hcLen","tl","ldt","clt","clb","clbmsk","clm","lt","dt","lms","dms","lpos","sym","dsym","end","BYTES_PER_ELEMENT","slc","et","unzlibSync","td","TextDecoder","decode","stream","HTTPFSAdapter","req","XMLHttpRequest","overrideMimeType","send","status","statusText","ab","ArrayBuffer","responseText","ua","charCodeAt","path2info","file","fullfile","pathname1","pathname2","main","setInstance","sliderNodes","targetFactory","loadMacroTargets","register","morphControls","poseChanged","poseNode","POSE","poseNodes","poseControls","teethProxy","toungeProxy","eyesProxy","skinProxy","download","makeDownloadAnchor","refCanvas","assign","href","URL","createObjectURL","Blob","downloadCollada","overflow","alert","message"],"mappings":"uCAAO,MAAMA,EACTC,YAAYC,EAAQC,GAChBC,KAAKF,OAASA,EACdE,KAAKD,UAAYA,EAAUE,UAC9B,CACDC,MACI,OAAOF,KAAKF,OAAOE,KAAKD,UAC3B,CACDI,IAAIC,GACAC,OAAOC,eAAeN,KAAKF,OAAQE,KAAKD,UAAW,CAAEK,MAAOA,GAC/D,CACDH,WACI,MAAO,GAAGD,KAAKF,OAAOE,KAAKD,YAC9B,CACDQ,WAAWH,GACP,MAAMI,SAAcR,KAAKF,OAAOE,KAAKD,WACrC,IAAIU,EACJ,OAAQD,GACJ,IAAK,SACDC,EAAWL,EACX,MACJ,IAAK,SACDK,EAAWC,OAAOC,WAAWP,GAC7B,MACJ,QACI,MAAMQ,MAAM,uDAAuDJ,KAE3EH,OAAOC,eAAeN,KAAKF,OAAQE,KAAKD,UAAW,CAAEK,MAAOK,GAC/D,EAEE,SAASI,EAAIf,EAAQC,GACxB,OAAO,IAAIH,EAAUE,EAAQC,EACjC,CAIO,MAAMe,UAAiBC,MAC1BlB,YAAYmB,GACRC,SAASD,GAAOE,UAChB,IAAK,IAAIC,EAAI,EAAGA,EAAInB,KAAKoB,SAAUD,EAAG,CAClC,MAAME,EAAIrB,KAAKmB,GACE,iBAANE,IACPrB,KAAKmB,GAAKG,SAASC,eAAeF,GAEzC,CACJ,CACDG,UAAUC,GACN,KAAOA,EAAQC,WAAWN,OAAS,GAC/BK,EAAQE,YAAYF,EAAQC,WAAWD,EAAQC,WAAWN,OAAS,IAEvEpB,KAAK4B,SAASH,EACjB,CACDG,SAASH,GACL,IAAK,IAAII,KAAS7B,KACdyB,EAAQK,YAAYD,EAE3B,EAEE,SAASE,EAAIC,EAAmBhB,EAAOiB,GAI1C,YAHcC,IAAVlB,QAA0CkB,IAAnBlB,EAAME,WAC7BF,EAAME,SAAW,CAACF,EAAME,WAErBiB,EAAKH,EAAmBhB,EACnC,CACO,SAASmB,EAAKH,EAAmBhB,EAAOiB,GAC3C,IAAIG,EACJ,GAAiC,iBAAtBJ,EACP,OAAO,IAAIA,EAAkBhB,GAEjC,MAAMqB,EAAOL,EACb,OAAQK,GACJ,IAAK,MACL,IAAK,OACL,IAAK,OACL,IAAK,SACL,IAAK,OACL,IAAK,OACDD,EAAY,6BACZ,MACJ,QACIA,EAAY,+BAEpB,MAAME,EAAMhB,SAASiB,gBAAgBH,EAAWC,GAEhD,OAEG,SAA8BZ,EAAST,EAAOoB,GACjD,GAAIpB,QACA,OACJ,IAAK,IAAKiB,EAAK7B,KAAUC,OAAOmC,QAAQxB,GACpC,OAAQiB,GACJ,IAAK,WACD,MACJ,IAAK,SACDR,EAAQgB,UAAUrC,GAClB,MACJ,IAAK,QACDqB,EAAQiB,SAAStC,GACjB,MACJ,IAAK,QACDqB,EAAQkB,UAAUC,IAAIxC,GACtB,MACJ,IAAK,QACD,IAAK,IAAKyC,EAAMC,KAAWzC,OAAOmC,QAAQpC,GAAQ,CAC9C,MAAM2C,EAAQ,SACdF,EAAOA,EAAKG,QAAQD,GAAQE,GAAc,IAAMA,EAAUC,gBAC1DzB,EAAQ0B,MAAMC,YAAYP,EAAMC,EACnC,CACD,MACJ,IAAK,MACDzC,OAAOC,eAAeU,EAAMb,IAAIL,OAAQkB,EAAMb,IAAIJ,UAAW,CAAEK,MAAOqB,IACtE,MACJ,QACI,GAA4B,OAAxBQ,EAAIoB,UAAU,EAAG,GACjB5B,EAAQ6B,iBAAiBrB,EAAIsB,OAAO,GAAInD,QAGxC,GAAqB,iBAAVA,EAAoB,CAC3B,GAAkB,+BAAdgC,EAA4C,CAC5C,MAAMW,EAAQ,SACdd,EAAMA,EAAIe,QAAQD,GAAQE,GAAc,IAAMA,EAAUC,eAC3D,CACDzB,EAAQ+B,eAAe,KAAMvB,EAAK,GAAG7B,IACxC,EAIjB,QAAuB8B,IAAnBlB,EAAME,SACN,IAAK,IAAIW,KAASb,EAAME,SACC,iBAAVW,EACPJ,EAAQK,YAAYR,SAASC,eAAeM,IAG5CJ,EAAQK,YAAYD,EAIpC,CAtDI4B,CAAqBnB,EAAKtB,EAAOoB,GAC1BE,CACX,CCrFO,MAAMoB,EACT7D,YAAY8D,EAAUC,GAClB5D,KAAK2D,SAAWA,EAChB3D,KAAK4D,GAAKA,CACb,EAEE,MAAMC,EACTjB,IAAIe,EAAUC,GACL5D,KAAK8D,YACN9D,KAAK8D,UAAY,IAAI/C,OACzBf,KAAK8D,UAAUC,KAAK,IAAIL,EAAWC,EAAUC,GAChD,CACDI,OAAOJ,GACH,GAAK5D,KAAK8D,UAEV,IAAK,IAAI3C,EAAInB,KAAK8D,UAAU1C,OAAS,EAAGD,GAAK,IAAKA,EAC1CnB,KAAK8D,UAAU3C,GAAGyC,KAAOA,GACzB5D,KAAK8D,UAAUG,OAAO9C,EAAG,EAEpC,CACD+C,QACI,OAAKlE,KAAK8D,UAEH9D,KAAK8D,UAAU1C,OADX,CAEd,CACD+C,OACInE,KAAKoE,QAAS,CACjB,CACDC,SAEI,GADArE,KAAKoE,YAASlC,EACVlC,KAAKsE,UAAW,CAChB,IAAIC,EAAOvE,KAAKsE,UAAUC,KAC1BvE,KAAKsE,eAAYpC,EACjBlC,KAAKwE,QAAQD,EAChB,CACJ,CACDC,QAAQD,GACJ,GAAIvE,KAAKoE,OACLpE,KAAKsE,UAAY,CAAEC,KAAMA,QAG7B,GAAKvE,KAAK8D,UAEV,IAAK,IAAI3C,EAAI,EAAGA,EAAInB,KAAK8D,UAAU1C,SAAUD,EACzCnB,KAAK8D,UAAU3C,GAAGwC,SAASY,EAClC,EC5CE,MAAME,EACT5E,cACIG,KAAK0E,UAAW,EAChB1E,KAAK2E,SAAW,IAAId,CACvB,CACGe,YAAQA,GACJ5E,KAAK0E,UAAYE,IAErB5E,KAAK0E,SAAWE,EAChB5E,KAAK2E,SAASH,aAAQtC,GACzB,CACG0C,cACA,OAAO5E,KAAK0E,QACf,ECbE,MAAMG,UAAqBJ,EAC9B5E,YAAYO,GACRa,QACAjB,KAAK8E,OAAS1E,CACjB,CACGA,UAAMA,GACFJ,KAAK8E,QAAU1E,IAEnBJ,KAAK8E,OAAS1E,EACdJ,KAAK2E,SAASH,UACjB,CACGpE,YACA,OAAOJ,KAAK8E,MACf,ECbE,MAAMC,UAAoBF,EAC7BhF,YAAYO,EAAO4E,GACf/D,MAAMb,GACF4E,IACAhF,KAAKiF,IAAMD,EAAQC,IACnBjF,KAAKkF,IAAMF,EAAQE,IACnBlF,KAAKmF,KAAOH,EAAQG,KAE3B,CACDC,iBACsBlD,IAAdlC,KAAKmF,OACLnF,KAAKI,OAASJ,KAAKmF,KAE1B,CACDE,iBACsBnD,IAAdlC,KAAKmF,OACLnF,KAAKI,OAASJ,KAAKmF,KAE1B,CACG/E,YACA,OAAOa,MAAMb,KAChB,CACGA,UAAMA,QACW8B,IAAblC,KAAKiF,KACD7E,EAAQJ,KAAKiF,MACb7E,EAAQJ,KAAKiF,UAGJ/C,IAAblC,KAAKkF,KACD9E,EAAQJ,KAAKkF,MACb9E,EAAQJ,KAAKkF,KAGrBjE,MAAMb,MAAQA,CACjB,QC1BQkF,EAqDTzF,cAlDAG,KAAA2E,SAAW,IAAId,EASf7D,KAAGuF,IAAG,IAAIR,EAAY,GAAK,CAAEE,IAAK,EAAGC,IAAK,EAAGC,KAAM,MACnDnF,KAAMwF,OAAG,IAAIT,EAAY,GAAK,CAAEE,IAAK,EAAGC,IAAK,EAAGC,KAAM,MACtDnF,KAAMyF,OAAG,IAAIV,EAAY,GAAK,CAAEE,IAAK,EAAGC,IAAK,EAAGC,KAAM,MACtDnF,KAAM0F,OAAG,IAAIX,EAAY,GAAK,CAAEE,IAAK,EAAGC,IAAK,EAAGC,KAAM,MACtDnF,KAAM2F,OAAG,IAAIZ,EAAY,GAAK,CAAEE,IAAK,EAAGC,IAAK,EAAGC,KAAM,MACtDnF,KAAU4F,WAAG,IAAIb,EAAY,GAAK,CAAEE,IAAK,EAAGC,IAAK,EAAGC,KAAM,MAC1DnF,KAAc6F,eAAG,IAAId,EAAY,GAAK,CAAEE,IAAK,EAAGC,IAAK,EAAGC,KAAM,MAC9DnF,KAAe8F,gBAAG,IAAIf,EAAY,GAAK,CAAEE,IAAK,EAAGC,IAAK,EAAGC,KAAM,MAG/DnF,KAAY+F,aAAG,IAAIhB,EAAY,EAAI,EAAG,CAAEE,IAAK,EAAGC,IAAK,EAAGC,KAAM,MAC9DnF,KAAQgG,SAAG,IAAIjB,EAAY,EAAI,EAAG,CAAEE,IAAK,EAAGC,IAAK,EAAGC,KAAM,MAC1DnF,KAAUiG,WAAG,IAAIlB,EAAY,EAAI,EAAG,CAAEE,IAAK,EAAGC,IAAK,EAAGC,KAAM,MAIpDnF,KAAAkG,QAAU,IAAInB,EAAY,GAC1B/E,KAAAmG,UAAY,IAAIpB,EAAY,GAC5B/E,KAAAoG,OAAS,IAAIrB,EAAY,GACzB/E,KAAAqG,QAAU,IAAItB,EAAY,GAC1B/E,KAAAsG,SAAW,IAAIvB,EAAY,GAC3B/E,KAAAuG,SAAW,IAAIxB,EAAY,GAC3B/E,KAAAwG,aAAe,IAAIzB,EAAY,GAC/B/E,KAAAyG,aAAe,IAAI1B,EAAY,GAC/B/E,KAAA0G,iBAAmB,IAAI3B,EAAY,GACnC/E,KAAA2G,aAAe,IAAI5B,EAAY,GAC/B/E,KAAA4G,aAAe,IAAI7B,EAAY,GAC/B/E,KAAA6G,iBAAmB,IAAI9B,EAAY,GACnC/E,KAAA8G,aAAe,IAAI/B,EAAY,GAC/B/E,KAAA+G,aAAe,IAAIhC,EAAY,GAC/B/E,KAAAgH,iBAAmB,IAAIjC,EAAY,GACnC/E,KAAAiH,UAAY,IAAIlC,EAAY,GAC5B/E,KAAAkH,UAAY,IAAInC,EAAY,GAC5B/E,KAAAmH,cAAgB,IAAIpC,EAAY,GAChC/E,KAAAoH,eAAiB,IAAIrC,EAAY,GACjC/E,KAAAqH,eAAiB,IAAItC,EAAY,GACjC/E,KAAAsH,mBAAqB,IAAIvC,EAAY,GACrC/E,KAAAuH,oBAAsB,IAAIxC,EAAY,GACtC/E,KAAAwH,uBAAyB,IAAIzC,EAAY,GACzC/E,KAAAyH,sBAAwB,IAAI1C,EAAY,GA+NhD/E,KAAI0H,MAAG,EA5NH1H,KAAK2H,sBAEL3H,KAAKwF,OAAOb,SAAS/B,KAAI,IAAM5C,KAAK4H,mBACpC5H,KAAKuF,IAAIZ,SAAS/B,KAAI,IAAM5C,KAAK6H,gBACjC7H,KAAK0F,OAAOf,SAAS/B,KAAI,IAAM5C,KAAK8H,mBACpC9H,KAAKyF,OAAOd,SAAS/B,KAAI,IAAM5C,KAAK+H,mBACpC/H,KAAK2F,OAAOhB,SAAS/B,KAAI,IAAM5C,KAAKgI,mBACpChI,KAAK4F,WAAWjB,SAAS/B,KAAI,IAAM5C,KAAKiI,uBACxCjI,KAAK6F,eAAelB,SAAS/B,KAAI,IAAM5C,KAAKkI,2BAC5ClI,KAAK8F,gBAAgBnB,SAAS/B,KAAI,IAAM5C,KAAKmI,2BAC7CnI,KAAKiG,WAAWtB,SAAS/B,KAAI,IAAM5C,KAAKoI,eAAe,aACvDpI,KAAKgG,SAASrB,SAAS/B,KAAI,IAAM5C,KAAKoI,eAAe,WACrDpI,KAAK+F,aAAapB,SAAS/B,KAAI,IAAM5C,KAAKoI,eAAe,eAEzDpI,KAAKqI,UAAY,IAAIC,IACrBtI,KAAKuI,eAAiB,IAAID,IAC1BtI,KAAKwI,mBAAqB,IAAIF,GACjC,CAEDG,YAAYpG,GACR,OAAOrC,KAAKqI,UAAUnI,IAAImC,EAC7B,CAEDqG,oBAAoBC,GAChB,MAAMC,EAAQ5I,KAAKuI,eAAerI,IAAIyI,GACtC,YAAczG,IAAV0G,GACAC,QAAQC,IAAI,kBAAkBH,qBACvB,IAEJC,CACV,CAEDG,YAAYC,GAGR,GAAIhJ,KAAKqI,UAAUY,IAAID,EAASE,UAG5B,MAAMtI,MAAM,sBAAsBoI,EAASE,0CAK/ClJ,KAAKqI,UAAUlI,IAAI6I,EAASE,SAAUF,GAGjChJ,KAAKuI,eAAeU,IAAID,EAASL,YAElC3I,KAAKuI,eAAepI,IAAI6I,EAASL,UAAW,IAAI5H,OAIpDf,KAAKuI,eAAerI,IAAI8I,EAASL,WAAY5E,KAAKiF,EAkCrD,CAEDG,UAAUC,EAAoBhJ,QAGZ8B,IAAV9B,EACAJ,KAAKwI,mBAAmBrI,IAAIiJ,EAAYhJ,GAExCJ,KAAKwI,mBAAmBa,OAAOD,EAEtC,CAEDE,UAAUF,GAEN,IAAIhJ,EAAQJ,KAAKwI,mBAAmBtI,IAAIkJ,GAIxC,YAHclH,IAAV9B,IACAA,EAAQ,GAELA,CACV,CAEDmJ,mBACIvJ,KAAKuF,IAAInF,MAAQ,GACjBJ,KAAKwF,OAAOpF,MAAQ,GACpBJ,KAAKyF,OAAOrF,MAAQ,GACpBJ,KAAK0F,OAAOtF,MAAQ,GACpBJ,KAAK2F,OAAOvF,MAAQ,GACpBJ,KAAK4F,WAAWxF,MAAQ,GACxBJ,KAAK6F,eAAezF,MAAQ,GAC5BJ,KAAK8F,gBAAgB1F,MAAQ,GAC7BJ,KAAK+F,aAAa3F,MAAQ,EAAI,EAC9BJ,KAAKgG,SAAS5F,MAAQ,EAAI,EAC1BJ,KAAKiG,WAAW7F,MAAQ,EAAI,EAC5BJ,KAAK2H,qBACR,CAEDA,sBACI3H,KAAK4H,iBACL5H,KAAK6H,cACL7H,KAAK+H,iBACL/H,KAAK8H,iBACL9H,KAAKgI,iBACLhI,KAAKiI,qBACLjI,KAAKkI,yBACLlI,KAAKmI,wBACR,CAEDP,iBACI5H,KAAKkG,QAAQ9F,MAAQJ,KAAKwF,OAAOpF,MACjCJ,KAAKmG,UAAU/F,MAAQ,EAAIJ,KAAKwF,OAAOpF,KAC1C,CAEDyH,cAeQ7H,KAAKuF,IAAInF,MAAQ,IACjBJ,KAAKoG,OAAOhG,MAAQ,EACpBJ,KAAKqG,QAAQjG,MAAQoJ,KAAKtE,IAAI,EAAK,EAAqB,MAAjBlF,KAAKuF,IAAInF,OAChDJ,KAAKsG,SAASlG,MAAQoJ,KAAKtE,IAAI,EAAiC,KAA3BlF,KAAKuF,IAAInF,MAAQ,QACtDJ,KAAKuG,SAASnG,MAAQoJ,KAAKtE,IAAI,EAAKsE,KAAKvE,IAAI,EAAK,MAAQjF,KAAKuF,IAAInF,OAASJ,KAAKsG,SAASlG,SAE1FJ,KAAKuG,SAASnG,MAAQ,EACtBJ,KAAKqG,QAAQjG,MAAQ,EACrBJ,KAAKoG,OAAOhG,MAAQoJ,KAAKtE,IAAI,EAAsB,EAAjBlF,KAAKuF,IAAInF,MAAY,GACvDJ,KAAKsG,SAASlG,MAAQ,EAAIJ,KAAKoG,OAAOhG,MAE7C,CAED2H,iBACI/H,KAAKwG,aAAapG,MAAQoJ,KAAKtE,IAAI,EAAyB,EAApBlF,KAAKyF,OAAOrF,MAAY,GAChEJ,KAAKyG,aAAarG,MAAQoJ,KAAKtE,IAAI,EAAK,EAAwB,EAApBlF,KAAKyF,OAAOrF,OACxDJ,KAAK0G,iBAAiBtG,MAAQ,GAAKJ,KAAKwG,aAAapG,MAAQJ,KAAKyG,aAAarG,MAClF,CAED0H,iBACI9H,KAAK2G,aAAavG,MAAQoJ,KAAKtE,IAAI,EAAyB,EAApBlF,KAAK0F,OAAOtF,MAAY,GAChEJ,KAAK4G,aAAaxG,MAAQoJ,KAAKtE,IAAI,EAAK,EAAwB,EAApBlF,KAAK0F,OAAOtF,OACxDJ,KAAK6G,iBAAiBzG,MAAQ,GAAKJ,KAAK2G,aAAavG,MAAQJ,KAAK4G,aAAaxG,MAClF,CAED4H,iBACIhI,KAAK8G,aAAa1G,MAAQoJ,KAAKtE,IAAI,EAAyB,EAApBlF,KAAK2F,OAAOvF,MAAY,GAChEJ,KAAK+G,aAAa3G,MAAQoJ,KAAKtE,IAAI,EAAK,EAAwB,EAApBlF,KAAK2F,OAAOvF,OACpDJ,KAAK8G,aAAa1G,MAAQJ,KAAK+G,aAAa3G,MAC5CJ,KAAKgH,iBAAiB5G,MAAQ,EAAIJ,KAAK8G,aAAa1G,MAEpDJ,KAAKgH,iBAAiB5G,MAAQ,EAAIJ,KAAK+G,aAAa3G,KAE3D,CAED6H,qBACIjI,KAAKiH,UAAU7G,MAAQoJ,KAAKtE,IAAI,EAA6B,EAAxBlF,KAAK4F,WAAWxF,MAAY,GACjEJ,KAAKkH,UAAU9G,MAAQoJ,KAAKtE,IAAI,EAAK,EAA4B,EAAxBlF,KAAK4F,WAAWxF,OACrDJ,KAAKiH,UAAU7G,MAAQJ,KAAKkH,UAAU9G,MACtCJ,KAAKmH,cAAc/G,MAAQ,EAAIJ,KAAKiH,UAAU7G,MAE9CJ,KAAKmH,cAAc/G,MAAQ,EAAIJ,KAAKkH,UAAU9G,KAErD,CAED8H,yBACIlI,KAAKoH,eAAehH,MAAQoJ,KAAKtE,IAAI,EAAiC,EAA5BlF,KAAK6F,eAAezF,MAAY,GAC1EJ,KAAKqH,eAAejH,MAAQoJ,KAAKtE,IAAI,EAAK,EAAgC,EAA5BlF,KAAK6F,eAAezF,OAE9DJ,KAAKoH,eAAehH,MAAQJ,KAAKqH,eAAejH,MAChDJ,KAAKsH,mBAAmBlH,MAAQ,EAAIJ,KAAKoH,eAAehH,MAExDJ,KAAKsH,mBAAmBlH,MAAQ,EAAIJ,KAAKqH,eAAejH,KAE/D,CAED+H,yBACInI,KAAKuH,oBAAoBnH,MAAQoJ,KAAKtE,IAAI,EAAkC,EAA7BlF,KAAK8F,gBAAgB1F,MAAY,GAChFJ,KAAKwH,uBAAuBpH,MAAQoJ,KAAKtE,IAAI,EAAK,EAAiC,EAA7BlF,KAAK8F,gBAAgB1F,OAEvEJ,KAAKuH,oBAAsBvH,KAAKwH,uBAChCxH,KAAKyH,sBAAsBrH,MAAQ,EAAIJ,KAAKuH,oBAAoBnH,MAEhEJ,KAAKyH,sBAAsBrH,MAAQ,EAAIJ,KAAKwH,uBAAuBpH,KAE1E,CAGDgI,eAAeqB,GACPzJ,KAAK0H,OAET1H,KAAK0H,MAAO,EACZ1H,KAAKiG,WAAWtB,SAASR,OACzBnE,KAAKgG,SAASrB,SAASR,OACvBnE,KAAK+F,aAAapB,SAASR,OAC3BnE,KAAK0J,mBAAmBD,GACxBzJ,KAAKiG,WAAWtB,SAASN,SACzBrE,KAAKgG,SAASrB,SAASN,SACvBrE,KAAK+F,aAAapB,SAASN,SAC3BrE,KAAK0H,MAAO,EACf,CAESgC,mBAAmBD,GACzB,IAAIE,EAAY,EACZC,EAAa,EACD,YAAZH,EACAG,GAAc5J,KAAKiG,WAAW7F,MAE9BuJ,GAAa3J,KAAKiG,WAAW7F,MAEjB,UAAZqJ,EACAG,GAAc5J,KAAKgG,SAAS5F,MAE5BuJ,GAAa3J,KAAKgG,SAAS5F,MAEf,cAAZqJ,EACAG,GAAc5J,KAAK+F,aAAa3F,MAEhCuJ,GAAa3J,KAAK+F,aAAa3F,MAGhB,IAAfwJ,OACgB1H,IAAZuH,GAEAzJ,KAAK+F,aAAa3F,MAAQ,EAAI,EAC9BJ,KAAKgG,SAAS5F,MAAQ,EAAI,EAC1BJ,KAAKiG,WAAW7F,MAAQ,EAAI,GAEvBoJ,KAAKK,IAAIF,GAAa,MAGvB3J,KAAKiG,WAAW7F,MADJ,YAAZqJ,EACwB,EAEA,EAGxBzJ,KAAKgG,SAAS5F,MADF,UAAZqJ,EACsB,EAEA,EAGtBzJ,KAAK+F,aAAa3F,MADN,cAAZqJ,EAC0B,EAEA,IAId,YAAZA,IACAzJ,KAAKiG,WAAW7F,MAAQ,KAEZ,UAAZqJ,IACAzJ,KAAKgG,SAAS5F,MAAQ,KAEV,cAAZqJ,IACAzJ,KAAK+F,aAAa3F,MAAQ,KAE9BJ,KAAK0J,mBAAmBD,KAGZ,YAAZA,IACAzJ,KAAKiG,WAAW7F,MAAQuJ,EAAY3J,KAAKiG,WAAW7F,MAAQwJ,GAEhD,UAAZH,IACAzJ,KAAKgG,SAAS5F,MAAQuJ,EAAY3J,KAAKgG,SAAS5F,MAAQwJ,GAE5C,cAAZH,IACAzJ,KAAK+F,aAAa3F,MAAQuJ,EAAY3J,KAAK+F,aAAa3F,MAAQwJ,GAG3E,CAEDE,gBAAgBC,GAAa,GAEzB/J,KAAK2E,SAASH,SAKjB,QCrXQwF,EAITnK,YAAY0E,GACRvE,KAAKuE,KAAOA,EACZvE,KAAKiK,MAAQ,CAChB,CAEDC,OACI,GAAyB,IAArBlK,KAAKuE,KAAKnD,SAAgC,IAAhBpB,KAAKiK,MAC/B,MAAO,CAAE7J,WAAO8B,EAAWiI,MAAM,GACrC,MAAMC,EAAYpK,KAAKuE,KAAK8F,QAAQ,KAAMrK,KAAKiK,OAC/C,IAAI7I,EAEAA,GADe,IAAfgJ,OACSlI,EAEAkI,EAAYpK,KAAKiK,MAE9B,MAAMK,EAAStK,KAAKuE,KAAKhB,OAAOvD,KAAKiK,MAAO7I,GAM5C,OAJIpB,KAAKiK,OADU,IAAfG,GACc,EAEDA,EAAY,EAEtB,CAAEhK,MAAOkK,EAAQH,MAAM,EACjC,QCzBQI,EAET1K,YAAY0E,GACRvE,KAAKuE,KAAOA,CACf,CAED,CAACiG,OAAOC,YACJ,OAAO,IAAIT,EAAqBhK,KAAKuE,KACxC,QCRQmG,EAETC,mBAAmBC,GACfF,EAAkBE,SAAWA,CAChC,CACDD,qBACI,QAAmCzI,IAA/BwI,EAAkBE,SAClB,MAAMhK,MAAM,uFAChB,OAAO8J,EAAkBE,QAC5B,QCmCQC,EAIThL,cACIG,KAAK8K,MAAQ,IAAI/J,MACjBf,KAAKuE,KAAO,IAAIxD,KACnB,CAEDgK,KAAKC,GACD,MAAMzG,EAAOmG,EAAkBO,cAAcC,SAASF,GAEhDG,EAAS,IAAIZ,EAAahG,GAGhC,IAAK,IAAI6G,KAAQD,EAAQ,CAIrB,GADAC,EAAOA,EAAKC,OACQ,IAAhBD,EAAKhK,OACL,SACJ,GAAgB,MAAZgK,EAAK,GACL,SACJ,MAAME,EAASF,EAAKG,MAAM,OAC1BvL,KAAKuE,KAAKR,KAAKyH,SAASF,EAAO,GAAI,KACnCtL,KAAK8K,MAAM/G,KAAKpD,WAAW2K,EAAO,KAClCtL,KAAK8K,MAAM/G,KAAKpD,WAAW2K,EAAO,KAClCtL,KAAK8K,MAAM/G,KAAKpD,WAAW2K,EAAO,IACrC,CACJ,CAEDG,MAAMX,EAAiBY,GAEnB,IAAIC,EAAY,EAAGC,EAAc,EACjC,KAAMD,EAAY3L,KAAKuE,KAAKnD,QAAQ,CAChC,IAAI6I,EAAiC,EAAzBjK,KAAKuE,KAAKoH,KACtBb,EAAMb,MAAYjK,KAAK8K,MAAMc,KAAiBF,EAC9CZ,EAAMb,MAAYjK,KAAK8K,MAAMc,KAAiBF,EAC9CZ,EAAMb,MAAYjK,KAAK8K,MAAMc,KAAiBF,CACjD,CACJ,ECrFL,MAAMG,EAAe,CAEjBrG,OAAmB,CAAC,OAAQ,UAC5BD,IAAmB,CAAC,OAAQ,QAAS,QAAS,OAC9CuG,KAAmB,CAAC,YAAa,QAAS,WAC1CpG,OAAmB,CAAC,YAAa,gBAAiB,aAClDD,OAAmB,CAAC,YAAa,gBAAiB,aAClDE,OAAmB,CAAC,YAAa,gBAAiB,aAClDoG,WAAmB,CAAC,SAAU,aAAc,UAC5CC,eAAmB,CAAC,cAAe,kBAAmB,eACtDC,gBAAmB,CAAC,sBAAuB,qBAAsB,qBAGxDC,EAAkB,IAAInL,MAEtBoL,EAAkB,IAAI7D,IAEnC,IAAI,MAAM8D,KAAYP,EAClB,GAAKA,EAAaQ,eAAeD,GAAjC,CAEAF,EAAgBnI,KAAKqI,GAErB,IAAI,MAAMhM,KAAUyL,EAAqBO,GACrCD,EAAgBhM,IAAIC,EAAOgM,EAJnB,OAQHE,EAUTzM,YAAY0M,GACRvM,KAAKuM,OAASA,OACCrK,IAAXqK,GACAvM,KAAKiC,IAAM,IAAIlB,MACff,KAAKuE,KAAO,IAAI+D,MAEhBtI,KAAKiC,IAAMsK,EAAOtK,IAAIuK,QACtBxM,KAAKuE,KAAO,IAAI+D,IAAIiE,EAAOhI,MAElC,CAEDkI,SACI,YAAuBvK,IAAhBlC,KAAKuM,MACf,CAEDG,cACI,OAAO,IAAIJ,EAAUtM,KACxB,CAED2M,OAAOvM,GACH,MAAMgM,EAAWD,EAAgBjM,IAAIE,QACpB8B,IAAbkK,EACApM,KAAK4M,QAAQR,EAAUhM,GAEb,WAAVA,GACAJ,KAAK6M,OAAOzM,EAEnB,CAED0M,QACI,IAAIC,EAAI,GACR,IAAI,MAAM9K,KAAOjC,KAAKiC,IACD,IAAb8K,EAAE3L,SACF2L,GAAK,KACTA,GAAK9K,EAET,OAAO8K,CACV,CAEDC,eAEI,MAAM1C,EAAS,GACf,IAAI,MAAOrI,EAAK7B,KAAUJ,KAAKuE,KAAK/B,eAClBN,IAAV9B,GACAkK,EAAOvG,KAAK3D,GAEpB,OAAOkK,CACV,CAEOuC,OAAO5K,GACXjC,KAAKiC,IAAI8B,KAAK9B,EACjB,CAEO2K,QAAQR,EAAkBhM,GAC9BJ,KAAKuE,KAAO,IAAI+D,IAAItI,KAAKuE,MACzB,MAAM0I,EAAOjN,KAAKuE,KAAKrE,IAAIkM,GAC3B,QAAalK,IAAT+K,EAKJjN,KAAKuE,KAAKpE,IAAIiM,EAAUhM,QAJpB,GAAI6M,IAAS7M,EACT,MAAMQ,MAAM,sBAAsBwL,uBAA8BhM,kCAAsC6M,IAIjH,CAEDC,OAAOC,GACHnN,KAAKoN,KAAOD,EACZ,IAAI,MAAMf,KAAYF,EACblM,KAAKuE,KAAK0E,IAAImD,IACfpM,KAAKuE,KAAKpE,IAAIiM,OAAUlK,EAEnC,QCxFQmL,EAOTxN,cACIG,KAAKsN,cAAgB,IAAIhB,EACzBtM,KAAKuN,OAAS,IAAIjF,IAClBtI,KAAKwN,QAAU,IAAIzM,MACnBf,KAAKyN,OAAS,IAAInF,IAClBtI,KAAKiK,MAAQ,IAAI3B,IACjBtI,KAAK0N,sBACL7E,QAAQC,IAAI,4BAA4B9I,KAAKwN,QAAQpM,mBAAmBpB,KAAKyN,OAAOE,gBAAgB3N,KAAKiK,MAAM0D,iBAAiB3N,KAAKuN,OAAOI,cAC/I,CAGDhD,qBAGI,YAF+BzI,IAA3BmL,EAAczC,WACdyC,EAAczC,SAAW,IAAIyC,GAC1BA,EAAczC,QACxB,CAEO8C,sBACJ1N,KAAK4N,YAAY,GAAI5N,KAAKsN,eAC1BtN,KAAK6N,YACR,CAEDC,YAAYC,GAMR,IAAK/N,KAAKiK,MAAMhB,IAAI8E,GAEhB,MAAO,GAEX,MAAMzD,EAAS,IAAIvJ,MAEnB,IAAK,MAAMiN,KAAShO,KAAKiK,MAAM/J,IAAI6N,GAE3BC,aAAiB1B,EAEjBhC,EAAOvG,KAAKiK,GAIZ1D,EAAO2D,OAAOjO,KAAK8N,YAAYE,IAGvC,OAAO1D,CACV,CAED4D,kBAAkBtF,GACd,OAAO5I,KAAKyN,OAAOvN,IAAI0I,EAC1B,CAEOgF,YAAYO,EAAcC,GAC9B,MAAMC,EAAK3D,EAAkBO,cACvBqD,EAAgBD,EAAGE,SAASJ,GAC5BK,EAAMH,EAAGI,QAAQH,GAAeI,OAEtC,IAAI,MAAMrM,KAAQmM,EAAK,CAEnB,MAAMG,EAAIN,EAAGO,SAASN,EAAejM,GACrC,GAAIgM,EAAGQ,OAAOF,KAAQA,EAAEzL,cAAc4L,SAAS,WACvCH,EAAEzL,cAAc4L,SAAS,SACzB9O,KAAKuN,OAAOpN,IAAIkC,EAAKa,cAAeyL,OAErC,CACH,MAAMI,EAAOX,EAAK1B,cACZsC,EAAQ3M,EAAKW,QAAQ,IAAK,KAAKA,QAAQ,IAAK,KAAKuI,MAAM,KAC7D,IAAI,MAAM0D,KAAQD,EAAMxM,UACN,IAAVyM,EAAK,IAAoB,YAAVA,EAAK,IAExBF,EAAKpC,OAAOsC,EAAK,IAGrB,GAAIZ,EAAGa,MAAMP,GAAI,CACb,MAAMQ,EAAWd,EAAGO,SAAST,EAAM9L,GACnCrC,KAAK4N,YAAYuB,EAAUJ,EAC9B,KAAM,CACHA,EAAK7B,OAAO,QAAQiB,KAAQ9L,KAC5BrC,KAAKwN,QAAQzJ,KAAKgL,GAClB,MAAM9M,EAAM8M,EAAKjC,QACjB,IAAIsC,EAAIpP,KAAKyN,OAAOvN,IAAI+B,QACdC,IAANkN,IACAA,EAAI,IAAIrO,MACRf,KAAKyN,OAAOtN,IAAI8B,EAAKmN,IAEzBA,EAAGrL,KAAKgL,EACX,CACJ,CACJ,CACJ,CAEOlB,aACJ,IAAI,MAAMwB,KAAUrP,KAAKwN,QAAS,CACzBxN,KAAKiK,MAAMhB,IAAIoG,EAAOvC,UACvB9M,KAAKiK,MAAM9J,IAAIkP,EAAOvC,QAAS,IAEnC9M,KAAKiK,MAAM/J,IAAImP,EAAOvC,SAAU/I,KAAKsL,GACrC,IAAIC,EAAYD,EAChB,UAA2BnN,IAArBoN,EAAU/C,QAAsB,CAClC,MAAMA,EAAS+C,EAAU/C,OACpBvM,KAAKiK,MAAMhB,IAAIsD,EAAOO,UACvB9M,KAAKiK,MAAM9J,IAAIoM,EAAOO,QAAS,IAAI/L,OAEnCuO,EAAUxC,UAAYP,EAAOO,SAC3B9M,KAAKiK,MAAM/J,IAAIqM,EAAOO,SAAUyC,SAASD,EAAUxC,UACjD9M,KAAKiK,MAAM/J,IAAIqM,EAAOO,SAAU/I,KAAKuL,EAAUxC,SAEvDwC,EAAY/C,CACf,CACJ,CACJ,EAUL,MAAMiD,EAAe,IAAIlH,IC9IlB,IAAImH,EAAU,KACVC,EAAqC,oBAAjBC,aAA+BA,aAAe5O,MCMtE,SAAS6O,IACd,IAAIC,EAAM,IAAIC,EAAoB,IAqBlC,OAnBIA,GAAuBH,eACzBE,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,GAGZA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,IAAM,EACVA,EAAI,IAAM,EACHA,CACT,CAkJO,SAASE,EAASF,GAiBvB,OAhBAA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EACHA,CACT,CA2DO,SAASG,EAAOH,EAAKT,GAC1B,IAAIa,EAAMb,EAAE,GACRc,EAAMd,EAAE,GACRe,EAAMf,EAAE,GACRgB,EAAMhB,EAAE,GACRiB,EAAMjB,EAAE,GACRkB,EAAMlB,EAAE,GACRmB,EAAMnB,EAAE,GACRoB,EAAMpB,EAAE,GACRqB,EAAMrB,EAAE,GACRsB,EAAMtB,EAAE,GACRuB,EAAMvB,EAAE,IACRwB,EAAMxB,EAAE,IACRyB,EAAMzB,EAAE,IACR0B,EAAM1B,EAAE,IACR2B,EAAM3B,EAAE,IACR4B,EAAM5B,EAAE,IACR6B,EAAMhB,EAAMK,EAAMJ,EAAMG,EACxBa,EAAMjB,EAAMM,EAAMJ,EAAME,EACxBc,EAAMlB,EAAMO,EAAMJ,EAAMC,EACxBe,EAAMlB,EAAMK,EAAMJ,EAAMG,EACxBe,EAAMnB,EAAMM,EAAMJ,EAAME,EACxBgB,EAAMnB,EAAMK,EAAMJ,EAAMG,EACxBgB,EAAMd,EAAMK,EAAMJ,EAAMG,EACxBW,EAAMf,EAAMM,EAAMJ,EAAME,EACxBY,EAAMhB,EAAMO,EAAMJ,EAAMC,EACxBa,EAAMhB,EAAMK,EAAMJ,EAAMG,EACxBa,EAAMjB,EAAMM,EAAMJ,EAAME,EACxBc,EAAMjB,EAAMK,EAAMJ,EAAMG,EAExBc,EAAMZ,EAAMW,EAAMV,EAAMS,EAAMR,EAAMO,EAAMN,EAAMK,EAAMJ,EAAMG,EAAMF,EAAMC,EAE5E,OAAKM,GAILA,EAAM,EAAMA,EACZhC,EAAI,IAAMS,EAAMsB,EAAMrB,EAAMoB,EAAMnB,EAAMkB,GAAOG,EAC/ChC,EAAI,IAAMM,EAAMwB,EAAMzB,EAAM0B,EAAMxB,EAAMsB,GAAOG,EAC/ChC,EAAI,IAAMiB,EAAMQ,EAAMP,EAAMM,EAAML,EAAMI,GAAOS,EAC/ChC,EAAI,IAAMc,EAAMU,EAAMX,EAAMY,EAAMV,EAAMQ,GAAOS,EAC/ChC,EAAI,IAAMU,EAAMkB,EAAMpB,EAAMuB,EAAMpB,EAAMgB,GAAOK,EAC/ChC,EAAI,IAAMI,EAAM2B,EAAMzB,EAAMsB,EAAMrB,EAAMoB,GAAOK,EAC/ChC,EAAI,IAAMkB,EAAMI,EAAMN,EAAMS,EAAMN,EAAME,GAAOW,EAC/ChC,EAAI,IAAMY,EAAMa,EAAMX,EAAMQ,EAAMP,EAAMM,GAAOW,EAC/ChC,EAAI,IAAMQ,EAAMsB,EAAMrB,EAAMmB,EAAMjB,EAAMe,GAAOM,EAC/ChC,EAAI,IAAMK,EAAMuB,EAAMxB,EAAM0B,EAAMvB,EAAMmB,GAAOM,EAC/ChC,EAAI,KAAOgB,EAAMQ,EAAMP,EAAMK,EAAMH,EAAMC,GAAOY,EAChDhC,EAAI,KAAOa,EAAMS,EAAMV,EAAMY,EAAMT,EAAMK,GAAOY,EAChDhC,EAAI,KAAOS,EAAMkB,EAAMnB,EAAMqB,EAAMnB,EAAMgB,GAAOM,EAChDhC,EAAI,KAAOI,EAAMyB,EAAMxB,EAAMsB,EAAMrB,EAAMoB,GAAOM,EAChDhC,EAAI,KAAOiB,EAAMI,EAAML,EAAMO,EAAML,EAAME,GAAOY,EAChDhC,EAAI,KAAOY,EAAMW,EAAMV,EAAMQ,EAAMP,EAAMM,GAAOY,EACzChC,GApBE,IAqBX,CA4FO,SAASiC,EAASjC,EAAKT,EAAG2C,GAC/B,IAAI9B,EAAMb,EAAE,GACRc,EAAMd,EAAE,GACRe,EAAMf,EAAE,GACRgB,EAAMhB,EAAE,GACRiB,EAAMjB,EAAE,GACRkB,EAAMlB,EAAE,GACRmB,EAAMnB,EAAE,GACRoB,EAAMpB,EAAE,GACRqB,EAAMrB,EAAE,GACRsB,EAAMtB,EAAE,GACRuB,EAAMvB,EAAE,IACRwB,EAAMxB,EAAE,IACRyB,EAAMzB,EAAE,IACR0B,EAAM1B,EAAE,IACR2B,EAAM3B,EAAE,IACR4B,EAAM5B,EAAE,IAER4C,EAAKD,EAAE,GACPE,EAAKF,EAAE,GACPG,EAAKH,EAAE,GACPI,EAAKJ,EAAE,GA6BX,OA5BAlC,EAAI,GAAKmC,EAAK/B,EAAMgC,EAAK5B,EAAM6B,EAAKzB,EAAM0B,EAAKtB,EAC/ChB,EAAI,GAAKmC,EAAK9B,EAAM+B,EAAK3B,EAAM4B,EAAKxB,EAAMyB,EAAKrB,EAC/CjB,EAAI,GAAKmC,EAAK7B,EAAM8B,EAAK1B,EAAM2B,EAAKvB,EAAMwB,EAAKpB,EAC/ClB,EAAI,GAAKmC,EAAK5B,EAAM6B,EAAKzB,EAAM0B,EAAKtB,EAAMuB,EAAKnB,EAC/CgB,EAAKD,EAAE,GACPE,EAAKF,EAAE,GACPG,EAAKH,EAAE,GACPI,EAAKJ,EAAE,GACPlC,EAAI,GAAKmC,EAAK/B,EAAMgC,EAAK5B,EAAM6B,EAAKzB,EAAM0B,EAAKtB,EAC/ChB,EAAI,GAAKmC,EAAK9B,EAAM+B,EAAK3B,EAAM4B,EAAKxB,EAAMyB,EAAKrB,EAC/CjB,EAAI,GAAKmC,EAAK7B,EAAM8B,EAAK1B,EAAM2B,EAAKvB,EAAMwB,EAAKpB,EAC/ClB,EAAI,GAAKmC,EAAK5B,EAAM6B,EAAKzB,EAAM0B,EAAKtB,EAAMuB,EAAKnB,EAC/CgB,EAAKD,EAAE,GACPE,EAAKF,EAAE,GACPG,EAAKH,EAAE,IACPI,EAAKJ,EAAE,IACPlC,EAAI,GAAKmC,EAAK/B,EAAMgC,EAAK5B,EAAM6B,EAAKzB,EAAM0B,EAAKtB,EAC/ChB,EAAI,GAAKmC,EAAK9B,EAAM+B,EAAK3B,EAAM4B,EAAKxB,EAAMyB,EAAKrB,EAC/CjB,EAAI,IAAMmC,EAAK7B,EAAM8B,EAAK1B,EAAM2B,EAAKvB,EAAMwB,EAAKpB,EAChDlB,EAAI,IAAMmC,EAAK5B,EAAM6B,EAAKzB,EAAM0B,EAAKtB,EAAMuB,EAAKnB,EAChDgB,EAAKD,EAAE,IACPE,EAAKF,EAAE,IACPG,EAAKH,EAAE,IACPI,EAAKJ,EAAE,IACPlC,EAAI,IAAMmC,EAAK/B,EAAMgC,EAAK5B,EAAM6B,EAAKzB,EAAM0B,EAAKtB,EAChDhB,EAAI,IAAMmC,EAAK9B,EAAM+B,EAAK3B,EAAM4B,EAAKxB,EAAMyB,EAAKrB,EAChDjB,EAAI,IAAMmC,EAAK7B,EAAM8B,EAAK1B,EAAM2B,EAAKvB,EAAMwB,EAAKpB,EAChDlB,EAAI,IAAMmC,EAAK5B,EAAM6B,EAAKzB,EAAM0B,EAAKtB,EAAMuB,EAAKnB,EACzCnB,CACT,CAUO,SAASuC,EAAUvC,EAAKT,EAAGiD,GAChC,IAGIpC,EAAKC,EAAKC,EAAKC,EACfC,EAAKC,EAAKC,EAAKC,EACfC,EAAKC,EAAKC,EAAKC,EALf0B,EAAID,EAAE,GACNE,EAAIF,EAAE,GACNG,EAAIH,EAAE,GAyCV,OApCIjD,IAAMS,GACRA,EAAI,IAAMT,EAAE,GAAKkD,EAAIlD,EAAE,GAAKmD,EAAInD,EAAE,GAAKoD,EAAIpD,EAAE,IAC7CS,EAAI,IAAMT,EAAE,GAAKkD,EAAIlD,EAAE,GAAKmD,EAAInD,EAAE,GAAKoD,EAAIpD,EAAE,IAC7CS,EAAI,IAAMT,EAAE,GAAKkD,EAAIlD,EAAE,GAAKmD,EAAInD,EAAE,IAAMoD,EAAIpD,EAAE,IAC9CS,EAAI,IAAMT,EAAE,GAAKkD,EAAIlD,EAAE,GAAKmD,EAAInD,EAAE,IAAMoD,EAAIpD,EAAE,MAE9Ca,EAAMb,EAAE,GACRc,EAAMd,EAAE,GACRe,EAAMf,EAAE,GACRgB,EAAMhB,EAAE,GACRiB,EAAMjB,EAAE,GACRkB,EAAMlB,EAAE,GACRmB,EAAMnB,EAAE,GACRoB,EAAMpB,EAAE,GACRqB,EAAMrB,EAAE,GACRsB,EAAMtB,EAAE,GACRuB,EAAMvB,EAAE,IACRwB,EAAMxB,EAAE,IACRS,EAAI,GAAKI,EACTJ,EAAI,GAAKK,EACTL,EAAI,GAAKM,EACTN,EAAI,GAAKO,EACTP,EAAI,GAAKQ,EACTR,EAAI,GAAKS,EACTT,EAAI,GAAKU,EACTV,EAAI,GAAKW,EACTX,EAAI,GAAKY,EACTZ,EAAI,GAAKa,EACTb,EAAI,IAAMc,EACVd,EAAI,IAAMe,EACVf,EAAI,IAAMI,EAAMqC,EAAIjC,EAAMkC,EAAI9B,EAAM+B,EAAIpD,EAAE,IAC1CS,EAAI,IAAMK,EAAMoC,EAAIhC,EAAMiC,EAAI7B,EAAM8B,EAAIpD,EAAE,IAC1CS,EAAI,IAAMM,EAAMmC,EAAI/B,EAAMgC,EAAI5B,EAAM6B,EAAIpD,EAAE,IAC1CS,EAAI,IAAMO,EAAMkC,EAAI9B,EAAM+B,EAAI3B,EAAM4B,EAAIpD,EAAE,KAGrCS,CACT,CA0CO,SAAS4C,EAAO5C,EAAKT,EAAGsD,EAAKC,GAClC,IAII5F,EAAG6F,EAAGC,EACN5C,EAAKC,EAAKC,EAAKC,EACfC,EAAKC,EAAKC,EAAKC,EACfC,EAAKC,EAAKC,EAAKC,EACfK,EAAKC,EAAKC,EACVQ,EAAKC,EAAKkB,EACVC,EAAKC,EAAKC,EAVVX,EAAIK,EAAK,GACTJ,EAAII,EAAK,GACTH,EAAIG,EAAK,GACTO,EAAM1J,KAAK2J,MAAMb,EAAGC,EAAGC,GAS3B,OAAIU,EAAME,EACD,MAITd,GADAY,EAAM,EAAIA,EAEVX,GAAKW,EACLV,GAAKU,EACLnG,EAAIvD,KAAK6J,IAAIX,GAEbG,EAAI,GADJD,EAAIpJ,KAAK8J,IAAIZ,IAEbzC,EAAMb,EAAE,GACRc,EAAMd,EAAE,GACRe,EAAMf,EAAE,GACRgB,EAAMhB,EAAE,GACRiB,EAAMjB,EAAE,GACRkB,EAAMlB,EAAE,GACRmB,EAAMnB,EAAE,GACRoB,EAAMpB,EAAE,GACRqB,EAAMrB,EAAE,GACRsB,EAAMtB,EAAE,GACRuB,EAAMvB,EAAE,IACRwB,EAAMxB,EAAE,IAER6B,EAAMqB,EAAIA,EAAIO,EAAID,EAClB1B,EAAMqB,EAAID,EAAIO,EAAIL,EAAIzF,EACtBoE,EAAMqB,EAAIF,EAAIO,EAAIN,EAAIxF,EACtB4E,EAAMW,EAAIC,EAAIM,EAAIL,EAAIzF,EACtB6E,EAAMW,EAAIA,EAAIM,EAAID,EAClBE,EAAMN,EAAID,EAAIM,EAAIP,EAAIvF,EACtBgG,EAAMT,EAAIE,EAAIK,EAAIN,EAAIxF,EACtBiG,EAAMT,EAAIC,EAAIK,EAAIP,EAAIvF,EACtBkG,EAAMT,EAAIA,EAAIK,EAAID,EAElB/C,EAAI,GAAKI,EAAMgB,EAAMZ,EAAMa,EAAMT,EAAMU,EACvCtB,EAAI,GAAKK,EAAMe,EAAMX,EAAMY,EAAMR,EAAMS,EACvCtB,EAAI,GAAKM,EAAMc,EAAMV,EAAMW,EAAMP,EAAMQ,EACvCtB,EAAI,GAAKO,EAAMa,EAAMT,EAAMU,EAAMN,EAAMO,EACvCtB,EAAI,GAAKI,EAAM0B,EAAMtB,EAAMuB,EAAMnB,EAAMqC,EACvCjD,EAAI,GAAKK,EAAMyB,EAAMrB,EAAMsB,EAAMlB,EAAMoC,EACvCjD,EAAI,GAAKM,EAAMwB,EAAMpB,EAAMqB,EAAMjB,EAAMmC,EACvCjD,EAAI,GAAKO,EAAMuB,EAAMnB,EAAMoB,EAAMhB,EAAMkC,EACvCjD,EAAI,GAAKI,EAAM8C,EAAM1C,EAAM2C,EAAMvC,EAAMwC,EACvCpD,EAAI,GAAKK,EAAM6C,EAAMzC,EAAM0C,EAAMtC,EAAMuC,EACvCpD,EAAI,IAAMM,EAAM4C,EAAMxC,EAAMyC,EAAMrC,EAAMsC,EACxCpD,EAAI,IAAMO,EAAM2C,EAAMvC,EAAMwC,EAAMpC,EAAMqC,EAEpC7D,IAAMS,IAERA,EAAI,IAAMT,EAAE,IACZS,EAAI,IAAMT,EAAE,IACZS,EAAI,IAAMT,EAAE,IACZS,EAAI,IAAMT,EAAE,KAGPS,EACT,CDrkBKrG,KAAK2J,QAAO3J,KAAK2J,MAAQ,WAI5B,IAHA,IAAIZ,EAAI,EACJpR,EAAIoS,UAAUnS,OAEXD,KACLoR,GAAKgB,UAAUpS,GAAKoS,UAAUpS,GAGhC,OAAOqI,KAAKgK,KAAKjB,EACnB,GC80CO,IAAIkB,EAlCJ,SAAuB5D,EAAK6D,EAAMC,EAAQC,EAAMC,GACrD,IACIC,EADAC,EAAI,EAAMvK,KAAKwK,IAAIN,EAAO,GA0B9B,OAxBA7D,EAAI,GAAKkE,EAAIJ,EACb9D,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAKkE,EACTlE,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,KAAO,EACXA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EAEC,MAAPgE,GAAeA,IAAQI,KACzBH,EAAK,GAAKF,EAAOC,GACjBhE,EAAI,KAAOgE,EAAMD,GAAQE,EACzBjE,EAAI,IAAM,EAAIgE,EAAMD,EAAOE,IAE3BjE,EAAI,KAAO,EACXA,EAAI,KAAO,EAAI+D,GAGV/D,CACT,EAsfWqE,EAAMpC,ECn2DV,SAASlC,IACd,IAAIC,EAAM,IAAIC,EAAoB,GAQlC,OANIA,GAAuBH,eACzBE,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,GAGJA,CACT,CAqCO,SAASsE,EAAW7B,EAAGC,EAAGC,GAC/B,IAAI3C,EAAM,IAAIC,EAAoB,GAIlC,OAHAD,EAAI,GAAKyC,EACTzC,EAAI,GAAK0C,EACT1C,EAAI,GAAK2C,EACF3C,CACT,CAuDO,SAASuE,EAASvE,EAAKT,EAAG2C,GAI/B,OAHAlC,EAAI,GAAKT,EAAE,GAAK2C,EAAE,GAClBlC,EAAI,GAAKT,EAAE,GAAK2C,EAAE,GAClBlC,EAAI,GAAKT,EAAE,GAAK2C,EAAE,GACXlC,CACT,CAgHO,SAASnE,EAAMmE,EAAKT,EAAG2C,GAI5B,OAHAlC,EAAI,GAAKT,EAAE,GAAK2C,EAChBlC,EAAI,GAAKT,EAAE,GAAK2C,EAChBlC,EAAI,GAAKT,EAAE,GAAK2C,EACTlC,CACT,CA8FO,SAASwE,EAAUxE,EAAKT,GAC7B,IAAIkD,EAAIlD,EAAE,GACNmD,EAAInD,EAAE,GACNoD,EAAIpD,EAAE,GACN8D,EAAMZ,EAAIA,EAAIC,EAAIA,EAAIC,EAAIA,EAU9B,OARIU,EAAM,IAERA,EAAM,EAAI1J,KAAKgK,KAAKN,IAGtBrD,EAAI,GAAKT,EAAE,GAAK8D,EAChBrD,EAAI,GAAKT,EAAE,GAAK8D,EAChBrD,EAAI,GAAKT,EAAE,GAAK8D,EACTrD,CACT,CAqBO,SAASyE,EAAMzE,EAAKT,EAAG2C,GAC5B,IAAIwC,EAAKnF,EAAE,GACPoF,EAAKpF,EAAE,GACPqF,EAAKrF,EAAE,GACPsF,EAAK3C,EAAE,GACP4C,EAAK5C,EAAE,GACP6C,EAAK7C,EAAE,GAIX,OAHAlC,EAAI,GAAK2E,EAAKI,EAAKH,EAAKE,EACxB9E,EAAI,GAAK4E,EAAKC,EAAKH,EAAKK,EACxB/E,EAAI,GAAK0E,EAAKI,EAAKH,EAAKE,EACjB7E,CACT,CAgGO,SAASgF,EAAchF,EAAKT,EAAG0F,GACpC,IAAIxC,EAAIlD,EAAE,GACNmD,EAAInD,EAAE,GACNoD,EAAIpD,EAAE,GACN2F,EAAID,EAAE,GAAKxC,EAAIwC,EAAE,GAAKvC,EAAIuC,EAAE,IAAMtC,EAAIsC,EAAE,IAK5C,OAJAC,EAAIA,GAAK,EACTlF,EAAI,IAAMiF,EAAE,GAAKxC,EAAIwC,EAAE,GAAKvC,EAAIuC,EAAE,GAAKtC,EAAIsC,EAAE,KAAOC,EACpDlF,EAAI,IAAMiF,EAAE,GAAKxC,EAAIwC,EAAE,GAAKvC,EAAIuC,EAAE,GAAKtC,EAAIsC,EAAE,KAAOC,EACpDlF,EAAI,IAAMiF,EAAE,GAAKxC,EAAIwC,EAAE,GAAKvC,EAAIuC,EAAE,IAAMtC,EAAIsC,EAAE,KAAOC,EAC9ClF,CACT,CC7dO,SAASD,IACd,IAAIC,EAAM,IAAIC,EAAoB,GASlC,OAPIA,GAAuBH,eACzBE,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,GAGJA,CACT,CA0BO,SAASsE,EAAW7B,EAAGC,EAAGC,EAAGuC,GAClC,IAAIlF,EAAM,IAAIC,EAAoB,GAKlC,OAJAD,EAAI,GAAKyC,EACTzC,EAAI,GAAK0C,EACT1C,EAAI,GAAK2C,EACT3C,EAAI,GAAKkF,EACFlF,CACT,CAwaO,SAASgF,EAAchF,EAAKT,EAAG0F,GACpC,IAAIxC,EAAIlD,EAAE,GACNmD,EAAInD,EAAE,GACNoD,EAAIpD,EAAE,GACN2F,EAAI3F,EAAE,GAKV,OAJAS,EAAI,GAAKiF,EAAE,GAAKxC,EAAIwC,EAAE,GAAKvC,EAAIuC,EAAE,GAAKtC,EAAIsC,EAAE,IAAMC,EAClDlF,EAAI,GAAKiF,EAAE,GAAKxC,EAAIwC,EAAE,GAAKvC,EAAIuC,EAAE,GAAKtC,EAAIsC,EAAE,IAAMC,EAClDlF,EAAI,GAAKiF,EAAE,GAAKxC,EAAIwC,EAAE,GAAKvC,EAAIuC,EAAE,IAAMtC,EAAIsC,EAAE,IAAMC,EACnDlF,EAAI,GAAKiF,EAAE,GAAKxC,EAAIwC,EAAE,GAAKvC,EAAIuC,EAAE,IAAMtC,EAAIsC,EAAE,IAAMC,EAC5ClF,CACT,CD0QYD,ICjLL,IAAIoF,EAhdJ,SAAkBnF,EAAKT,EAAG2C,GAK/B,OAJAlC,EAAI,GAAKT,EAAE,GAAK2C,EAAE,GAClBlC,EAAI,GAAKT,EAAE,GAAK2C,EAAE,GAClBlC,EAAI,GAAKT,EAAE,GAAK2C,EAAE,GAClBlC,EAAI,GAAKT,EAAE,GAAK2C,EAAE,GACXlC,CACT,cA6fE,IAAIoF,EAAMrF,GAgCX,UCjpBYsF,EA6BTrV,YACIsV,EACA9S,EACA+S,EACAC,EACAC,EACAC,EACAC,EACAC,GAlCJzV,KAAKiK,OAAY,EAGjBjK,KAAO0V,QAAG,CAAC,EAAG,EAAG,GACjB1V,KAAO2V,QAAG,CAAC,EAAG,EAAG,GAEjB3V,KAAMoB,OAAG,EAITpB,KAAQkB,SAAW,GAGnBlB,KAAewV,gBAAG,GAsBdxV,KAAKmV,SAAWA,EAChBnV,KAAKqC,KAAOA,EACZrC,KAAKqV,UAAYA,EACjBrV,KAAKsV,UAAYA,EACjBtV,KAAKuV,KAAOA,EAEZvV,KAAK4V,uBAEc,OAAfR,IACApV,KAAKuM,OAASvM,KAAKmV,SAASU,QAAQT,GACpCpV,KAAKuM,OAAQrL,SAAS6C,KAAK/D,OAG3BA,KAAKuM,OACLvM,KAAK8V,MAAQ9V,KAAKuM,OAAOuJ,MAAQ,EAEjC9V,KAAK8V,MAAQ,EAcjB9V,KAAK+V,QAAUC,EAAcC,IAChC,CAEGC,aACA,OAAOlW,KAAKmV,SAASe,MACxB,CAMDN,qBAAqBO,GAAmB,GAMpCnW,KAAK0V,QAAU1V,KAAKmV,SAASiB,iBAAiBpW,KAAKqV,UAAWc,GAC9DnW,KAAK2V,QAAU3V,KAAKmV,SAASiB,iBAAiBpW,KAAKsV,UAAWa,EACjE,CAYDE,MAAMC,GACF,MAAMC,EAAQC,EAAgBxW,KAAK0V,QAAQ,GAAI1V,KAAK0V,QAAQ,GAAI1V,KAAK0V,QAAQ,IACvEe,EAAQD,EAAgBxW,KAAK2V,QAAQ,GAAI3V,KAAK2V,QAAQ,GAAI3V,KAAK2V,QAAQ,IAE7E,IAAIe,EACJ,GAAIJ,EACA,MAAM1V,MAAM,uBAEZ8V,EAAS1W,KAAK2W,aAElB3W,KAAK4W,uBCvEaC,EAAYC,EAAYJ,GAC9C,IAAIK,EAAiBC,EAAcC,IAAeH,EAAMD,GACxDK,EAAeH,EAAgBA,GAC/B,MAAMI,EAAOD,EAAeD,IAAeP,GACrCU,EAASF,EAAeD,IAAeI,EAAWJ,IAAeE,EAAMJ,IACvEO,EAASJ,EAAeD,IAAeI,EAAWJ,IAAeF,EAAgBK,IACvF,OJ+DuBG,EI9DnBD,EAAO,GJ8DiBE,EI9DbF,EAAO,GJ8DWG,EI9DPH,EAAO,GJ8DKI,EI9DD,EJ8DMC,EI7DvCZ,EAAe,GJ6D6Ba,EI7DzBb,EAAe,GJ6Dec,EI7DXd,EAAe,GJ6DCe,EI7DG,EJ6DEC,EI5D3DX,EAAO,GJ4DyDY,EI5DrDZ,EAAO,GJ4DmDa,EI5D/Cb,EAAO,GJ4D6Cc,EI5DzC,EJ4D8CC,EI3D/EtB,EAAK,GJ2D+EuB,EI3D3EvB,EAAK,GJ2D2EwB,EI3DvExB,EAAK,GJ2DuEyB,EI3DnE,EJ4D7BzI,EAAM,IAAIC,EAAoB,IAClCD,EAAI,GAAK0H,EACT1H,EAAI,GAAK2H,EACT3H,EAAI,GAAK4H,EACT5H,EAAI,GAAK6H,EACT7H,EAAI,GAAK8H,EACT9H,EAAI,GAAK+H,EACT/H,EAAI,GAAKgI,EACThI,EAAI,GAAKiI,EACTjI,EAAI,GAAKkI,EACTlI,EAAI,GAAKmI,EACTnI,EAAI,IAAMoI,EACVpI,EAAI,IAAMqI,EACVrI,EAAI,IAAMsI,EACVtI,EAAI,IAAMuI,EACVvI,EAAI,IAAMwI,EACVxI,EAAI,IAAMyI,EACHzI,EAlBF,IAAoB0H,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAChGzI,CI1DN,CD2D6B0I,CAAUhC,EAAOE,EAAOC,GAC7C1W,KAAKoB,OFwJN,SAAkBgO,EAAG2C,GAC1B,IAAIO,EAAIP,EAAE,GAAK3C,EAAE,GACbmD,EAAIR,EAAE,GAAK3C,EAAE,GACboD,EAAIT,EAAE,GAAK3C,EAAE,GACjB,OAAO5F,KAAK2J,MAAMb,EAAGC,EAAGC,EAC1B,CE7JsBgG,CAAcjC,EAAOE,QACfvU,IAAhBlC,KAAKuM,OACLvM,KAAKyY,gBAAkBzY,KAAK4W,cAE5B5W,KAAKyY,gBACDC,EACIzC,IACA0C,EAAY1C,IAAejW,KAAKuM,OAAOqK,eACvC5W,KAAK4W,eAGjB5W,KAAK4Y,SAAWC,EAAgB,EAAG7Y,KAAKoB,OAAQ,EAAG,EACtD,CAGDuL,cACwBzK,IAAhBlC,KAAKuM,OACLvM,KAAK8Y,cACDC,EAAc9C,IAAejW,KAAKuM,OAAOuM,cACrCC,EAAc9C,IAAejW,KAAKyY,gBAAkBzY,KAAK+V,UAEjE/V,KAAK8Y,cAAgBC,EAAc9C,IAAejW,KAAKyY,gBAAkBzY,KAAK+V,SAElF/V,KAAKgZ,aAAeD,EAAc9C,IAAejW,KAAK8Y,cAClDH,EAAY1C,IAAejW,KAAK4W,eACvC,CAEDD,aACI,IAAID,EACJ,GAAI1W,KAAKuV,gBAAgBxU,MACrB,MAAMH,MAAM,uBAcX,GAAyB,iBAAdZ,KAAKuV,KAAmB,CACpC,MAAM0D,EAAajZ,KAAKuV,KACxBmB,WCtGewC,EAAgBD,EAAoBE,GACtDA,EAAWlQ,IAAIgQ,KAChBpQ,QAAQuQ,KAAK,sBAAsBH,2BACnCzC,EAAgB,EAAG,EAAG,IAE1B,MAAM6C,EAAcF,EAAWjZ,IAAI+Y,IAC5BK,EAAIC,EAAIC,GAAMH,EACfI,EAAKC,EAAWzC,IAAe0C,EAAOT,EAAK9C,iBAAiBkD,IAAMJ,EAAKxN,OACvEkO,EAAKF,EAAWzC,IAAe0C,EAAOT,EAAK9C,iBAAiBmD,IAAML,EAAKxN,OACvEmO,EAAKH,EAAWzC,IAAe0C,EAAOT,EAAK9C,iBAAiBoD,IAAMN,EAAKxN,OACvEoO,EAAO5C,EAAeD,IAAeD,EAAcC,IAAe2C,EAAIH,IACtEM,EAAO7C,EAAeD,IAAeD,EAAcC,IAAe4C,EAAID,IAC5E,OAAO1C,EAAeD,IAAeI,EAAWJ,IAAe8C,EAAMD,GACzE,CDyFqBnD,CAAW3W,KAAKmV,SAAU8D,EAAYjZ,KAAKkW,OAGvD,MACGQ,EAASF,EAAgB,EAAG,EAAG,GAEnC,OAAOE,CACV,QE/IQsD,EAITna,YAAYmL,EAAkBzG,GAE1BsE,QAAQC,IAAI,gCAAgCkC,YAAmBzG,KAC3DA,EAAKlC,OACLrC,KAAKia,KAAO,CACR5X,KAAMkC,EAAKlC,KACX6X,QAAS3V,EAAK2V,QAEdC,YAAa5V,EAAK4V,YAClBC,UAAW7V,EAAK6V,UAChBC,QAAS9V,EAAK8V,UAGtBra,KAAKsa,MAAQta,KAAKua,2BAA2BhW,EAAKiW,SAClDxa,KAAKya,wBACR,CAGSF,2BAA2BG,EAAwBC,EAAkCzY,UAAW0Y,EAAmB,QAGzH,QAA0B1Y,IAAtBwY,EACA,MAAM9Z,MAAM,2CAkBhB,IAAIia,EACJ,QAAoB3Y,IAAhByY,EACAE,EAASF,MACN,CACHE,EAAS,EACT,IAAK,IAAIC,KAAaza,OAAO0a,oBAAoBL,GAAoB,CAC7CA,EAAkBI,GAC1BE,SAASjM,IACjB,MAAMkM,EAAelM,EAAK,GAC1B8L,EAASrR,KAAKtE,IAAI2V,EAAQI,EAAa,GAE9C,GACCJ,CACL,CACD7a,KAAKkb,aAAeL,EAGpB,MAAMM,EAAuB,IAAIpa,MAAc8Z,GAAQO,KAAK,GAC5D,IAAK,IAAIN,KAAaza,OAAO0a,oBAAoBL,GAAoB,CAC7CA,EAAkBI,GAC1BE,SAASjM,IACjB,MAAMkM,EAAelM,EAAK,GACpBsM,EAAgBtM,EAAK,GAC3BoM,EAAqBF,IAAiBI,CAAa,GAE1D,CAED,MAAMC,EAAiC,IAAIhT,IAC3C,IAAK,IAAIiT,KAASlb,OAAO0a,oBAAoBL,GAAoB,CAC7D,MAAMc,EAASd,EAAkBa,GACjC,GAAsB,IAAlBC,EAAOpa,OACP,SAEJ,IAAIoZ,EAAoB,GAAI1P,EAAkB,GAAI2Q,EAAW,IAAInT,IACjE,IAAK,IAAKoT,EAAI3G,KAAMyG,EAAQ,CACxB,MAAMG,EAAK5G,EAAIoG,EAAqBO,GACpC,GAAKD,EAASxS,IAAIyS,GAIX,CACH,MAAME,EAAQH,EAASvb,IAAIwb,GAC3BlB,EAAQoB,IAAUD,CACrB,MANGF,EAAStb,IAAIub,EAAI5Q,EAAM1J,QACvB0J,EAAM/G,KAAK2X,GACXlB,EAAQzW,KAAK4X,EAKpB,CAED,MAAME,EAAMrB,EACPsB,KAAI,CAACrW,EAAQwE,IAAUxE,EApEP,KAoEmCwE,OAAQ/H,IAC3D6Z,QAAO9R,QAAmB/H,IAAV+H,IAChByE,MAAK,CAACU,EAAG2C,IAAMjH,EAAMsE,GAAMtE,EAAMiH,KAEtCjH,EAAQ+Q,EAAIC,KAAI3a,GAAK2J,EAAM3J,KAC3BqZ,EAAUqB,EAAIC,KAAI3a,GAAKqZ,EAAQrZ,KAC/Bma,EAAYnb,IAAIob,EAAO,CAACzQ,EAAO0P,GAClC,CAGD,IAAIwB,EAAcC,EACbX,EAAYrS,IAAI2R,IAIhBoB,EAAIC,GAAMX,EAAYpb,IAAI0a,IAH3BoB,EAAK,GACLC,EAAK,IAIT,MAAMC,EAAOf,EACRW,KAAI,CAAC1b,EAAO6J,IAAoB,IAAV7J,EAAc6J,GAAS,IAC7C8R,QAAO9R,GAASA,GAAS,IAe9B,OAdA+R,EAAKA,EAAG/N,OAAOiO,GACfD,EAAKA,EAAGhO,OAAO,IAAIlN,MAAcmb,EAAK9a,QAAQga,KAAK,IAC/Cc,EAAK9a,OAAS,IACV8a,EAAK9a,OAAS,IAEdyH,QAAQC,IAAI,4CAA4C8R,SAAgBsB,EAAK9a,gCAAgC8a,MAE7GrT,QAAQC,IAAI,4CAA4C8R,SAAgBsB,EAAK9a,gCAGjF4a,EAAG5a,OAAS,GACZka,EAAYnb,IAAIya,EAAU,CAACoB,EAAIC,IAG5BX,CACV,CAESb,yBACT,QCnJQ0B,EAoBTtc,YAAYuc,EAAkBpR,EAAkBzG,GAfhDvE,KAAAqc,MAAQ,IAAI/T,IAEZtI,KAAAsc,MAAgB,GAEhBtc,KAAAuc,eAAiB,IAAIjU,IACrBtI,KAAAkW,OAAS,IAAI5N,IACbtI,KAAAwc,mBAA8B,EAI9Bxc,KAAAyc,oBAAqB,EAErBzc,KAAK0L,MAAW,EAIZ1L,KAAKoc,MAAQA,EACbpc,KAAKia,KAAO,CACR5X,KAAMkC,EAAKlC,KACX6X,QAAS3V,EAAK2V,QACdwC,KAAMnY,EAAKmY,KACXvC,YAAa5V,EAAK4V,YAClBC,UAAW7V,EAAK6V,UAChBC,QAAS9V,EAAK8V,SAElBra,KAAKwc,mBAAqBjY,EAAKiY,mBAM/B,IAAK,IAAIG,KAActc,OAAO0a,oBAAoBxW,EAAKqY,QAAS,CAE5D,MAAMC,EAAStY,EAAKqY,OAAOD,GACvBE,GAAUA,EAAOzb,OAAS,GAC1BpB,KAAKuc,eAAepc,IAAIwc,EAAYE,EAE3C,CACDhU,QAAQC,IAAI,uDAAuD9I,KAAKuc,eAAe5O,QAGvF,IAAK,IAAImP,KAASzc,OAAO0a,oBAAoBxW,EAAK2R,QAC9ClW,KAAKkW,OAAO/V,IAAI2c,EAAOvY,EAAK2R,OAAO4G,IAIvC,MAAMC,EAAyB,IAAIC,IAC7BC,EAAqB,IAAIlc,MAC/B,IAAImc,GAAY,EAChB,KAAOH,EAAuBpP,MAAQpJ,EAAK8X,MAAMjb,QAAU8b,GAAYH,EAAuBpP,MAAM,CAChGuP,EAAWH,EAAuBpP,KAClC,IAAK,IAAImN,KAAaza,OAAO0a,oBAAoBxW,EAAK8X,OAAQ,CAC1D,MAAMc,EAAY5Y,EAAK8X,MAAMvB,GAC7B,IAAKiC,EAAuB9T,IAAI6R,GAAY,CACxC,MAAMvO,EAAS4Q,EAAkB,OACjC,GAAe,OAAX5Q,GAAqC,iBAAXA,EAAqB,CAC/C1D,QAAQC,IAAI,SAASgS,0BAAkCvO,MACvD,QACH,EACc,OAAXA,GAIKwQ,EAAuB9T,IAAIsD,MAHhCwQ,EAAuBna,IAAIkY,GAC3BmC,EAAmBlZ,KAAK+W,GAM/B,CACJ,CACJ,CACD,GAAIiC,EAAuBpP,OAAStN,OAAO0a,oBAAoBxW,EAAK8X,OAAOjb,OAAQ,CAC/E,IAAIgc,EAAU,GACd,IAAK,IAAI7B,KAAShX,EAAK8X,MACdU,EAAuB9T,IAAIsS,IAC5B6B,EAAQrZ,KAAKwX,GAGrB1S,QAAQC,IAAI,+BAA+BkC,sCAA6ChL,KAAKia,KAAK5X,oDAAoD+a,KACzJ,CAEDvU,QAAQC,IAAI,8BAA8BmU,EAAmB7b,UAS7D,IAAK,IAAI0Z,KAAamC,EAAoB,CACtC,MAAME,EAAY5Y,EAAK8X,MAAMvB,GAC7B,IAAIuC,EAAiBF,EAAUE,eAKD,iBAAnBA,IACPxU,QAAQC,IAAI,2BAA2BwU,KAAKC,UAAUF,0BAAuCvC,+FAC7FuC,EAAiB,MAGrBrd,KAAKwd,QAAQ1C,EAAWqC,EAAU5Q,OAAQ4Q,EAAUtG,KAAMsG,EAAUrG,KAAMuG,EAAgBF,EAAUM,UAAWN,EAAUO,kBAC5H,CAED1d,KAAKqW,QAEL,MAAMsH,EAAepZ,EAAmB,aACxC,QAAqBrC,IAAjByb,EAA4B,CAE5B,MAAM3S,EAAW,aAAa2S,IACxBpZ,EAAOmG,EAAkBO,cAAcC,SAASF,GACtD,IAAI4S,EACJ,IACIA,EAAON,KAAKO,MAAMtZ,EACrB,CACD,MAAOuZ,GAEH,MADAjV,QAAQC,IAAI,2BAA2BkC,OAAczG,EAAKlB,UAAU,EAAG,QACjEya,CACT,CACD9d,KAAK+d,cAAgB,IAAI/D,EAAkBhP,EAAU4S,GACrD5d,KAAKyc,oBAAqB,EAC1B5T,QAAQC,IAAI,oBAIf,CACJ,CAcDsN,iBAAiBuG,EAAoBqB,GAAa,GAC9C,GAAIhe,KAAKuc,eAAetT,IAAI0T,GAAa,CAErC,MAAMf,EAAQ5b,KAAKuc,eAAerc,IAAIyc,GAEtC,IAAI7R,EACJ,IAAIkT,EASA,MAAMpd,MAAM,uBATA,CACZ,MAAMqd,EAAaje,KAAKoc,MAAM8B,yBAC9BpT,EAAQ8Q,EAAME,KAAI3a,GAEP,CAAC8c,EADR9c,GAAQ,GACe8c,EAAW9c,EAAI,GAAI8c,EAAW9c,EAAI,KAIhE,CAKD,IAAImR,EAAI,EAAGC,EAAI,EAAGC,EAAI,EAStB,OARA1H,EAAMkQ,SAAQ3I,IACVC,GAAKD,EAAE,GACPE,GAAKF,EAAE,GACPG,GAAKH,EAAE,EAAE,IAEbC,GAAKxH,EAAM1J,OACXmR,GAAKzH,EAAM1J,OACXoR,GAAK1H,EAAM1J,OACJ,CAACkR,EAAGC,EAAGC,EACjB,CACD,MAAM5R,MAAM,kBAGf,CAMDyV,MAAMC,GACFtW,KAAKme,eAAYjc,EACjB,IAAK,MAAMkc,KAAQpe,KAAKqe,WACpBD,EAAK/H,MAAMC,EAElB,CAED3J,SACI,IAAK,MAAMyR,KAAQpe,KAAKqe,WACpBD,EAAKzR,QAEZ,CAED2R,eACI,IAAK,MAAMF,KAAQpe,KAAKqe,WACpBD,EAAKxI,sBAEZ,CAIDyI,WAII,YAHuBnc,IAAnBlC,KAAKme,YACLne,KAAKme,UAAYne,KAAKue,iBAEnBve,KAAKme,SACf,CAGOI,gBACJ,MAAMjU,EAAiB,GACvB,IAAIkU,EAAQ,IAAIxe,KAAKsc,OACrB,KAAOkC,EAAMpd,OAAS,GAAG,CACrB,MAAMgd,EAAOI,EAAMC,QACnBL,EAAKnU,MAAQK,EAAOlJ,OACpBkJ,EAAOvG,KAAKqa,GACZI,EAAQA,EAAMvQ,UAAUmQ,EAAMld,SACjC,CACD,OAAOoJ,CACV,CAGDkT,QACInb,EACA+S,EACAC,EACAC,EACAC,EACAC,EACAC,GAQA,GAAIpT,KAAQrC,KAAKqc,MACb,MAAMzb,MAAM,gBAAgBZ,KAAKia,KAAK5X,sCAAsCA,MAEhF,MAAM+b,EAAO,IAAIlJ,EAAKlV,KAAMqC,EAAM+S,EAAYC,EAAWC,EAAWC,EAAMC,EAAiBC,GAK3F,OAJAzV,KAAKqc,MAAMlc,IAAIkC,EAAM+b,GAChBhJ,GACDpV,KAAKsc,MAAMvY,KAAKqa,GAEbA,CACV,CAGDvI,QAAQxT,GACJ,MAAM+b,EAAOpe,KAAKqc,MAAMnc,IAAImC,GAC5B,QAAaH,IAATkc,EAEA,MADAvV,QAAQ6V,MAAM,oBAAoBrc,oBAC5BzB,MAAM,oBAAoByB,oBAEpC,OAAO+b,CACV,CAEDO,SAASV,EAAsBW,GAC3B,MAAMC,EAAS,IAAI9d,MAAckd,EAAW7c,QAAQga,KAAK,GACzD,IAAK,IAAKG,EAAOuD,KAAYF,EAAgBpc,UAAW,CACpD,MAAOsI,EAAO0P,GAAWsE,EACnBV,EAAOpe,KAAK6V,QAAQ0F,GAC1B,IAAK,IAAIpa,EAAI,EAAGA,EAAI2J,EAAM1J,SAAUD,EAAG,CACnC,MAAM4d,EAAkB,EAAXjU,EAAM3J,GACbsE,EAAS+U,EAAQrZ,GACjB8T,EAAM+J,EACR/H,IACAT,EAAgByH,EAAWc,GAAOd,EAAWc,EAAO,GAAId,EAAWc,EAAO,IAC1EX,EAAKpF,cACT6F,EAAOE,IAAS9J,EAAI,GAAKxP,EACzBoZ,EAAOE,EAAK,IAAM9J,EAAI,GAAKxP,EAC3BoZ,EAAOE,EAAK,IAAM9J,EAAI,GAAKxP,CAC9B,CACJ,CACD,OAAOoZ,CACV,EFzRW,SAAAI,EAAa7C,EAAkBpR,GAC3C,MAAMmD,EAQJ,SAAwBiO,EAAkB7X,EAAcyG,EAAW,UACrE,IAAI4S,EACJ,IACIA,EAAON,KAAKO,MAAMtZ,EACrB,CACD,MAAOuZ,GAEH,MADAjV,QAAQC,IAAI,2BAA2BkC,OAAczG,EAAKlB,UAAU,EAAG,QACjEya,CACT,CACD,OAAO,IAAI3B,EAASC,EAAOpR,EAAU4S,EACzC,CAlBiBsB,CACT9C,EACA1R,EAAkBO,cAAcC,SAASF,GACzCA,GAEJ,OADAnC,QAAQC,IAAI,wBAAwBqF,EAAKkO,MAAM1O,wBAAwB3C,KAChEmD,CACX,CAuBA,SAASwL,EAAOvK,GACZ,QAAUlN,IAANkN,EACA,MAAMxO,QAEV,OAAO4V,EAAgBpH,EAAE,GAAIA,EAAE,GAAIA,EAAE,GACzC,CGrCgB,SAAA+P,EAAiB3R,EAAsB4R,EAA8Bhf,EAAQ,EAAKif,GAAiB,GAE/G,MAAM/U,EAAS,IAAIhC,IAmCnB,OAlCI+W,EACA7R,EAAQwN,SAAS3Z,IAGb,IAAI6S,EAAM,EACV7S,EAAEie,mBAAmBtE,SAAQuE,IACzB,MAAMxL,EAAIqL,EAAQlf,IAAIqf,QACZrd,IAAN6R,EACAG,GAAOH,EAEPlL,QAAQC,IAAI,kBAAkByW,KACjC,IAELjV,EAAOnK,IAAIkB,EAAEme,WAAYpf,EAAQ8T,EAAI,IAKzC1G,EAAQwN,SAAS3Z,IAGb,IAAI6S,EAAM,EACV7S,EAAEie,mBAAmBtE,SAAQuE,IACzB,IAAIxL,EAAIqL,EAAQlf,IAAIqf,QACVrd,IAAN6R,IACAlL,QAAQC,IAAI,iBAAiByW,KAC7BxL,EAAI,EAAE,GAEVG,GAAOH,GAAK,CAAC,IAEjBzJ,EAAOnK,IAAIkB,EAAEme,WAAYpf,EAAQ8T,EAAI,IAItC5J,CACX,CCgBO,SAASvI,EAAIC,EAAmBhB,EAAOiB,GAI1C,YAHcC,IAAVlB,QAA0CkB,IAAnBlB,EAAME,WAC7BF,EAAME,SAAW,CAACF,EAAME,WAErBiB,EAAKH,EAAmBhB,EACnC,CACO,SAASmB,EAAKH,EAAmBhB,EAAOiB,GAC3C,IAAIG,EACJ,GAAiC,iBAAtBJ,EACP,OAAO,IAAIA,EAAkBhB,GAEjC,MAAMqB,EAAOL,EACb,OAAQK,GACJ,IAAK,MACL,IAAK,OACL,IAAK,OACL,IAAK,SACL,IAAK,OACL,IAAK,OACDD,EAAY,6BACZ,MACJ,QACIA,EAAY,+BAEpB,MAAME,EAAMhB,SAASiB,gBAAgBH,EAAWC,GAEhD,OADAoB,EAAqBnB,EAAKtB,EAAOoB,GAC1BE,CACX,CACO,SAASmB,EAAqBhC,EAAST,EAAOoB,GACjD,GAAIpB,QAAJ,CAEA,IAAK,IAAKiB,EAAK7B,KAAUC,OAAOmC,QAAQxB,GACpC,OAAQiB,GACJ,IAAK,WACD,MACJ,IAAK,SACDR,EAAQgB,UAAUrC,GAClB,MACJ,IAAK,QACDqB,EAAQiB,SAAStC,GACjB,MACJ,IAAK,QACDqB,EAAQkB,UAAUC,IAAIxC,GACtB,MACJ,IAAK,QACD,IAAK,IAAKyC,EAAMC,KAAWzC,OAAOmC,QAAQpC,GAAQ,CAC9C,MAAM2C,EAAQ,SACdF,EAAOA,EAAKG,QAAQD,GAAQE,GAAc,IAAMA,EAAUC,gBAC1DzB,EAAQ0B,MAAMC,YAAYP,EAAMC,EACnC,CACD,MACJ,IAAK,MACDzC,OAAOC,eAAeU,EAAMb,IAAIL,OAAQkB,EAAMb,IAAIJ,UAAW,CAAEK,MAAOqB,IACtE,MACJ,QACI,GAA4B,OAAxBQ,EAAIoB,UAAU,EAAG,GACjB5B,EAAQ6B,iBAAiBrB,EAAIsB,OAAO,GAAInD,QAGxC,GAAqB,iBAAVA,EAAoB,CAC3B,GAAkB,+BAAdgC,EAA4C,CAC5C,MAAMW,EAAQ,SACdd,EAAMA,EAAIe,QAAQD,GAAQE,GAAc,IAAMA,EAAUC,eAC3D,CACDzB,EAAQ+B,eAAe,KAAMvB,EAAK,GAAG7B,IACxC,EAIjB,QAAuB8B,IAAnBlB,EAAME,SACN,IAAK,IAAIW,KAASb,EAAME,SACC,iBAAVW,EACPJ,EAAQK,YAAYR,SAASC,eAAeM,IAG5CJ,EAAQK,YAAYD,EA7CrB,CAiDf,CCzIO,SAAS4d,EAAIC,KAAYC,GAC5B,IAAIC,EAAMF,EAAQ,GAIlB,OAHAC,EAAO3E,SAAQ,CAACjO,EAAG5L,KACfye,EAAMA,EAAI3R,OAAOlB,GAAGkB,OAAOyR,EAAQve,EAAI,GAAG,IAEvCye,CACX,CACO,SAASne,EAAQjB,EAAMU,GAC1B,MAAMO,EAAUH,SAASue,cAAcrf,GACvC,IAAK,IAAIW,EAAI,EAAGA,EAAID,EAASE,SAAUD,EAAG,CACtC,IAAIU,EAAQX,EAASC,GACjBU,aAAiBd,QACjBG,EAAS+C,OAAO9C,EAAG,KAAMU,GACzBA,EAAQX,EAASC,IAEA,iBAAVU,EAIXJ,EAAQK,YAAYD,GAHhBJ,EAAQK,YAAYR,SAASC,eAAeM,GAInD,CACD,OAAOJ,CACX,CAcO,SAASqe,GAAKA,GAAQ,OAAOxe,SAASC,eAAeue,EAAQ,CAC7D,MAAMC,GAAM,IAAI7e,IAAaO,EAAQ,MAAOP,GACtC8e,GAAO,IAAI9e,IAAaO,EAAQ,OAAQP,GAGxC+e,GAAQ,IAAI/e,IAAaO,EAAQ,QAASP,GAC1Cgf,GAAS,IAAIhf,IAAaO,EAAQ,SAAUP,GAC5Cif,GAAK,IAAIjf,IAAaO,EAAQ,KAAMP,GAEpCkf,GAAK,IAAIlf,IAAaO,EAAQ,KAAMP,GAO3Cmf,GAAK,6BACJ,SAASC,GAAIze,GAChB,MAAMkL,EAAIzL,SAASiB,gBAAgB8d,GAAI,OAIvC,YAHcne,IAAVL,GACAkL,EAAEjL,YAAYD,GAEXkL,CACX,CACO,SAASK,GAAKmT,GACjB,MAAM5R,EAAIrN,SAASiB,gBAAgB8d,GAAI,QAIvC,YAHUne,IAANqe,GACA5R,EAAEnL,eAAe,KAAM,IAAK+c,GAEzB5R,CACX,CAeO,SAASvD,GAAKoV,EAAIC,EAAIC,EAAIC,EAAIC,EAAQxF,GACzC,MAAMyF,EAAIvf,SAASiB,gBAAgB8d,GAAI,QAWvC,OAVAQ,EAAErd,eAAe,KAAM,KAAM,GAAGgd,KAChCK,EAAErd,eAAe,KAAM,KAAM,GAAGid,KAChCI,EAAErd,eAAe,KAAM,KAAM,GAAGkd,KAChCG,EAAErd,eAAe,KAAM,KAAM,GAAGmd,UACjBze,IAAX0e,GACAC,EAAErd,eAAe,KAAM,SAAUod,QAExB1e,IAATkZ,GACAyF,EAAErd,eAAe,KAAM,OAAQ4X,GAE5ByF,CACX,CC7FO,MAAMC,WAAqBjc,EAC9BhF,YAAYO,GACRa,MAAMb,EACT,ECHE,MAAM2gB,WAAkBtc,EAC3B5E,YAAYO,EAAQ,IAChBa,QACAjB,KAAK8E,OAAS1E,CACjB,CACG4gB,YAAQA,GACRhhB,KAAK8E,OAASkc,EACdhhB,KAAK2E,SAASH,SACjB,CACGwc,cACA,MAA2B,iBAAhBhhB,KAAK8E,OACL,IACI9E,KAAK8E,OAGb9E,KAAK8E,MACf,CACG1E,UAAMA,GACFJ,KAAK8E,SAAW1E,IAEC,iBAAVA,GAIXJ,KAAK8E,OAAS1E,EACdJ,KAAK2E,SAASH,WAJVqE,QAAQ6V,MAAM,8CAA8Cte,wBAKnE,CACGA,YACA,cAAeJ,KAAK8E,QAChB,IAAK,SACL,IAAK,SACD9E,KAAK8E,OAAS,GAAG9E,KAAK8E,SACtB,MACJ,IAAK,WACD9E,KAAK8E,OAAS9E,KAAK8E,SAG3B,OAAO9E,KAAK8E,MACf,ECtCE,MAAMmc,WAAkBF,GAC3BlhB,YAAYO,GACRa,MAAMb,EACT,ECFE,MAAM8gB,WAAezc,EACxB5E,YAAY0M,EAAQ4U,GAChBlgB,QACAjB,KAAKohB,OAAS,IAAIvd,EAClB7D,KAAKmhB,MAAQA,EACbnhB,KAAK0E,UAAW,CACnB,CACGtE,UAAMihB,GACN,MAAMzgB,MAAM,2CACf,CACGR,YACA,MAAMQ,MAAM,sCACf,CACD4D,QAAQD,GACCvE,KAAK0E,UAEV1E,KAAKohB,OAAO5c,QAAQD,EACvB,EC8CE,SAASxE,GAAU0B,EAASY,GAC/B,IAAItC,EAAY0B,EAAQ6f,aAAajf,GACrC,GAAkB,OAAdtC,EAEA,MADA8I,QAAQC,IAAI,sBAAwBzG,EAAO,QAASZ,GAC9Cb,MAAM,sBAAwByB,EAAO,QAAUZ,EAAQ8f,UAEjE,OAAOxhB,CACX,CACO,SAASyhB,GAAqB/f,EAASY,GAC1C,IAAItC,EAAY0B,EAAQ6f,aAAajf,GACrC,OAAqB,OAAdtC,OAAqBmC,EAAYnC,CAC5C,CC3EO,IAAI0hB,GAAmB,ICKvB,MACH5hB,cACIG,KAAK0hB,eAAiB,IAAIpZ,IAC1BtI,KAAK2hB,cAAgB,IAAIrZ,IACzBtI,KAAK4hB,cAAgB,IAAItZ,IACzBtI,KAAK6hB,WAAa,IAAIhe,CACzB,CACDie,eAAeC,EAAUpe,GACrB,IAAIqe,EAAS,IAAId,QAAOhf,EAAW6f,GAGnC,OAFAC,EAAOZ,OAAOxe,IAAIe,GAClB3D,KAAKiiB,eAAe,KAAOF,EAAUC,GAC9BA,CACV,CACDE,cAAcC,EAASC,GACnBpiB,KAAKiiB,eAAe,KAAOE,EAASC,EACvC,CACDH,eAAeE,EAASC,GACpB,IAAIC,EAAmBriB,KAAK0hB,eAAexhB,IAAIiiB,GAC1CE,IACDA,EAAmB,IAAIrF,IACvBhd,KAAK0hB,eAAevhB,IAAIgiB,EAASE,IAErCA,EAAiBzf,IAAIwf,GACrB,IAAIE,EAAkBtiB,KAAK2hB,cAAczhB,IAAIiiB,GAC7C,GAAKG,EAEL,IAAK,IAAIC,KAAQD,EACbC,EAAK7f,SAAS0f,EAErB,CACDI,aAAaL,EAASI,GAClB,GAAIA,EAAKE,YAAcF,EAAKE,aAAeziB,KAEvC,YADA6I,QAAQC,IAAI,2EAGhByZ,EAAKE,WAAaziB,KAClB,IAAI0iB,EAAkB1iB,KAAK4hB,cAAc1hB,IAAIqiB,GACxCG,IACDA,EAAkB,IAAI1F,IACtBhd,KAAK4hB,cAAczhB,IAAIoiB,EAAMG,IAEjCA,EAAgB9f,IAAIuf,GACpB,IAAIG,EAAkBtiB,KAAK2hB,cAAczhB,IAAIiiB,GACxCG,IACDA,EAAkB,IAAItF,IACtBhd,KAAK2hB,cAAcxhB,IAAIgiB,EAASG,IAEpCA,EAAgB1f,IAAI2f,GACpB,IAAII,EAAgB3iB,KAAK0hB,eAAexhB,IAAIiiB,GAC5C,GAAKQ,EAEL,IAAK,IAAIP,KAASO,EACdJ,EAAK7f,SAAS0f,EAErB,CACDQ,eAAeL,GACX,IAAKA,EAAKE,WACN,OACJ,GAAIF,EAAKE,aAAeziB,KACpB,MAAMY,MAAM,oDAChB,IAAIiiB,EAAW7iB,KAAK4hB,cAAc1hB,IAAIqiB,GACtC,GAAKM,EAEL,IAAK,IAAIV,KAAWU,EAAU,CAC1B,IAAIC,EAAQ9iB,KAAK2hB,cAAczhB,IAAIiiB,GAC9BW,IAELA,EAAMzZ,OAAOkZ,GACM,IAAfO,EAAMnV,MACN3N,KAAK2hB,cAActY,OAAO8Y,GAE9BI,EAAK7f,cAASR,GACjB,CACJ,CACD6gB,QACI,IAAK,IAAI/U,KAAShO,KAAK4hB,cACnB5T,EAAM,GAAGtL,cAASR,GAEtBlC,KAAK0hB,eAAeqB,QACpB/iB,KAAK2hB,cAAcoB,QACnB/iB,KAAK4hB,cAAcmB,OACtB,CACDC,KAAKb,EAASC,GACVpiB,KAAKkiB,cAAcC,EAASC,EAC/B,CACDJ,OAAOD,EAAUpe,GACb,OAAO3D,KAAK8hB,eAAeC,EAAUpe,EACxC,CACDmc,KAAKqC,EAAS/hB,GACV,IAAIgiB,EAAQ,IAAIrB,GAAU3gB,GAE1B,OADAJ,KAAKgjB,KAAKb,EAASC,GACZA,CACV,CACDa,KAAKd,EAAS/hB,GACV,IAAIgiB,EAAQ,IAAInB,GAAU7gB,GAE1B,OADAJ,KAAKgjB,KAAKb,EAASC,GACZA,CACV,CACDc,QAAQf,EAAS/hB,GACb,IAAIgiB,EAAQ,IAAItB,GAAa1gB,GAE7B,OADAJ,KAAKgjB,KAAKb,EAASC,GACZA,CACV,CACDe,OAAOhB,EAAS/hB,EAAO4E,GACnB,IAAIod,EAAQ,IAAIrd,EAAY3E,EAAO4E,GAEnC,OADAhF,KAAKgjB,KAAKb,EAASC,GACZA,CACV,GCjHE,MAAMgB,GACTvjB,cACIG,KAAKqjB,OAAQ,EACbrjB,KAAKsjB,YAActjB,KAAKsjB,YAAYN,KAAKhjB,MACzCA,KAAKujB,gBAAkBvjB,KAAKujB,gBAAgBP,KAAKhjB,KACpD,CACDwjB,QACIxjB,KAAKyjB,WACc,IAAfzjB,KAAKqjB,OAETrjB,KAAK0jB,sBAAsB1jB,KAAKsjB,YACnC,CACDK,OACI3jB,KAAKqjB,OAAQ,EACTrjB,KAAK4jB,UAAUC,UAAY7jB,MAC3BA,KAAK4jB,SAASE,cAErB,CACD9gB,QAAQ+gB,GACJ/jB,KAAKkK,KAAO6Z,EACZ/jB,KAAKgkB,eAAe,GACpBhkB,KAAKikB,YACLF,EAAUN,SACb,CACDA,UAAa,CACbS,aAAgB,CAChBF,eAAe5jB,GAAU,CACzB6jB,YAAe,CACfP,sBAAsB/f,GAClBwgB,OAAOT,sBAAsB/f,EAChC,CACD2f,YAAYc,GACRpkB,KAAKqkB,UAAYD,EACjBpkB,KAAKkkB,aACDlkB,KAAKqjB,QAETrjB,KAAKgkB,eAAe,GACpBhkB,KAAK0jB,sBAAsB1jB,KAAKujB,iBACnC,CACDA,gBAAgBa,GACZ,GAAIpkB,KAAKkK,KAEL,YADAlK,KAAKkK,KAAKoZ,YAAYc,GAG1B,IAAIE,EAAUlB,GAAcmB,oBAAsB,GAAKH,EAAOpkB,KAAKqkB,WAAajB,GAAcmB,oBAAsB,EACpHD,EAAUA,EAAU,EAAI,EAAIA,EAC5B,MAAMlkB,EAAQJ,KAAKwkB,KAAKF,GACxBtkB,KAAKgkB,eAAe5jB,GAChBJ,KAAKqjB,QAGLjjB,EAAQ,EACRJ,KAAK0jB,sBAAsB1jB,KAAKujB,gBAAgBP,KAAKhjB,QAGrDA,KAAKikB,YACDjkB,KAAK4jB,UAAY5jB,KAAK4jB,SAASa,WAAazkB,MAC5CA,KAAK4jB,SAASE,gBAGzB,CACDU,KAAKE,GACD,MAAO,IAAO,EAAIlb,KAAK8J,IAAI9J,KAAKmb,GAAKD,GACxC,EAELtB,GAAcmB,oBAAsB,IACpC,MAAMK,WAAyBxB,GAC3BvjB,YAAYkkB,GACR9iB,QACAjB,KAAK+jB,UAAYA,CACpB,CACDN,UACIzjB,KAAK+jB,UAAUN,SAClB,CACDS,aACIlkB,KAAK+jB,UAAUG,YAClB,CACDF,eAAe5jB,GACXJ,KAAK+jB,UAAUC,eAAe5jB,EACjC,CACD6jB,YACIjkB,KAAK+jB,UAAUE,WAClB,EAEE,MAAMY,GACLhB,cACA,QAAsB3hB,IAAlBlC,KAAKykB,SAGT,OAAIzkB,KAAKykB,oBAAoBG,GAClB5kB,KAAKykB,SAASV,UAElB/jB,KAAKykB,QACf,CACDX,eACI9jB,KAAKykB,cAAWviB,CACnB,CACD4iB,IAAIf,GACA,IAAIgB,EAKAA,EAJEhB,aAAqBX,GAIPW,EAHA,IAAIa,GAAiBb,GAKzC,MAAMiB,EAAoBhlB,KAAKykB,SAG/B,GAFAzkB,KAAKykB,SAAWM,EAChBA,EAAcnB,SAAW5jB,KACrBglB,EACAA,EAAkBpB,cAAW1hB,EAC7B8iB,EAAkBhiB,QAAQ+hB,OAEzB,CACD,GAAIF,GAASI,KACT,OAEJF,EAAcvB,OACjB,CACJ,EAELqB,GAASI,MAAO,ECvHT,MAAMC,WAAwBzgB,EACjC5E,cACIoB,QACAjB,KAAKmlB,aAAe,EACvB,CACGC,gBAAY/S,GACRrS,KAAKmlB,eAAiB9S,IAE1BrS,KAAKmlB,aAAe9S,EACpBrS,KAAK2E,SAASH,UACjB,CACG4gB,kBACA,OAAOplB,KAAKmlB,YACf,CACDE,mBAAmBD,GACf,OAAO,CACV,EChBE,MAAME,WAAkBJ,GAC3BrlB,YAAY0lB,EAAWnlB,GACnBa,QACAjB,KAAKulB,UAAYA,OACHrjB,IAAV9B,IACAJ,KAAK8E,OAAS1E,EAErB,CACGA,YACA,OAAOJ,KAAK8E,MACf,CACG1E,UAAMA,GACNJ,KAAKwlB,SAASplB,EACjB,CACGglB,kBACA,OAAOplB,KAAKC,UACf,CACGmlB,gBAAYhlB,GACZJ,KAAKO,WAAWH,EACnB,CACDqlB,WACI,OAAOzlB,KAAK8E,MACf,CACD0gB,SAASplB,GACDJ,KAAK8E,SAAW1E,IAGpBJ,KAAK8E,OAAS1E,EACdJ,KAAK2E,SAASH,UACjB,CACDvE,WACI,OAAOD,KAAKulB,UAAUvlB,KAAK8E,OAC9B,CACDvE,WAAWH,GACP,MAAMkS,EAAItS,KAAKulB,UAAUnlB,GACzB,QAAU8B,IAANoQ,GAAgD,iBAAtBtS,KAAKulB,UAAUjT,GAAiB,CAC1D,IAAIoT,EAAiB,GAarB,OAZArlB,OAAOslB,KAAK3lB,KAAKulB,WAAWvK,SAAQ/Y,IAChC,MAAM2jB,EAAa5lB,KAAKulB,UAAUtjB,GACR,iBAAf2jB,IAEHF,EAD0B,IAA1BA,EAAetkB,OACE,GAAGskB,MAAmBE,IAGtBA,EAExB,SAEL/c,QAAQ6V,MAAM,4BAA4Bte,sCAA0CslB,IAEvF,CACG1lB,KAAK8E,SAAWwN,IAGpBtS,KAAK8E,OAASwN,EACdtS,KAAK2E,SAASH,UACjB,CACD6gB,mBAAmBjlB,GACf,MAAMkS,EAAItS,KAAKulB,UAAUnlB,GACzB,YAAa8B,IAANoQ,GAAgD,iBAAtBtS,KAAKulB,UAAUjT,EACnD,EC3DE,MAAMuT,WAAaC,YACtBnb,cAActI,EAAMkgB,EAAMvd,GACtB,MAAMvD,EAAU0iB,OAAO4B,eAAe7lB,IAAImC,QAC1BH,IAAZT,EACA0iB,OAAO4B,eAAeC,OAAO3jB,EAAMkgB,EAAMvd,GAGrCvD,IAAY8gB,GACZ1Z,QAAQ6V,MAAM,gBAAgBrc,+DAGzC,CACDxC,YAAYmB,GACRC,QACAwC,EAAqBzD,KAAMgB,EAC9B,CACDilB,YAAY9iB,GACRnD,KAAKkmB,WAAWpkB,YAAYR,SAAS6kB,WAAWhjB,GAAO,GAC1D,CACDT,SAAS0f,GACLvZ,QAAQ6V,MAAM,+DACjB,CACD0H,aACI,IAAKpmB,KAAKqmB,aAAa,SACnB,MAAMzlB,MAAM,wBAChB,IAAIuhB,EAAUniB,KAAKshB,aAAa,SAChC,IAAKa,EACD,MAAMvhB,MAAM,eAChB,MAAO,KAAOuhB,CACjB,CACDmE,cACI,IAAKtmB,KAAKqmB,aAAa,UACnB,MAAMzlB,MAAM,yBAChB,IAAImhB,EAAW/hB,KAAKshB,aAAa,UACjC,IAAKS,EACD,MAAMnhB,MAAM,gBAChB,MAAO,KAAOmhB,CACjB,CACDwE,oBACI,GAAIvmB,KAAKyiB,WACL,OACJ,IAAIN,EAAU,GACd,IACIA,EAAUniB,KAAKomB,YAClB,CACD,MAAOtI,GACN,CACc,IAAXqE,GACAV,GAAiBe,aAAaL,EAASniB,KAC9C,CACDwmB,uBACQxmB,KAAKyiB,YACLziB,KAAKyiB,WAAWG,eAAe5iB,KACtC,ECtDE,MAAMymB,WAAkBZ,GAC3BhmB,YAAY6mB,GACRzlB,MAAMylB,QACcxkB,IAAhBwkB,GAAMtE,OACNpiB,KAAK0C,SAASgkB,EAAKtE,MAE1B,CACDuE,cAAiB,CACjBC,WAAWriB,GAAS,CACpB7B,SAAS0f,GACL,GAAIA,IAAUpiB,KAAKoiB,MACf,OACJ,MAAMG,EAAOviB,KACTA,KAAKoiB,OACLpiB,KAAKoiB,MAAMzd,SAASX,OAAOue,GAC3BH,GACAA,EAAMzd,SAAS/B,KAAK2B,GAASge,EAAKqE,WAAWriB,IAAOge,GACxDviB,KAAKoiB,MAAQA,EACTpiB,KAAK6mB,aACL7mB,KAAK4mB,gBAAW1kB,EAEvB,CACDqkB,oBACItlB,MAAMslB,oBACFvmB,KAAKoiB,OACLpiB,KAAK4mB,gBAAW1kB,EACvB,ECvBE,MAAM4kB,WAAmBL,GAC5B5mB,YAAY6mB,GACRzlB,MAAMylB,EACT,CACDH,oBACI,GAAIvmB,KAAKyiB,WACLziB,KAAK4mB,iBADT,CAIA,IACInF,GAAiBe,aAAaxiB,KAAKsmB,cAAetmB,KACrD,CACD,MAAOqB,GACN,CACD,IACIogB,GAAiBe,aAAaxiB,KAAKomB,aAAcpmB,KACpD,CACD,MAAOqB,GACN,CACDrB,KAAK4mB,YAXJ,CAYJ,CACDJ,uBACIvlB,MAAMulB,uBACFxmB,KAAKyiB,YACLziB,KAAKyiB,WAAWG,eAAe5iB,KACtC,CACD0C,SAAS0f,GACL,IAAKA,EAQD,OAPIpiB,KAAKoiB,OACLpiB,KAAKoiB,MAAMzd,SAASX,OAAOhE,MAC3BA,KAAKgiB,QACLhiB,KAAKgiB,OAAOrd,SAASX,OAAOhE,MAChCA,KAAKoiB,WAAQlgB,EACblC,KAAKgiB,YAAS9f,OACdlC,KAAK4mB,aAGT,GAAIxE,aAAiBlB,GACjBlhB,KAAKgiB,OAASI,EACdpiB,KAAKgiB,OAAOrd,SAAS/B,KAAI,KACrB5C,KAAK4mB,YAAY,GAClB5mB,UAEF,MAAIoiB,aAAiBrB,IAOtB,MAAMngB,MAAM,4BAA8BwhB,EAAMviB,YAAYwC,MAN5DrC,KAAKoiB,MAAQA,EACbpiB,KAAKoiB,MAAMzd,SAAS/B,KAAI,KACpB5C,KAAK4mB,YAAY,GAClB5mB,KAIN,CACDA,KAAK4mB,YACR,CACDnkB,UAAUrC,GACN,GAAIA,aAAiB2mB,SAAU,CAC3B,MAAM/E,EAAS,IAAId,QAAOhf,EAAW,IACrC8f,EAAOZ,OAAOxe,IAAIxC,GAClBJ,KAAK0C,SAASsf,EACjB,MAEGhiB,KAAK0C,SAAStC,EAErB,CACD4mB,YACI,YAAuB9kB,IAAhBlC,KAAKgiB,QAAwBhiB,KAAKgiB,OAAOpd,OACnD,ECrEE,MAAMzB,GAAQ7B,SAASue,cAAc,SAC5C1c,GAAM8jB,YAAcxH,CAAI;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ECCjB,MAAMyH,WAAaT,GACtB5mB,YAAY6mB,GACRzlB,MAAMylB,GACN1mB,KAAKigB,MAAQ3e,SAASue,cAAc,SACpC7f,KAAKigB,MAAMtd,UAAUC,IAAI,WACzB5C,KAAKigB,MAAMkH,QAAU,KAAQnnB,KAAK2mB,aAAa,EAC/C3mB,KAAKonB,MAAQpnB,KAAKonB,MAAMpE,KAAKhjB,MAC7BA,KAAKigB,MAAMoH,QAAUrnB,KAAKonB,MAC1BpnB,KAAKsnB,aAAa,CAAEC,KAAM,SAC1BvnB,KAAKimB,YAAYuB,IACjBxnB,KAAKkmB,WAAWpkB,YAAY9B,KAAKigB,MACpC,CACDmH,MAAM/lB,GACErB,KAAKoiB,iBAAiBrd,IAClB1D,EAAEomB,OAAS,IACXznB,KAAKoiB,MAAM/c,YACXhE,EAAEqmB,kBAEFrmB,EAAEomB,OAAS,IACXznB,KAAKoiB,MAAMhd,YACX/D,EAAEqmB,kBAGb,CACDC,QACI3nB,KAAKigB,MAAM0H,OACd,CACDC,OACI5nB,KAAKigB,MAAM2H,MACd,CACUC,gCAAuB,MAAO,CAAC,QAAW,CACrDC,yBAAyBzlB,EAAM0lB,EAAUC,GACrC,GACS,UADD3lB,EAEIrC,KAAKoiB,YAAsBlgB,IAAb8lB,IACdhoB,KAAKoiB,MAAMhiB,MAAQ4nB,EAIlC,CACDrB,cACQ3mB,KAAKoiB,QACLpiB,KAAKoiB,MAAMhiB,MAAQJ,KAAKigB,MAAM7f,OAElCJ,KAAKioB,aAAa,QAASjoB,KAAKigB,MAAM7f,MACzC,CACDwmB,aACI,IAAK5mB,KAAKoiB,MACN,OACJ,MAAM8F,EAAW,GAAGloB,KAAKoiB,MAAMhiB,QAC3BJ,KAAKigB,MAAM7f,QAAU8nB,IACrBloB,KAAKigB,MAAM7f,MAAQ8nB,EACnBloB,KAAKioB,aAAa,QAASjoB,KAAKigB,MAAM7f,OAE7C,CACGA,YACA,OAAOJ,KAAKigB,MAAM7f,KACrB,CACGA,UAAMA,GACNJ,KAAKigB,MAAM7f,MAAQA,EACnBJ,KAAK2mB,aACR,EAELO,GAAKlB,OAAO,UAAWkB,IClEhB,IAAIiB,GAAgB7mB,SAASue,cAAc,SAClDsI,GAAclB,YAAc,w/DCErB,MAAMmB,WAAiB3B,GAC1B5mB,cACIoB,QACAmnB,GAASC,SAAWroB,KACpB,IAAIsoB,EAAUC,EAAK,MAAO,CAAEC,MAAO,YACnCxoB,KAAKyoB,SAAWF,EAAK,SAAU,CAAEC,MAAO,OAAQtnB,SAAU,OAC1DlB,KAAKyoB,SAASC,QAAU,KACpBpnB,SAASqnB,YAAY,eAAe,EAAO,QAC3C3oB,KAAK2M,QAAQ,EAEjB2b,EAAQxmB,YAAY9B,KAAKyoB,UACzBzoB,KAAK4oB,SAAWL,EAAK,SAAU,CAAErnB,SAAU,OAC3ClB,KAAK4oB,SAASF,QAAU,KACpBpnB,SAASqnB,YAAY,eAAe,EAAO,QAC3C3oB,KAAK2M,QAAQ,EAEjB2b,EAAQxmB,YAAY9B,KAAK4oB,UACzB5oB,KAAK6oB,SAAWN,EAAK,SAAU,CAAErnB,SAAU,OAC3ClB,KAAK6oB,SAASH,QAAU,KACpBpnB,SAASqnB,YAAY,eAAe,EAAO,QAC3C3oB,KAAK2M,QAAQ,EAEjB2b,EAAQxmB,YAAY9B,KAAK6oB,UACzB7oB,KAAK8oB,SAAWP,EAAK,SAAU,CAAEC,MAAO,QAAStnB,SAAU,OAC3DlB,KAAK8oB,SAASJ,QAAU,KACpBpnB,SAASqnB,YAAY,eAAe,EAAO,QAC3C3oB,KAAK2M,QAAQ,EAEjB2b,EAAQxmB,YAAY9B,KAAK8oB,UACzBR,EAAQxmB,YAAYR,SAASC,eAAe,MAC5CvB,KAAK+oB,WAAaR,EAAK,SAAU,CAAEC,MAAO,OAAQtnB,SAAUqnB,EAAK,IAAK,CAAErnB,SAAU,QAClFlB,KAAK+oB,WAAWL,QAAU,KACtBpnB,SAASqnB,YAAY,QAAQ,GAC7B3oB,KAAK2M,QAAQ,EAEjB2b,EAAQxmB,YAAY9B,KAAK+oB,YACzB/oB,KAAKgpB,aAAeT,EAAK,SAAU,CAAErnB,SAAUqnB,EAAK,IAAK,CAAErnB,SAAU,QACrElB,KAAKgpB,aAAaN,QAAU,KACxBpnB,SAASqnB,YAAY,UAAU,GAC/B3oB,KAAK2M,QAAQ,EAEjB2b,EAAQxmB,YAAY9B,KAAKgpB,cACzBhpB,KAAKipB,gBAAkBV,EAAK,SAAU,CAAErnB,SAAUqnB,EAAK,IAAK,CAAErnB,SAAU,QACxElB,KAAKipB,gBAAgBP,QAAU,KAC3BpnB,SAASqnB,YAAY,aAAa,GAClC3oB,KAAK2M,QAAQ,EAEjB2b,EAAQxmB,YAAY9B,KAAKipB,iBACzBjpB,KAAKkpB,oBAAsBX,EAAK,SAAU,CAAErnB,SAAUqnB,EAAK,SAAU,CAAErnB,SAAU,QACjFlB,KAAKkpB,oBAAoBR,QAAU,KAC/BpnB,SAASqnB,YAAY,iBAAiB,GACtC3oB,KAAK2M,QAAQ,EAEjB2b,EAAQxmB,YAAY9B,KAAKkpB,qBACzBlpB,KAAKmpB,gBAAkBZ,EAAK,SAAU,CAAErnB,SAAU,OAClDlB,KAAKmpB,gBAAgBT,QAAU,KAC3BpnB,SAASqnB,YAAY,aAAa,GAClC3oB,KAAK2M,QAAQ,EAEjB2b,EAAQxmB,YAAY9B,KAAKmpB,iBACzBnpB,KAAKopB,kBAAoBb,EAAK,SAAU,CAAEC,MAAO,QAAStnB,SAAU,OACpElB,KAAKopB,kBAAkBV,QAAU,KAC7BpnB,SAASqnB,YAAY,eAAe,GACpC3oB,KAAK2M,QAAQ,EAEjB2b,EAAQxmB,YAAY9B,KAAKopB,mBACzBd,EAAQxmB,YAAYR,SAASC,eAAe,MAC5CvB,KAAKqpB,kBAAoBd,EAAK,SAAU,CAAEC,MAAO,OAAQtnB,SAAUooB,EAAM,MAAO,CAAEC,QAAS,WAAYC,MAAO,KAAM7jB,OAAQ,IAAKzE,SAAU,CAACqnB,EAAK,OAAQ,CAAE/H,GAAI,IAAKC,GAAI,MAAOC,GAAI,KAAMC,GAAI,MAAO6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,IAAKC,GAAI,MAAOC,GAAI,IAAKC,GAAI,MAAO6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,IAAKC,GAAI,MAAOC,GAAI,KAAMC,GAAI,MAAO6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,IAAKC,GAAI,MAAOC,GAAI,IAAKC,GAAI,MAAO6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,IAAKC,GAAI,MAAOC,GAAI,KAAMC,GAAI,MAAO6H,MAAO,gBACzfxoB,KAAKqpB,kBAAkBX,QAAU,KAC7BpnB,SAASqnB,YAAY,eAAe,GACpC3oB,KAAK2M,QAAQ,EAEjB2b,EAAQxmB,YAAY9B,KAAKqpB,mBACzBrpB,KAAKypB,oBAAsBlB,EAAK,SAAU,CAAErnB,SAAUooB,EAAM,MAAO,CAAEC,QAAS,WAAYC,MAAO,KAAM7jB,OAAQ,IAAKzE,SAAU,CAACqnB,EAAK,OAAQ,CAAE/H,GAAI,IAAKC,GAAI,MAAOC,GAAI,KAAMC,GAAI,MAAO6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,IAAKC,GAAI,MAAOC,GAAI,IAAKC,GAAI,MAAO6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,IAAKC,GAAI,MAAOC,GAAI,KAAMC,GAAI,MAAO6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,IAAKC,GAAI,MAAOC,GAAI,IAAKC,GAAI,MAAO6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,IAAKC,GAAI,MAAOC,GAAI,KAAMC,GAAI,MAAO6H,MAAO,gBAC5exoB,KAAKypB,oBAAoBf,QAAU,KAC/BpnB,SAASqnB,YAAY,iBAAiB,GACtC3oB,KAAK2M,QAAQ,EAEjB2b,EAAQxmB,YAAY9B,KAAKypB,qBACzBzpB,KAAK0pB,mBAAqBnB,EAAK,SAAU,CAAEC,MAAO,QAAStnB,SAAUooB,EAAM,MAAO,CAAEC,QAAS,WAAYC,MAAO,KAAM7jB,OAAQ,IAAKzE,SAAU,CAACqnB,EAAK,OAAQ,CAAE/H,GAAI,IAAKC,GAAI,MAAOC,GAAI,KAAMC,GAAI,MAAO6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,IAAKC,GAAI,MAAOC,GAAI,KAAMC,GAAI,MAAO6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,IAAKC,GAAI,MAAOC,GAAI,KAAMC,GAAI,MAAO6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,IAAKC,GAAI,MAAOC,GAAI,KAAMC,GAAI,MAAO6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,IAAKC,GAAI,MAAOC,GAAI,KAAMC,GAAI,MAAO6H,MAAO,gBAC7fxoB,KAAK0pB,mBAAmBhB,QAAU,KAC9BpnB,SAASqnB,YAAY,gBAAgB,GACrC3oB,KAAK2M,QAAQ,EAEjB2b,EAAQxmB,YAAY9B,KAAK0pB,oBACzB1pB,KAAKsnB,aAAa,CAAEC,KAAM,SAC1BvnB,KAAKkmB,WAAWpkB,YAAYR,SAAS6kB,WAAWgC,IAAe,IAC/DnoB,KAAKkmB,WAAWpkB,YAAYwmB,EAC/B,CACD3b,SACI3M,KAAKyoB,SAAS9lB,UAAUgnB,OAAO,SAAwD,OAA9CroB,SAASsoB,kBAAkB,gBACpE5pB,KAAK4oB,SAASjmB,UAAUgnB,OAAO,SAAwD,OAA9CroB,SAASsoB,kBAAkB,gBACpE5pB,KAAK6oB,SAASlmB,UAAUgnB,OAAO,SAAwD,OAA9CroB,SAASsoB,kBAAkB,gBACpE5pB,KAAK8oB,SAASnmB,UAAUgnB,OAAO,SAAwD,OAA9CroB,SAASsoB,kBAAkB,gBACpE5pB,KAAK+oB,WAAWpmB,UAAUgnB,OAAO,SAAUroB,SAASuoB,kBAAkB,SACtE7pB,KAAKgpB,aAAarmB,UAAUgnB,OAAO,SAAUroB,SAASuoB,kBAAkB,WACxE7pB,KAAKipB,gBAAgBtmB,UAAUgnB,OAAO,SAAUroB,SAASuoB,kBAAkB,cAC3E7pB,KAAKkpB,oBAAoBvmB,UAAUgnB,OAAO,SAAUroB,SAASuoB,kBAAkB,kBAC/E7pB,KAAKmpB,gBAAgBxmB,UAAUgnB,OAAO,SAAUroB,SAASuoB,kBAAkB,cAC3E7pB,KAAKopB,kBAAkBzmB,UAAUgnB,OAAO,SAAUroB,SAASuoB,kBAAkB,gBAC7E7pB,KAAKqpB,kBAAkB1mB,UAAUgnB,OAAO,SAAUroB,SAASuoB,kBAAkB,gBAC7E7pB,KAAKypB,oBAAoB9mB,UAAUgnB,OAAO,SAAUroB,SAASuoB,kBAAkB,kBAC/E7pB,KAAK0pB,mBAAmB/mB,UAAUgnB,OAAO,SAAUroB,SAASuoB,kBAAkB,gBACjF,EAELzB,GAASpC,OAAO,cAAeoC,ICxGxB,MAAM0B,WAAiBrD,GAC1B5mB,YAAY6mB,GACRzlB,MAAMylB,GACN,IAAIqD,EAAUzoB,SAASue,cAAc,OACrC7f,KAAK+pB,QAAUA,EACfA,EAAQpnB,UAAUC,IAAI,WACtBmnB,EAAQC,gBAAkB,OAC1BD,EAAQ5C,QAAW8C,IACf,GAAIjqB,KAAKoiB,iBAAiBnB,GAAW,CACjC,IAAIiJ,EAAaD,EAAM5a,OAAO6a,WAC1BA,GAAsC,IAAxBA,EAAWC,SACzB7oB,SAASqnB,YAAY,eAAe,EAAO,SAEhB,SAAtBoB,EAAQK,YACbL,EAAQK,UAAY,GAE3B,CACDpqB,KAAK2mB,aAAa,EAEtBoD,EAAQM,UAAaJ,IACXjqB,KAAKoiB,iBAAiBnB,MAGN,IAAlBgJ,EAAMK,SAAkC,MAAdL,EAAMhoB,KAChCgoB,EAAMvC,iBACNpmB,SAASqnB,YAAY,QAAQ,GAC7B3oB,KAAKuqB,mBAEkB,IAAlBN,EAAMK,SAAkC,MAAdL,EAAMhoB,KACrCgoB,EAAMvC,iBACNpmB,SAASqnB,YAAY,UAAU,GAC/B3oB,KAAKuqB,mBAEkB,IAAlBN,EAAMK,SAAkC,MAAdL,EAAMhoB,KACrCgoB,EAAMvC,iBACNpmB,SAASqnB,YAAY,aAAa,GAClC3oB,KAAKuqB,kBAEc,QAAdN,EAAMhoB,IACXgoB,EAAMvC,iBAEa,UAAduC,EAAMhoB,MACQ,IAAnBgoB,EAAMO,UACwC,eAA9ClpB,SAASsoB,kBAAkB,gBAC3BtoB,SAASqnB,YAAY,eAAe,EAAO,OAC9C,EAELoB,EAAQU,QAAU,KACdzqB,KAAKuqB,gBAAgB,EAEzBR,EAAQW,UAAY,KAChB1qB,KAAKuqB,gBAAgB,EAEzBvqB,KAAKsnB,aAAa,CAAEC,KAAM,SAC1BvnB,KAAKimB,YAAYuB,IACjBxnB,KAAKkmB,WAAWpkB,YAAYioB,EAC/B,CACDQ,sBAC8BroB,IAAtBkmB,GAASC,UACTD,GAASC,SAAS1b,QACzB,CACDga,cACQ3mB,KAAKoiB,QACLpiB,KAAKoiB,MAAMpB,QAAU,IACbhhB,KAAKoiB,iBAAiBnB,GACfjhB,KAAK+pB,QAAQK,UAGbpqB,KAAK+pB,QAAQY,UAInC,CACD/D,aACS5mB,KAAKoiB,QAGNpiB,KAAKoiB,iBAAiBnB,GAClBjhB,KAAK+pB,QAAQK,YAAcpqB,KAAKoiB,MAAMhiB,QACtCJ,KAAK+pB,QAAQK,UAAYpqB,KAAKoiB,MAAMhiB,OAIpCJ,KAAK+pB,QAAQY,YAAc3qB,KAAKoiB,MAAMhiB,QACtCJ,KAAK+pB,QAAQY,UAAY3qB,KAAKoiB,MAAMhiB,OAG/C,EAEL0pB,GAAS9D,OAAO,cAAe8D,ICzFxB,MAAMc,WAAgBnE,GACzB5mB,YAAY6mB,GACRzlB,MAAMylB,EACT,CACDE,kBACuB1kB,IAAflC,KAAKoiB,MAILpiB,KAAKoiB,iBAAiBrB,GACtB/gB,KAAK2qB,UAAY3qB,KAAKoiB,MAAMhiB,MAG5BJ,KAAKoiB,iBAAiBnB,GACtBjhB,KAAKoqB,UAAYpqB,KAAKoiB,MAAMhiB,MAG5BJ,KAAKoiB,iBAAiBrd,IACtB/E,KAAK2qB,UAAY,GAAG3qB,KAAKoiB,MAAMhiB,SAZ/BJ,KAAK2qB,UAAY,EAexB,EAELC,GAAQ5E,OAAO,aAAc4E,IC1BtB,MAAMznB,GAAQ7B,SAASue,cAAc,SAC5C1c,GAAM8jB,YAAcxH,CAAI;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ECEjB,MAAMoL,WAAe/D,GACxBjnB,YAAY6mB,GACRzlB,MAAMylB,GACN1mB,KAAKkgB,OAASA,GAAOlgB,KAAK8qB,MAAQ9K,MAClChgB,KAAKkgB,OAAOvd,UAAUC,IAAI,aAC1B5C,KAAK8qB,MAAMnoB,UAAUC,IAAI,YACzB5C,KAAKkgB,OAAOwI,QAAU,KACd1oB,KAAKgiB,QACLhiB,KAAKgiB,OAAOxd,SAAS,EAE7BxE,KAAKkgB,OAAO6K,UAAW,EACvB/qB,KAAKsnB,aAAa,CAAEC,KAAM,SAC1BvnB,KAAKimB,YAAY+E,IACjBhrB,KAAKkmB,WAAWpkB,YAAY9B,KAAKkgB,OACpC,CACDqG,oBACItlB,MAAMslB,oBACuB,IAAzBvmB,KAAKkB,SAASE,SAGlBpB,KAAKirB,UAAY,IAAIC,kBAAiB,CAACC,EAAQC,UACvBlpB,IAAhBlC,KAAKqrB,QACLC,aAAatrB,KAAKqrB,QACtBrrB,KAAKqrB,OAASlH,OAAOoH,YAAW,KAC5BvrB,KAAKqrB,YAASnpB,EACdlC,KAAK4mB,YAAY,GAClB,IAAI,IAEX5mB,KAAKirB,UAAUO,QAAQxrB,KAAM,CACzByrB,WAAW,EACXC,SAAS,EACTC,eAAe,IAEtB,CACD/E,aACS5mB,KAAK6mB,cAEN7mB,KAAKoiB,OAASpiB,KAAKoiB,MAAMhiB,MACrBJ,KAAKoiB,iBAAiBnB,GACtBjhB,KAAK8qB,MAAMV,UAAYpqB,KAAKoiB,MAAMhiB,MAElCJ,KAAK8qB,MAAMH,UAAY3qB,KAAKoiB,MAAMhiB,MAGtCJ,KAAK8qB,MAAMV,UAAYpqB,KAAKoqB,UAEhCpqB,KAAKkgB,OAAO6K,UAAY/qB,KAAKgnB,YAChC,EAEL6D,GAAO7E,OAAO,YAAa6E,ICnDpB,MAAMe,WAAoBnF,GAC7B/jB,SAAS0f,GACL,QAAclgB,IAAVkgB,KAAyBA,aAAiBtB,IAC1C,MAAMlgB,MAAM,6DAEhBK,MAAMyB,SAAS0f,EAClB,CACDuE,cACQ3mB,KAAKoiB,QACLpiB,KAAKoiB,MAAMhiB,MAAQJ,KAAKigB,MAAM4L,QAErC,CACDjF,aACS5mB,KAAKoiB,OAAUpiB,KAAKoiB,MAAMxd,QAI3B5E,KAAKigB,MAAM6L,gBAAgB,YAH3B9rB,KAAKigB,MAAMgI,aAAa,WAAY,IAKpCjoB,KAAKoiB,QACLpiB,KAAKigB,MAAM4L,QAAU7rB,KAAKoiB,MAAMhiB,MAEvC,ECvBE,MAAM+C,GAAQ7B,SAASue,cAAc,SAC5C1c,GAAM8jB,YAAcxH,CAAI;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ECCjB,MAAMsM,WAAiBH,GAC1B/rB,YAAY6mB,GACRzlB,MAAMylB,GACN1mB,KAAK2C,UAAUC,IAAI,eACnB5C,KAAKigB,MAAQA,KACbjgB,KAAKigB,MAAMzf,KAAO,WAClBR,KAAKigB,MAAM+L,SAAW,KAClBhsB,KAAK2mB,aAAa,EAEtB,MAAMsF,EAAY3L,GAAIlT,GAAK,qIAC3BpN,KAAKsnB,aAAa,CAAEC,KAAM,SAC1BvnB,KAAKimB,YAAYiG,IACjBlsB,KAAKkmB,WAAWpkB,YAAY9B,KAAKigB,OACjCjgB,KAAKkmB,WAAWpkB,YAAYmqB,EAC/B,EAELF,GAAS/F,OAAO,cAAe+F,IClBxB,MAAM5oB,GAAQ7B,SAASue,cAAc,SAC5C1c,GAAM8jB,YAAcxH,CAAI;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;GCCjB,MAAM0M,WAAe1F,GACxB5mB,YAAY6mB,GAEL,IAAC0F,EAAIC,EAAOlrB,EAAGwN,EADlB1N,MAAMylB,GAEN,MAAM3S,E1BiCM,KAAI7S,IAAaO,EAAQ,OAAQP,G0BjCnCorB,CAAKvM,GAAIqM,EAAK9L,GAAI3R,EAAIvB,GAAK,kIAAmIjM,EAAI8e,MAAcC,GAAOmM,EAAK/L,GAAIlT,GAAK,qMAC/Mgf,EAAG5oB,eAAe,KAAM,QAAS,QACjC4oB,EAAG5oB,eAAe,KAAM,SAAU,QAClCmL,EAAEnL,eAAe,KAAM,YAAa,mBACpC6oB,EAAG7oB,eAAe,KAAM,QAAS,QACjC6oB,EAAG7oB,eAAe,KAAM,SAAU,QAClCrC,EAAEX,KAAO,SACTW,EAAEorB,YAAc,SAChBprB,EAAEqrB,aAAe,MACjBzY,EAAEpR,UAAUC,IAAI,aAChB5C,KAAKsnB,aAAa,CAAEC,KAAM,SAC1BvnB,KAAKimB,YAAYwG,IACjBzsB,KAAKkmB,WAAWpkB,YAAYiS,EAC/B,EAELoY,GAAOnG,OAAO,YAAamG,ICrBpB,MAAMhpB,GAAQ7B,SAASue,cAAc,SAC5C1c,GAAM8jB,YAAcxH,CAAI;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;GCCjB,MAAMiN,WAAed,GACxB/rB,YAAY6mB,GACRzlB,MAAMylB,GACN1mB,KAAK2C,UAAUC,IAAI,aACnB5C,KAAKigB,MAAQA,KACbjgB,KAAKigB,MAAMzf,KAAO,WAClBR,KAAKigB,MAAM+L,SAAW,KAClBhsB,KAAK2mB,aAAa,EAEtB3mB,KAAKsnB,aAAa,CAAEC,KAAM,SAC1BvnB,KAAKimB,YAAY0G,IACjB3sB,KAAKkmB,WAAWpkB,YAAY9B,KAAKigB,OACjCjgB,KAAKkmB,WAAWpkB,YAAYke,KAC/B,EAEL0M,GAAO1G,OAAO,YAAa0G,ICjBpB,MAAMvpB,GAAQ7B,SAASue,cAAc,SAC5C1c,GAAM8jB,YAAcxH,CAAI;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ECCjB,MAAMmN,WAAoBnG,GAC7B5mB,YAAY6mB,GACRzlB,MAAMylB,GACN1mB,KAAK2C,UAAUC,IAAI,YACnB5C,KAAKigB,MAAQA,KACbjgB,KAAKigB,MAAMzf,KAAO,QAClBR,KAAKigB,MAAM7f,MAAQJ,KAAKshB,aAAa,SACrC,IAAIiB,EAAOviB,KACXA,KAAKigB,MAAM+L,SAAW,KAClBzJ,EAAKoE,aAAa,EAEtB3mB,KAAKsnB,aAAa,CAAEC,KAAM,SAC1BvnB,KAAKimB,YAAY4G,IACjB7sB,KAAKkmB,WAAWpkB,YAAY9B,KAAKigB,OACjCjgB,KAAKkmB,WAAWpkB,YAAYke,KAC/B,CACD2G,cACQ3mB,KAAKoiB,QACLpiB,KAAKoiB,MAAMgD,YAAcplB,KAAKigB,MAAM7f,MAE3C,CACDwmB,aACI,GAAI5mB,KAAKoiB,MAAO,CACZ,IAAI0K,EAAaF,GAAYG,YAAY7sB,IAAIF,KAAKoiB,YAC/BlgB,IAAf4qB,IACAA,IAAeF,GAAYI,kBAC3BJ,GAAYG,YAAY5sB,IAAIH,KAAKoiB,MAAO0K,IAE5C9sB,KAAKigB,MAAM5d,KAAO,aAAayqB,GAClC,MAEG9sB,KAAKigB,MAAM5d,KAAO,GAEjBrC,KAAKoiB,OAAUpiB,KAAKoiB,MAAMxd,QAI3B5E,KAAKigB,MAAM6L,gBAAgB,YAH3B9rB,KAAKigB,MAAMgI,aAAa,WAAY,IAKpCjoB,KAAKoiB,QACLpiB,KAAKigB,MAAM4L,QAAU7rB,KAAKoiB,MAAMgD,cAAgBplB,KAAKigB,MAAM7f,MAElE,EC7CE,IAAI6sB,GD+CXL,GAAYI,kBAAoB,EAChCJ,GAAYG,YAAc,IAAIG,QAC9BN,GAAY5G,OAAO,iBAAkB4G,IChDrC,SAAWK,GACPA,EAAUA,EAAgB,KAAI,GAAK,OACnCA,EAAUA,EAAgB,KAAI,GAAK,OACnCA,EAAUA,EAAqB,UAAI,GAAK,YACxCA,EAAUA,EAAuB,YAAI,GAAK,cAC1CA,EAAUA,EAA0B,eAAI,GAAK,iBAC7CA,EAAUA,EAA+B,oBAAI,GAAK,qBACrD,CAPD,CAOGA,KAAcA,GAAY,CAAA,ICNtB,MAAME,WAA4BtH,GACrChmB,YAAYmB,GACRC,MAAMD,GACNhB,KAAKotB,UAAW,EAChBptB,KAAKqtB,cAAe,EACpBrtB,KAAKstB,MAAQL,GAAUM,IAC1B,ECNE,MAAMC,WAAkBL,GAC3BttB,YAAYsO,EAAM5B,GACdtL,QACAjB,KAAKotB,UAAW,EAChBptB,KAAKmO,KAAOA,EACZnO,KAAKytB,aAAelhB,EACpBvM,KAAK0tB,MAAQpsB,SAASue,cAAc,OACpC7f,KAAK0tB,MAAM/qB,UAAUC,IAAI,cACzB,IAAI+qB,EAAOxf,EAAKyf,KAChB,KAAOD,GACCA,EAAKE,cACLF,EAAKG,eAAe9tB,KAAMA,KAAK0tB,OAG/BC,EAAKI,eAETJ,EAAOA,EAAKzjB,KAEhBlK,KAAK8B,YAAY9B,KAAK0tB,OACtB1tB,KAAKguB,MACR,CACDA,OACShuB,KAAKytB,aAAaQ,OAAOb,SA4B/B,SAA8B7gB,EAAQmhB,GACzC,IAAIQ,EAAiB3hB,EAAO4hB,wBAC5BT,EAAMvqB,MAAMirB,QAAU,IACtBV,EAAMvqB,MAAMkrB,KAAQH,EAAeG,KAAOH,EAAe1E,MAAS,KAClEkE,EAAMvqB,MAAMmrB,IAAMJ,EAAeI,IAAM,KACvC/C,YAAW,WACP,IAAIgD,EAAgBb,EAAMS,wBACRD,EAAeI,IAAMC,EAAc5oB,OACnCwe,OAAOqK,cACrBd,EAAMvqB,MAAMmrB,IAAOJ,EAAeI,IAAMJ,EAAevoB,OAAS4oB,EAAc5oB,OAAU,MAE3EuoB,EAAeG,KAAOH,EAAe1E,MAAQ+E,EAAc/E,MAC3DrF,OAAOsK,aACpBf,EAAMvqB,MAAMkrB,KAAQH,EAAeG,KAAOE,EAAc/E,MAAS,MAErEkE,EAAMvqB,MAAMirB,QAAU,GACzB,GAAE,EACP,CA1CYM,CAAqB1uB,KAAKytB,aAAcztB,KAAK0tB,OAF7CiB,GAAmB3uB,KAAKytB,aAAcztB,KAAK0tB,OAG/C1tB,KAAKmD,MAAMyrB,QAAU,EACxB,CACDC,OACI7uB,KAAKmD,MAAMyrB,QAAU,MACxB,EAEE,SAASD,GAAmBpiB,EAAQmhB,GACvC,IAAIQ,EAAiB3hB,EAAO4hB,wBAC5BT,EAAMvqB,MAAMirB,QAAU,IACtBV,EAAMvqB,MAAMkrB,KAAOH,EAAeG,KAAO,KACzCX,EAAMvqB,MAAMmrB,IAAOJ,EAAeI,IAAMJ,EAAevoB,OAAU,KACjE4lB,YAAW,WACP,IAAIgD,EAAgBb,EAAMS,wBACRD,EAAeI,IAAMJ,EAAevoB,OAAS4oB,EAAc5oB,OAC3Dwe,OAAOqK,cACrBd,EAAMvqB,MAAMmrB,IAAOJ,EAAeI,IAAMC,EAAc5oB,OAAU,MAEnDuoB,EAAeG,KAAOE,EAAc/E,MACpCrF,OAAOsK,aACpBf,EAAMvqB,MAAMkrB,KAAQH,EAAeG,KAAOH,EAAe1E,MAAQ+E,EAAc/E,MAAS,MAE5FkE,EAAMvqB,MAAMirB,QAAU,GACzB,GAAE,EACP,CAmBAvI,GAAKG,OAAO,eAAgBwH,ICrErB,MAAMrqB,GAAQ7B,SAASue,cAAc,SAC5C1c,GAAM8jB,YAAcxH,CAAI;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ECDjB,MAAMtc,GAAQ7B,SAASue,cAAc,SAC5C1c,GAAM8jB,YAAcxH,CAAI;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;GCMjB,MAAMqP,WAAerI,GACxB5mB,YAAY6mB,GACRzlB,MAAMylB,GACN1mB,KAAKigB,MAAQA,KACbjgB,KAAKigB,MAAMzf,KAAO,OAClBR,KAAK+uB,cACL,IASIhiB,EATAwV,EAAOviB,KACXA,KAAKigB,MAAMkH,QAAU,KACjB5E,EAAKoE,aAAa,EAEtB3mB,KAAKigB,MAAM+O,OAAUC,SACE/sB,IAAflC,KAAKkvB,OACLlvB,KAAKmvB,OACR,EAGL,MAAMpd,EAAImO,GAAOnT,EAAIuT,GAAIlT,GAAK,iJAC9BpN,KAAKkgB,OAASnO,EACdA,EAAEqd,UAAY,EACdrd,EAAE5O,MAAMksB,QAAU,OAClBtiB,EAAE5J,MAAMqmB,MAAQ,OAChBzc,EAAE5J,MAAMwC,OAAS,OACjBoM,EAAEud,cAAiBL,IACXjvB,KAAK0tB,MACL1tB,KAAKmvB,SAGTF,EAAGvH,iBACH1nB,KAAKigB,MAAM0H,QACX3nB,KAAKuvB,OACLxd,EAAEyd,kBAAkBP,EAAGQ,WAAU,EAErC1d,EAAE2d,cAAiBT,IACf,QAAmB/sB,IAAflC,KAAK0tB,MACL,OAEJ,MAAMrsB,EAAIrB,KAAKkmB,WAAWyJ,iBAAiBV,EAAGW,QAASX,EAAGY,SAC1D,IAAIC,EAEAA,EADAzuB,aAAa0uB,cACF1uB,OAGAa,EAEXlC,KAAKkvB,QAAUY,IACX9vB,KAAKkvB,OACLlvB,KAAKkvB,MAAMvsB,UAAUqB,OAAO,YAEhChE,KAAKkvB,MAAQY,EACT9vB,KAAKkvB,OACLlvB,KAAKkvB,MAAMvsB,UAAUC,IAAI,YAEhC,EAELmP,EAAEie,YAAef,IACb,GAAIjvB,KAAKkvB,MAAO,CACZ,MAAMe,EAAMzkB,SAASxL,KAAKkvB,MAAMgB,QAAa,KAG7C,OAFAlwB,KAAKmvB,aACLnvB,KAAKmwB,OAAOF,EAEf,CACD,MAAM5uB,EAAIrB,KAAKkmB,WAAWyJ,iBAAiBV,EAAGW,QAASX,EAAGY,SACtD9d,EAAEqe,SAAS/uB,GACXrB,KAAKigB,MAAM0H,QAGf3nB,KAAKmvB,OAAO,EAEhBnvB,KAAKqwB,QAAUrwB,KAAKqwB,QAAQrN,KAAKhjB,MACjCA,KAAKigB,MAAMoK,UAAYrqB,KAAKqwB,QAC5BrwB,KAAKonB,MAAQpnB,KAAKonB,MAAMpE,KAAKhjB,MAC7BA,KAAKigB,MAAMoH,QAAUrnB,KAAKkgB,OAAOmH,QAAUrnB,KAAKonB,MAChDpnB,KAAK2C,UAAUC,IAAI,eACnB5C,KAAKsnB,aAAa,CAAEC,KAAM,SAC1BvnB,KAAKimB,YAAYqK,IACjBtwB,KAAKimB,YAAYsK,IACjBvwB,KAAKkmB,WAAWpkB,YAAY9B,KAAKigB,OACjCjgB,KAAKkmB,WAAWpkB,YAAYiQ,EAC/B,CACDwU,oBACI,GAAIvmB,KAAKyiB,WACL,OACJxhB,MAAMslB,oBACN,MAAMzG,EAAO9f,KAAKshB,aAAa,QAClB,OAATxB,IACA2B,GAAiBe,aAAa,KAAK1C,IAAQ9f,MAC3CA,KAAKwwB,aACLxwB,KAAK2mB,cAEZ,CACDjkB,SAAS0f,GACL,IAAKA,EAMD,OALIpiB,KAAK8f,OACL9f,KAAK8f,KAAKnb,SAASX,OAAOhE,MAC1BA,KAAK8f,UAAO5d,QAEhBjB,MAAMyB,SAAS0f,GAGfA,aAAiB8C,IACjBjkB,MAAMyB,SAAS0f,GAEfA,aAAiBrB,KACjB/gB,KAAK8f,KAAOsC,EACZpiB,KAAK8f,KAAKnb,SAAS/B,KAAI,KACnB5C,KAAKigB,MAAM7f,MAAQJ,KAAK8f,KAAK1f,KAAK,GACnCJ,MAEV,CACDqwB,QAAQpB,GAIJ,OAHIjvB,KAAKigB,MAAMwQ,UACXxB,EAAGvH,iBAECuH,EAAGhtB,KACP,IAAK,UACDjC,KAAK0wB,eACL,MACJ,IAAK,YACD1wB,KAAK2wB,WAGhB,CACDvJ,MAAM6H,GACFA,EAAGvH,iBACH1nB,KAAKigB,MAAM0H,QACPsH,EAAGxH,OAAS,GACZznB,KAAK2wB,WAEL1B,EAAGxH,OAAS,GACZznB,KAAK0wB,cAEZ,CACD3B,cACI/uB,KAAKigB,MAAMwQ,UAAW,EACtB,IAAK,IAAIG,IAAY,CAAC,cAAe,sBAAuB,wBAAyB,sBACjF5wB,KAAKigB,MAAM9c,MAAMC,YAAYwtB,EAAU,OAE9C,CACDJ,aACIxwB,KAAKigB,MAAMwQ,UAAW,EACtB,IAAK,IAAIG,IAAY,CAAC,cAAe,sBAAuB,wBAAyB,sBACjF5wB,KAAKigB,MAAM9c,MAAM0tB,eAAeD,EAEvC,CACDjK,cACQ3mB,KAAK8f,OACL9f,KAAK8f,KAAK1f,MAAQJ,KAAKigB,MAAM7f,MAEpC,CACDwmB,aACS5mB,KAAKoiB,OAAUpiB,KAAKoiB,MAAMxd,QAI3B5E,KAAKigB,MAAM6L,gBAAgB,YAH3B9rB,KAAKigB,MAAMgI,aAAa,WAAY,SAKrB/lB,IAAflC,KAAKoiB,QACLpiB,KAAKigB,MAAM7f,MAAQJ,KAAK8wB,YAAY9wB,KAAKoiB,MAAMgD,aAC/CplB,KAAK2mB,cAEZ,CACDmK,YAAY1wB,GACR,IAAK,IAAIe,EAAI,EAAGA,EAAInB,KAAKkB,SAASE,SAAUD,EAAG,CAC3C,MAAMU,EAAQ7B,KAAKkB,SAASC,GAC5B,GAAuB,WAAnBU,EAAM0f,SAAuB,CAC7B,MAAMwP,EAASlvB,EACf,GAAIkvB,EAAO3wB,QAAUA,EACjB,OAAO2wB,EAAOjR,IAErB,CACJ,CACD,IAAIkR,EAAM,GACV,IAAK,IAAI7vB,EAAI,EAAGA,EAAInB,KAAKkB,SAASE,SAAUD,EAAG,CAC3C,MAAMU,EAAQ7B,KAAKkB,SAASC,GAC5B,GAAuB,WAAnBU,EAAM0f,SAAuB,CAE7ByP,EAAM,GAAGA,MADMnvB,EACSzB,QAC3B,CACJ,CAMD,OALmB,IAAf4wB,EAAI5vB,SACJ4vB,EAAM,sBAEVnoB,QAAQC,IAAI,IAAI1I,eAAmB4wB,0BAA4BhxB,KAAKshB,aAAa,cACjFzY,QAAQ6V,MAAM1e,MACP,EACV,CACDuvB,OACI,IACI0B,EADA1O,EAAOviB,KAEXA,KAAK0tB,MAAQ3N,GAAIkR,EAAI9Q,MpC9KtB,SAAe+Q,EAAOthB,GACzB,IAAIR,EAAI,GACR,IAAK,IAAIjO,EAAI,EAAGA,EAAI+vB,IAAS/vB,EAAG,CAC5B,MAAMyR,EAAIhD,EAAOzO,GACbyR,aAAa7R,MACbqO,EAAErL,QAAQ6O,GAGVxD,EAAErL,KAAK6O,EAEd,CACD,OAAOxD,CACX,CoCkKmC+hB,CAAMnxB,KAAKkB,SAASE,QAAS6uB,IACpD,MAAMpP,EAAIT,GAAGN,GAAK9f,KAAKkB,SAAS6N,KAAKkhB,GAAKtF,YAa1C,OAZA9J,EAAEuO,SAAW,EACbvO,EAAEuQ,oBAAsB,SACxBvQ,EAAEqP,QAAa,IAAI,GAAGD,IACtBpP,EAAEyO,cAAiBL,IACfjvB,KAAKkgB,OAAOsP,kBAAkBP,EAAGQ,WACjCzvB,KAAKkvB,MAAQrO,EACboO,EAAGvH,gBAAgB,EAEvB7G,EAAE6H,QAAU,KACRnG,EAAK4N,OAAOF,EAAI,EAEpBjwB,KAAKkB,SAAS+uB,GACPpP,CAAC,MAEZ7gB,KAAK0tB,MAAM/qB,UAAUC,IAAI,cACzB5C,KAAK0tB,MAAMvqB,MAAMkuB,SAAW,QAC5BrxB,KAAK0tB,MAAMvqB,MAAMmuB,OAAS,KAC1BL,EAAEG,oBAAsB,UACxBH,EAAEtuB,UAAUC,IAAI,WAChB5C,KAAKkmB,WAAWpkB,YAAY9B,KAAK0tB,OACjCiB,GAAmB3uB,KAAMA,KAAK0tB,MACjC,CACDyB,QACInvB,KAAKkvB,WAAQhtB,OACMA,IAAflC,KAAK0tB,QACL1tB,KAAKkmB,WAAWvkB,YAAY3B,KAAK0tB,OACjC1tB,KAAK0tB,WAAQxrB,EAEpB,CACDiuB,OAAOlmB,GACH,QAAmB/H,IAAflC,KAAKoiB,MAEL,YADAvZ,QAAQC,IAAI,qBAAqB9I,KAAKshB,aAAa,2BAGvDthB,KAAKmvB,QACL,MAAM4B,EAAS/wB,KAAKkB,SAAS+I,GACvB8mB,aAAkBQ,kBAIxBvxB,KAAKoiB,MAAMgD,YAAc2L,EAAO3wB,MAH5ByI,QAAQC,IAAI,oCAAoCioB,EAAOxP,SAASre,qCAIvE,CACDsuB,WACI,MAAMnf,EAAIrS,KAAKoiB,OAAOgD,YACtB,IAAK,IAAIjkB,EAAI,EAAGA,EAAInB,KAAKkB,SAASE,SAAUD,EACxC,GAAInB,KAAKkB,SAASC,GAAGf,QAAUiS,EAC3B,OAAOlR,CAGlB,CACDwvB,WACI,IAAI1mB,EAAQjK,KAAKwxB,gBACHtvB,IAAV+H,EACAA,EAAQ,IAGNA,EAEFA,GAASjK,KAAKkB,SAASE,QAG3BpB,KAAKmwB,OAAOlmB,EACf,CACDymB,eACI,IAAIzmB,EAAQjK,KAAKwxB,gBACHtvB,IAAV+H,EACAA,EAAQjK,KAAKkB,SAASE,OAAS,IAG7B6I,EAEFA,EAAQ,GAGZjK,KAAKmwB,OAAOlmB,EACf,EAEL6kB,GAAO9I,OAAO,YAAa8I,ICnRpB,MAAM3rB,GAAQ7B,SAASue,cAAc,SAC5C1c,GAAM8jB,YAAcxH,CAAI;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ECAjB,MAAMgS,WAAehL,GACxB5mB,YAAY6mB,GACRzlB,MAAMylB,GACN1mB,KAAKigB,MAAQ3e,SAASue,cAAc,SACpC7f,KAAKigB,MAAMzf,KAAO,QAClB,IAAI+hB,EAAOviB,KACXA,KAAKigB,MAAMkH,QAAU,KACjB5E,EAAKoE,aAAa,EAEtB3mB,KAAK2C,UAAUC,IAAI,aACnB5C,KAAKsnB,aAAa,CAAEC,KAAM,SAC1BvnB,KAAKimB,YAAYyL,IACjB1xB,KAAKkmB,WAAWpkB,YAAY9B,KAAKigB,MACpC,CACD0G,cACQ3mB,KAAKoiB,QACLpiB,KAAKoiB,MAAMhiB,MAAQM,OAAOC,WAAWX,KAAKigB,MAAM7f,OACvD,CACDwmB,aACS5mB,KAAKoiB,aAEclgB,IAApBlC,KAAKoiB,MAAMjd,WAAyCjD,IAAnBlC,KAAKoiB,MAAMnd,UAAwC/C,IAAnBlC,KAAKoiB,MAAMld,IAC5ElF,KAAKigB,MAAM9a,KAAO,IAAInF,KAAKoiB,MAAMld,IAAMlF,KAAKoiB,MAAMnd,KAAO,IAEzDjF,KAAKigB,MAAM9a,KAAOwsB,OAAO3xB,KAAKoiB,MAAMjd,MACxCnF,KAAKigB,MAAMhb,IAAM0sB,OAAO3xB,KAAKoiB,MAAMnd,KACnCjF,KAAKigB,MAAM/a,IAAMysB,OAAO3xB,KAAKoiB,MAAMld,KACnClF,KAAKigB,MAAM7f,MAAQuxB,OAAO3xB,KAAKoiB,MAAMhiB,OACxC,EAELqxB,GAAOzL,OAAO,YAAayL,IC/BpB,MAAMG,WAAoB/L,GAC7Blb,eAAe4X,GACX,MAAMsP,EAAc,IAAIvpB,IACxB,IAAK,IAAIiE,EAASgW,EAAKuP,cAAeC,EAAW,EAAc,OAAXxlB,EAAiBA,EAASA,EAAOulB,gBAAiBC,EAClGF,EAAY1xB,IAAIoM,EAAQwlB,GAE5B,IACIC,EAsBAC,EAvBAC,EAAsBxxB,OAAOyxB,iBAE7BC,EAAkB,IAAIrxB,MAC1B,IAAK,MAAMsxB,KAAQryB,KAAKsyB,SAAS3S,SAC7B,GAAK0S,EAAKE,UAAUhQ,GAEpB,IAAK,IAAIiQ,EAAaH,EAAKP,cAAeW,EAAQ,EAAkB,OAAfD,EAAqBA,EAAaA,EAAWV,gBAAiBW,EAAO,CACtH,MAAMC,EAAeb,EAAY3xB,IAAIsyB,QAChBtwB,IAAjBwwB,IAEAR,EAAsBQ,IAEtBR,EAAsBQ,IACtBN,EAAgBhxB,OAAS,GAE7B8wB,EAAsBQ,EACtBV,EAAgBQ,EAChBJ,EAAgBruB,KAAKsuB,IACxB,CAEL,IAAKL,EACD,OAGJ,MAAMW,EAAYf,GAAYJ,SAASjP,EAAMyP,GAC7C,IAAIY,EAA0BlyB,OAAOmyB,iBACrC,IAAK,IAAIR,KAAQD,EAAiB,CAC9B,MAAMU,EAAYlB,GAAYJ,SAASa,EAAML,GACzCc,EAAYH,GAAaG,EAAYF,IACrCA,EAA0BE,EAC1Bb,EAAcI,EAErB,CACDryB,KAAK+yB,UAAUd,EAAa1P,EAC/B,CACD5X,gBAAgB4X,EAAMhW,QACHrK,IAAXqK,GACA1D,QAAQ6V,MAAM,wBAAwB6D,MAAShW,MAEnD,IAAI9K,EAAU8gB,EACd,KAAO9gB,EAAQqwB,gBAAkBvlB,GAC7B9K,EAAUA,EAAQqwB,cACtB,OAAO/wB,MAAMiyB,KAAKzmB,EAAO7K,YAAY2I,QAAQ5I,EAChD,CACDkJ,iBAAiB0nB,EAAM9P,GACfviB,KAAKizB,YACLjzB,KAAKizB,WAAWC,aACpBlzB,KAAKizB,WAAaZ,EAClBryB,KAAKmzB,WAAa5Q,EACd8P,GACAA,EAAKe,UACZ,CACDzoB,gBAAgB4X,GACRviB,KAAKmzB,aAAe5Q,GACpBviB,KAAK+yB,eAAU7wB,OAAWA,EAEjC,CACDqkB,oBACItlB,MAAMslB,oBACNqL,GAAYU,SAAS1vB,IAAI5C,KAC5B,CACDwmB,uBACQoL,GAAYqB,aAAejzB,MAC3B4xB,GAAYmB,eAAU7wB,OAAWA,GAErC0vB,GAAYU,SAASjpB,OAAOrJ,MAC5BiB,MAAMulB,sBACT,EAELoL,GAAYU,SAAW,IAAItV,IAC3BmH,OAAO7gB,iBAAiB,WAAY2mB,IAC5BA,EAAM5a,kBAAkBuiB,KAExB3H,EAAMoJ,yBAAyBxN,IAC/B+L,GAAY0B,SAASrJ,EAAMoJ,eAE3BpJ,EAAM5a,kBAAkBwW,IACxB+L,GAAY2B,QAAQtJ,EAAM5a,QAC7B,ICpFL,IAAImkB,GAAkBlyB,SAASue,cAAc,SAC7C2T,GAAgBvM,YAAc,+aA6BvB,MAAMwM,WAAmBhN,GAC5B5mB,YAAY6mB,GACRzlB,MAAMylB,GACDA,GAQD1mB,KAAKioB,aAAa,QAASvB,EAAKtmB,OAChCJ,KAAKioB,aAAa,MAAOvB,EAAKgN,MACR,IAAlBhN,EAAKqE,UACL/qB,KAAKioB,aAAa,WAAY,aAVlCvB,EAAO,CACHtmB,MAAOJ,KAAKshB,aAAa,SACzBoS,IAAK1zB,KAAKshB,aAAa,OACvByJ,SAAU/qB,KAAKqmB,aAAa,aASpCrmB,KAAK2zB,YAAe1J,IACZjqB,KAAKqmB,aAAa,cAGtBrmB,KAAK2nB,QACLsC,EAAMvC,sBACaxlB,IAAflC,KAAKoiB,QACLpiB,KAAKoiB,MAAMgD,YAAcplB,KAAKylB,YACjC,EAEL,IAAIiO,EAAMpyB,SAASue,cAAc,OACjC6T,EAAIE,IAAMlN,EAAKgN,IACf1zB,KAAKsnB,aAAa,CAAEC,KAAM,SAC1BvnB,KAAKkmB,WAAWpkB,YAAYR,SAAS6kB,WAAWqN,IAAiB,IACjExzB,KAAKkmB,WAAWpkB,YAAY4xB,EAC/B,CACDjO,WACI,IAAIrlB,EAAQJ,KAAKshB,aAAa,SAC9B,GAAc,OAAVlhB,EACA,MAAMQ,MAAM,YAChB,OAAOR,CACV,CACDmmB,oBACItlB,MAAMslB,yBACarkB,IAAflC,KAAKoiB,OACLpiB,KAAKioB,aAAa,WAAY,GACrC,CACDrB,aACI,QAAmB1kB,IAAflC,KAAKoiB,MAGL,OAFApiB,KAAKioB,aAAa,WAAY,SAC9BjoB,KAAK8rB,gBAAgB,YAGzB,IAAI1rB,EAAQJ,KAAKylB,WACbzlB,KAAKoiB,MAAMiD,mBAAmBjlB,GAC9BJ,KAAK8rB,gBAAgB,YAGrB9rB,KAAKioB,aAAa,WAAY,IAE9BjoB,KAAKoiB,MAAMgD,cAAgBhlB,EAC3BJ,KAAKioB,aAAa,WAAY,IAG9BjoB,KAAK8rB,gBAAgB,WAE5B,EAEL2H,GAAWzN,OAAO,gBAAiByN,IC7F5B,MAAMI,WAAiBpN,GAC1B5mB,YAAY6mB,GACRzlB,MAAMylB,EACT,CACDE,aACI,IAAK5mB,KAAKoiB,MACN,OACJ,IAAIhiB,OAA6B8B,IAArBlC,KAAKoiB,MAAMhiB,MAAsB,GAAKJ,KAAKoiB,MAAMhiB,MACzDJ,KAAKoiB,iBAAiBnB,GACtBjhB,KAAKoqB,UAAYhqB,EAEjBJ,KAAK2qB,UAAYvqB,CACxB,EAELyzB,GAAS7N,OAAO,UAAW6N,ICfpB,MAAMC,WAAerN,GACxB5mB,YAAY6mB,GACRzlB,MAAMylB,EACT,CACDE,aACQ5mB,KAAKoiB,QACLpiB,KAAKmD,MAAMyrB,QAAU5uB,KAAKoiB,MAAMhiB,MAAQ,GAAK,OAEpD,EAEL0zB,GAAO9N,OAAO,QAAS8N,ICVhB,MAAM3wB,GAAQ7B,SAASue,cAAc,SAC5C1c,GAAM8jB,YAAcxH,CAAI;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ECEjB,MAAMsU,WAAatN,GACtB5mB,YAAY6mB,GACRzlB,MAAMylB,GACN1mB,KAAKg0B,OAASh0B,KAAKg0B,OAAOhR,KAAKhjB,MAC/BA,KAAK2C,UAAUC,IAAI,WACf5C,KAAKqmB,aAAa,aAClBrmB,KAAK2C,UAAUC,IAAI,eAEvB5C,KAAK+pB,QAAUhK,G5C2BH,KAAI7e,IAAaO,EAAQ,OAAQP,G4C3B1B+yB,IACnBj0B,KAAK+pB,QAAQpnB,UAAUC,IAAI,WAC3B,MAAMsxB,EAAe/T,KACrB,IAAK,IAAIhf,EAAI,EAAGA,EAAInB,KAAKkB,SAASE,SAAUD,EAAG,CAC3C,MAAMU,EAAQ7B,KAAKkB,SAASC,GAC5B,GAAuB,WAAnBU,EAAM0f,SAAuB,CAC7B1Y,QAAQC,IAAI,eAAejH,EAAM0f,SAASre,gCAC1C,QACH,CACD,MAAMixB,EAAMtyB,EACZ,IAAIuyB,EACJF,EAAapyB,YAAYse,GAAGgU,EAAWpU,GAAKF,GAAKqU,EAAI7S,aAAa,aAClE8S,EAAS9E,cAAiBL,IACtBA,EAAGoF,kBACHpF,EAAGvH,iBACHuH,EAAGqF,cAAe,EAClBt0B,KAAKg0B,OAAOI,EAAUD,EAAI,OAEPjyB,IAAnBlC,KAAKu0B,WACLv0B,KAAKu0B,UAAYH,EACjBp0B,KAAKw0B,YAAcL,GAGnBA,EAAIhxB,MAAMyrB,QAAU,MAE3B,CACD5uB,KAAKsnB,aAAa,CAAEC,KAAM,SAC1BvnB,KAAKkmB,WAAWpkB,YAAYR,SAAS6kB,WAAWsO,IAAQ,IACxDz0B,KAAKkmB,WAAWpkB,YAAYoyB,GAC5Bl0B,KAAKkmB,WAAWpkB,YAAY9B,KAAK00B,WAAa3U,MAC9C/f,KAAKkmB,WAAWpkB,YAAY9B,KAAK+pB,SACjC/pB,KAAK00B,WAAW/xB,UAAUC,IAAI,QAC1B5C,KAAKu0B,WACLv0B,KAAKg0B,OAAOh0B,KAAKu0B,UAAWv0B,KAAKw0B,YAExC,CACDjO,oBACItlB,MAAMslB,oBACNvmB,KAAK20B,YACR,CACDX,OAAOG,EAAKS,GACR50B,KAAKu0B,UAAU5xB,UAAUqB,OAAO,UAChChE,KAAKu0B,UAAYJ,EACjBn0B,KAAKu0B,UAAU5xB,UAAUC,IAAI,UAC7B5C,KAAKw0B,YAAYrxB,MAAMyrB,QAAU,OACjC5uB,KAAKw0B,YAAcI,EACnB50B,KAAKw0B,YAAYrxB,MAAMyrB,QAAU,GACjC5uB,KAAK20B,aACD30B,KAAKoiB,OAASwS,EAAMx0B,QACpBJ,KAAKoiB,MAAMgD,YAAcwP,EAAMx0B,MAEtC,CACDu0B,aACI,MAAMvpB,EAAOpL,KAAK00B,WACZP,EAAMn0B,KAAKu0B,eACLryB,IAARiyB,IACIn0B,KAAKqmB,aAAa,aAClBjb,EAAKjI,MAAMmrB,IAAM,GAAG6F,EAAIU,cACxBzpB,EAAKjI,MAAMwC,OAAS,GAAGwuB,EAAIW,mBAG3B1pB,EAAKjI,MAAMmrB,IAAM,OACjBljB,EAAKjI,MAAMkrB,KAAO,GAAG8F,EAAIY,eACzB3pB,EAAKjI,MAAMqmB,MAAQ,GAAG2K,EAAIa,iBAGrC,EAELjB,GAAK/N,OAAO,UAAW+N,IAChB,MAAMkB,WAAYpP,GACrBhmB,YAAY6mB,GACRzlB,MAAMylB,GACN1mB,KAAK8qB,MAAQpE,GAAMoE,MACnB9qB,KAAKI,MAAQsmB,GAAMtmB,KACtB,EAELylB,GAAKG,OAAO,SAAUiP,ICxFf,MAAMC,GAAY5zB,SAASue,cAAc,SAChDqV,GAAUjO,YAAc,6uBA2B+BkO,KAAK,0TAKLA,KAAK,6UAMLA,KAAK,0TAKLA,KAAK,ihBCpCrD,MAAMC,WAAmB3O,GAC5B5mB,YAAYouB,EAAQN,GAChB1sB,QACAjB,KAAKiuB,OAASA,EACdjuB,KAAK2tB,KAAOA,EACZ,IAAI0H,EAAar1B,KA0IjB,GAzIAA,KAAK2C,UAAUC,IAAI,eACf+qB,EAAKC,OACDK,EAAOb,SACPptB,KAAK2C,UAAUC,IAAI,aAEnB5C,KAAK2C,UAAUC,IAAI,cAE3B5C,KAAK4mB,aACL5mB,KAAK2zB,YAAe1J,IAChBA,EAAMoK,kBACN,IAAIiB,EAAkB,SAAUrL,GAC5B3oB,SAASi0B,oBAAoB,UAAWD,EAAiB,CAAEE,SAAS,IACpEvL,EAAMvC,iBACN6D,YAAW,KACH6J,GAAWK,YACXJ,EAAWK,cAAc,IAAIC,WAAW,UAAW1L,GAAO,GAC/D,EACnB,EAGY,GAFA3oB,SAASgC,iBAAiB,UAAWgyB,EAAiB,CAAEE,SAAS,IACjEJ,GAAWK,YAAa,GACnBz1B,KAAKiuB,OACN,MAAMrtB,MAAM,SAChB,OAAQZ,KAAKiuB,OAAOX,OAChB,KAAKL,GAAUM,KACXvtB,KAAKiuB,OAAOX,MAAQL,GAAU2I,KAC9B51B,KAAKozB,WACL,MACJ,KAAKnG,GAAU4I,UACP71B,KAAKiuB,OAAO6H,SAAW91B,MACvBA,KAAKiuB,OAAOX,MAAQL,GAAU2I,KAC9B51B,KAAKozB,YAGLpzB,KAAKiuB,OAAOX,MAAQL,GAAU8I,YAElC,MACJ,QACI,MAAMn1B,MAAM,oBAAsBZ,KAAKiuB,OAAOX,OAEtD,OAAO,CAAK,EAEhBttB,KAAK0qB,UAAaT,IAEd,GADAA,EAAMoK,kBACDe,GAAWK,WAAhB,CAGA,GADAL,GAAWK,YAAa,GACnBz1B,KAAKiuB,OACN,MAAMrtB,MAAM,SAChB,IAAKZ,KAAK2tB,KACN,MAAM/sB,MAAM,SAChB,OAAQZ,KAAKiuB,OAAOX,OAChB,KAAKL,GAAU2I,KACP51B,KAAK2tB,KAAK3G,cAAgBhnB,KAAK2tB,KAAKC,MACpC5tB,KAAKwE,UACLxE,KAAKiuB,OAAOX,MAAQL,GAAUM,OAG9BvtB,KAAKiuB,OAAOX,MAAQL,GAAU4I,UAC1BT,GAAWY,mBACX10B,SAASi0B,oBAAoB,YAAaH,GAAWY,kBAAmB,CAAER,SAAS,IAEvFJ,GAAWY,kBAAoB,SAAU/L,GACjCmL,GAAWY,mBACX10B,SAASi0B,oBAAoB,YAAaH,GAAWY,kBAAmB,CAAER,SAAS,IACvFJ,GAAWY,uBAAoB9zB,EAEf,oBADF+nB,EAAM5a,OAAO4mB,SAEvBZ,EAAWa,UAE3C,EACwB50B,SAASgC,iBAAiB,YAAa8xB,GAAWY,kBAAmB,CAAER,SAAS,KAEpF,MACJ,KAAKvI,GAAU8I,YACf,KAAK9I,GAAUkJ,eACXn2B,KAAKiuB,OAAOX,MAAQL,GAAUM,KAC9BvtB,KAAKkzB,aACLlzB,KAAKk2B,WACDl2B,KAAKiuB,OAAOZ,aAEhB,MACJ,KAAKJ,GAAUmJ,oBACXp2B,KAAKwE,UACL,MACJ,QACI,MAAM5D,MAAM,oBAAsBZ,KAAKiuB,OAAOX,OAEtD,OAAO,CA3CI,CA2CC,EAEhBttB,KAAKq2B,WAAcpM,IAEf,GADAA,EAAMoK,mBACDr0B,KAAKiuB,OACN,MAAMrtB,MAAM,SAEhB,OADAw0B,GAAWkB,YAASp0B,EACZlC,KAAKiuB,OAAOX,OAChB,KAAKL,GAAUM,KACf,KAAKN,GAAUkJ,eACf,KAAKlJ,GAAU4I,UACf,KAAK5I,GAAU8I,YACX,MACJ,KAAK9I,GAAU2I,KACf,KAAK3I,GAAUmJ,oBACXp2B,KAAKiuB,OAAOX,MAAQL,GAAUkJ,eAC9Bn2B,KAAK4mB,aACL,MACJ,QACI,MAAMhmB,MAAM,oBAEpB,OAAO,CAAK,EAEhBZ,KAAKu2B,YAAetM,IAEhB,GADAA,EAAMoK,mBACDgB,EAAWpH,OACZ,MAAMrtB,MAAM,SAEhB,OADAw0B,GAAWkB,OAASjB,EACZA,EAAWpH,OAAOX,OACtB,KAAKL,GAAUM,KACf,KAAKN,GAAU4I,UACf,KAAK5I,GAAUkJ,eACf,KAAKlJ,GAAU8I,YACf,KAAK9I,GAAU2I,KACf,KAAK3I,GAAUmJ,oBACX,IAAKhB,GAAWK,WACZ,MACJ,IAAKz1B,KAAKiuB,OACN,MAAMrtB,MAAM,SACZZ,KAAKiuB,OAAO6H,QACZ91B,KAAKiuB,OAAO6H,OAAO5C,aACvBlzB,KAAKiuB,OAAOX,MAAQL,GAAUmJ,oBAC9Bp2B,KAAKozB,WACL,MACJ,QACI,MAAMxyB,MAAM,oBAAsBy0B,EAAWpH,OAAOX,OAE5D,OAAO,CAAK,EAEhBttB,KAAKsnB,aAAa,CAAEC,KAAM,UACrBvnB,KAAKkmB,WACN,MAAMtlB,MAAM,SAChBZ,KAAKkmB,WAAWpkB,YAAYR,SAAS6kB,WAAW+O,IAAW,IACtDl1B,KAAK2tB,KAAKxL,SACXniB,KAAKkmB,WAAWpkB,YAAYR,SAASC,eAAeosB,EAAK7C,OAChE,CACDvE,oBACI,IAAIvmB,KAAKyiB,WAAT,CAEA,QAAuBvgB,IAAnBlC,KAAK2tB,KAAKC,KAAoB,CAC9B,IAAI7L,EAAW/hB,KAAK2tB,KAAKxM,MACzB,IAAK,IAAIwM,EAAO3tB,KAAK2tB,KAAKphB,OAAQohB,GACzBA,EAAKxM,MAAM/f,OADoBusB,EAAOA,EAAKphB,OAGhDwV,EAAW4L,EAAKxM,MAAQ,IAAMY,EAElCA,EAAW,KAAOA,EAClBN,GAAiBe,aAAaT,EAAU/hB,KAC3C,CACD,QAA0BkC,IAAtBlC,KAAK2tB,KAAKxL,QACV,GAAiC,iBAAtBniB,KAAK2tB,KAAKxL,QAAsB,CACvC,IAAIA,EAAU,KAAOniB,KAAK2tB,KAAKxL,QAC/BV,GAAiBe,aAAaL,EAASniB,KAC1C,MAEGA,KAAK0C,SAAS1C,KAAK2tB,KAAKxL,QAjBrB,CAoBd,CACDqE,uBACQxmB,KAAKyiB,YACLziB,KAAKyiB,WAAWG,eAAe5iB,KACtC,CACD0C,SAAS0f,GACL,IAAKA,EAMD,OALIpiB,KAAKgiB,QACLhiB,KAAKgiB,OAAOrd,SAASX,OAAOhE,MAChCA,KAAKoiB,WAAQlgB,EACblC,KAAKgiB,YAAS9f,OACdlC,KAAK4mB,aAGT,GAAIxE,aAAiBlB,GACjBlhB,KAAKgiB,OAASI,EACdpiB,KAAKgiB,OAAOrd,SAAS/B,KAAI,KACrB5C,KAAK4mB,YAAY,GAClB5mB,UAEF,MAAIoiB,aAAiBrB,IAItB,MAAMngB,MAAM,4BAA8BwhB,EAAMviB,YAAYwC,MAH5DrC,KAAKoiB,MAAQA,CAIhB,CACDpiB,KAAK4mB,YACR,CACDA,aACI,GAAI5mB,KAAKoiB,OAASpiB,KAAKoiB,MAAMhiB,MAAO,CAChC,IAAKJ,KAAKkmB,WACN,MAAMtlB,MAAM,SAChB,IAAIof,EAAO1e,SAASue,cAAc,QAC9B7f,KAAKoiB,iBAAiBnB,GACtBjB,EAAKoK,UAAYpqB,KAAKoiB,MAAMhiB,MAE5B4f,EAAK2K,UAAY3qB,KAAKoiB,MAAMhiB,MAC5BJ,KAAKkmB,WAAWhlB,SAASE,OAAS,GAClCpB,KAAKkmB,WAAWvkB,YAAY3B,KAAKkmB,WAAWhlB,SAAS,IACrDlB,KAAKkmB,WAAWhlB,SAASE,OAAS,EAClCpB,KAAKkmB,WAAWsQ,aAAaxW,EAAMhgB,KAAKkmB,WAAWhlB,SAAS,IAE5DlB,KAAKkmB,WAAWpkB,YAAYke,EACnC,CACD,IAAKhgB,KAAKiuB,OACN,MAAMrtB,MAAM,SAChB,IAAIk1B,GAAS,EACb,GAAI91B,KAAKiuB,OAAO6H,QAAU91B,KACtB,OAAQA,KAAKiuB,OAAOX,OAChB,KAAKL,GAAU2I,KACf,KAAK3I,GAAU4I,UACf,KAAK5I,GAAU8I,YACf,KAAK9I,GAAUmJ,oBACXN,GAAS,EACT,MACJ,KAAK7I,GAAUkJ,eACX,IAAKn2B,KAAK2tB,KACN,MAAM/sB,MAAM,SAChBk1B,OAA4B5zB,IAAnBlC,KAAK2tB,KAAKC,MAAsB5tB,KAAK2tB,KAAK3G,YAI/DhnB,KAAK2C,UAAUgnB,OAAO,SAAUmM,GAChC91B,KAAK2C,UAAUgnB,OAAO,YAAa3pB,KAAKgnB,YAC3C,CACDA,YACI,YAAuB9kB,IAAnBlC,KAAK2tB,KAAKC,WAES1rB,IAAhBlC,KAAKgiB,QAAwBhiB,KAAKgiB,OAAOpd,OACnD,CACDJ,UACIxE,KAAKk2B,WACAl2B,KAAKgiB,QAEVhiB,KAAKgiB,OAAOxd,SACf,CACD0xB,WACI,IAAKl2B,KAAKiuB,OACN,MAAMrtB,MAAM,SACZZ,KAAKiuB,OAAOR,aACZztB,KAAKiuB,OAAOR,aAAayI,WAEzBl2B,KAAKkzB,YACZ,CACDuD,YACI,GAAKz2B,KAAK2tB,MAEL3tB,KAAK2tB,KAAKC,KAAf,CAEA,IAAK5tB,KAAKkmB,WACN,MAAMtlB,MAAM,SACXZ,KAAK0tB,MAKN1tB,KAAK0tB,MAAMM,QAJXhuB,KAAK0tB,MAAQ,IAAIF,GAAUxtB,KAAK2tB,KAAM3tB,MACtCA,KAAKkmB,WAAWpkB,YAAY9B,KAAK0tB,OAL1B,CAUd,CACDgJ,aACS12B,KAAK0tB,QAEN1tB,KAAK0tB,MAAMoI,QACX91B,KAAK0tB,MAAMoI,OAAO5C,aACtBlzB,KAAK0tB,MAAMmB,OACd,CACDuE,WACI,IAAKpzB,KAAKiuB,OACN,MAAMrtB,MAAM,SAChB,IAAKZ,KAAK2tB,KACN,MAAM/sB,MAAM,SAChB,IAAI+1B,EAAY32B,KAAKiuB,OAAO6H,OAC5B91B,KAAKiuB,OAAO6H,OAAS91B,KACjB22B,GAAaA,IAAc32B,OAC3B22B,EAAUD,aACVC,EAAU/P,cAEd5mB,KAAK4mB,aACL5mB,KAAKy2B,WACR,CACDvD,aACI,IAAKlzB,KAAKiuB,OACN,MAAMrtB,MAAM,SACZZ,KAAKiuB,OAAO6H,SAAW91B,OAE3BA,KAAKiuB,OAAO6H,OAAOY,aACnB12B,KAAKiuB,OAAO6H,YAAS5zB,EACrBlC,KAAKiuB,OAAOX,MAAQL,GAAUM,KAC9BvtB,KAAK4mB,aACR,EAELwO,GAAWpP,OAAO,gBAAiBoP,ICrT5B,MAAMwB,GACT/2B,YAAYshB,EAAO2J,EAAO+L,EAAUr2B,EAAM2hB,GACtCniB,KAAKmhB,MAAQA,EACbnhB,KAAK8qB,MAAQA,EACb9qB,KAAK62B,SAAWA,EAChB72B,KAAKQ,KAAOA,GAAc,QAC1BR,KAAKmiB,QAAUA,CAClB,CACD6E,YACI,OAAO,CACV,CACD6G,cACI,OAAO,CACV,CACDC,eAAevhB,EAAQuqB,GACnB,GAAiB,UAAb92B,KAAKQ,KAAkB,CACvB,IAAIwf,EAAO1e,SAASue,cAAc,QAGlC,OAFAG,EAAK7c,MAAM4zB,SAAW,SACtBD,EAAWh1B,YAAYke,EAE1B,CACDhgB,KAAKuiB,KAAO,IAAI6S,GAAW7oB,EAAQvM,MACnC82B,EAAWh1B,YAAY9B,KAAKuiB,KAC/B,CACDwL,eACC,ECtBE,MAAMiJ,WAAa7J,GACtBttB,YAAYmB,GACRC,MAAMD,GACNhB,KAAKi3B,OAASj2B,GAAOi2B,OACrBj3B,KAAKotB,UAAW,EAChBptB,KAAKmO,KAAO,IAAIyoB,GAAS,GAAI,QAAI10B,OAAWA,EAC/C,CACDqkB,oBAGI,GAFAtlB,MAAMslB,oBACNvmB,KAAKovB,SAAW,EACZpvB,KAAKi3B,OAIL,OAHAj3B,KAAKk3B,aAAal3B,KAAKi3B,OAAQj3B,KAAKmO,MACpCnO,KAAKm3B,wBACLn3B,KAAKo3B,kBAGoB,IAAzBp3B,KAAKkB,SAASE,QACdpB,KAAKirB,UAAY,IAAIC,kBAAiB,CAACC,EAAQC,UACvBlpB,IAAhBlC,KAAKqrB,QACLC,aAAatrB,KAAKqrB,QACtBrrB,KAAKqrB,OAASlH,OAAOoH,YAAW,KAC5BvrB,KAAKqrB,YAASnpB,EACdlC,KAAKq3B,aAAar3B,KAAKkB,SAAUlB,KAAKmO,MACtCnO,KAAKm3B,mBACLn3B,KAAKo3B,iBAAiB,GACvB,IAAI,IAEXp3B,KAAKirB,UAAUO,QAAQxrB,KAAM,CACzByrB,WAAW,EACXC,SAAS,MAIb1rB,KAAKq3B,aAAar3B,KAAKkB,SAAUlB,KAAKmO,MACtCnO,KAAKm3B,mBACLn3B,KAAKo3B,kBAEZ,CACDC,aAAan2B,EAAUqL,GACnB,IAAIohB,EAAOphB,EAAOqhB,KAClB,IAAK,IAAI/rB,KAASX,EAAU,CACxB,IAAIo2B,EACJ,OAAQz1B,EAAM0f,UACV,IAAK,gBACD+V,EAAU,IAAIV,GAAS,GAAI,GAAI,GAAI,UACnC,MACJ,IAAK,eACDU,EAAU,IAAIV,GAASW,GAAc11B,EAAO,QAAS01B,GAAc11B,EAAO,SAAU21B,GAAyB31B,EAAO,YAAa21B,GAAyB31B,EAAO,QAAS21B,GAAyB31B,EAAO,UAWlN,GARIy1B,IACAA,EAAQ/qB,OAASA,EACZohB,EAGDA,EAAKzjB,KAAOotB,EAFZ/qB,EAAOqhB,KAAO0J,EAGlB3J,EAAO2J,IAEN3J,EACD,MAAM/sB,MAAM,SAChBZ,KAAKq3B,aAAax1B,EAAMX,SAAUysB,EACrC,CACJ,CACDuJ,aAAaD,EAAQ1qB,GACjB,IAAIohB,EAAOphB,EAAOqhB,KAClB,IAAK,IAAI/rB,KAASo1B,EAAQ,CACtB,IAAIK,EAeJ,GAbIA,GADgB,IAAhBz1B,EAAM41B,MACI,IAAIb,GAAS,GAAI,GAAI,GAAI,UAGzB,IAAIA,GAAS/0B,EAAMQ,KAAMR,EAAMipB,MAAOjpB,EAAMg1B,SAAUh1B,EAAMrB,KAAMqB,EAAMugB,OAElFkV,IACAA,EAAQ/qB,OAASA,EACZohB,EAGDA,EAAKzjB,KAAOotB,EAFZ/qB,EAAOqhB,KAAO0J,EAGlB3J,EAAO2J,IAEN3J,EACD,MAAM/sB,MAAM,SACZiB,EAAMmT,KACNhV,KAAKk3B,aAAar1B,EAAMmT,IAAK2Y,EACpC,CACJ,CACDwJ,mBACC,CACDO,SAAS9X,EAAKrT,GACV,IAAIorB,EAAS/X,EAAIvV,QAAQ,KACrBgkB,GAAkB,GAAXsJ,EAAe/X,EAAMA,EAAIrc,OAAO,EAAGo0B,GAC1CC,GAAmB,GAAXD,EAAe,GAAK/X,EAAIrc,OAAOo0B,EAAS,GAC/CprB,IACDA,EAASvM,KAAKmO,MAClB,IAAK,IAAI0pB,EAAItrB,EAAOqhB,KAAMiK,EAAGA,EAAIA,EAAE3tB,KAC/B,GAAI2tB,EAAE1W,OAASkN,EACX,OAAKwJ,EAAEjK,KAGA5tB,KAAK03B,SAASE,EAAOC,GAFjBA,CAMtB,CACDT,kBACIp3B,KAAKuiB,KAAOjhB,SAASue,cAAc,OACnC7f,KAAKuiB,KAAK5f,UAAUC,IAAI,YACxB,IAAI+qB,EAAO3tB,KAAKmO,KAAKyf,KACrB,KAAOD,GACCA,EAAKE,cACLF,EAAKG,eAAe9tB,KAAMA,KAAKuiB,MAG/BoL,EAAKI,eAETJ,EAAOA,EAAKzjB,KAEhBlK,KAAKsnB,aAAa,CAAEC,KAAM,SAC1BvnB,KAAKkmB,WAAWpkB,YAAYR,SAAS6kB,WAAW+O,IAAW,IAC3Dl1B,KAAKkmB,WAAWpkB,YAAY9B,KAAKuiB,KACpC,EAELyU,GAAKhR,OAAO,UAAWgR,IC9HhB,MAAMc,WAAmBhS,aAEhCD,GAAKG,OAAO,gBAAiB8R,ICFtB,MAAMC,WAAmBtzB,EAC5BuzB,UAAY,OAAyB,IAAlBh4B,KAAKi4B,UAAoC,IAAlBj4B,KAAKk4B,QAAiB,ECF7D,IAAIC,GCCAC,GCDAC,IFCX,SAAWF,GACPA,EAAcA,EAAyB,UAAI,GAAK,YAChDA,EAAcA,EAA2B,YAAI,GAAK,cAClDA,EAAcA,EAA0B,WAAI,GAAK,YACpD,CAJD,CAIGA,KAAkBA,GAAgB,CAAA,IGL9B,MAAMG,GACTz4B,YAAY04B,EAAKC,GACbx4B,KAAKu4B,IAAMA,EACXv4B,KAAKw4B,IAAMA,CACd,CACDv4B,WACI,MAAO,kBAAkBD,KAAKu4B,YAAYv4B,KAAKw4B,OAClD,ECJE,MAAMC,WAAuBh0B,EAChC5E,YAAY0nB,EAAO4Q,GAAcO,WAC7Bz3B,QACAjB,KAAKunB,KAAOA,EACZvnB,KAAK8E,OAAS,IAAIwzB,GAAS,EAAG,EACjC,CACGC,QAAIA,GACAv4B,KAAK8E,OAAOyzB,MAAQA,IAExBv4B,KAAK8E,OAAOyzB,IAAMA,EAClBv4B,KAAK2E,SAASH,UACjB,CACG+zB,UACA,OAAOv4B,KAAK8E,OAAOyzB,GACtB,CACGC,QAAIA,GACAx4B,KAAK8E,OAAO0zB,MAAQA,IAExBx4B,KAAK8E,OAAO0zB,IAAMA,EAClBx4B,KAAK2E,SAASH,UACjB,CACGg0B,UACA,OAAOx4B,KAAK8E,OAAO0zB,GACtB,CACGp4B,UAAMA,GACFJ,KAAK8E,OAAOyzB,MAAQn4B,EAAMm4B,KAAOv4B,KAAK8E,OAAO0zB,MAAQp4B,EAAMo4B,MAE/Dx4B,KAAK8E,OAAS1E,EACdJ,KAAK2E,SAASH,UACjB,CACGpE,YACA,OAAOJ,KAAK8E,MACf,CACD7E,WACI,MAAO,4BAA4BD,KAAK0E,mBAAmByzB,GAAcn4B,KAAKunB,iBAAiBvnB,KAAK8E,SACvG,ECrCE,MAAM6zB,WAAwBZ,GACjCl4B,YAAY+4B,EAAWzqB,GACnBlN,QACAjB,KAAK44B,UAAYA,CACpB,GJHL,SAAWR,GACPA,EAASA,EAAwB,cAAI,GAAK,gBAC1CA,EAASA,EAAwB,cAAI,GAAK,eAC7C,CAHD,CAGGA,KAAaA,GAAW,CAAE,IACtB,MAAMS,GACTh5B,cACIG,KAAK84B,SAAWV,GAASW,cACzB/4B,KAAKg5B,UAAW,EAChBh5B,KAAKi5B,cAAe,EACpBj5B,KAAKk5B,WAAY,CACpB,EAEE,MAAMC,GACTt5B,YAAYuiB,GACRpiB,KAAKi3B,OAAS,IAAI4B,GAClB74B,KAAKoiB,MAAQA,CAChB,CACG6V,eAAa,YAAsB/1B,IAAflC,KAAKoiB,MAAsB,EAAIpiB,KAAKoiB,MAAM6V,QAAW,CACzEC,eAAa,YAAsBh2B,IAAflC,KAAKoiB,MAAsB,EAAIpiB,KAAKoiB,MAAM8V,QAAW,CAC7EkB,cAAcb,GAA0B,CACxCc,WAAWb,GAA0B,CACrCc,SAASC,EAAKC,GAAS,CACvBC,SAASF,EAAKC,GAAS,CACvBE,SAASH,EAAKC,GAAS,CACvBG,gBAAkB,OAAO,CAAQ,CACjChvB,gBAAgBivB,EAASxX,EAAO7d,GAC5B,IAAIs1B,EAAcV,GAAaW,eAAe55B,IAAIkiB,GAKlD,QAJoBlgB,IAAhB23B,IACAA,EAAc,IAAIvxB,IAClB6wB,GAAaW,eAAe35B,IAAIiiB,EAAOyX,SAE9B33B,IAATqC,EAAoB,CACpB,GAAIs1B,EAAY5wB,IAAI1E,GAChB,MAAM3D,MAAM,8CAEhBi5B,EAAY15B,IAAIoE,EAAMq1B,EACzB,KACI,CACD,GAAIC,EAAY5wB,IAAI,MAChB,MAAMrI,MAAM,8CAEhBi5B,EAAY15B,IAAI,KAAMy5B,EACzB,CACJ,CACDjvB,gBACIwuB,GAAaW,eAAe/W,OAC/B,CACDpY,cAAcyX,GACV,IAAI2X,EAEAA,EADA3X,aAAiBuW,GACNvW,EAAMwW,UAGN,KAEf,MAAMoB,EAAgBb,GAAaW,eAAe55B,IAAIG,OAAO45B,eAAe7X,GAAOviB,aACnF,IAAI+5B,EAAUI,GAAe95B,IAAI65B,GACjC,QAAgB73B,IAAZ03B,EACA,IAAK,IAAIM,KAAaf,GAAaW,eAAenU,OAC9C,GAAIvD,aAAiB8X,EAAW,CAC5BN,EAAUT,GAAaW,eAAe55B,IAAIg6B,IAAYh6B,IAAI65B,GAC1D,KACH,CAGT,QAAgB73B,IAAZ03B,EAAuB,CACvB,IAAIO,EAAM,oEAAoE/X,EAAMviB,YAAYwC,OAEhG,GADA83B,GAAO,kCAAkC/X,EAAMviB,YAAYwC,cAAc03B,GAAU13B,gCAC1C,IAArC82B,GAAaW,eAAensB,KAC5BwsB,GAAO,cAGP,IAAK,MAAOC,EAAQC,KAAmBlB,GAAaW,eAChD,IAAK,MAAOQ,EAAOC,KAAaF,EAC5BF,GAAO,mBAAmBC,EAAO/3B,OAC7Bi4B,UACAH,GAAO,UAAUG,EAAMj4B,QAKvC,MAAMzB,MAAMu5B,EACf,CACD,OAAOP,CACV,EAELT,GAAaW,eAAiB,IAAIxxB,ICvFlC,SAAW+vB,GACPA,EAAeA,EAA2B,WAAI,GAAK,aACnDA,EAAeA,EAA2B,WAAI,GAAK,aACnDA,EAAeA,EAA2B,WAAI,GAAK,aACnDA,EAAeA,EAA2B,WAAI,GAAK,aACnDA,EAAeA,EAA6B,aAAI,GAAK,eACrDA,EAAeA,EAA2B,WAAI,GAAK,aACnDA,EAAeA,EAA2B,WAAI,GAAK,aACnDA,EAAeA,EAAwB,QAAI,GAAK,SACnD,CATD,CASGA,KAAmBA,GAAiB,CAAA,IIVhC,MAAMmC,GACT36B,YAAY46B,GACRz6B,KAAKy6B,MAAQA,CAChB,CACGb,cACA,OAAO55B,KAAKy6B,MAAMb,OACrB,CACGzrB,WACA,OAAOnO,KAAKy6B,MAAMtsB,IACrB,CACGusB,cACA,OAAO16B,KAAKy6B,MAAMC,OACrB,CACDC,aACI,MAAM/W,EAAW5jB,KAAKy6B,MAAM7W,SAC5B,QAAyB1hB,IAArB0hB,EAASC,QACT,OAEJ,OADkBD,EAASC,QACV+W,WACpB,CACDC,iBACI,MAAMjX,EAAW5jB,KAAKy6B,MAAM7W,SAC5B,QAAyB1hB,IAArB0hB,EAASC,QACT,OAEJ,OADkBD,EAASC,QACViX,WACpB,CACGC,WACA,OAAO/6B,KAAKy6B,MAAMM,IACrB,CACGC,gBACA,OAAOh7B,KAAKy6B,MAAMO,SACrB,CACGC,eACA,OAAOj7B,KAAKy6B,MAAMQ,QACrB,CACGA,aAASlb,GACT/f,KAAKy6B,MAAMQ,SAAWlb,CACzB,CACGmb,eACA,OAAOl7B,KAAKy6B,MAAMS,QACrB,CACGA,aAASnb,GACT/f,KAAKy6B,MAAMS,SAAWnb,CACzB,CACGob,uBACA,OAAOn7B,KAAKy6B,MAAMU,gBACrB,CACGA,qBAAiBpb,GACjB/f,KAAKy6B,MAAMU,iBAAmBpb,CACjC,CACGqb,uBACA,OAAOp7B,KAAKy6B,MAAMW,gBACrB,CACGA,qBAAiBrb,GACjB/f,KAAKy6B,MAAMW,iBAAmBrb,CACjC,CACGsb,kBAAcA,GACdr7B,KAAKy6B,MAAMY,cAAgBA,CAC9B,CACGC,gBACA,OAAOt7B,KAAKy6B,MAAMa,SACrB,CACGn4B,YACA,OAAOnD,KAAKy6B,MAAMt3B,KACrB,CACDo4B,YAAYvb,EAAM1N,EAAGC,EAAGwC,EAAGymB,GACvBx7B,KAAKy6B,MAAMc,YAAYvb,EAAM1N,EAAGC,EAAGwC,EAAGymB,EACzC,CACDC,iBACIz7B,KAAKy6B,MAAM1W,eAAY7hB,CAC1B,ECpEE,MAAMw5B,WAAuBlB,GAChC36B,YAAY46B,GACRx5B,MAAMw5B,EACT,CACDkB,yBACI37B,KAAK47B,qBACL57B,KAAK67B,wBACL77B,KAAKy6B,MAAMqB,WAAW97B,KAAK46B,YAAa56B,KAAK86B,aAC7C96B,KAAK+7B,eACR,CACDC,4BACIh8B,KAAK47B,qBACL57B,KAAKi8B,wBACLj8B,KAAKy6B,MAAMqB,WAAW97B,KAAK46B,YAAa56B,KAAK86B,aAC7C96B,KAAK+7B,eACR,CACDH,qBACI57B,KAAK46B,YAAc7a,KACnB/f,KAAK46B,YAAYsB,UAAY,UAC7Bl8B,KAAK46B,YAAYz3B,MAAMkrB,KAAOruB,KAAK+6B,KAAK53B,MAAMkrB,KAC9CruB,KAAK46B,YAAYz3B,MAAMmrB,IAAMtuB,KAAK+6B,KAAK53B,MAAMmrB,GAChD,CACDuN,6BAC0B35B,IAAlBlC,KAAKk7B,WAGTl7B,KAAK86B,YAAc/a,KACnB/f,KAAK86B,YAAYn4B,UAAUC,IAAI,WAC/B5C,KAAK86B,YAAY33B,MAAMmrB,IAAMtuB,KAAKk7B,SAAS/3B,MAAMmrB,IACjDtuB,KAAK86B,YAAY33B,MAAMqmB,MAAQxpB,KAAKk7B,SAAS/3B,MAAMqmB,MACtD,CACDyS,6BAC0B/5B,IAAlBlC,KAAKi7B,WAGTj7B,KAAK86B,YAAc/a,KACnB/f,KAAK86B,YAAYn4B,UAAUC,IAAI,WAC/B5C,KAAK86B,YAAYn4B,UAAUC,IAAI,WAC/B5C,KAAK86B,YAAY33B,MAAMkrB,KAAOruB,KAAKi7B,SAAS93B,MAAMkrB,KAClDruB,KAAK86B,YAAY33B,MAAMwC,OAAS3F,KAAKi7B,SAAS93B,MAAMwC,OACvD,CACDw2B,iBACIn8B,KAAKy6B,MAAM2B,cAAcp8B,KAAK46B,YAAa56B,KAAK86B,YACnD,CACDiB,gBACC,CACDM,YAAY7Y,EAAO7V,GACf,MAAM2uB,EAAOtc,KAQb,OAPAsc,EAAKn5B,MAAMo5B,UAAY,cACvBD,EAAKn5B,MAAMmrB,IAAM,GAAG9K,MACpB8Y,EAAKn5B,MAAMwC,OAAS,GAAGgI,MACvB2uB,EAAKn5B,MAAMkrB,KAAO,IAClBiO,EAAKn5B,MAAMy0B,MAAQ,IACnB0E,EAAKn5B,MAAMq5B,OAAS,OACpBF,EAAKn5B,MAAMs5B,gBAAkBC,GAAMC,UAC5BL,CACV,CACDM,eAAepZ,EAAO7V,GAClB,MAAM2uB,EAAOtc,KAQb,OAPAsc,EAAKn5B,MAAMo5B,UAAY,cACvBD,EAAKn5B,MAAMkrB,KAAO,GAAG7K,MACrB8Y,EAAKn5B,MAAMqmB,MAAQ,GAAG7b,MACtB2uB,EAAKn5B,MAAMmrB,IAAM,IACjBgO,EAAKn5B,MAAM05B,OAAS,IACpBP,EAAKn5B,MAAMq5B,OAAS,OACpBF,EAAKn5B,MAAMs5B,gBAAkBC,GAAMC,UAC5BL,CACV,ECrEE,MAAMQ,WAAwBpB,GACjC77B,YAAY46B,EAAOxQ,GACfhpB,MAAMw5B,GACNz6B,KAAKmK,MAAO,EACZnK,KAAKiqB,MAAQA,CAChB,CACDxG,UACIzjB,KAAK+8B,2BACL/8B,KAAKg9B,gBACR,CACD9Y,aACIlkB,KAAKi9B,mBACLj9B,KAAKuL,OACR,CACDyY,eAAe6T,GACX73B,KAAKk9B,QAAQl9B,KAAKm9B,eAAiBtF,EAAI73B,KAAKo9B,UAC/C,CACDnZ,YACIjkB,KAAKk9B,QAAQl9B,KAAKm9B,eAAiBn9B,KAAKo9B,WACxCp9B,KAAKq9B,OACLr9B,KAAKm8B,gBACR,CACDkB,OACQr9B,KAAKmK,OAGTnK,KAAKmK,MAAO,EACZnK,KAAKs9B,aACLt9B,KAAKu9B,WACDv9B,KAAKy6B,MAAMY,eACXr7B,KAAKy6B,MAAMY,gBAElB,EC7BE,MAAMmC,WAA2BV,GACpCj9B,YAAY46B,EAAOxQ,GACfhpB,MAAMw5B,EAAOxQ,GACbjqB,KAAKq9B,KAAOr9B,KAAKq9B,KAAKra,KAAKhjB,MAC3BA,KAAKy9B,gBAAkBz9B,KAAK45B,QAAQ1B,SAAWjO,EAAMtc,KACrD6vB,GAAmB3Z,QAAU7jB,IAChC,CACDg9B,iBACIh9B,KAAK27B,wBACR,CACDuB,QAAQ3D,GACJv5B,KAAKg7B,UAAU73B,MAAMmrB,IAAM,GAAGiL,MAC9Bv5B,KAAKs8B,KAAKn5B,MAAMmrB,IAAM,GAAGiL,WACHr3B,IAAlBlC,KAAKk7B,WACLl7B,KAAK09B,UAAUv6B,MAAMmrB,IAAM,GAAGiL,MAC9Bv5B,KAAK29B,SAASx6B,MAAMmrB,IAAM,GAAGiL,MAEpC,CACDwD,2BACI/8B,KAAKy6B,MAAMmD,qBACX,IAAIC,EAAa,IAAI98B,MAAMf,KAAKiqB,MAAMtc,MACtC,IAAK,IAAI6qB,EAAMx4B,KAAKiqB,MAAMhgB,MAAOuuB,EAAMx4B,KAAKiqB,MAAMhgB,MAAQjK,KAAKiqB,MAAMtc,OAAQ6qB,EAAK,CAC9E,MAAMzO,EAAU/pB,KAAK45B,QAAQP,WAAWb,QAClBt2B,IAAlBlC,KAAKk7B,eAAsCh5B,IAAZ6nB,IAC/B/pB,KAAKk7B,SAAWnb,KAChB/f,KAAKk7B,SAASgB,UAAY,OAC1Bl8B,KAAKmO,KAAKrM,YAAY9B,KAAKk7B,UAC3Bl7B,KAAKo7B,iBAAmBrb,KACxB/f,KAAKo7B,iBAAiBc,UAAY,OAClCl8B,KAAKmO,KAAKrM,YAAY9B,KAAKo7B,mBAE/ByC,EAAWrF,EAAMx4B,KAAKiqB,MAAMhgB,OAAS8f,CACxC,CACD,QAAsB7nB,IAAlBlC,KAAKk7B,SACL,IAAK,IAAI1C,EAAM,EAAGA,EAAMx4B,KAAKiqB,MAAMtc,OAAQ6qB,EAAK,CAC5C,MAAMgB,EAAOxZ,GAAK6d,EAAWrF,IAC7BgB,EAAK0C,UAAY,OACjBl8B,KAAK06B,QAAQ54B,YAAY03B,EAC5B,CAEL,QAAsBt3B,IAAlBlC,KAAKi7B,UAA0Bj7B,KAAK45B,QAAQ3B,WAAaj4B,KAAKiqB,MAAMtc,KAAM,CAC1E,IAAImwB,EAAa,IAAI/8B,MAAMf,KAAK45B,QAAQ3B,UACxC,IAAK,IAAIM,EAAM,EAAGA,EAAMv4B,KAAK45B,QAAQ3B,WAAYM,EAAK,CAClD,MAAMxO,EAAU/pB,KAAK45B,QAAQR,cAAcb,QACrBr2B,IAAlBlC,KAAKi7B,eAAsC/4B,IAAZ6nB,IAC/B/pB,KAAKi7B,SAAWlb,KAChB/f,KAAKi7B,SAASiB,UAAY,OAC1Bl8B,KAAKmO,KAAKrM,YAAY9B,KAAKi7B,UAC3Bj7B,KAAKm7B,iBAAmBpb,KACxB/f,KAAKm7B,iBAAiBe,UAAY,OAClCl8B,KAAKmO,KAAKrM,YAAY9B,KAAKm7B,mBAE/B2C,EAAWvF,GAAOxO,CACrB,CACD,QAAsB7nB,IAAlBlC,KAAKi7B,SACL,IAAK,IAAI1C,EAAM,EAAGA,EAAMv4B,KAAK45B,QAAQ3B,WAAYM,EAAK,CAClD,MAAMiB,EAAOxZ,GAAK8d,EAAWvF,IAC7BiB,EAAK0C,UAAY,OACjBl8B,KAAK06B,QAAQ54B,YAAY03B,EAC5B,CAER,CACD,IAAK,IAAIhB,EAAMx4B,KAAKiqB,MAAMhgB,MAAOuuB,EAAMx4B,KAAKiqB,MAAMhgB,MAAQjK,KAAKiqB,MAAMtc,OAAQ6qB,EACzE,IAAK,IAAID,EAAM,EAAGA,EAAMv4B,KAAK45B,QAAQ3B,WAAYM,EAAK,CAClD,MAAMiB,EAAOx5B,KAAKy6B,MAAMsD,aACxB/9B,KAAKy6B,MAAMnB,SAAS,IAAIhB,GAASC,EAAKC,GAAMgB,GAC5Cx5B,KAAK06B,QAAQ54B,YAAY03B,EAC5B,CAER,CACDyD,mBACIj9B,KAAKy6B,MAAMuD,uBACX,MAAMC,EAAUj+B,KAAK45B,QAAQ3C,OAAO+B,SAAW,EAAI,EACnD,IAAI1K,EAAM,EACN2B,EAAMjwB,KAAKiqB,MAAMhgB,MAAQjK,KAAK45B,QAAQ3B,SAC1C,GAAkC,IAA9Bj4B,KAAK+6B,KAAK75B,SAASE,OACnB,GAAI6uB,EAAMjwB,KAAK+6B,KAAK75B,SAASE,OAAQ,CAEjCktB,EAAM4P,GADKl+B,KAAK+6B,KAAK75B,SAAS+uB,GACV9sB,MAAMmrB,IAC7B,KACI,CACD,IAAIkL,EAAOx5B,KAAK+6B,KAAK75B,SAASlB,KAAK+6B,KAAK75B,SAASE,OAAS,GACtD2Q,EAAIynB,EAAKrL,wBACbG,EAAM4P,GAAS1E,EAAKr2B,MAAMmrB,KAAOvc,EAAEpM,OAASs4B,CAC/C,CAEL,IAAIE,EAAW,IAAIp9B,MAAMf,KAAK45B,QAAQ3B,UACtC,GAAIj4B,KAAK+6B,KAAK75B,SAASE,OAAS,EAC5B,IAAK,IAAIm3B,EAAM,EAAGA,EAAMv4B,KAAK45B,QAAQ3B,WAAYM,EAAK,CAClD,MACM6F,EADOp+B,KAAK+6B,KAAK75B,SAASq3B,GACZpK,wBACpBgQ,EAAS5F,GAAO6F,EAAO5U,MACnBxpB,KAAK45B,QAAQ3C,OAAO+B,WACpBmF,EAAS5F,IAAQ,EAExB,MAGD4F,EAAS/iB,KAAKpb,KAAKy6B,MAAM4D,cAE7B,IAAIC,EAAet+B,KAAKy6B,MAAM4D,aAC9B,GAAIr+B,KAAKk7B,UAAYl7B,KAAKk7B,SAASh6B,SAASE,OAAS,EAAG,CACpD,MACMg9B,EADOp+B,KAAKk7B,SAASh6B,SAAS,GAChBitB,wBACpBmQ,EAAe90B,KAAKtE,IAAIo5B,EAAcF,EAAO5U,OACzCxpB,KAAK45B,QAAQ3C,OAAO+B,WACpBsF,GAAgB,EAEvB,CACD,IAAIC,EAAY,IAAIx9B,MAAMf,KAAKiqB,MAAMtc,MAIrC,GAHA4wB,EAAUnjB,KAAKpb,KAAKy6B,MAAM+D,eAC1Bx+B,KAAKo9B,UAAY,EACjBnN,EAAM,OACgB/tB,IAAlBlC,KAAKk7B,SACL,IAAK,IAAI1C,EAAM,EAAGA,EAAMx4B,KAAKiqB,MAAMtc,OAAQ6qB,EAAK,CAC5C,MACM4F,EADOp+B,KAAK06B,QAAQx5B,SAAS+uB,KACf9B,wBACpBoQ,EAAU/F,GAAOhvB,KAAKtE,IAAIq5B,EAAU/F,GAAM4F,EAAOz4B,QACjD24B,EAAe90B,KAAKtE,IAAIo5B,EAAcF,EAAO5U,MAChD,CAEL8U,EAAe90B,KAAKi1B,KAAKH,GACzB,IAAII,EAAgB,EACpB,QAAsBx8B,IAAlBlC,KAAKi7B,UAA4D,IAAlCj7B,KAAKi7B,SAAS/5B,SAASE,QAAgBpB,KAAK45B,QAAQ1B,UAAYl4B,KAAKiqB,MAAMtc,KAAM,CAChH+wB,EAAgB1+B,KAAKy6B,MAAM+D,cAC3B,IAAK,IAAIjG,EAAM,EAAGA,EAAMv4B,KAAK45B,QAAQ3B,WAAYM,EAAK,CAClD,MACM6F,EADOp+B,KAAK06B,QAAQx5B,SAAS+uB,KACf9B,wBACpBgQ,EAAS5F,GAAO/uB,KAAKtE,IAAIi5B,EAAS5F,GAAM6F,EAAO5U,MAAQxpB,KAAKy6B,MAAMkE,cAClED,EAAgBl1B,KAAKtE,IAAIw5B,EAAeN,EAAOz4B,OAAS3F,KAAKy6B,MAAMmE,cACtE,CACJ,MAEG,QAAsB18B,IAAlBlC,KAAKi7B,SAAwB,CAE7ByD,EADU1+B,KAAKi7B,SAAS/5B,SAAS,GAAGitB,wBAClBxoB,OAAS3F,KAAKy6B,MAAMmE,aACzC,CAELF,EAAgBl1B,KAAKi1B,KAAKC,GACtB1+B,KAAKk7B,WAEDl7B,KAAKk7B,SAAS/3B,MAAMmrB,IADF,IAAlBoQ,EAC0B,MAGGA,EAAgB1+B,KAAKy6B,MAAMmE,cAAgBX,EAA9C,KAE9Bj+B,KAAKk7B,SAAS/3B,MAAM05B,OAAS,MAC7B78B,KAAKk7B,SAAS/3B,MAAMqmB,MAAQ,GAAG8U,MAC/Bt+B,KAAK+6B,KAAK53B,MAAMkrB,KAAUiQ,EAAeL,EAAlB,KACvBj+B,KAAK46B,YAAYz3B,MAAMkrB,KAAUiQ,EAAeL,EAAlB,MAElC,IAAK,IAAIzF,EAAM,EAAGA,EAAMx4B,KAAKiqB,MAAMtc,OAAQ6qB,EAAK,CAC5C,IAAK,IAAID,EAAM,EAAGA,EAAMv4B,KAAK45B,QAAQ3B,WAAYM,EAAK,CAClD,MACM6F,EADOp+B,KAAK06B,QAAQx5B,SAAS+uB,KACf9B,wBACpBoQ,EAAU/F,GAAOhvB,KAAKtE,IAAIq5B,EAAU/F,GAAM4F,EAAOz4B,QAC7C3F,KAAK45B,QAAQ3C,OAAOgC,aACpBkF,EAAS5F,GAAO/uB,KAAKi1B,KAAKj1B,KAAKtE,IAAIi5B,EAAS5F,GAAM6F,EAAO5U,QAG7C,IAARgP,GAA2C,IAA9Bx4B,KAAK+6B,KAAK75B,SAASE,SAChC+8B,EAAS5F,GAAO/uB,KAAKi1B,KAAKL,EAAO5U,OAG5C,CACDxpB,KAAKo9B,WAAamB,EAAU/F,GAAOyF,CACtC,CACD,GAAIj+B,KAAK45B,QAAQ3C,OAAOgC,aAAc,CAClChJ,EAAM,EACN,IAAI3d,EAAI,EACJimB,EAAM,EACV,KAAOtI,EAAMjwB,KAAK+6B,KAAK75B,SAASE,QAAQ,CACpC,MAAMo4B,EAAOx5B,KAAK+6B,KAAK75B,SAAS+uB,GAChCuJ,EAAKr2B,MAAMkrB,KAAO,GAAG/b,MACrBknB,EAAKr2B,MAAMqmB,MAAW2U,EAAS5F,GAAOv4B,KAAKy6B,MAAMkE,aAA9B,KACnBrsB,GAAK6rB,EAAS5F,GAAO0F,EACjBj+B,KAAK45B,QAAQ3C,OAAO+B,WACpB1mB,GAAK,KAEPimB,IACAtI,EACEsI,GAAOv4B,KAAK45B,QAAQ3B,WACpB3lB,EAAI,EACJimB,EAAM,EAEb,CACJ,CACDv4B,KAAKo9B,WAAaa,EACdj+B,KAAK45B,QAAQ3C,OAAO+B,WACpBh5B,KAAKo9B,WAAa,EAAIp9B,KAAKiqB,MAAMtc,MAErC,IAAI4E,EAAI+b,EACR,QAAsBpsB,IAAlBlC,KAAKk7B,SACL,IAAK,IAAI1C,EAAM,EAAGA,EAAMx4B,KAAKiqB,MAAMtc,OAAQ6qB,EAAK,CAC5C,MAAMgB,EAAOx5B,KAAK06B,QAAQx5B,SAAS,GACnClB,KAAKu7B,YAAY/B,EAAM,EAAGjnB,EAAG+rB,EAAcC,EAAU/F,IACrDx4B,KAAK86B,YAAYh5B,YAAY03B,GAC7BjnB,GAAKgsB,EAAU/F,GAAOyF,EAClBj+B,KAAK45B,QAAQ3C,OAAO+B,WACpBzmB,GAAK,EAEZ,CAEL,QAAsBrQ,IAAlBlC,KAAKi7B,UAA4D,IAAlCj7B,KAAKi7B,SAAS/5B,SAASE,QAAgBpB,KAAK45B,QAAQ1B,UAAYl4B,KAAKiqB,MAAMtc,KAAM,CAChH,IAAI2E,EAAI,EACR,IAAK,IAAIimB,EAAM,EAAGA,EAAMv4B,KAAK45B,QAAQ3B,WAAYM,EAAK,CAClD,MAAMiB,EAAOx5B,KAAK06B,QAAQx5B,SAAS,GACnCs4B,EAAKr2B,MAAMkrB,KAAO,GAAG/b,MACrBknB,EAAKr2B,MAAMqmB,MAAW2U,EAAS5F,GAAOv4B,KAAKy6B,MAAMkE,aAA9B,KACnBnF,EAAKr2B,MAAMwC,OAAS,GAAG+4B,MACvB1+B,KAAKi7B,SAASn5B,YAAY03B,GAC1BlnB,GAAK6rB,EAAS5F,GAAO0F,CACxB,CACDS,GAAiB1+B,KAAKy6B,MAAMmE,cAC5B5+B,KAAK+6B,KAAK53B,MAAMmrB,IAASoQ,EAAgBT,EAAnB,KACtBj+B,KAAK46B,YAAYz3B,MAAMmrB,IAASoQ,EAAgBT,EAAnB,KAC7Bj+B,KAAK86B,YAAY33B,MAAMmrB,IAASoQ,EAAgBT,EAAnB,KAC7Bj+B,KAAKk7B,SAAS/3B,MAAMmrB,IAASoQ,EAAgBT,EAAnB,KAC1Bj+B,KAAKi7B,SAAS93B,MAAMkrB,KAAUiQ,EAAeL,EAAlB,KAC3Bj+B,KAAKi7B,SAAS93B,MAAMy0B,MAAQ,MAC5B53B,KAAKi7B,SAAS93B,MAAMwC,OAAS,GAAG+4B,KACnC,CACDnsB,EAAI+b,EACJ,IAAK,IAAIkK,EAAM,EAAGA,EAAMx4B,KAAKiqB,MAAMtc,OAAQ6qB,EAAK,CAC5C,IAAIlmB,EAAI,EACR,IAAK,IAAIimB,EAAM,EAAGA,EAAMv4B,KAAK45B,QAAQ3B,WAAYM,EAAK,CAClD,MAAMiB,EAAOx5B,KAAK06B,QAAQx5B,SAAS,GACnClB,KAAKu7B,YAAY/B,EAAMlnB,EAAGC,EAAG4rB,EAAS5F,GAAMgG,EAAU/F,IACtDx4B,KAAK46B,YAAY94B,YAAY03B,GAC7BlnB,GAAK6rB,EAAS5F,GAAO0F,EACjBj+B,KAAK45B,QAAQ3C,OAAO+B,WACpB1mB,GAAK,EAEZ,CACDC,GAAKgsB,EAAU/F,GAAOyF,EAClBj+B,KAAK45B,QAAQ3C,OAAO+B,WACpBzmB,GAAK,EAEZ,CAOD,GANAvS,KAAKs8B,KAAOt8B,KAAKq8B,YAAY/N,EAAKtuB,KAAKo9B,WACvCp9B,KAAK46B,YAAY94B,YAAY9B,KAAKs8B,WACZp6B,IAAlBlC,KAAKk7B,WACLl7B,KAAK29B,SAAW39B,KAAKq8B,YAAY/N,EAAKtuB,KAAKo9B,WAC3Cp9B,KAAK86B,YAAYh5B,YAAY9B,KAAK29B,WAET,IAAzB39B,KAAKy9B,gBAAuB,CAC5B,MAAMQ,EAAUj+B,KAAK45B,QAAQ3C,OAAO+B,SAAW,EAAI,EACnDh5B,KAAKo9B,WAAaa,CACrB,CACJ,CACD1yB,QACIvL,KAAKy6B,MAAMoE,mBAAmB7+B,KAAKiqB,MAAMhgB,YACnB/H,IAAlBlC,KAAKk7B,WACLl7B,KAAK09B,UAAY19B,KAAKk7B,SAAS4D,kBAEnC9+B,KAAKm9B,eAAiBe,GAASl+B,KAAKg7B,UAAU73B,MAAMmrB,IACvD,CACDgP,aACI,QAAsBp7B,IAAlBlC,KAAKk7B,SAAT,CAKA,IAFAl7B,KAAK86B,YAAYn5B,YAAY3B,KAAK29B,UAClC39B,KAAKk7B,SAASv5B,YAAY3B,KAAK09B,WACxB19B,KAAK86B,YAAY55B,SAASE,OAAS,GACtCpB,KAAKk7B,SAASp5B,YAAY9B,KAAK86B,YAAY55B,SAAS,IAExD,GAAIlB,KAAK09B,UAAUx8B,SAASE,OAAS,EAAG,CACpC,IAAIktB,EAAM4P,GAASl+B,KAAK09B,UAAUv6B,MAAMmrB,KACxC,KAAOtuB,KAAK09B,UAAUx8B,SAASE,OAAS,GAAG,CACvC,MAAMo4B,EAAOx5B,KAAK09B,UAAUx8B,SAAS,GACrCs4B,EAAKr2B,MAAMmrB,IAAM,GAAG4P,GAAS1E,EAAKr2B,MAAMmrB,KAAOA,MAC/CtuB,KAAKk7B,SAASp5B,YAAY03B,EAC7B,CACJ,CAbA,CAcJ,CACD+D,WAGI,IAFAv9B,KAAK46B,YAAYj5B,YAAY3B,KAAKs8B,MAClCt8B,KAAK+6B,KAAKp5B,YAAY3B,KAAKg7B,WACpBh7B,KAAK46B,YAAY15B,SAASE,OAAS,GACtCpB,KAAK+6B,KAAKj5B,YAAY9B,KAAK46B,YAAY15B,SAAS,IAEpD,GAAIlB,KAAKg7B,UAAU95B,SAASE,OAAS,EAAG,CACpC,IAAIktB,EAAM4P,GAASl+B,KAAKg7B,UAAU73B,MAAMmrB,KACxC,KAAOtuB,KAAKg7B,UAAU95B,SAASE,OAAS,GAAG,CACvC,MAAMo4B,EAAOx5B,KAAKg7B,UAAU95B,SAAS,GACrCs4B,EAAKr2B,MAAMmrB,IAAM,GAAG4P,GAAS1E,EAAKr2B,MAAMmrB,KAAOA,MAC/CtuB,KAAK+6B,KAAKj5B,YAAY03B,EACzB,CACJ,CACJ,ECnSE,MAAMuF,WAA2BrD,GACpC77B,YAAY46B,EAAOxQ,GAIf,GAHAhpB,MAAMw5B,GACNz6B,KAAKiqB,MAAQA,EACbjqB,KAAKg/B,eAAiBh/B,KAAKg/B,eAAehc,KAAKhjB,MACb,IAA9BA,KAAK+6B,KAAK75B,SAASE,OACnBpB,KAAKi/B,cAAgB,MAEpB,CACD,MAAMC,EAAal/B,KAAK+6B,KAAK75B,SAASlB,KAAK+6B,KAAK75B,SAASE,OAAS,GAC5DktB,EAAM4P,GAASgB,EAAW/7B,MAAMmrB,KAChC8P,EAASc,EAAW/Q,wBAC1BnuB,KAAKi/B,cAAgB3Q,EAAM8P,EAAOz4B,MACrC,CACD3F,KAAKi+B,QAAUj+B,KAAK45B,QAAQ3C,OAAO+B,SAAW,EAAI,EAClDh5B,KAAKm/B,UAAYn/B,KAAKiqB,MAAMhgB,OAASjK,KAAK45B,QAAQ1B,SAClD6G,GAAmBlb,QAAU7jB,IAChC,CACDyjB,UACIzjB,KAAK27B,yBACL37B,KAAKo/B,uBACLp/B,KAAKq/B,iBACR,CACDnb,aAAgB,CAChBF,eAAe6T,GACX73B,KAAKg7B,UAAU73B,MAAMmrB,IAAStuB,KAAKs/B,aAAezH,EAAI73B,KAAKu/B,gBAAhC,KAC3Bv/B,KAAKs8B,KAAKn5B,MAAMmrB,IAAStuB,KAAKw/B,QAAU3H,EAAI73B,KAAKu/B,gBAA3B,UACAr9B,IAAlBlC,KAAKk7B,WACLl7B,KAAK09B,UAAUv6B,MAAMmrB,IAAStuB,KAAKs/B,aAAezH,EAAI73B,KAAKu/B,gBAAhC,KAC3Bv/B,KAAK29B,SAASx6B,MAAMmrB,IAAStuB,KAAKw/B,QAAU3H,EAAI73B,KAAKu/B,gBAA3B,KAEjC,CACDtb,YACIjkB,KAAKg/B,iBACLh/B,KAAKm8B,gBACR,CACDiD,uBACI,MAAMnP,EAAMjwB,KAAKiqB,MAAMhgB,MAAQjK,KAAK45B,QAAQ3B,SACtCwH,EAAYz/B,KAAKiqB,MAAMtc,KAAO3N,KAAK45B,QAAQ3B,SAC3CzU,EAAQ0a,GAASl+B,KAAK+6B,KAAK75B,SAAS+uB,GAAK9sB,MAAMmrB,KACrD,IAAK,IAAIntB,EAAI,EAAGA,EAAIs+B,IAAat+B,EAC7BnB,KAAK46B,YAAY94B,YAAY9B,KAAK+6B,KAAK75B,SAAS+uB,IAEpD,IAAIyP,EACJ,GAAIzP,EAAMjwB,KAAK+6B,KAAK75B,SAASE,OACzBs+B,EAAkBxB,GAASl+B,KAAK+6B,KAAK75B,SAAS+uB,GAAK9sB,MAAMmrB,SAExD,CACD,MAAMkL,EAAOx5B,KAAK46B,YAAY15B,SAASlB,KAAK46B,YAAY15B,SAASE,OAAS,GAC1Es+B,EAAkBxB,GAAS1E,EAAKr2B,MAAMmrB,KAAO4P,GAAS1E,EAAKr2B,MAAMwC,QAAU3F,KAAKy6B,MAAMmE,aACzF,CAID,GAHA5+B,KAAKu/B,gBAAkBG,EAAkBlc,EACzCxjB,KAAKs8B,KAAOt8B,KAAKq8B,YAAYqD,EAAiB1/B,KAAKu/B,iBACnDv/B,KAAK46B,YAAY94B,YAAY9B,KAAKs8B,WACZp6B,IAAlBlC,KAAKk7B,SAAT,CAGA,IAAK,IAAI/5B,EAAI,EAAGA,EAAInB,KAAKiqB,MAAMtc,OAAQxM,EACnCnB,KAAK86B,YAAYh5B,YAAY9B,KAAKk7B,SAASh6B,SAASlB,KAAKiqB,MAAMhgB,QAEnEjK,KAAK29B,SAAW39B,KAAKq8B,YAAYqD,EAAiB1/B,KAAKu/B,iBACvDv/B,KAAK86B,YAAYh5B,YAAY9B,KAAK29B,SALjC,CAMJ,CACD0B,kBACIr/B,KAAKy6B,MAAMoE,mBAAmB7+B,KAAKiqB,MAAMhgB,YACnB/H,IAAlBlC,KAAKk7B,WACLl7B,KAAK09B,UAAY19B,KAAKk7B,SAAS4D,kBAEnC9+B,KAAKs/B,aAAepB,GAASl+B,KAAKg7B,UAAU73B,MAAMmrB,KAClDtuB,KAAKw/B,QAAUtB,GAASl+B,KAAKs8B,KAAKn5B,MAAMmrB,IAC3C,CACD0Q,iBACIh/B,KAAK46B,YAAYj5B,YAAY3B,KAAKs8B,MAClCt8B,KAAK+6B,KAAKp5B,YAAY3B,KAAKg7B,WAC3Bh7B,KAAK46B,YAAY+E,kBACjB3/B,KAAK4/B,sBACD5/B,KAAKk7B,WACLl7B,KAAK86B,YAAYn5B,YAAY3B,KAAK29B,UAClC39B,KAAKk7B,SAASv5B,YAAY3B,KAAK09B,WAC/B19B,KAAK86B,YAAY6E,kBACjB3/B,KAAK6/B,uBAEL7/B,KAAKy6B,MAAMY,eACXr7B,KAAKy6B,MAAMY,eAElB,CACDwE,sBACI,GAAuC,IAAnC7/B,KAAK09B,UAAUx8B,SAASE,OACxB,OAEJ,IAAIktB,EAAM4P,GAASl+B,KAAK09B,UAAUv6B,MAAMmrB,KACxC,KAAOtuB,KAAK09B,UAAUx8B,SAASE,OAAS,GAAG,CACvC,MAAMo4B,EAAOx5B,KAAK09B,UAAUx8B,SAAS,GACrCs4B,EAAKr2B,MAAMmrB,IAAM,GAAG4P,GAAS1E,EAAKr2B,MAAMmrB,KAAOA,MAC/CtuB,KAAKk7B,SAASp5B,YAAY03B,EAC7B,CACJ,CACDoG,sBACI,GAAuC,IAAnC5/B,KAAKg7B,UAAU95B,SAASE,OACxB,OAEJ,IAAIktB,EAAM4P,GAASl+B,KAAKg7B,UAAU73B,MAAMmrB,KACxC,KAAOtuB,KAAKg7B,UAAU95B,SAASE,OAAS,GAAG,CACvC,MAAMo4B,EAAOx5B,KAAKg7B,UAAU95B,SAAS,GACrCs4B,EAAKr2B,MAAMmrB,IAAM,GAAG4P,GAAS1E,EAAKr2B,MAAMmrB,KAAOA,MAC/CtuB,KAAK+6B,KAAKj5B,YAAY03B,EACzB,CACJ,ECzGE,MAAMsG,WAA8BhD,GACvCj9B,YAAY46B,EAAOxQ,GACfhpB,MAAMw5B,EAAOxQ,GACbjqB,KAAKiqB,MAAQA,EACbjqB,KAAKq9B,KAAOr9B,KAAKq9B,KAAKra,KAAKhjB,MAC3BA,KAAKi4B,SAAWj4B,KAAK45B,QAAQ3B,SAC7Bj4B,KAAKk4B,SAAWl4B,KAAK45B,QAAQ1B,SAC7B4H,GAAsBjc,QAAU7jB,IACnC,CACDg9B,iBACIh9B,KAAKg8B,2BACR,CACDkB,QAAQ3D,GACJv5B,KAAKs8B,KAAKn5B,MAAMkrB,KAAO,GAAGkL,MAC1Bv5B,KAAKg7B,UAAU73B,MAAMkrB,KAAO,GAAGkL,WACTr3B,IAAlBlC,KAAKi7B,WACLj7B,KAAK09B,UAAUv6B,MAAMkrB,KAAO,GAAGkL,MAC/Bv5B,KAAK29B,SAASx6B,MAAMkrB,KAAO,GAAGkL,MAErC,CACDwD,2BACI/8B,KAAKy6B,MAAMmD,qBACX,IAAIE,EAAa,IAAI/8B,MAAMf,KAAKiqB,MAAMtc,MACtC,IAAK,IAAI4qB,EAAMv4B,KAAKiqB,MAAMhgB,MAAOsuB,EAAMv4B,KAAKiqB,MAAMhgB,MAAQjK,KAAKiqB,MAAMtc,OAAQ4qB,EAAK,CAC9E,MAAMxO,EAAU/pB,KAAK45B,QAAQR,cAAcb,QACrBr2B,IAAlBlC,KAAKi7B,eAAsC/4B,IAAZ6nB,IAC/B/pB,KAAKi7B,SAAWlb,KAChB/f,KAAKi7B,SAASiB,UAAY,OAC1Bl8B,KAAKmO,KAAKrM,YAAY9B,KAAKi7B,UAC3Bj7B,KAAKm7B,iBAAmBpb,KACxB/f,KAAKm7B,iBAAiBe,UAAY,OAClCl8B,KAAKmO,KAAKrM,YAAY9B,KAAKm7B,mBAE/B2C,EAAWvF,EAAMv4B,KAAKiqB,MAAMhgB,OAAS8f,CACxC,CACD,QAAsB7nB,IAAlBlC,KAAKi7B,SACL,IAAK,IAAIzC,EAAM,EAAGA,EAAMx4B,KAAKiqB,MAAMtc,OAAQ6qB,EAAK,CAC5C,MAAMgB,EAAOxZ,GAAK8d,EAAWtF,IAC7BgB,EAAK0C,UAAY,OACjBl8B,KAAK06B,QAAQ54B,YAAY03B,EAC5B,CAEL,QAAsBt3B,IAAlBlC,KAAKk7B,UAA0Bl7B,KAAK45B,QAAQ1B,WAAal4B,KAAKiqB,MAAMtc,KAAM,CAC1E,IAAIkwB,EAAa,IAAI98B,MAAMf,KAAK45B,QAAQ1B,UACxC,IAAK,IAAIM,EAAM,EAAGA,EAAMx4B,KAAK45B,QAAQ1B,WAAYM,EAAK,CAClD,MAAMzO,EAAU/pB,KAAK45B,QAAQP,WAAWb,QAClBt2B,IAAlBlC,KAAKk7B,eAAsCh5B,IAAZ6nB,IAC/B/pB,KAAKk7B,SAAWnb,KAChB/f,KAAKk7B,SAASgB,UAAY,OAC1Bl8B,KAAKmO,KAAKrM,YAAY9B,KAAKk7B,UAC3Bl7B,KAAKo7B,iBAAmBrb,KACxB/f,KAAKo7B,iBAAiBc,UAAY,OAClCl8B,KAAKmO,KAAKrM,YAAY9B,KAAKo7B,mBAE/ByC,EAAWrF,GAAOzO,CACrB,CACD,QAAsB7nB,IAAlBlC,KAAKk7B,SACL,IAAK,IAAI1C,EAAM,EAAGA,EAAMx4B,KAAK45B,QAAQ1B,WAAYM,EAAK,CAClD,MAAMgB,EAAOxZ,GAAK6d,EAAWrF,IAC7BgB,EAAK0C,UAAY,OACjBl8B,KAAK06B,QAAQ54B,YAAY03B,EAC5B,CAER,CACD,IAAK,IAAIjB,EAAMv4B,KAAKiqB,MAAMhgB,MAAOsuB,EAAMv4B,KAAKiqB,MAAMhgB,MAAQjK,KAAKiqB,MAAMtc,OAAQ4qB,EACzE,IAAK,IAAIC,EAAM,EAAGA,EAAMx4B,KAAKk4B,WAAYM,EAAK,CAC1C,MAAMgB,EAAOxZ,KACbhgB,KAAKy6B,MAAMnB,SAAS,IAAIhB,GAASC,EAAKC,GAAMgB,GAC5Cx5B,KAAK06B,QAAQ54B,YAAY03B,EAC5B,CAER,CACDyD,mBACIj9B,KAAKy6B,MAAMuD,uBACX,MAAM+B,EAAmB//B,KAAKi4B,SAAWj4B,KAAKiqB,MAAMtc,KAC9CswB,EAAUj+B,KAAK45B,QAAQ3C,OAAO+B,SAAW,EAAI,EACnD,IAAI3K,EACA4B,EAAMjwB,KAAKiqB,MAAMhgB,MACrB,GAAIgmB,EAAM8P,EAAkB,CAExB1R,EAAO2R,GADIhgC,KAAK+6B,KAAK75B,SAAS+uB,GACX9sB,MAAMkrB,KAC5B,MAEG,GAAkC,IAA9BruB,KAAK+6B,KAAK75B,SAASE,OACnBitB,EAAO,MAEN,CACD,MAAMmL,EAAOx5B,KAAK+6B,KAAK75B,SAAS6+B,EAAmB,GACnD1R,EAAO2R,GAAOxG,EAAKr2B,MAAMkrB,MAAQ2R,GAAOxG,EAAKr2B,MAAMqmB,OAASxpB,KAAKy6B,MAAMkE,aAAeV,CACzF,CAELj+B,KAAKm9B,eAAiB9O,EACtB,IAAIkQ,EAAY,IAAIx9B,MAAMf,KAAK45B,QAAQ1B,UACvC,GAAkC,IAA9Bl4B,KAAK+6B,KAAK75B,SAASE,OACnB,IAAK,IAAIo3B,EAAM,EAAGA,EAAMx4B,KAAK45B,QAAQ1B,WAAYM,EAAK,CAClD,MACM4F,EADOp+B,KAAK+6B,KAAK75B,SAASs3B,EAAMuH,GAClB5R,wBACpBoQ,EAAU/F,GAAO4F,EAAOz4B,OACpB3F,KAAK45B,QAAQ3C,OAAO+B,WACpBuF,EAAU/F,IAAQ,EAEzB,MAGD+F,EAAUnjB,KAAKpb,KAAKy6B,MAAM+D,eAE9B,IAAIE,EAAgB1+B,KAAKy6B,MAAM+D,cAC/B,GAAIx+B,KAAKi7B,UAAYj7B,KAAKi7B,SAAS/5B,SAASE,OAAS,EAAG,CAGpDs9B,EAFa1+B,KAAKi7B,SAAS/5B,SAAS,GAChBitB,wBACGxoB,OACnB3F,KAAK45B,QAAQ3C,OAAO+B,WACpB0F,GAAiB,EAExB,CACD,IAAIP,EAAW,IAAIp9B,MAAMf,KAAKiqB,MAAMtc,MAIpC,GAHAwwB,EAAS/iB,KAAKpb,KAAKy6B,MAAM4D,cACzBr+B,KAAKo9B,UAAY,EACjBnN,EAAM,OACgB/tB,IAAlBlC,KAAKi7B,SACL,IAAK,IAAI1C,EAAM,EAAGA,EAAMv4B,KAAKiqB,MAAMtc,OAAQ4qB,EAAK,CAC5C,MACM6F,EADOp+B,KAAK06B,QAAQx5B,SAAS+uB,KACf9B,wBACpBgQ,EAAS5F,GAAO/uB,KAAKtE,IAAIi5B,EAAS5F,GAAM6F,EAAO5U,OAC/CkV,EAAgBl1B,KAAKtE,IAAIw5B,EAAeN,EAAOz4B,OAClD,CAEL+4B,EAAgBl1B,KAAKi1B,KAAKC,GAC1B,IAAIJ,EAAe,EACnB,QAAsBp8B,IAAlBlC,KAAKk7B,UAA4D,IAAlCl7B,KAAKk7B,SAASh6B,SAASE,QAAgBpB,KAAK45B,QAAQ3B,UAAYj4B,KAAKiqB,MAAMtc,KAAM,CAChH2wB,EAAet+B,KAAKy6B,MAAM4D,aAC1B,IAAK,IAAI7F,EAAM,EAAGA,EAAMx4B,KAAK45B,QAAQ1B,WAAYM,EAAK,CAClD,MACM4F,EADOp+B,KAAK06B,QAAQx5B,SAAS+uB,KACf9B,wBACpBoQ,EAAU/F,GAAOhvB,KAAKtE,IAAIq5B,EAAU/F,GAAM4F,EAAOz4B,OAAS3F,KAAKy6B,MAAMmE,eACrEN,EAAe90B,KAAKtE,IAAIo5B,EAAcF,EAAO5U,MAAQxpB,KAAKy6B,MAAMkE,aACnE,CACJ,MAEG,QAAsBz8B,IAAlBlC,KAAKk7B,SAAwB,CAE7BoD,EADUt+B,KAAKk7B,SAASh6B,SAAS,GAAGitB,wBACnB3E,MAAQxpB,KAAKy6B,MAAMkE,YACvC,CAELL,EAAe90B,KAAKi1B,KAAKH,GACrBt+B,KAAKi7B,WAEDj7B,KAAKi7B,SAAS93B,MAAMkrB,KADH,IAAjBiQ,EAC2B,MAGGA,EAAet+B,KAAKy6B,MAAMkE,aAAe,EAAIV,EAAhD,KAE/Bj+B,KAAKi7B,SAAS93B,MAAMy0B,MAAQ,MAC5B53B,KAAKi7B,SAAS93B,MAAMwC,OAAS,GAAG+4B,MAChC1+B,KAAK+6B,KAAK53B,MAAMmrB,IAASoQ,EAAgB,EAAnB,KACtB1+B,KAAK46B,YAAYz3B,MAAMmrB,IAASoQ,EAAgB,EAAnB,MAEjC,IAAK,IAAInG,EAAM,EAAGA,EAAMv4B,KAAKiqB,MAAMtc,OAAQ4qB,EAAK,CAC5C,IAAK,IAAIC,EAAM,EAAGA,EAAMx4B,KAAK45B,QAAQ1B,WAAYM,EAAK,CAClD,MACM4F,EADOp+B,KAAK06B,QAAQx5B,SAAS+uB,KACf9B,wBACpBgQ,EAAS5F,GAAO/uB,KAAKi1B,KAAKj1B,KAAKtE,IAAIi5B,EAAS5F,GAAM6F,EAAO5U,OAAS,GAC9DxpB,KAAK45B,QAAQ3C,OAAOiC,UACpBqF,EAAUhG,GAAO/uB,KAAKi1B,KAAKj1B,KAAKtE,IAAIq5B,EAAU/F,GAAM4F,EAAOz4B,SAG/C,IAAR4yB,GAA2C,IAA9Bv4B,KAAK+6B,KAAK75B,SAASE,SAChCm9B,EAAU/F,GAAOhvB,KAAKi1B,KAAKL,EAAOz4B,QAG7C,CACD3F,KAAKo9B,WAAae,EAAS5F,GAAO0F,CACrC,CACDE,EAASnjB,SAAQ,CAAC3I,EAAGlR,IAAMg9B,EAASh9B,GAAKkR,EAAI,IAC7CrS,KAAKo9B,WAAaa,EACdj+B,KAAK45B,QAAQ3C,OAAO+B,WACpBh5B,KAAKo9B,WAAa,EAAIp9B,KAAKiqB,MAAMtc,MAErC,IAAI2E,EAAI+b,EACR,QAAsBnsB,IAAlBlC,KAAKi7B,SACL,IAAK,IAAI1C,EAAM,EAAGA,EAAMv4B,KAAKiqB,MAAMtc,OAAQ4qB,EAAK,CAC5C,MAAMiB,EAAOx5B,KAAK06B,QAAQx5B,SAAS,GACnClB,KAAKu7B,YAAY/B,EAAMlnB,EAAG,EAAG6rB,EAAS5F,GAAMmG,GAC5C1+B,KAAK86B,YAAYh5B,YAAY03B,GAC7BlnB,GAAK6rB,EAAS5F,GAAO0F,EACjBj+B,KAAK45B,QAAQ3C,OAAO+B,WACpB1mB,GAAK,EAEZ,CAEL,QAAsBpQ,IAAlBlC,KAAKk7B,UAA4D,IAAlCl7B,KAAKk7B,SAASh6B,SAASE,QAAgBpB,KAAK45B,QAAQ3B,UAAYj4B,KAAKiqB,MAAMtc,KAAM,CAChH,IAAI4E,EAAI,EACR,IAAK,IAAIimB,EAAM,EAAGA,EAAMx4B,KAAK45B,QAAQ1B,WAAYM,EAAK,CAClD,MAAMgB,EAAOx5B,KAAK06B,QAAQx5B,SAAS,GACnCs4B,EAAKr2B,MAAMmrB,IAAM,GAAG/b,MACpBinB,EAAKr2B,MAAMwC,OAAY44B,EAAU/F,GAAOx4B,KAAKy6B,MAAMmE,cAA/B,KACpBpF,EAAKr2B,MAAMqmB,MAAQ,GAAG8U,MACtBt+B,KAAKk7B,SAASp5B,YAAY03B,GAC1BjnB,GAAKgsB,EAAU/F,GAAOyF,CACzB,CACDK,GAAgBt+B,KAAKy6B,MAAMkE,aAC3B3+B,KAAK+6B,KAAK53B,MAAMkrB,KAAUiQ,EAAeL,EAAlB,KACvBj+B,KAAK46B,YAAYz3B,MAAMkrB,KAAUiQ,EAAeL,EAAlB,KAC9Bj+B,KAAK86B,YAAY33B,MAAMkrB,KAAUiQ,EAAeL,EAAlB,KAC9Bj+B,KAAKi7B,SAAS93B,MAAMkrB,KAAUiQ,EAAeL,EAAlB,KAC3Bj+B,KAAKk7B,SAAS/3B,MAAMmrB,IAASoQ,EAAgBT,EAAnB,KAC1Bj+B,KAAKk7B,SAAS/3B,MAAM05B,OAAS,MAC7B78B,KAAKk7B,SAAS/3B,MAAMqmB,MAAQ,GAAG8U,KAClC,CACD,IAAI2B,EAAa,EACjB3tB,EAAI+b,EACJ,IAAK,IAAIkK,EAAMv4B,KAAKiqB,MAAMhgB,MAAOsuB,EAAMv4B,KAAKiqB,MAAMhgB,MAAQjK,KAAKiqB,MAAMtc,OAAQ4qB,EAAK,CAC9E,IAAI2H,EAAc/B,EAAS5F,EAAMv4B,KAAKiqB,MAAMhgB,OACxCsI,EAAI,EACR,IAAK,IAAIimB,EAAM,EAAGA,EAAMx4B,KAAKk4B,WAAYM,EAAK,CAC1C,MAAMgB,EAAOx5B,KAAK06B,QAAQx5B,SAAS,GACnClB,KAAKu7B,YAAY/B,EAAMlnB,EAAGC,EAAG2tB,EAAa3B,EAAU/F,IACpDx4B,KAAK46B,YAAY94B,YAAY03B,GAC7BjnB,GAAKgsB,EAAU/F,GAAOyF,EAClBj+B,KAAK45B,QAAQ3C,OAAO+B,WACpBzmB,GAAK,EAEZ,CACDD,GAAK4tB,EAAcjC,EAAU,EACxBj+B,KAAK45B,QAAQ3C,OAAO+B,WACrB1mB,GAAK,GAET2tB,GAAcC,EAAc,CAC/B,CACDlgC,KAAKo9B,UAAY6C,EAAa,EAC9BjgC,KAAKs8B,KAAOt8B,KAAK48B,eAAevO,EAAMruB,KAAKo9B,WAC3Cp9B,KAAK46B,YAAY94B,YAAY9B,KAAKs8B,WACZp6B,IAAlBlC,KAAKi7B,WACLj7B,KAAK29B,SAAW39B,KAAK48B,eAAevO,EAAMruB,KAAKo9B,WAC/Cp9B,KAAK86B,YAAYh5B,YAAY9B,KAAK29B,UAEzC,CACDpyB,QACIvL,KAAKy6B,MAAM0F,iBAAiBngC,KAAKiqB,MAAMhgB,YACjB/H,IAAlBlC,KAAKi7B,WACLj7B,KAAK09B,UAAY19B,KAAKi7B,SAAS6D,iBAEtC,CACDxB,aACI,QAAsBp7B,IAAlBlC,KAAKi7B,SAAT,CAKA,IAFAj7B,KAAK86B,YAAYn5B,YAAY3B,KAAK29B,UAClC39B,KAAKi7B,SAASt5B,YAAY3B,KAAK09B,WACxB19B,KAAK86B,YAAY55B,SAASE,OAAS,GACtCpB,KAAKi7B,SAASn5B,YAAY9B,KAAK86B,YAAY55B,SAAS,IAExD,GAAIlB,KAAK09B,UAAUx8B,SAASE,OAAS,EAAG,CACpC,IAAIitB,EAAO6P,GAASl+B,KAAK09B,UAAUv6B,MAAMkrB,MACzC,KAAOruB,KAAK09B,UAAUx8B,SAASE,OAAS,GAAG,CACvC,MAAMo4B,EAAOx5B,KAAK09B,UAAUx8B,SAAS,GACrCs4B,EAAKr2B,MAAMkrB,KAAO,GAAG6P,GAAS1E,EAAKr2B,MAAMkrB,MAAQA,MACjDruB,KAAKi7B,SAASn5B,YAAY03B,EAC7B,CACJ,CAbA,CAcJ,CACD+D,WACIv9B,KAAK46B,YAAYj5B,YAAY3B,KAAKs8B,MAClCt8B,KAAK+6B,KAAKp5B,YAAY3B,KAAKg7B,WAC3B,MAAMiF,EAAajgC,KAAK45B,QAAQxX,MAAM6V,SAChCmI,EAAYpgC,KAAKiqB,MAAMhgB,MACvBo2B,EAAergC,KAAKiqB,MAAMtc,KAC1B2yB,EAAaL,EAAaI,EAAergC,KAAKiqB,MAAMhgB,MAC1D,IAAK,IAAIsuB,EAAM,EAAGA,EAAM8H,IAAgB9H,EACpC,IAAK,IAAIC,EAAM,EAAGA,EAAMx4B,KAAKk4B,WAAYM,EAAK,CAC1C,MAAMgB,EAAOx5B,KAAK46B,YAAY15B,SAAS,GACjC+uB,EAAMuI,GAAO4H,EAAYC,GAAgBD,EAAY7H,EAC3Dv4B,KAAKugC,aAAa/G,EAAMvJ,EAC3B,CAEL,IAAI5B,EAAOruB,KAAKo9B,UAAYp9B,KAAKm9B,eACjC,IAAK,IAAI3E,EAAM,EAAGA,EAAMx4B,KAAKk4B,WAAYM,EACrC,IAAK,IAAID,EAAM,EAAGA,EAAM+H,IAAc/H,EAAK,CACvC,MAAMiB,EAAOx5B,KAAKg7B,UAAU95B,SAAS,GACrCs4B,EAAKr2B,MAAMkrB,KAAO,GAAG6P,GAAS1E,EAAKr2B,MAAMkrB,MAAQA,MACjD,MAAM4B,EAAMuI,EAAMyH,EAAaG,EAAYC,EAAe9H,EAC1Dv4B,KAAKugC,aAAa/G,EAAMvJ,EAC3B,CAER,CACDsQ,aAAa5S,EAAMsC,GACf,IAAIuQ,EAEAA,EADAvQ,EAAMjwB,KAAK+6B,KAAK75B,SAASE,OACXpB,KAAK+6B,KAAK75B,SAAS+uB,GAGnB,KAElBjwB,KAAK+6B,KAAKvE,aAAa7I,EAAM6S,EAChC,ECxSE,MAAMC,WAA8B/E,GACvC77B,YAAY46B,EAAOxQ,GAOf,GANAhpB,MAAMw5B,GACNz6B,KAAKmK,MAAO,EACZnK,KAAKi4B,SAAWj4B,KAAK45B,QAAQ3B,SAC7Bj4B,KAAKk4B,SAAWl4B,KAAK45B,QAAQ1B,SAC7Bl4B,KAAKiqB,MAAQA,EACbjqB,KAAK0gC,aAAe1gC,KAAK0gC,aAAa1d,KAAKhjB,MACT,IAA9BA,KAAK+6B,KAAK75B,SAASE,OACnBpB,KAAK2gC,aAAe,MAEnB,CACD,MAAMnH,EAAOx5B,KAAK+6B,KAAK75B,SAASlB,KAAK+6B,KAAK75B,SAASE,OAAS,GACtDitB,EAAO6P,GAAS1E,EAAKr2B,MAAMkrB,MAC3B+P,EAAS5E,EAAKrL,wBACpBnuB,KAAK2gC,aAAetS,EAAO+P,EAAO5U,KACrC,CACDiX,GAAsB5c,QAAU7jB,IACnC,CACDyjB,UACIzjB,KAAKg8B,4BACLh8B,KAAK4gC,0BACL5gC,KAAK6gC,eACR,CACD3c,aAAgB,CAChBF,eAAe6T,GACX,IAAIzoB,EAAI,EACJpP,KAAK45B,QAAQ3C,OAAO+B,WACpB5pB,EAAI,GAERpP,KAAKg7B,UAAU73B,MAAMkrB,KAAO,GAAGruB,KAAK8gC,cAAgBjJ,EAAI73B,KAAK+gC,eAAiB3xB,MAC9EpP,KAAKs8B,KAAKn5B,MAAMkrB,KAAUruB,KAAKghC,SAAWnJ,EAAI73B,KAAK+gC,eAA5B,UACD7+B,IAAlBlC,KAAKi7B,WACLj7B,KAAK09B,UAAUv6B,MAAMkrB,KAAO,GAAGruB,KAAK8gC,cAAgBjJ,EAAI73B,KAAK+gC,eAAiB3xB,MAC9EpP,KAAK29B,SAASx6B,MAAMkrB,KAAUruB,KAAKghC,SAAWnJ,EAAI73B,KAAK+gC,eAA5B,KAElC,CACD9c,YACIjkB,KAAK0gC,eACL1gC,KAAKm8B,gBACR,CACDyE,0BACI,IAAI3Q,EAAMjwB,KAAKiqB,MAAMhgB,MACrB,IAAK,IAAIuuB,EAAM,EAAGA,EAAMx4B,KAAK45B,QAAQ1B,WAAYM,EAAK,CAClD,IAAK,IAAID,EAAM,EAAGA,EAAMv4B,KAAKiqB,MAAMtc,OAAQ4qB,EACvCv4B,KAAK46B,YAAY94B,YAAY9B,KAAK+6B,KAAK75B,SAAS+uB,IAEpDA,GAAOjwB,KAAKi4B,QACf,CACD,MAAMgJ,EAAqBjhC,KAAK46B,YAAY15B,SAAS,GAC/CggC,EAAoBlhC,KAAK46B,YAAY15B,SAASlB,KAAK46B,YAAY15B,SAASE,OAAS,GACvF,IAAI+/B,EAAiBjD,GAASgD,EAAkB/9B,MAAMkrB,MAAQ6P,GAASgD,EAAkB/9B,MAAMqmB,OAASxpB,KAAKy6B,MAAMkE,aACnHwC,GAAkB,EAClB,IAAIpsB,EAAIosB,EAAiBjD,GAAS+C,EAAmB99B,MAAMkrB,MAI3D,GAHAruB,KAAK+gC,eAAiBhsB,EACtB/U,KAAKs8B,KAAOt8B,KAAK48B,eAAeuE,EAAgBpsB,GAChD/U,KAAK46B,YAAY94B,YAAY9B,KAAKs8B,WACZp6B,IAAlBlC,KAAKi7B,SAAT,CAGA,IAAK,IAAI95B,EAAI,EAAGA,EAAInB,KAAKiqB,MAAMtc,OAAQxM,EACnCnB,KAAK86B,YAAYh5B,YAAY9B,KAAKi7B,SAAS/5B,SAASlB,KAAKiqB,MAAMhgB,QAEnEjK,KAAK29B,SAAW39B,KAAK48B,eAAeuE,EAAgBpsB,GACpD/U,KAAK86B,YAAYh5B,YAAY9B,KAAK29B,SALjC,CAMJ,CACDkD,gBACI7gC,KAAKy6B,MAAM0F,iBAAiBngC,KAAKiqB,MAAMhgB,YACjB/H,IAAlBlC,KAAKi7B,WACLj7B,KAAK09B,UAAY19B,KAAKi7B,SAAS6D,kBAEnC,MAAMzQ,EAAO6P,GAASl+B,KAAKg7B,UAAU73B,MAAMkrB,MAC3CruB,KAAKg7B,UAAU73B,MAAMqmB,MAAWxpB,KAAK2gC,aAAetS,EAAO,EAA9B,KAC7BruB,KAAK8gC,cAAgBzS,EACrBruB,KAAKghC,SAAW9C,GAASl+B,KAAKs8B,KAAKn5B,MAAMkrB,WACnBnsB,IAAlBlC,KAAKi7B,WACLj7B,KAAK09B,UAAUv6B,MAAMkrB,KAAO,GAAGA,MAC/BruB,KAAK09B,UAAUv6B,MAAMqmB,MAAWxpB,KAAK2gC,aAAetS,EAAO,EAA9B,KAEpC,CACDqS,eACI1gC,KAAK46B,YAAYj5B,YAAY3B,KAAKs8B,MAClCt8B,KAAK+6B,KAAKp5B,YAAY3B,KAAKg7B,WAC3Bh7B,KAAK46B,YAAY+E,kBACjB3/B,KAAK4/B,sBACD5/B,KAAKi7B,WACLj7B,KAAK86B,YAAYn5B,YAAY3B,KAAK29B,UAClC39B,KAAKi7B,SAASt5B,YAAY3B,KAAK09B,WAC/B19B,KAAK86B,YAAY6E,kBACjB3/B,KAAK6/B,uBAEL7/B,KAAKy6B,MAAMY,eACXr7B,KAAKy6B,MAAMY,eAElB,CACDwE,sBACI,GAAuC,IAAnC7/B,KAAK09B,UAAUx8B,SAASE,OACxB,OAEJ,IAAIitB,EAAO6P,GAASl+B,KAAK09B,UAAUv6B,MAAMkrB,MACzC,KAAOruB,KAAK09B,UAAUx8B,SAASE,OAAS,GAAG,CACvC,MAAMo4B,EAAOx5B,KAAK09B,UAAUx8B,SAAS,GACrCs4B,EAAKr2B,MAAMkrB,KAAO,GAAG6P,GAAS1E,EAAKr2B,MAAMkrB,MAAQA,MACjDruB,KAAKi7B,SAASn5B,YAAY03B,EAC7B,CACJ,CACDoG,sBACI,GAAuC,IAAnC5/B,KAAKg7B,UAAU95B,SAASE,OACxB,OAEJ,IAAIitB,EAAO6P,GAASl+B,KAAKg7B,UAAU73B,MAAMkrB,MACzC,IAAK,IAAImK,EAAM,EAAGA,EAAMx4B,KAAKk4B,WAAYM,EACrC,IAAK,IAAID,EAAM,EAAGA,EAAMv4B,KAAKi4B,SAAWj4B,KAAKiqB,MAAMhgB,QAASsuB,EAAK,CAC7D,MAAMiB,EAAOx5B,KAAKg7B,UAAU95B,SAAS,GACrCs4B,EAAKr2B,MAAMkrB,KAAO,GAAG6P,GAAS1E,EAAKr2B,MAAMkrB,MAAQA,MACjD,MAAM4B,EAAMuI,EAAMx4B,KAAK45B,QAAQ3B,SAAWj4B,KAAKiqB,MAAMhgB,MAAQsuB,EAC7Dv4B,KAAKugC,aAAa/G,EAAMvJ,EAC3B,CAER,CACDsQ,aAAa5S,EAAMsC,GACf,IAAIuQ,EAEAA,EADAvQ,EAAMjwB,KAAK+6B,KAAK75B,SAASE,OACXpB,KAAK+6B,KAAK75B,SAAS+uB,GAGnB,KAElBjwB,KAAK+6B,KAAKvE,aAAa7I,EAAM6S,EAChC,ECnIL,IAAIjc,GAAsB,IAInB,SAAS6c,GAAe3/B,GAC3B,QAAgBS,IAAZT,EACA,OACJ,MAAM4/B,EA0HH,SAA8BC,GACjC,KAAOA,IAAOhgC,SAASy5B,OAA6B,IAArBwG,GAAaD,IAAe,CACvD,GAAyB,OAArBA,EAAGxP,cACH,OACJwP,EAAKA,EAAGxP,aACX,CACD,OAAOwP,CACX,CAjI6BE,CAAqB//B,GAC9C,QAAyBS,IAArBm/B,EACA,OACJ,MAAMI,EAAaJ,EAAiBlT,wBAC9BuT,EAAajgC,EAAQ0sB,wBAC3B,GAAIkT,IAAqB//B,SAASy5B,KAAM,CACpC,MAAMzoB,EAAEA,EAACC,EAAEA,GAkBnB,SAA6B8uB,EAAkBI,EAAYC,GACvD,MAAMC,EAAM,GACNC,EAAaF,EAAWrT,KAAOgT,EAAiBQ,WAAaJ,EAAWpT,KAAOsT,EAC/EG,EAAcJ,EAAW9J,MAAQyJ,EAAiBQ,WAAaJ,EAAWpT,KAAOsT,EACjFI,EAAYL,EAAWpT,IAAM+S,EAAiBW,UAAYP,EAAWnT,IAAMqT,EAC3EM,EAAeP,EAAW7E,OAASwE,EAAiBW,UAAYP,EAAWnT,IAAMqT,EACjFO,EAAcb,EAAiBrM,YAC/BmN,EAAed,EAAiBvM,aACtC,IAAIxiB,EAAI+uB,EAAiBQ,WACrBtvB,EAAI8uB,EAAiBW,UACrBF,EAAcF,EAAa,EAAID,EAAMO,EACrC5vB,EAAIsvB,EACCE,EAAcT,EAAiBQ,WAAaK,EACjD5vB,EAAIwvB,EAAcI,EACbN,EAAaP,EAAiBQ,aACnCvvB,EAAIsvB,GACJK,EAAeF,EAAY,EAAIJ,EAAMQ,EACrC5vB,EAAIwvB,EACCE,EAAeZ,EAAiBW,UAAYG,EACjD5vB,EAAI0vB,EAAeE,EACdJ,EAAYV,EAAiBW,YAClCzvB,EAAIwvB,GAGR,OAFAzvB,EAAI9I,KAAKtE,IAAI,EAAGoN,GAChBC,EAAI/I,KAAKtE,IAAI,EAAGqN,GACT,CAAED,IAAGC,IAChB,CA3CyB6vB,CAAoBf,EAAkBI,EAAYC,IA6C3E,SAAsBW,EAAY/vB,EAAGC,GACjC,IASI+vB,EAAQC,EATRC,EAAaC,GAAiBviC,IAAImiC,QACnBngC,IAAfsgC,GACAA,EAAa,CAAElwB,EAAGA,EAAGC,EAAGA,GACxBkwB,GAAiBtiC,IAAIkiC,EAAYG,KAGjCA,EAAWlwB,EAAIA,EACfkwB,EAAWjwB,EAAIA,GAGf8vB,IAAe/gC,SAASy5B,MACxBuH,EAASne,OAAOue,SAAWve,OAAOwe,YAClCJ,EAASpe,OAAOye,SAAWze,OAAO0e,cAGlCP,EAASD,EAAWR,WACpBU,EAASF,EAAWL,WAExB,MAAMc,EAASxwB,EAAIgwB,EACb7a,EAASlV,EAAIgwB,EACnB,GAAe,IAAXO,GAA2B,IAAXrb,EAEhB,YADAgb,GAAiBp5B,OAAOg5B,GAuBR1+B,EApBXvD,IACL,GAAIoiC,EAAWlwB,IAAMA,GAAKkwB,EAAWjwB,IAAMA,EACvC,OAAO,EAEX,MAAMwwB,EAAKT,EAASliC,EAAQ0iC,EACtBE,EAAKT,EAASniC,EAAQqnB,EAW5B,OAVI4a,IAAe/gC,SAASy5B,KACxB5W,OAAO8e,SAASF,EAAIC,IAGpBX,EAAWR,WAAakB,EACxBV,EAAWL,UAAYgB,GAEb,IAAV5iC,GACAqiC,GAAiBp5B,OAAOg5B,IAErB,CAAI,EAKf9W,YAAW,KAAQpH,OAAOT,sBAAsBwf,GAAYlgB,KAAKmB,OAAQxgB,OAAUzB,OAAWA,GAAW,GAAK,GAD3G,IAAiByB,CAFxB,CAvFQw/B,CAAa9B,EAAkB/uB,EAAGC,GACyB,UAAvD4R,OAAOif,iBAAiB/B,GAAkBhQ,UAC1ClN,OAAOkf,SAAS,CACZhV,KAAMoT,EAAWpT,KACjBC,IAAKmT,EAAWnT,IAChBgV,SAAU,UAGrB,MAEGnf,OAAOkf,SAAS,CACZhV,KAAMqT,EAAWrT,KACjBC,IAAKoT,EAAWpT,IAChBgV,SAAU,UAGtB,CA2BA,MAAMb,GAAmB,IAAIn6B,IA6C7B,IAAIi7B,GAAW,EAIf,SAASL,GAAYv/B,EAAU0gB,EAAWzgB,QACpB1B,IAAdmiB,IACAA,EAAYmf,KAAKC,MACjB7/B,IAAO2/B,IAGX,IAAIjf,GADSkf,KAAKC,MAC8Bpf,GAAaE,GAC7DD,EAAUA,EAAU,EAAI,EAAIA,EAC5B,MAAMlkB,GAOIskB,EAPSJ,EAQZ,IAAO,EAAI9a,KAAK8J,IAAI9J,KAAKmb,GAAKD,KADzC,IAAcA,GANc,IAApB/gB,EAASvD,IAETA,EAAQ,GACR+jB,OAAOT,sBAAsBwf,GAAYlgB,KAAKmB,OAAQxgB,EAAU0gB,EAAWzgB,GAEnF,CAIA,IAC4B8/B,GADxBC,IACwBD,GADgBvf,OAAOyf,UAAUF,UAGlD,IAAIG,OADe,CAAC,QAAS,WAAY,SACZxG,KAAK,MAAMyG,KAAKJ,IAHkB,EAAI,GAavE,SAASnC,GAAaD,GACzB,MAAMyC,EAAgBC,GAAmB1C,EAAI,MAAQ2C,GAAY3C,EAAI,KAC/D4C,EAAgBF,GAAmB1C,EAAI,MAAQ2C,GAAY3C,EAAI,KACrE,OAAOyC,GAAiBG,CAC5B,CACA,SAASF,GAAmB1C,EAAI3uB,GAC5B,MAAa,MAATA,EACO2uB,EAAGtM,YAAc2O,GAAqBrC,EAAG6C,YAEzC7C,EAAGxM,aAAe6O,GAAqBrC,EAAG8C,YACzD,CACA,SAASH,GAAY3C,EAAI3uB,GACrB,MACM0xB,EADQlgB,OAAOif,iBAAiB9B,EAAI,MACd,WAAa3uB,GACzC,MAAyB,SAAlB0xB,GAA8C,WAAlBA,CACvC,CCvJO,MAAMlhC,GAAQ7B,SAASue,cAAc,SCiBrC,SAASmgB,GAAOjzB,GACnB,OAAOvB,SAASuB,EAAE1J,UAAU,EAAG0J,EAAE3L,OAAS,GAC9C,CACO,SAAS88B,GAASnxB,GACrB,OAAOpM,WAAWoM,EAAE1J,UAAU,EAAG0J,EAAE3L,OAAS,GAChD,CACA,SAASkjC,GAAUjjC,GACf,OAAsB,IAAlBA,EAAEwlB,cAGqC,SAAvC1C,OAAOif,iBAAiB/hC,GAAGutB,WAG3BvtB,EAAEywB,eACKwS,GAAUjjC,EAAEywB,gBAG3B,CDjCA3uB,GAAM8jB,YAAcxH,CAAI;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ECkCjB,MAAMid,WAAc7W,GACvBhmB,YAAYmB,GACRC,QACAjB,KAAK2+B,aAAe,EACpB3+B,KAAK4+B,cAAgB,EACrB5+B,KAAKukC,YAAc,EACnBvkC,KAAKwkC,YAAc,EACnBxkC,KAAKykC,SAAU,EACfzkC,KAAK4jB,SAAW,IAAIiB,GACpB7kB,KAAK0kC,yBAA2B1kC,KAAK0kC,yBAAyB1hB,KAAKhjB,MACnEA,KAAK2kC,YAAc3kC,KAAK2kC,YAAY3hB,KAAKhjB,MACzCA,KAAK4kC,YAAc5kC,KAAK4kC,YAAY5hB,KAAKhjB,MACzCA,KAAK6kC,UAAY7kC,KAAK6kC,UAAU7hB,KAAKhjB,MACrCA,KAAKuzB,QAAUvzB,KAAKuzB,QAAQvQ,KAAKhjB,MACjCA,KAAKszB,SAAWtzB,KAAKszB,SAAStQ,KAAKhjB,MACnCA,KAAK8kC,YAAc9kC,KAAK8kC,YAAY9hB,KAAKhjB,MACzCA,KAAK+kC,WAAa/kC,KAAK+kC,WAAW/hB,KAAKhjB,MACvCA,KAAKglC,WAAahlC,KAAKglC,WAAWhiB,KAAKhjB,MACvCA,KAAKilC,SAAWjlC,KAAKilC,SAASjiB,KAAKhjB,MACnCA,KAAKklC,oCAAsCllC,KAAKklC,oCAAoCliB,KAAKhjB,MACzFA,KAAKmlC,iBAAmBnlC,KAAKmlC,iBAAiBniB,KAAKhjB,MACnDA,KAAKolC,aAAeplC,KAAKolC,aAAapiB,KAAKhjB,MAC3CA,KAAKmO,KAAO4R,GAAI/f,KAAK+6B,KAAOhb,MAC5B/f,KAAKmO,KAAK+tB,UAAY,OACtBl8B,KAAK+6B,KAAKmB,UAAY,OACtBl8B,KAAK06B,QAAU3a,KACf/f,KAAK06B,QAAQ/3B,UAAUC,IAAI,WAC3B5C,KAAKqqB,UAAYrqB,KAAK2kC,YACtB3kC,KAAKsD,iBAAiB,UAAWtD,KAAKuzB,SACtCvzB,KAAKsD,iBAAiB,WAAYtD,KAAKszB,UACvCtzB,KAAK+6B,KAAKsK,SAAWrlC,KAAKklC,oCAC1BllC,KAAK+6B,KAAKuK,SAAW,KACbtlC,KAAK4jB,SAASC,SAAW7jB,KAAK4jB,SAASC,mBAAmB6X,IAC1D17B,KAAK4jB,SAASC,QAAQkY,gBAE1B/7B,KAAKklC,sCACDllC,KAAKi7B,WACLj7B,KAAKi7B,SAAS4G,WAAa7hC,KAAK+6B,KAAK8G,WACrC7hC,KAAKm7B,iBAAiB0G,WAAa7hC,KAAK+6B,KAAK8G,YAE7C7hC,KAAKk7B,WACLl7B,KAAKk7B,SAAS8G,UAAYhiC,KAAK+6B,KAAKiH,UACpChiC,KAAKo7B,iBAAiB4G,UAAYhiC,KAAK+6B,KAAKiH,UAC/C,EAELhiC,KAAK+6B,KAAKzL,cAAgBtvB,KAAK8kC,YAC/B9kC,KAAKsnB,aAAa,CAAEC,KAAM,OAAQge,gBAAgB,IAClDvlC,KAAKimB,YAAYuf,IACjBxlC,KAAKkmB,WAAWpkB,YAAY9B,KAAKmO,MACjCnO,KAAKkmB,WAAWpkB,YAAY9B,KAAK06B,SAC7B15B,IACAyC,EAAqBzD,KAAMgB,GACvBA,EAAMykC,gBACNzlC,KAAK0C,SAAS1B,EAAMykC,sBAELvjC,IAAnBw6B,GAAMtR,WACNsR,GAAMtR,SAAW,IAAIF,kBAAiB,CAACwa,EAAWta,KAC9CsR,GAAMiJ,UAAU3qB,SAAQyf,IAChB6J,GAAU7J,KACViC,GAAMiJ,UAAUt8B,OAAOoxB,GACvBA,EAAMmL,eACT,GACH,IAENlJ,GAAMtR,SAASI,QAAQlqB,SAASy5B,KAAM,CAClC8K,YAAY,EACZna,SAAS,IAGpB,CACDnF,oBACQ+d,GAAUtkC,MACVA,KAAK4lC,eAGLlJ,GAAMiJ,UAAU/iC,IAAI5C,MAExBiB,MAAMslB,yBACiBrkB,IAAnBlC,KAAKs7B,YACLt7B,KAAKs7B,UAAY,IAAI7C,GAAeN,GAAc2N,aAClD9lC,KAAKs7B,UAAU32B,SAAS/B,IAAI5C,KAAKmlC,iBAAkBnlC,MAE1D,CACDwmB,uBACIkW,GAAMiJ,UAAUt8B,OAAOrJ,KAC1B,CACD87B,cAAciK,GACV,IAAK,MAAMtkC,KAAWskC,OACF7jC,IAAZT,GAGJzB,KAAKmO,KAAKqoB,aAAa/0B,EAASzB,KAAKmO,KAAKjN,SAAS,GAE1D,CACDk7B,iBAAiB2J,GACb,IAAK,MAAMtkC,KAAWskC,OACF7jC,IAAZT,GAGJzB,KAAKmO,KAAKxM,YAAYF,EAE7B,CACDkjC,YAAY1V,GACR,GAAKjvB,KAAKs7B,WAEFt7B,KAAKs7B,UAAU/T,OACd4Q,GAAc2N,YACf,CACI,IAAIvM,EAAM,CAAEhB,IAAKv4B,KAAKs7B,UAAU/C,IAAKC,IAAKx4B,KAAKs7B,UAAU9C,KACzD,OAAQvJ,EAAGhtB,KACP,IAAK,kBACoBC,IAAjBlC,KAAKgmC,SAAyBzM,EAAIhB,IAAM,EAAIv4B,KAAK45B,QAAQ3B,aACvDsB,EAAIhB,IACNtJ,EAAGvH,iBACHuH,EAAGoF,mBAEP,MACJ,IAAK,iBACoBnyB,IAAjBlC,KAAKgmC,SAAyBzM,EAAIhB,IAAM,MACtCgB,EAAIhB,IACNtJ,EAAGvH,iBACHuH,EAAGoF,mBAEP,MACJ,IAAK,YACGkF,EAAIf,IAAM,EAAIx4B,KAAK45B,QAAQ1B,aACzBqB,EAAIf,IACNvJ,EAAGvH,iBACHuH,EAAGoF,mBAEP,MACJ,IAAK,UACGkF,EAAIf,IAAM,MACRe,EAAIf,IACNvJ,EAAGvH,iBACHuH,EAAGoF,mBAEP,MACJ,IAAK,aACoBnyB,IAAjBlC,KAAKgmC,QACDhmC,KAAK45B,SAAS3C,OAAO6B,WAAaV,GAAS6N,eAC3CjmC,KAAK05B,YAIT15B,KAAKy5B,WACDF,EAAIf,IAAM,EAAIx4B,KAAK45B,QAAQ1B,aACzBqB,EAAIf,IACNx4B,KAAKs7B,UAAUl7B,MAAQm5B,EACvBv5B,KAAK05B,aAGbzK,EAAGvH,iBACHuH,EAAGoF,kBAGXr0B,KAAKs7B,UAAUl7B,MAAQm5B,CAC1B,CAGZ,CACDqL,YAAY3V,GACR,MAAMuK,EAAOvK,EAAG5f,OAChB,GAAe,UAAX4f,EAAGhtB,IAGH,OAFAjC,KAAK2kC,YAAY1V,QACjBA,EAAGvH,iBAGP,IAAK8R,EAAK72B,UAAUytB,SAAS,cAA4BluB,IAAjBlC,KAAKgmC,QACzC,OAAQ/W,EAAGhtB,KACP,IAAK,YACL,IAAK,UACL,IAAK,aACL,IAAK,YACL,IAAK,MACL,IAAK,QACD,MACJ,QACQjC,KAAK45B,SAAS3C,OAAO6B,WAAaV,GAAS6N,eAC3ChX,EAAGvH,iBAMtB,CACDmd,UAAU5a,GACN,MAAMuP,EAAOvP,EAAM5a,OACnB,GAAImqB,aAAgB1T,YAAa,CAC7B,MAAM/T,EAAIynB,EAAKrL,wBACTxf,EAAI3O,KAAKkmC,oBAAoBn0B,EAAEO,EAAIP,EAAEyX,MAAQ,EAAGzX,EAAEQ,EAAIR,EAAEpM,OAAS,QAC7DzD,IAANyM,IACA3O,KAAKs7B,UAAUl7B,MAAQuO,EAE9B,CACJ,CACD4kB,QAAQtJ,GACP,CACDqJ,SAASrJ,GACR,CACDyP,WACI,QAAqBx3B,IAAjBlC,KAAKgmC,QAAuB,CAC5B,GAAIhmC,KAAKgmC,QAAQzN,MAAQv4B,KAAKs7B,UAAUl7B,MAAMm4B,KAC1Cv4B,KAAKgmC,QAAQxN,MAAQx4B,KAAKs7B,UAAUl7B,MAAMo4B,IAC1C,OAGA3vB,QAAQC,IAAI,uDAEnB,CACD,MAAMyvB,EAAMv4B,KAAKs7B,UAAUl7B,MAAMm4B,IAC3BC,EAAMx4B,KAAKs7B,UAAUl7B,MAAMo4B,IAC3BgB,EAAOx5B,KAAK+6B,KAAK75B,SAASq3B,EAAMC,EAAMx4B,KAAK45B,QAAQ3B,UACzDj4B,KAAKgmC,QAAU,IAAI1N,GAASC,EAAKC,GACjCgB,EAAK72B,UAAUC,IAAI,QACnB5C,KAAK45B,QAAQF,SAAS15B,KAAKgmC,QAASxM,EACvC,CACDC,WACI,QAAqBv3B,IAAjBlC,KAAKgmC,QACL,OAEJ,MAAMzN,EAAMv4B,KAAKgmC,QAAQzN,IACnBC,EAAMx4B,KAAKgmC,QAAQxN,IACnBgB,EAAOx5B,KAAK+6B,KAAK75B,SAASq3B,EAAMC,EAAMx4B,KAAK45B,QAAQ3B,UACzDuB,EAAK72B,UAAUqB,OAAO,QACtBhE,KAAK45B,QAAQH,SAASz5B,KAAKgmC,QAASxM,GACpCx5B,KAAKgmC,aAAU9jC,EACflC,KAAK2nB,OACR,CACDmd,YAAY7V,GACX,CACDkX,WACI,OAAOnmC,KAAKoiB,KACf,CACD1f,SAAS0f,GACL,QAAclgB,IAAVkgB,EAOA,OANIpiB,KAAKs7B,WACLt7B,KAAKs7B,UAAU32B,SAASX,OAAOhE,MAEnCA,KAAKoiB,WAAQlgB,EACblC,KAAKs7B,UAAY,IAAI7C,QACrBz4B,KAAKs7B,UAAU32B,SAAS/B,IAAI5C,KAAKmlC,iBAAkBnlC,MAGvD,GAAIoiB,aAAiBqW,GAMjB,OALIz4B,KAAKs7B,WACLt7B,KAAKs7B,UAAU32B,SAASX,OAAOhE,MAEnCA,KAAKs7B,UAAYlZ,OACjBpiB,KAAKs7B,UAAU32B,SAAS/B,IAAI5C,KAAKmlC,iBAAkBnlC,MAGvD,GAAIoiB,aAAiB2V,GAArB,CACI/3B,KAAKoiB,MAAQA,EACbpiB,KAAKoiB,MAAMzd,SAAS/B,IAAI5C,KAAKolC,aAAcplC,MAC3C,MAAM45B,EAAUT,GAAaiN,OAAOhkB,GACpC,IACIpiB,KAAK45B,QAAU,IAAIA,EAAQxX,EAC9B,CACD,MAAO/gB,GAGH,MAFAwH,QAAQC,IAAI,0DAA0DzH,KACtEwH,QAAQC,IAAI,mDACNzH,CACT,CACDrB,KAAK4lC,cAER,MACD,GAAIxjB,aAAiB/hB,OACjB,MAAMO,MAAM,8CAAgDwhB,EAAMviB,YAAYwC,KAErF,CACD8iC,mBACI,QAAuBjjC,IAAnBlC,KAAKs7B,UAIT,OADAt7B,KAAKy5B,WACGz5B,KAAKs7B,UAAU/T,MACnB,KAAK4Q,GAAcO,UAEX,GAAIp3B,SAAS+kC,gBAAkBrmC,KAAM,CAEjCohC,GADaphC,KAAK+6B,KAAK75B,SAASlB,KAAKs7B,UAAU/C,IAAMv4B,KAAKs7B,UAAU9C,IAAMx4B,KAAK45B,QAAQ3B,UAE1F,CAEL,MACJ,KAAKE,GAAc2N,YACf,GAAIxkC,SAAS+kC,gBAAkBrmC,KAAM,CACjC,MAAMw5B,EAAOx5B,KAAK+6B,KAAK75B,SAASlB,KAAKs7B,UAAU/C,IAAMv4B,KAAKs7B,UAAU9C,IAAMx4B,KAAK45B,QAAQ3B,W7DnSpG,SAAkBx2B,GACrB,IAAKH,SAASglC,WACV,OAAO,EACX,IAAIxQ,EAASx0B,SAAS+kC,cACtB,KAAkB,OAAXvQ,GAAiB,CACpB,GAAIA,IAAWr0B,EACX,OAAO,EAEX,GAA0B,OAAtBq0B,EAAO5P,WACP,MACJ4P,EAASA,EAAO5P,WAAWmgB,aAC9B,CACD,OAAO,CACX,E6DuRyBC,CAAS9M,IACVA,EAAK7R,QAETyZ,GAAe5H,GACXx5B,KAAK45B,SAAS3C,OAAO6B,WAAaV,GAASW,eAC3C/4B,KAAK05B,UAEZ,CAGL,KAAKvB,GAAcoO,YAI1B,CACDnB,aAAanb,GACT,OAAQA,EAAMzpB,MACV,KAAK63B,GAAemO,aAChB,CACI,MAAMhN,EAAOx5B,KAAK+6B,KAAK75B,SAAS+oB,EAAMsO,IAAMtO,EAAMuO,IAAMx4B,KAAK45B,QAAQ3B,UACrEj4B,KAAKs5B,SAASrP,EAAOuP,EACxB,CACD,MACJ,KAAKnB,GAAeoO,WAChBzmC,KAAK4jB,SAASkB,IAAI,IAAI0Y,GAAmBx9B,KAAMiqB,IAC/C,MACJ,KAAKoO,GAAeqO,WAChB1mC,KAAK4jB,SAASkB,IAAI,IAAIia,GAAmB/+B,KAAMiqB,IAC/C,MACJ,KAAKoO,GAAesO,WAChB3mC,KAAK4jB,SAASkB,IAAI,IAAIgb,GAAsB9/B,KAAMiqB,IAClD,MACJ,KAAKoO,GAAeuO,WAChB5mC,KAAK4jB,SAASkB,IAAI,IAAI2b,GAAsBzgC,KAAMiqB,IAClD,MACJ,QACIphB,QAAQC,IAAI,yBAAyBmhB,wBAEhD,CACD2b,eACS5lC,KAAK45B,UAGV55B,KAAKykC,QAAUH,GAAUtkC,MACpBA,KAAKykC,SAGoB,IAA1BzkC,KAAK45B,QAAQ3B,UAA4C,IAA1Bj4B,KAAK45B,QAAQ1B,WAG5Cl4B,KAAK45B,QAAQ3C,OAAO+B,UACpBh5B,KAAKmO,KAAKxL,UAAUC,IAAI,YAE5B5C,KAAK49B,qBACL59B,KAAK6mC,qBACL7mC,KAAK8mC,kBACL9mC,KAAK+mC,cACLxb,WAAWvrB,KAAK0kC,yBAA0B,IAC7C,CACDA,2BACI1kC,KAAKg+B,uBACL,IAAIgJ,UAAEA,EAAStI,cAAEA,GAAkB1+B,KAAKinC,yBACpCC,WAAEA,EAAU5I,aAAEA,GAAiBt+B,KAAKmnC,sBACxCnnC,KAAKonC,iBAAiBJ,EAAWtI,EAAeJ,GAChDt+B,KAAKqnC,cAAcH,EAAYxI,EAAeJ,GAC9Ct+B,KAAKsnC,UAAUhJ,EAAcI,GAC7B1+B,KAAKunC,eAAeP,EAAWE,EAAYxI,EAAeJ,GAC1Dt+B,KAAKklC,qCACR,CACDtH,qBACI,QAA2B17B,IAAvBlC,KAAKw+B,cACL,OAEJ,MAAMgJ,EAAoBxnB,GAAKF,GAAK,OACpC9f,KAAK06B,QAAQ54B,YAAY0lC,EAC5B,CACDxJ,uBACI,QAA2B97B,IAAvBlC,KAAKw+B,cACL,OAEJ,MAAMgJ,EAAoBxnC,KAAK06B,QAAQx5B,SAAS,GAC1C6Q,EAAIy1B,EAAkBrZ,wBAC5BnuB,KAAKq+B,aAAe70B,KAAKi1B,KAAK1sB,EAAEyX,MAAQxpB,KAAK2+B,cAC7C3+B,KAAKw+B,cAAgBh1B,KAAKi1B,KAAK1sB,EAAEpM,OAAS3F,KAAK4+B,eAC/C5+B,KAAK06B,QAAQ/4B,YAAY6lC,EAC5B,CACDX,qBACI,MAAMY,EAAgB,IAAI1mC,MAAMf,KAAK45B,QAAQ3B,UAC7C,IAAK,IAAIM,EAAM,EAAGA,EAAMv4B,KAAK45B,QAAQ3B,WAAYM,EAAK,CAClD,MAAMxO,EAAU/pB,KAAK45B,QAAQR,cAAcb,QACrBr2B,IAAlBlC,KAAKi7B,eAAsC/4B,IAAZ6nB,IAC/B/pB,KAAKi7B,SAAWlb,KAChB/f,KAAKi7B,SAASiB,UAAY,OAC1Bl8B,KAAKmO,KAAKrM,YAAY9B,KAAKi7B,UAC3Bj7B,KAAKm7B,iBAAmBpb,KACxB/f,KAAKm7B,iBAAiBe,UAAY,OAClCl8B,KAAKmO,KAAKrM,YAAY9B,KAAKm7B,mBAE/BsM,EAAclP,GAAOxO,CACxB,CACD,QAAsB7nB,IAAlBlC,KAAKi7B,SACL,IAAK,IAAI1C,EAAM,EAAGA,EAAMv4B,KAAK45B,QAAQ3B,WAAYM,EAAK,CAClD,MAAMiB,EAAOxZ,GAAKynB,EAAclP,IAChCiB,EAAK0C,UAAY,OACjBl8B,KAAK06B,QAAQ54B,YAAY03B,EAC5B,CAER,CACDsN,kBACI,IAAIjJ,EAAa,IAAI98B,MAAMf,KAAK45B,QAAQ1B,UACxC,IAAK,IAAIM,EAAM,EAAGA,EAAMx4B,KAAK45B,QAAQ1B,WAAYM,EAAK,CAClD,MAAMzO,EAAU/pB,KAAK45B,QAAQP,WAAWb,QAClBt2B,IAAlBlC,KAAKk7B,eAAsCh5B,IAAZ6nB,IAC/B/pB,KAAKk7B,SAAWnb,KAChB/f,KAAKk7B,SAASgB,UAAY,OAC1Bl8B,KAAKmO,KAAKrM,YAAY9B,KAAKk7B,UAC3Bl7B,KAAKo7B,iBAAmBrb,KACxB/f,KAAKo7B,iBAAiBc,UAAY,OAClCl8B,KAAKmO,KAAKrM,YAAY9B,KAAKo7B,mBAE/ByC,EAAWrF,GAAOzO,CACrB,CACD,GAAI/pB,KAAKk7B,SACL,IAAK,IAAI1C,EAAM,EAAGA,EAAMx4B,KAAK45B,QAAQ1B,WAAYM,EAAK,CAClD,MAAMgB,EAAOxZ,GAAK6d,EAAWrF,IAC7BgB,EAAK0C,UAAY,OACjBl8B,KAAK06B,QAAQ54B,YAAY03B,EAC5B,CAER,CACDuN,cACI,IAAK,IAAIvO,EAAM,EAAGA,EAAMx4B,KAAK45B,QAAQ1B,WAAYM,EAC7C,IAAK,IAAID,EAAM,EAAGA,EAAMv4B,KAAK45B,QAAQ3B,WAAYM,EAAK,CAClD,MAAMiB,EAAOx5B,KAAK+9B,aAClB/9B,KAAKs5B,SAAS,IAAIhB,GAASC,EAAKC,GAAMgB,GACtCx5B,KAAK06B,QAAQ54B,YAAY03B,EAC5B,CAER,CACDuE,aACI,MAAMvE,EAAOxZ,KAKb,OAJAwZ,EAAKkO,QAAU1nC,KAAK6kC,UACpBrL,EAAKnP,UAAYrqB,KAAK4kC,YACtBpL,EAAKpK,SAAW,EAChBoK,EAAKvR,aAAa,kBAAmB,IAC9BuR,CACV,CACD+B,YAAYvb,EAAM1N,EAAGC,EAAGwC,EAAGymB,GACvBxb,EAAK7c,MAAMkrB,KAAO,GAAG/b,MACrB0N,EAAK7c,MAAMmrB,IAAM,GAAG/b,MACpByN,EAAK7c,MAAMqmB,MAAWzU,EAAI/U,KAAK2+B,aAAZ,KACnB3e,EAAK7c,MAAMwC,OAAY61B,EAAIx7B,KAAK4+B,cAAZ,IACvB,CACDtF,SAASC,EAAKC,GACVx5B,KAAK45B,QAAQN,SAASC,EAAKC,GACE,IAAzBA,EAAKt4B,SAASE,SACdo4B,EAAKr2B,MAAMwkC,WAAa,eAE/B,CACDR,sBACI,IAAIlX,EAAMjwB,KAAKi7B,SAAWj7B,KAAK45B,QAAQ3B,SAAW,EAC9CqG,EAAe,EACnB,MAAM4I,EAAanmC,MAAMf,KAAK45B,QAAQ1B,UACtC,GAAIl4B,KAAKk7B,SACL,IAAK,IAAI1C,EAAM,EAAGA,EAAMx4B,KAAK45B,QAAQ1B,WAAYM,EAAK,CAClD,MACM4F,EADQp+B,KAAK06B,QAAQx5B,SAAS+uB,KACf9B,wBACrB+Y,EAAW1O,GAAOhvB,KAAKtE,IAAIk5B,EAAOz4B,OAAQ3F,KAAKw+B,eAC/CF,EAAe90B,KAAKtE,IAAIo5B,EAAcF,EAAO5U,MAChD,MAGD0d,EAAW9rB,KAAKpb,KAAKw+B,eAEzBvO,GAAOjwB,KAAKi7B,SAAWj7B,KAAK45B,QAAQ3B,SAAW,IAAMj4B,KAAKk7B,SAAWl7B,KAAK45B,QAAQ1B,SAAW,GAC7F,IAAK,IAAIM,EAAM,EAAGA,EAAMx4B,KAAK45B,QAAQ1B,WAAYM,EAAK,CAClD,IAAIoP,EAAKV,EAAW1O,GACpB,IAAK,IAAID,EAAM,EAAGA,EAAMv4B,KAAK45B,QAAQ3B,WAAYM,EAAK,CAClD,MACM6F,EADQp+B,KAAK06B,QAAQx5B,SAAS+uB,EAAMsI,EAAMC,EAAMx4B,KAAK45B,QAAQ3B,UAC9C9J,wBACrByZ,EAAKp+B,KAAKtE,IAAI0iC,EAAIxJ,EAAOz4B,OAC5B,CACDuhC,EAAW1O,GAAOhvB,KAAKi1B,KAAKmJ,EAC/B,CAED,OADAtJ,EAAe90B,KAAKi1B,KAAKH,GAClB,CAAE4I,aAAY5I,eACxB,CACD2I,sBAAsBY,GAAa,GAC/B,IAAInJ,EAAgB,EACpB,MAAMsI,EAAYjmC,MAAMf,KAAK45B,QAAQ3B,UACrC,GAAIj4B,KAAKi7B,SACL,IAAK,IAAI1C,EAAM,EAAGA,EAAMv4B,KAAK45B,QAAQ3B,WAAYM,EAAK,CAClD,MACM6F,EADQp+B,KAAK06B,QAAQx5B,SAASq3B,GACfpK,wBACrB6Y,EAAUzO,GAAO/uB,KAAKtE,IAAIk5B,EAAO5U,MAAOxpB,KAAKq+B,cAC7CK,EAAgBl1B,KAAKtE,IAAIw5B,EAAeN,EAAOz4B,OAClD,MAGDqhC,EAAU5rB,KAAKpb,KAAKq+B,cAGxB,IAAIyJ,EADJpJ,EAAgBl1B,KAAKi1B,KAAKC,GAGtBoJ,EADAD,EACW,GAGC7nC,KAAKi7B,SAAWj7B,KAAK45B,QAAQ3B,SAAW,IAAMj4B,KAAKk7B,SAAWl7B,KAAK45B,QAAQ1B,SAAW,GAEtG,IAAK,IAAIK,EAAM,EAAGA,EAAMv4B,KAAK45B,QAAQ3B,WAAYM,EAAK,CAClD,IAAIwP,EAAKf,EAAUzO,GACnB,IAAK,IAAIC,EAAM,EAAGA,EAAMx4B,KAAK45B,QAAQ1B,WAAYM,EAAK,CAClD,IAAI32B,EACAouB,EAAM6X,EAAWvP,EAAMC,EAAMx4B,KAAK45B,QAAQ3B,SAE1Cp2B,EADAgmC,EACQ7nC,KAAK+6B,KAAK75B,SAAS+uB,GAGnBjwB,KAAK06B,QAAQx5B,SAAS+uB,GAElC,MAAMmO,EAASv8B,EAAMssB,wBACrB4Z,EAAKv+B,KAAKtE,IAAI6iC,EAAI3J,EAAO5U,MAC5B,CACDwd,EAAUzO,GAAO/uB,KAAKi1B,KAAKsJ,EAC9B,CACD,MAAO,CAAEf,YAAWtI,gBACvB,CACD0I,iBAAiBJ,EAAWtI,EAAeJ,GACvC,QAAsBp8B,IAAlBlC,KAAKi7B,SACL,OAEJ,MAAM+M,EAAOhoC,KAAK45B,QAAQ3C,OAAO+B,SAAW,EAAI,EAChD,IAAI1mB,EAAI,EACR,IAAK,IAAIimB,EAAM,EAAGA,EAAMv4B,KAAK45B,QAAQ3B,WAAYM,EAAK,CAClD,MAAM12B,EAAQ7B,KAAK06B,QAAQx5B,SAAS,GACpClB,KAAKu7B,YAAY15B,EAAOyQ,EAAG,EAAG00B,EAAUzO,GAAMmG,GAC9C1+B,KAAKi7B,SAASn5B,YAAYD,GAC1ByQ,GAAK00B,EAAUzO,GAAO,EAAI,EAAIyP,CACjC,CACD,IAAIC,EAASjoB,KACbioB,EAAOtlC,UAAUC,IAAI,QACrBqlC,EAAOtlC,UAAUC,IAAI,QACrBqlC,EAAO9kC,MAAMkrB,KAAO,GAAG/b,MACvB21B,EAAO9kC,MAAMmrB,IAAM,IACnB2Z,EAAO9kC,MAAMqmB,MAAQ,QACrBye,EAAO9kC,MAAMwC,OAAS,GAAG+4B,MACzB1+B,KAAKi7B,SAASn5B,YAAYmmC,GAC1BjoC,KAAKm7B,iBAAiBh4B,MAAMkrB,KAAO,GAAGiQ,MACtCt+B,KAAKm7B,iBAAiBh4B,MAAMwC,OAAS,GAAG+4B,MACxCpsB,GAAKtS,KAAKwkC,YACV,IAAK,IAAIjM,EAAM,EAAGA,EAAMv4B,KAAK45B,QAAQ3B,WAAYM,EAAK,CAClDjmB,GAAK00B,EAAUzO,GAAO,EACtB,MAAM2P,EAASloC,KAAKmoC,aAAa5P,EAAKjmB,EAAG,EAAGtS,KAAKukC,YAAa7F,GAC9D1+B,KAAKm7B,iBAAiBr5B,YAAYomC,EACrC,CACD51B,GAAKtS,KAAKukC,YACV0D,EAASjoB,KACTioB,EAAOtlC,UAAUC,IAAI,QACrBqlC,EAAOtlC,UAAUC,IAAI,QACrBqlC,EAAO9kC,MAAMkrB,KAAO,GAAG/b,MACvB21B,EAAO9kC,MAAMmrB,IAAM,IACnB2Z,EAAO9kC,MAAMqmB,MAAQ,QACrBye,EAAO9kC,MAAMwC,OAAS,GAAG+4B,MACzB1+B,KAAKm7B,iBAAiBr5B,YAAYmmC,EACrC,CACDZ,cAAcH,EAAYxI,EAAeJ,GACrC,QAAsBp8B,IAAlBlC,KAAKk7B,SACL,OAEJ,MAAM8M,EAAOhoC,KAAK45B,QAAQ3C,OAAO+B,SAAW,EAAI,EAChD,IAAIzmB,EAAI,EACR,IAAK,IAAIimB,EAAM,EAAGA,EAAMx4B,KAAK45B,QAAQ1B,WAAYM,EAAK,CAClD,MAAM32B,EAAQ7B,KAAK06B,QAAQx5B,SAAS,GACpClB,KAAKu7B,YAAY15B,EAAO,EAAG0Q,EAAG+rB,EAAc4I,EAAW1O,IACvDx4B,KAAKk7B,SAASp5B,YAAYD,GAC1B0Q,GAAK20B,EAAW1O,GAAO,EAAI,EAAIwP,CAClC,CACD,IAAIC,EAASjoB,KACbioB,EAAOtlC,UAAUC,IAAI,QACrBqlC,EAAOtlC,UAAUC,IAAI,QACrBqlC,EAAO9kC,MAAMkrB,KAAO,IACpB4Z,EAAO9kC,MAAMmrB,IAAM,GAAG/b,MACtB01B,EAAO9kC,MAAMqmB,MAAQ,GAAG8U,MACxB2J,EAAO9kC,MAAMwC,OAAS,QACtB3F,KAAKk7B,SAASp5B,YAAYmmC,GAC1BjoC,KAAKo7B,iBAAiBj4B,MAAMmrB,IAAM,GAAGoQ,MACrC1+B,KAAKo7B,iBAAiBj4B,MAAMqmB,MAAQ,GAAG8U,MACvC/rB,GAAKvS,KAAKwkC,YACV,IAAK,IAAIhM,EAAM,EAAGA,EAAMx4B,KAAK45B,QAAQ1B,WAAYM,EAAK,CAClDjmB,GAAK20B,EAAW1O,GAAO,EACvB,MAAM4P,EAAYpoC,KAAKmoC,aAAa3P,EAAK,EAAGjmB,EAAG+rB,EAAct+B,KAAKukC,aAClEvkC,KAAKo7B,iBAAiBt5B,YAAYsmC,EACrC,CACD71B,GAAKvS,KAAKukC,YACV0D,EAASjoB,KACTioB,EAAOtlC,UAAUC,IAAI,QACrBqlC,EAAOtlC,UAAUC,IAAI,QACrBqlC,EAAO9kC,MAAMkrB,KAAO,IACpB4Z,EAAO9kC,MAAMmrB,IAAM,GAAG/b,OACtB01B,EAAO9kC,MAAMqmB,MAAQ,GAAG8U,MACxB2J,EAAO9kC,MAAMwC,OAAS,QACtB3F,KAAKo7B,iBAAiBt5B,YAAYmmC,EACrC,CACDX,UAAUhJ,EAAcI,GAmCpB,YAlCsBx8B,IAAlBlC,KAAKi7B,WACDj7B,KAAK45B,SAAS3C,OAAO+B,UACrBh5B,KAAKi7B,SAAS93B,MAAMwC,OAAY+4B,EAAgB,EAAnB,KAC7B1+B,KAAKi7B,SAAS93B,MAAMkrB,KAAUiQ,GAAiC,MAAjBt+B,KAAKk7B,SAAmB,EAAI,GAA/C,OAG3Bl7B,KAAKi7B,SAAS93B,MAAMwC,OAAS,GAAG+4B,MAChC1+B,KAAKi7B,SAAS93B,MAAMkrB,KAAUiQ,GAAiC,MAAjBt+B,KAAKk7B,SAAmB,EAAI,GAA/C,YAGbh5B,IAAlBlC,KAAKk7B,WACDl7B,KAAK45B,SAAS3C,OAAO+B,UACrBh5B,KAAKk7B,SAAS/3B,MAAMqmB,MAAW8U,EAAe,EAAlB,KAC5Bt+B,KAAKk7B,SAAS/3B,MAAMmrB,IAASoQ,GAAkC,MAAjB1+B,KAAKi7B,SAAmB,EAAI,GAAhD,OAG1Bj7B,KAAKk7B,SAAS/3B,MAAMqmB,MAAQ,GAAG8U,MAC/Bt+B,KAAKk7B,SAAS/3B,MAAMmrB,IAASoQ,GAAkC,MAAjB1+B,KAAKi7B,SAAmB,EAAI,GAAhD,SAGhCqD,IACAI,EACE1+B,KAAK45B,SAAS3C,OAAO+B,aACnBsF,IACAI,GAEFJ,EAAe,IACfA,EAAe,GAEfI,EAAgB,IAChBA,EAAgB,GAEpB1+B,KAAK+6B,KAAK53B,MAAMkrB,KAAO,GAAGiQ,MAC1Bt+B,KAAK+6B,KAAK53B,MAAMmrB,IAAM,GAAGoQ,MAClB,CAAEJ,eAAcI,gBAC1B,CACD6I,eAAeP,EAAWE,EAAYxI,EAAeJ,GACjD,MAAM0J,EAAOhoC,KAAK45B,QAAQ3C,OAAO+B,SAAW,EAAI,EAChD,IAAIzmB,EAAI,EACR,IAAK,IAAIimB,EAAM,EAAGA,EAAMx4B,KAAK45B,QAAQ1B,WAAYM,EAAK,CAClD,IAAIlmB,EAAI,EACR,IAAK,IAAIimB,EAAM,EAAGA,EAAMv4B,KAAK45B,QAAQ3B,WAAYM,EAAK,CAClD,MAAM12B,EAAQ7B,KAAK06B,QAAQx5B,SAAS,GACpClB,KAAKu7B,YAAY15B,EAAOyQ,EAAGC,EAAGy0B,EAAUzO,GAAM2O,EAAW1O,IACzDx4B,KAAK+6B,KAAKj5B,YAAYD,GACtByQ,GAAK00B,EAAUzO,GAAO,EAAIyP,CAC7B,CACDz1B,GAAK20B,EAAW1O,GAAO,EAAIwP,CAC9B,CACJ,CACDG,aAAalY,EAAK3d,EAAGC,EAAGwC,EAAGymB,GACvB,MAAM0M,EAASloB,KAUf,OATAkoB,EAAOhM,UAAY,SACnBgM,EAAO/kC,MAAMkrB,KAAO,GAAG/b,MACvB41B,EAAO/kC,MAAMmrB,IAAM,GAAG/b,MACtB21B,EAAO/kC,MAAMqmB,MAAQ,GAAGzU,MACxBmzB,EAAO/kC,MAAMwC,OAAS,GAAG61B,MACzB0M,EAAOhY,QAAa,IAAI,GAAGD,IAC3BiY,EAAO5Y,cAAgBtvB,KAAK+kC,WAC5BmD,EAAOxY,cAAgB1vB,KAAKglC,WAC5BkD,EAAOlY,YAAchwB,KAAKilC,SACnBiD,CACV,CACDnD,WAAW9V,GACPA,EAAGvH,iBACH1nB,KAAKkoC,OAASjZ,EAAG5f,OACjBrP,KAAKqoC,YAAc78B,SAASxL,KAAKkoC,OAAOhY,QAAa,KAAK,EAC1DlwB,KAAKkoC,OAAO1Y,kBAAkBP,EAAGQ,WAEjC,GADiBzvB,KAAKkoC,OAAOpW,gBAAkB9xB,KAAKm7B,iBACtC,CACVn7B,KAAKsoC,YAAcrZ,EAAGW,QAAUoQ,GAAOhgC,KAAKkoC,OAAO/kC,MAAMkrB,MACzDruB,KAAKuoC,eAAiBtZ,EAAGW,QACzB5vB,KAAKwoC,eAAiBvZ,EAAGW,QAAUsO,GAASl+B,KAAK+6B,KAAK53B,MAAMkrB,MAC5D,MAAMmL,EAAOx5B,KAAKi7B,SAAS/5B,SAASlB,KAAKqoC,YAAc,GACvDroC,KAAKyoC,YAAcxZ,EAAGW,QAAUsO,GAAS1E,EAAKr2B,MAAMqmB,OACpDxpB,KAAK6gC,cAAc7gC,KAAKqoC,YAC3B,KACI,CACDroC,KAAKsoC,YAAcrZ,EAAGY,QAAUqO,GAASl+B,KAAKkoC,OAAO/kC,MAAMmrB,KAC3DtuB,KAAKuoC,eAAiBtZ,EAAGY,QACzB7vB,KAAKwoC,eAAiBvZ,EAAGY,QAAUqO,GAASl+B,KAAK+6B,KAAK53B,MAAMmrB,KAC5D,MAAMkL,EAAOx5B,KAAKk7B,SAASh6B,SAASlB,KAAKqoC,YAAc,GACvDroC,KAAKyoC,YAAcxZ,EAAGY,QAAUqO,GAAS1E,EAAKr2B,MAAMwC,QACpD3F,KAAKq/B,gBAAgBr/B,KAAKqoC,YAC7B,CACJ,CACDrD,WAAW/V,GACP,QAAoB/sB,IAAhBlC,KAAKkoC,OACL,OAGJ,GADiBloC,KAAKkoC,OAAOpW,gBAAkB9xB,KAAKm7B,iBACtC,CACV,IAAIvL,EAAUX,EAAGW,QACjB,MAAM8Y,EAAS1oC,KAAKyoC,YAAc,EAC9B7Y,EAAU8Y,IACV9Y,EAAU8Y,GAEd1oC,KAAKkoC,OAAO/kC,MAAMkrB,KAAUuB,EAAU5vB,KAAKsoC,YAAlB,KACzBtoC,KAAK09B,UAAUv6B,MAAMkrB,KAAUuB,EAAU5vB,KAAKwoC,eAAlB,KAC5BxoC,KAAKg7B,UAAU73B,MAAMkrB,KAAUuB,EAAU5vB,KAAKuoC,eAAlB,KAC5B,MAAM/M,EAAIx7B,KAAKqoC,YACfroC,KAAKi7B,SAAS/5B,SAASs6B,EAAI,GAAGr4B,MAAMqmB,MAAWoG,EAAU5vB,KAAKyoC,YAAlB,KAC5C,IAAK,IAAIjQ,EAAM,EAAGA,EAAMx4B,KAAK45B,QAAQ1B,WAAYM,EAC7Cx4B,KAAK+6B,KAAK75B,SAASs6B,EAAI,EAAIhD,EAAMgD,GAAGr4B,MAAMqmB,MAAWoG,EAAU5vB,KAAKyoC,YAAlB,IAEzD,KACI,CACD,IAAI5Y,EAAUZ,EAAGY,QACjB,MAAM8Y,EAAS3oC,KAAKyoC,YAAc,EAC9B5Y,EAAU8Y,IACV9Y,EAAU8Y,GAEd3oC,KAAKkoC,OAAO/kC,MAAMmrB,IAASuB,EAAU7vB,KAAKsoC,YAAlB,KACxBtoC,KAAK09B,UAAUv6B,MAAMmrB,IAASuB,EAAU7vB,KAAKwoC,eAAlB,KAC3BxoC,KAAKg7B,UAAU73B,MAAMmrB,IAASuB,EAAU7vB,KAAKuoC,eAAlB,KAC3B,MAAM/M,EAAIx7B,KAAKqoC,YACfroC,KAAKk7B,SAASh6B,SAASs6B,EAAI,GAAGr4B,MAAMwC,OAAYkqB,EAAU7vB,KAAKyoC,YAAlB,KAC7C,IAAIxY,GAAOuL,EAAI,GAAKx7B,KAAK45B,QAAQ3B,SACjC,IAAK,IAAIM,EAAM,EAAGA,EAAMv4B,KAAK45B,QAAQ3B,WAAYM,EAC7Cv4B,KAAK+6B,KAAK75B,SAAS+uB,EAAMsI,GAAKp1B,MAAMwC,OAAYkqB,EAAU7vB,KAAKyoC,YAAlB,IAEpD,CACJ,CACDxD,SAAShW,GACL,QAAoB/sB,IAAhBlC,KAAKkoC,OACL,OAEJloC,KAAKglC,WAAW/V,GAEhB,GADiBjvB,KAAKkoC,OAAOpW,gBAAkB9xB,KAAKm7B,iBACtC,CACV,IAAIvL,EAAUX,EAAGW,QACjB,MAAM8Y,EAAS1oC,KAAKyoC,YAAc,EAC9B7Y,EAAU8Y,IACV9Y,EAAU8Y,GAEd1oC,KAAK0gC,aAAa1gC,KAAKqoC,YAAazY,EAAU5vB,KAAKuoC,eACtD,KACI,CACD,IAAI1Y,EAAUZ,EAAGY,QACjB,MAAM8Y,EAAS3oC,KAAKyoC,YAAc,EAC9B5Y,EAAU8Y,IACV9Y,EAAU8Y,GAEd3oC,KAAKg/B,eAAeh/B,KAAKqoC,YAAaxY,EAAU7vB,KAAKuoC,eACxD,CACDvoC,KAAKkoC,YAAShmC,CACjB,CACDi+B,iBAAiByI,GACb5oC,KAAK6oC,kBAAkBD,GACvB5oC,KAAK8oC,kBAAkBF,EAC1B,CACDC,kBAAkBD,GACd,QAAsB1mC,IAAlBlC,KAAKi7B,SACL,OAEJ,MAAMgD,EAAUj+B,KAAK45B,QAAQ3C,OAAO+B,SAAW,EAAI,EACnDh5B,KAAK09B,UAAY3d,KACjB/f,KAAK09B,UAAUxB,UAAY,oBAC3Bl8B,KAAK09B,UAAUv6B,MAAMmrB,IAAM,IAC3BtuB,KAAK09B,UAAUv6B,MAAM05B,OAAS,IAC9B78B,KAAK09B,UAAUv6B,MAAMs5B,gBAAkBC,GAAMqM,WAC7C,MAAM9Y,EAAM2Y,EACZ,GAAkC,IAA9B5oC,KAAK+6B,KAAK75B,SAASE,OACnBpB,KAAK09B,UAAUv6B,MAAMkrB,KAAO,MAC5BruB,KAAK09B,UAAUv6B,MAAMqmB,MAAQ,WAG7B,GAAIyG,EAAMjwB,KAAKi7B,SAAS/5B,SAASE,OAAQ,CACrC,IAAIo4B,EAAOx5B,KAAKi7B,SAAS/5B,SAAS+uB,GAC9BzG,EAAQ,EACZ,MAAM6E,EAAO6P,GAAS1E,EAAKr2B,MAAMkrB,MACjC,KAAO4B,EAAMjwB,KAAKi7B,SAAS/5B,SAASE,QAAQ,CACxCo4B,EAAOx5B,KAAKi7B,SAAS/5B,SAAS+uB,GAE9BzG,GADUgQ,EAAKrL,wBACJ3E,MAAQyU,EACnB,IAAI3rB,EAAI4rB,GAAS1E,EAAKr2B,MAAMkrB,MAC5BmL,EAAKr2B,MAAMkrB,KAAU/b,EAAI+b,EAAP,KAClBruB,KAAK09B,UAAU57B,YAAY03B,EAC9B,CACGx5B,KAAK45B,QAAQ3C,OAAO+B,WACpBxP,GAASyU,GAEbj+B,KAAK09B,UAAUv6B,MAAMkrB,KAAO,GAAGA,MAC/BruB,KAAK09B,UAAUv6B,MAAMqmB,MAAQ,GAAGA,KACnC,KACI,CACD,IAAIgQ,EAAOx5B,KAAKi7B,SAAS/5B,SAASlB,KAAK+6B,KAAK75B,SAASE,OAAS,GAC1D2Q,EAAIynB,EAAKrL,wBACTE,EAAO6P,GAAS1E,EAAKr2B,MAAMkrB,MAAQtc,EAAEyX,MAAQyU,EACjDj+B,KAAK09B,UAAUv6B,MAAMkrB,KAAO,GAAGA,MAC/BruB,KAAK09B,UAAUv6B,MAAMqmB,MAAQ,KAChC,CAELxpB,KAAKi7B,SAASn5B,YAAY9B,KAAK09B,UAClC,CACDoL,kBAAkBF,GACd,MAAM3K,EAAUj+B,KAAK45B,QAAQ3C,OAAO+B,SAAW,EAAI,EAMnD,GALAh5B,KAAKg7B,UAAYjb,KACjB/f,KAAKg7B,UAAUkB,UAAY,YAC3Bl8B,KAAKg7B,UAAU73B,MAAMmrB,IAAM,IAC3BtuB,KAAKg7B,UAAU73B,MAAM05B,OAAS,IAC9B78B,KAAKg7B,UAAU73B,MAAMs5B,gBAAkBC,GAAMqM,WACX,IAA9B/oC,KAAK+6B,KAAK75B,SAASE,OACnBpB,KAAKg7B,UAAU73B,MAAMkrB,KAAO,MAC5BruB,KAAKg7B,UAAU73B,MAAMqmB,MAAQ,UAE5B,CAED,GAAIof,EADqB5oC,KAAK+6B,KAAK75B,SAASE,OAASpB,KAAK45B,QAAQ1B,SACjC,CAC7B,IAAIsB,EAAOx5B,KAAK+6B,KAAK75B,SAAS0nC,GAC9B,MAAMva,EAAO6P,GAAS1E,EAAKr2B,MAAMkrB,MACjC,IAAI7E,EAAQ,EACZ,MACMwf,EADahpC,KAAK+6B,KAAK75B,SAASE,OAASpB,KAAK45B,QAAQ1B,SAC3B0Q,EACjC,IAAI3Y,EAAM2Y,EACV,IAAK,IAAIpQ,EAAM,EAAGA,EAAMx4B,KAAK45B,QAAQ1B,WAAYM,EAAK,CAClD,IAAK,IAAID,EAAM,EAAGA,EAAMyQ,IAAezQ,EAAK,CAExC,GADAiB,EAAOx5B,KAAK+6B,KAAK75B,SAAS+uB,GACd,IAARuI,EAAW,CAEXhP,GADUgQ,EAAKrL,wBACJ3E,MAAQyU,CACtB,CACDzE,EAAKr2B,MAAMkrB,KAAU6P,GAAS1E,EAAKr2B,MAAMkrB,MAAQA,EAA/B,KAClBruB,KAAKg7B,UAAUl5B,YAAY03B,EAC9B,CACDvJ,GAAO2Y,CACV,CACD5oC,KAAKg7B,UAAU73B,MAAMkrB,KAAO,GAAGA,MAC/BruB,KAAKg7B,UAAU73B,MAAMqmB,MAAQ,GAAGA,KACnC,KACI,CACD,IAAIgQ,EAAOx5B,KAAK+6B,KAAK75B,SAASlB,KAAK+6B,KAAK75B,SAASE,OAAS,GACtD6nC,EAAWzP,EAAKrL,wBAChBE,EAAO6P,GAAS1E,EAAKr2B,MAAMkrB,MAAQ4a,EAASzf,MAAQyU,EACxDj+B,KAAKg7B,UAAU73B,MAAMkrB,KAAO,GAAGA,MAC/BruB,KAAKg7B,UAAU73B,MAAMqmB,MAAQ,KAChC,CACJ,CACDxpB,KAAK+6B,KAAKj5B,YAAY9B,KAAKg7B,UAC9B,CACD6F,cAAcqI,EAAaC,EAAQ,QACTjnC,IAAlBlC,KAAKi7B,WACLj7B,KAAK09B,UAAY3d,KACjB/f,KAAK09B,UAAUxB,UAAY,OAC3Bl8B,KAAK09B,UAAUv6B,MAAMkrB,KAAOruB,KAAKi7B,SAAS93B,MAAMkrB,KAChDruB,KAAK09B,UAAUv6B,MAAMwC,OAAS3F,KAAKi7B,SAAS93B,MAAMwC,OAClD3F,KAAKmO,KAAKrM,YAAY9B,KAAK09B,WAC3BnS,YAAW,KACPvrB,KAAK09B,UAAUsE,UAAYhiC,KAAKi7B,SAAS+G,UACzChiC,KAAK09B,UAAUmE,WAAa7hC,KAAKi7B,SAAS4G,UAAU,GACrD,IAEP7hC,KAAKg7B,UAAYjb,KACjB/f,KAAKg7B,UAAUkB,UAAY,YAC3B,MAAMnqB,EAAI/R,KAAK+6B,KAAK5M,wBACpBnuB,KAAKg7B,UAAU73B,MAAMqmB,MAAQ,GAAGzX,EAAEyX,UAClCxpB,KAAKg7B,UAAU73B,MAAMwC,OAAS,GAAGoM,EAAEpM,WACnC3F,KAAK+6B,KAAKj5B,YAAY9B,KAAKg7B,WAC3B,MAAMoF,EAAY8I,EACZE,EAAmBppC,KAAK45B,QAAQ3B,SAAWiR,EAAcC,EAC/D,QAAuBjnC,IAAnBlC,KAAK09B,UAAyB,CAC9B,IAAK,IAAIv8B,EAAI,EAAGA,EAAIioC,IAAoBjoC,EACpCnB,KAAK09B,UAAU57B,YAAY9B,KAAKi7B,SAAS/5B,SAASgoC,IAEtDlpC,KAAK09B,UAAU57B,YAAY9B,KAAKi7B,SAAS/5B,SAASlB,KAAKi7B,SAAS/5B,SAASE,OAAS,GAAGioC,YACxF,CACD,IAAIpZ,EAAMiZ,EACV,IAAK,IAAI1Q,EAAM,EAAGA,EAAMx4B,KAAK45B,QAAQ1B,WAAYM,EAAK,CAClD,IAAK,IAAID,EAAM,EAAGA,EAAM6Q,IAAoB7Q,EACxCv4B,KAAKg7B,UAAUl5B,YAAY9B,KAAK+6B,KAAK75B,SAAS+uB,IAElDA,GAAOmQ,CACV,CACJ,CACDM,aAAakI,EAAUU,EAAOH,EAAQ,EAAGlR,EAAUC,QAC9Bh2B,IAAb+1B,IACAA,EAAWj4B,KAAK45B,QAAQ3B,eAEX/1B,IAAbg2B,IACAA,EAAWl4B,KAAK45B,QAAQ1B,UAE5B,MAAMkR,EAAmBnR,EAAW2Q,EAAWO,EAC/C,IAAIlZ,EAAM2Y,EAAWO,EACrB,QAAsBjnC,IAAlBlC,KAAKi7B,SAAwB,CAC7B,MAAMgN,EAASjoC,KAAKi7B,SAAS/5B,SAASlB,KAAKi7B,SAAS/5B,SAASE,OAAS,GACtE,IAAK,IAAIm3B,EAAM,EAAGA,EAAM6Q,IAAoB7Q,EAAK,CAC7C,MAAMiB,EAAOx5B,KAAK09B,UAAUx8B,SAAS,GAC/BmtB,EAAO6P,GAAS1E,EAAKr2B,MAAMkrB,MACjCmL,EAAKr2B,MAAMkrB,KAAO,GAAGA,EAAOib,MAC5BtpC,KAAKi7B,SAASzE,aAAagD,EAAMyO,EACpC,CACD,MACM5Z,EAAO6P,GADM+J,EAAO9kC,MAAMkrB,MAEhC4Z,EAAO9kC,MAAMkrB,KAAO,GAAGA,EAAOib,MAC9B,IAAK,IAAI/Q,EAAMtI,EAAKsI,GAAON,IAAYM,EAAK,CACxC,MAAMiB,EAAOx5B,KAAKm7B,iBAAiBj6B,SAASq3B,GACtClK,EAAO6P,GAAS1E,EAAKr2B,MAAMkrB,MACjCmL,EAAKr2B,MAAMkrB,KAAO,GAAGA,EAAOib,KAC/B,CACJ,CACD,IAAK,IAAI9Q,EAAM,EAAGA,EAAMN,IAAYM,EAAK,CACrC,IAAIgI,EAAcxgC,KAAK+6B,KAAK75B,SAAS+uB,GACrC,IAAK,IAAIsI,EAAM,EAAGA,EAAM6Q,IAAoB7Q,EAAK,CAC7C,MAAMiB,EAAOx5B,KAAKg7B,UAAU95B,SAAS,GAC/BmtB,EAAO6P,GAAS1E,EAAKr2B,MAAMkrB,MACjCmL,EAAKr2B,MAAMkrB,KAAO,GAAGA,EAAOib,MAC5BtpC,KAAK+6B,KAAKvE,aAAagD,EAAMgH,EAChC,CACDvQ,GAAOgI,CACV,MACqB/1B,IAAlBlC,KAAKi7B,WACLj7B,KAAKmO,KAAKxM,YAAY3B,KAAK09B,WAC3B19B,KAAK09B,eAAYx7B,GAErBlC,KAAK+6B,KAAKp5B,YAAY3B,KAAKg7B,WAC3Bh7B,KAAKg7B,eAAY94B,CACpB,CACD28B,mBAAmB0K,GACfvpC,KAAKwpC,oBAAoBD,GACzBvpC,KAAKypC,oBAAoBF,EAC5B,CACDC,oBAAoBD,GAChB,QAAsBrnC,IAAlBlC,KAAKk7B,SACL,OAEJ,MAAM+C,EAAUj+B,KAAK45B,QAAQ3C,OAAO+B,SAAW,EAAI,EACnDh5B,KAAK09B,UAAY3d,KACjB/f,KAAK09B,UAAUxB,UAAY,YAC3Bl8B,KAAK09B,UAAUv6B,MAAMkrB,KAAO,IAC5BruB,KAAK09B,UAAUv6B,MAAMy0B,MAAQ,IAC7B53B,KAAK09B,UAAUv6B,MAAMs5B,gBAAkBC,GAAMqM,WAC7C,MAAM9Y,EAAMsZ,EACZ,GAAkC,IAA9BvpC,KAAK+6B,KAAK75B,SAASE,OACnBpB,KAAK09B,UAAUv6B,MAAMmrB,IAAM,MAC3BtuB,KAAK09B,UAAUv6B,MAAMwC,OAAS,WAG9B,GAAIsqB,EAAMjwB,KAAKk7B,SAASh6B,SAASE,OAAQ,CACrC,IAAIo4B,EAAOx5B,KAAKk7B,SAASh6B,SAAS+uB,GAC9BtqB,EAAS,EACb,MAAM2oB,EAAM4P,GAAS1E,EAAKr2B,MAAMmrB,KAChC,KAAO2B,EAAMjwB,KAAKk7B,SAASh6B,SAASE,QAAQ,CACxCo4B,EAAOx5B,KAAKk7B,SAASh6B,SAAS+uB,GAE9BtqB,GADU6zB,EAAKrL,wBACHxoB,OAASs4B,EACrB,IAAI1rB,EAAI2rB,GAAS1E,EAAKr2B,MAAMmrB,KAC5BkL,EAAKr2B,MAAMmrB,IAAS/b,EAAI+b,EAAP,KACjBtuB,KAAK09B,UAAU57B,YAAY03B,EAC9B,CACGx5B,KAAK45B,QAAQ3C,OAAO+B,WACpBrzB,GAAUs4B,GAEdj+B,KAAK09B,UAAUv6B,MAAMmrB,IAAM,GAAGA,MAC9BtuB,KAAK09B,UAAUv6B,MAAMwC,OAAS,GAAGA,KACpC,KACI,CACD,IAAI6zB,EAAOx5B,KAAKk7B,SAASh6B,SAASlB,KAAK+6B,KAAK75B,SAASE,OAAS,GAC1D2Q,EAAIynB,EAAKrL,wBACTG,EAAM4P,GAAS1E,EAAKr2B,MAAMmrB,KAAOvc,EAAEpM,OAASs4B,EAChDj+B,KAAK09B,UAAUv6B,MAAMmrB,IAAM,GAAGA,MAC9BtuB,KAAK09B,UAAUv6B,MAAMwC,OAAS,KACjC,CAEL3F,KAAKk7B,SAASp5B,YAAY9B,KAAK09B,UAClC,CACD+L,oBAAoBF,GAChB,MAAMtL,EAAUj+B,KAAK45B,QAAQ3C,OAAO+B,SAAW,EAAI,EACnDh5B,KAAKg7B,UAAYjb,KACjB/f,KAAKg7B,UAAUkB,UAAY,YAC3Bl8B,KAAKg7B,UAAU73B,MAAMkrB,KAAO,IAC5BruB,KAAKg7B,UAAU73B,MAAMy0B,MAAQ,IAC7B53B,KAAKg7B,UAAU73B,MAAMs5B,gBAAkBC,GAAMqM,WAC7C,MAAM9Y,EAAMsZ,EAAWvpC,KAAK45B,QAAQ3B,SACpC,GAAkC,IAA9Bj4B,KAAK+6B,KAAK75B,SAASE,OACnBpB,KAAKg7B,UAAU73B,MAAMmrB,IAAM,MAC3BtuB,KAAKg7B,UAAU73B,MAAMwC,OAAS,WAG9B,GAAIsqB,EAAMjwB,KAAK+6B,KAAK75B,SAASE,OAAQ,CACjC,IAAIo4B,EAAOx5B,KAAK+6B,KAAK75B,SAAS+uB,GAC1BsI,EAAMv4B,KAAK45B,QAAQ3B,SACnBtyB,EAAS,EACb,MAAM2oB,EAAM4P,GAAS1E,EAAKr2B,MAAMmrB,KAChC,KAAO2B,EAAMjwB,KAAK+6B,KAAK75B,SAASE,QAAQ,CAGpC,GAFAo4B,EAAOx5B,KAAK+6B,KAAK75B,SAAS+uB,KACxBsI,EACU,IAARA,EAAW,CAEX5yB,GADU6zB,EAAKrL,wBACHxoB,OAASs4B,EACrB1F,EAAMv4B,KAAK45B,QAAQ3B,QACtB,CACD,IAAI1lB,EAAI2rB,GAAS1E,EAAKr2B,MAAMmrB,KAC5BkL,EAAKr2B,MAAMmrB,IAAS/b,EAAI+b,EAAP,KACjBtuB,KAAKg7B,UAAUl5B,YAAY03B,EAC9B,CACD7zB,GAAUs4B,EACVj+B,KAAKg7B,UAAU73B,MAAMmrB,IAAM,GAAGA,MAC9BtuB,KAAKg7B,UAAU73B,MAAMwC,OAAS,GAAGA,KACpC,KACI,CACD,IAAI+jC,EAAe1pC,KAAK+6B,KAAK75B,SAASlB,KAAK+6B,KAAK75B,SAASE,OAAS,GAC9D2Q,EAAI23B,EAAavb,wBACjBG,EAAM4P,GAASwL,EAAavmC,MAAMmrB,KAAOvc,EAAEpM,OAASs4B,EACxDj+B,KAAKg7B,UAAU73B,MAAMmrB,IAAM,GAAGA,MAC9BtuB,KAAKg7B,UAAU73B,MAAMwC,OAAS,KACjC,CAEL3F,KAAK+6B,KAAKj5B,YAAY9B,KAAKg7B,UAC9B,CACDqE,gBAAgBkK,EAAUJ,EAAQ,EAAGlf,QACX/nB,IAAlBlC,KAAKk7B,WACLl7B,KAAK09B,UAAY3d,KACjB/f,KAAK09B,UAAUxB,UAAY,OAC3Bl8B,KAAK09B,UAAUv6B,MAAMmrB,IAAMtuB,KAAKk7B,SAAS/3B,MAAMmrB,IAC/CtuB,KAAK09B,UAAUv6B,MAAMqmB,MAAQxpB,KAAKk7B,SAAS/3B,MAAMqmB,MACjDxpB,KAAKmO,KAAKrM,YAAY9B,KAAK09B,WAC3BnS,YAAW,KACPvrB,KAAK09B,UAAUsE,UAAYhiC,KAAKk7B,SAAS8G,UACzChiC,KAAK09B,UAAUmE,WAAa7hC,KAAKk7B,SAAS2G,UAAU,GACrD,IAEP7hC,KAAKg7B,UAAYjb,KACjB/f,KAAKg7B,UAAUkB,UAAY,YAC3Bl8B,KAAKg7B,UAAU73B,MAAMs5B,gBAAkB,sBACvC,MAAM1qB,EAAI/R,KAAK+6B,KAAK5M,wBACpBnuB,KAAKg7B,UAAU73B,MAAMqmB,MAAQ,GAAGzX,EAAEyX,UAClCxpB,KAAKg7B,UAAU73B,MAAMwC,OAAS,GAAGoM,EAAEpM,WACnC3F,KAAK+6B,KAAKj5B,YAAY9B,KAAKg7B,WAC3B,MAAM2O,EAAgB3pC,KAAK45B,QAAQ1B,SAAWqR,EAAWJ,EACzD,QAAuBjnC,IAAnBlC,KAAK09B,UAAyB,CAC9B,IAAK,IAAIv8B,EAAI,EAAGA,EAAIwoC,IAAiBxoC,EACjCnB,KAAK09B,UAAU57B,YAAY9B,KAAKk7B,SAASh6B,SAASqoC,IAEtDvpC,KAAK09B,UAAU57B,YAAY9B,KAAKk7B,SAASh6B,SAASlB,KAAKk7B,SAASh6B,SAASE,OAAS,GAAGioC,YACxF,CACD,IAAIpZ,EAAMjwB,KAAK45B,QAAQ3B,SAAWsR,EAClC,IAAK,IAAI/Q,EAAM,EAAGA,EAAMmR,IAAiBnR,EACrC,IAAK,IAAID,EAAM,EAAGA,EAAMv4B,KAAK45B,QAAQ3B,WAAYM,EAC7Cv4B,KAAKg7B,UAAUl5B,YAAY9B,KAAK+6B,KAAK75B,SAAS+uB,IAGtD,GAAIjwB,KAAKg7B,UAAU95B,SAASE,OAAS,EAAG,CACpC6uB,EAAMjwB,KAAKg7B,UAAU95B,SAASE,OAAS,EACvC,MACMktB,EAAM0R,GADChgC,KAAKg7B,UAAU95B,SAAS+uB,GACb9sB,MAAMmrB,KAC9B,IAAK,IAAIntB,EAAI,EAAGA,EAAInB,KAAKg7B,UAAU95B,SAASE,SAAUD,EAAG,CACrD,MAAMyR,EAAI5S,KAAKg7B,UAAU95B,SAASC,GAC5BoR,EAAIytB,GAAOptB,EAAEzP,MAAMmrB,KACzB1b,EAAEzP,MAAMmrB,IAAS/b,EAAI+b,EAAP,IACjB,CACDtuB,KAAKg7B,UAAU73B,MAAMs5B,gBAAkB,OACvCz8B,KAAKg7B,UAAU73B,MAAMmrB,IAAM,GAAGA,MAC9BtuB,KAAKg7B,UAAU73B,MAAMwC,OAAYoM,EAAEpM,OAAS2oB,EAAd,IACjC,MACI,QAAcpsB,IAAV+nB,GAAuBjqB,KAAK+6B,KAAK75B,SAASE,OAAS,EAAG,CAC3D6uB,EAAMhG,EAAMhgB,MAAQjK,KAAK45B,QAAQ3B,SACjC,MACM3J,EAAM0R,GADChgC,KAAK+6B,KAAK75B,SAAS+uB,GACR9sB,MAAMmrB,KAC9BtuB,KAAKg7B,UAAU73B,MAAMmrB,IAAM,GAAGA,MAC9BtuB,KAAKg7B,UAAU73B,MAAMwC,OAAYoM,EAAEpM,OAAS2oB,EAAd,IACjC,MACI,GAAItuB,KAAK+6B,KAAK75B,SAASE,OAAS,EAAG,CACpC,MAAM6mC,EAASjoB,KACfiQ,EAAMjwB,KAAK+6B,KAAK75B,SAASE,OAAS,EAClC,MAAMwoC,EAAO5pC,KAAK+6B,KAAK75B,SAAS+uB,GAC1B4Z,EAAK7pC,KAAK+6B,KAAK75B,SAAS+uB,GAAK9B,wBACnC8Z,EAAO9kC,MAAMq5B,OAAS,OACtByL,EAAO9kC,MAAMs5B,gBAAkB,UAC/B,MAAMnO,EAAM0R,GAAO4J,EAAKzmC,MAAMmrB,KAAOub,EAAGlkC,OACxCsiC,EAAO9kC,MAAMmrB,IAAM,GAAGA,MACtB2Z,EAAO9kC,MAAMkrB,KAAO,MACpB4Z,EAAO9kC,MAAMqmB,MAAWzX,EAAEyX,MAAQ,EAAb,KACrBye,EAAO9kC,MAAMwC,OAAYoM,EAAEpM,OAAS2oB,EAAd,KACtBtuB,KAAKg7B,UAAUl5B,YAAYmmC,EAC9B,CAGJ,CACDjJ,eAAeuK,EAAUD,EAAOH,EAAQ,EAAGlR,EAAUC,QAChCh2B,IAAb+1B,IACAA,EAAWj4B,KAAK45B,QAAQ3B,eAEX/1B,IAAbg2B,IACAA,EAAWl4B,KAAK45B,QAAQ1B,UAE5B,MAAMyR,EAAgBzR,EAAWqR,EAAWJ,EAC5C,QAAsBjnC,IAAlBlC,KAAKk7B,SAAwB,CAC7B,MAAM+M,EAASjoC,KAAKk7B,SAASh6B,SAASlB,KAAKk7B,SAASh6B,SAASE,OAAS,GACtE,IAAK,IAAIo3B,EAAM,EAAGA,EAAMmR,IAAiBnR,EAAK,CAC1C,MAAMgB,EAAOx5B,KAAK09B,UAAUx8B,SAAS,GAC/BotB,EAAM4P,GAAS1E,EAAKr2B,MAAMmrB,KAChCkL,EAAKr2B,MAAMmrB,IAAM,GAAGA,EAAMgb,MAC1BtpC,KAAKk7B,SAAS1E,aAAagD,EAAMyO,EACpC,CACD,MACM3Z,EAAM4P,GADM+J,EAAO9kC,MAAMmrB,KAE/B2Z,EAAO9kC,MAAMmrB,IAAM,GAAGA,EAAMgb,MAE5B,IAAK,IAAI9Q,EADC+Q,EACU/Q,GAAON,IAAYM,EAAK,CACxC,MAAMgB,EAAOx5B,KAAKo7B,iBAAiBl6B,SAASs3B,GACtClK,EAAM4P,GAAS1E,EAAKr2B,MAAMmrB,KAChCkL,EAAKr2B,MAAMmrB,IAAM,GAAGA,EAAMgb,KAC7B,CACJ,CACD,IAAK,IAAI9Q,EAAM,EAAGA,EAAMmR,IAAiBnR,EACrC,IAAK,IAAID,EAAM,EAAGA,EAAMN,IAAYM,EAAK,CACrC,MAAMiB,EAAOx5B,KAAKg7B,UAAU95B,SAAS,GAC/BotB,EAAM4P,GAAS1E,EAAKr2B,MAAMmrB,KAChCkL,EAAKr2B,MAAMmrB,IAAM,GAAGA,EAAMgb,MAC1BtpC,KAAK+6B,KAAKj5B,YAAY03B,EACzB,MAEiBt3B,IAAlBlC,KAAKk7B,WACLl7B,KAAKmO,KAAKxM,YAAY3B,KAAK09B,WAC3B19B,KAAK09B,eAAYx7B,GAErBlC,KAAK+6B,KAAKp5B,YAAY3B,KAAKg7B,WAC3Bh7B,KAAKg7B,eAAY94B,CACpB,CACDgjC,sCACI,MAAM9G,EAASp+B,KAAK+6B,KAAK5M,wBACzB,QAAsBjsB,IAAlBlC,KAAKi7B,SAAwB,CAC7B,MAAMlmB,EAAIvL,KAAKi1B,KAAKL,EAAO5U,MAAQxpB,KAAK+6B,KAAK/F,aAC7Ch1B,KAAKi7B,SAAS/5B,SAASlB,KAAKi7B,SAAS/5B,SAASE,OAAS,GAAG+B,MAAMqmB,MAAQ,GAAGzU,MAC3E/U,KAAKi7B,SAAS93B,MAAMy0B,MAAQ,GAAG7iB,KAClC,CACD,QAAsB7S,IAAlBlC,KAAKk7B,SAAwB,CAC7B,MAAMM,EAAIhyB,KAAKi1B,KAAKL,EAAOz4B,OAAS3F,KAAK+6B,KAAKjG,cAC9C90B,KAAKk7B,SAASh6B,SAASlB,KAAKk7B,SAASh6B,SAASE,OAAS,GAAG+B,MAAMwC,OAAS,GAAG61B,MAC5Ex7B,KAAKk7B,SAAS/3B,MAAM05B,OAAS,GAAGrB,KACnC,CACJ,CACD0K,oBAAoB5zB,EAAGC,GACnB,IAAIgmB,EAAKC,EACT,IAAKD,EAAM,EAAGA,EAAMv4B,KAAK45B,QAAQ3B,WAAYM,EAAK,CAC9C,MAAMxmB,EAAI/R,KAAK+6B,KAAK75B,SAASq3B,GAAKpK,wBAClC,GAAIpc,EAAEO,GAAKA,GAAKA,EAAIP,EAAEO,EAAIP,EAAEyX,MACxB,KACP,CACD,GAAI+O,GAAOv4B,KAAK45B,QAAQ3B,SACpB,OAEJ,IAAIhI,EAAM,EACV,IAAKuI,EAAM,EAAGA,EAAMx4B,KAAK45B,QAAQ1B,WAAYM,EAAK,CAC9C,MAAMzmB,EAAI/R,KAAK+6B,KAAK75B,SAAS+uB,GAAK9B,wBAClC,GAAIpc,EAAEQ,GAAKA,GAAKA,EAAIR,EAAEQ,EAAIR,EAAEpM,OACxB,MACJsqB,GAAOjwB,KAAK45B,QAAQ3B,QACvB,CACD,OAAIO,GAAOx4B,KAAK45B,QAAQ1B,cAAxB,EAGO,IAAII,GAASC,EAAKC,EAC5B,EAELkE,GAAMC,UAAY,UAClBD,GAAMqM,WAAa,UACnBrM,GAAMiJ,UAAY,IAAI3oB,IACtB0f,GAAM1W,OAAO,WAAY0W,IC9jCzB,SAASoN,GAAmB1nB,GACxB,YAAiBlgB,IAAVkgB,GAAuB,cAAeA,GAAS,cAAeA,CACzE,CACA,SAAS2nB,GAAsB3nB,GAC3B,YAAiBlgB,IAAVkgB,GAAuB,iBAAkBA,GAAS,iBAAkBA,CAC/E,CANAyD,GAAKG,OAAO,eA9FL,cAAwB4L,GAC3B/xB,cACIoB,QACAjB,KAAKsoB,QAAUC,EAAK,MAAO,CAAEC,MAAO,YACpCxoB,KAAKgqC,kBAAoBzhB,EAAK,SAAU,CAAEC,MAAO,OAAQrH,MAAO,gBAAiBjgB,SAAUooB,EAAM,MAAO,CAAEnmB,MAAO,CAAEyrB,QAAS,SAAWrF,QAAS,YAAaC,MAAO,KAAM7jB,OAAQ,KAAMzE,SAAU,CAACqnB,EAAK,OAAQ,CAAEjW,EAAG,MAAOC,EAAG,MAAOiX,MAAO,KAAM7jB,OAAQ,KAAM6iB,MAAO,eAAiBD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,MAAOC,GAAI,OAAQC,GAAI,MAAO6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,MAAOC,GAAI,MAAOC,GAAI,OAAQ6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,MAAOC,GAAI,MAAOC,GAAI,OAAQ6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,IAAKC,GAAI,MAAOC,GAAI,IAAK6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,IAAKC,GAAI,MAAOC,GAAI,IAAKC,GAAI,MAAO6H,MAAO,gBAClpBxoB,KAAKgqC,kBAAkBthB,QAAU,KAC7B1oB,KAAKiqC,iBAAiBtiB,QACtB,MAAMvF,EAAQpiB,KAAKiqC,iBAAiB7nB,MAC9BkZ,EAAYt7B,KAAKiqC,iBAAiB3O,UACpCA,GAAawO,GAAmB1nB,IAChCA,EAAM8nB,UAAU5O,EAAU9C,IAC7B,EAELx4B,KAAKsoB,QAAQxmB,YAAY9B,KAAKgqC,mBAC9BhqC,KAAKmqC,kBAAoB5hB,EAAK,SAAU,CAAEpH,MAAO,gBAAiBjgB,SAAUooB,EAAM,MAAO,CAAEC,QAAS,YAAaC,MAAO,KAAM7jB,OAAQ,KAAMzE,SAAU,CAACqnB,EAAK,OAAQ,CAAEjW,EAAG,MAAOC,EAAG,MAAOiX,MAAO,KAAM7jB,OAAQ,KAAM6iB,MAAO,eAAiBD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,MAAOC,GAAI,OAAQC,GAAI,MAAO6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,MAAOC,GAAI,MAAOC,GAAI,MAAO6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,MAAOC,GAAI,MAAOC,GAAI,MAAO6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,IAAKC,GAAI,MAAOC,GAAI,KAAM6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,IAAKC,GAAI,MAAOC,GAAI,IAAKC,GAAI,MAAO6H,MAAO,gBACrmBxoB,KAAKmqC,kBAAkBzhB,QAAU,KAC7B1oB,KAAKiqC,iBAAiBtiB,QACtB,MAAMvF,EAAQpiB,KAAKiqC,iBAAiB7nB,MAC9BkZ,EAAYt7B,KAAKiqC,iBAAiB3O,UACpCA,GAAawO,GAAmB1nB,IAChCA,EAAM8nB,UAAU5O,EAAU9C,IAAM,EACnC,EAELx4B,KAAKsoB,QAAQxmB,YAAY9B,KAAKmqC,mBAC9BnqC,KAAKoqC,gBAAkB7hB,EAAK,SAAU,CAAEC,MAAO,QAASrH,MAAO,aAAcjgB,SAAUooB,EAAM,MAAO,CAAEC,QAAS,YAAaC,MAAO,KAAM7jB,OAAQ,KAAMzE,SAAU,CAACqnB,EAAK,OAAQ,CAAEjW,EAAG,MAAOC,EAAG,MAAOiX,MAAO,KAAM7jB,OAAQ,KAAM6iB,MAAO,eAAiBD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,MAAOC,GAAI,OAAQC,GAAI,MAAO6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,MAAOC,GAAI,OAAQC,GAAI,MAAO6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,MAAOC,GAAI,OAAQC,GAAI,MAAO6H,MAAO,SAAU,eAAgB,QAAUD,EAAK,OAAQ,CAAE/H,GAAI,OAAQC,GAAI,MAAOC,GAAI,MAAOC,GAAI,MAAO6H,MAAO,SAAU,eAAgB,aAC5lBxoB,KAAKoqC,gBAAgB1hB,QAAU,KAC3B1oB,KAAKiqC,iBAAiBtiB,QACtB,MAAMvF,EAAQpiB,KAAKiqC,iBAAiB7nB,MAC9BkZ,EAAYt7B,KAAKiqC,iBAAiB3O,UACpCA,GAAawO,GAAmB1nB,IAChCA,EAAMioB,UAAU/O,EAAU9C,IAAK,EAClC,EAELx4B,KAAKsoB,QAAQxmB,YAAY9B,KAAKoqC,iBAC9BpqC,KAAKsoB,QAAQxmB,YAAYR,SAASC,eAAe,MACjDvB,KAAKsqC,oBAAsB/hB,EAAK,SAAU,CAAEC,MAAO,OAAQrH,MAAO,kBAAmBjgB,SAAUooB,EAAM,MAAO,CAAEC,QAAS,YAAaC,MAAO,KAAM7jB,OAAQ,KAAMzE,SAAU,CAACqnB,EAAK,OAAQ,CAAEjW,EAAG,MAAOC,EAAG,MAAOiX,MAAO,KAAM7jB,OAAQ,KAAM6iB,MAAO,eAAiBD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,MAAOC,GAAI,MAAOC,GAAI,OAAQ6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,MAAOC,GAAI,OAAQC,GAAI,MAAO6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,MAAOC,GAAI,OAAQC,GAAI,MAAO6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,IAAKC,GAAI,MAAOC,GAAI,IAAKC,GAAI,MAAO6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,IAAKC,GAAI,MAAOC,GAAI,IAAK6H,MAAO,gBACznBxoB,KAAKsqC,oBAAoB5hB,QAAU,KAC/B1oB,KAAKiqC,iBAAiBtiB,QACtB,MAAMvF,EAAQpiB,KAAKiqC,iBAAiB7nB,MAC9BkZ,EAAYt7B,KAAKiqC,iBAAiB3O,UACpCA,GAAayO,GAAsB3nB,IACnCA,EAAMmoB,aAAajP,EAAU/C,IAChC,EAELv4B,KAAKsoB,QAAQxmB,YAAY9B,KAAKsqC,qBAC9BtqC,KAAKwqC,qBAAuBjiB,EAAK,SAAU,CAAEpH,MAAO,mBAAoBjgB,SAAUooB,EAAM,MAAO,CAAEC,QAAS,YAAaC,MAAO,KAAM7jB,OAAQ,KAAMzE,SAAU,CAACqnB,EAAK,OAAQ,CAAEjW,EAAG,MAAOC,EAAG,MAAOiX,MAAO,KAAM7jB,OAAQ,KAAM6iB,MAAO,eAAiBD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,MAAOC,GAAI,MAAOC,GAAI,OAAQ6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,MAAOC,GAAI,MAAOC,GAAI,MAAO6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,MAAOC,GAAI,MAAOC,GAAI,MAAO6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,IAAKC,GAAI,MAAOC,GAAI,KAAMC,GAAI,MAAO6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,IAAKC,GAAI,MAAOC,GAAI,IAAK6H,MAAO,gBAC3mBxoB,KAAKwqC,qBAAqB9hB,QAAU,KAChC1oB,KAAKiqC,iBAAiBtiB,QACtB,MAAMvF,EAAQpiB,KAAKiqC,iBAAiB7nB,MAC9BkZ,EAAYt7B,KAAKiqC,iBAAiB3O,UACpCA,GAAayO,GAAsB3nB,IACnCA,EAAMmoB,aAAajP,EAAU/C,IAAM,EACtC,EAELv4B,KAAKsoB,QAAQxmB,YAAY9B,KAAKwqC,sBAC9BxqC,KAAKyqC,mBAAqBliB,EAAK,SAAU,CAAEC,MAAO,QAASrH,MAAO,gBAAiBjgB,SAAUooB,EAAM,MAAO,CAAEC,QAAS,YAAaC,MAAO,KAAM7jB,OAAQ,KAAMzE,SAAU,CAACqnB,EAAK,OAAQ,CAAEjW,EAAG,MAAOC,EAAG,MAAOiX,MAAO,KAAM7jB,OAAQ,KAAM6iB,MAAO,eAAiBD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,MAAOC,GAAI,MAAOC,GAAI,OAAQ6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,MAAOC,GAAI,MAAOC,GAAI,OAAQ6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,MAAOC,GAAI,MAAOC,GAAI,OAAQ6H,MAAO,SAAU,eAAgB,QAAUD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,OAAQC,GAAI,MAAOC,GAAI,MAAO6H,MAAO,SAAU,eAAgB,aAClmBxoB,KAAKyqC,mBAAmB/hB,QAAU,KAC9B1oB,KAAKiqC,iBAAiBtiB,QACtB,MAAMvF,EAAQpiB,KAAKiqC,iBAAiB7nB,MAC9BkZ,EAAYt7B,KAAKiqC,iBAAiB3O,UACpCA,GAAayO,GAAsB3nB,IACnCA,EAAMsoB,aAAapP,EAAU/C,IAAK,EACrC,EAELv4B,KAAKsoB,QAAQxmB,YAAY9B,KAAKyqC,oBAC9BzqC,KAAKsoB,QAAQxmB,YAAYR,SAASC,eAAe,MACjDvB,KAAK2qC,mBAAqBpiB,EAAK,SAAU,CAAEC,MAAO,OAAQrH,MAAO,iBAAkBjgB,SAAUooB,EAAM,MAAO,CAAEnmB,MAAO,CAAEyrB,QAAS,QAAS4N,OAAQ,QAAUjT,QAAS,WAAYC,MAAO,IAAK7jB,OAAQ,KAAMzE,SAAU,CAACqnB,EAAK,OAAQ,CAAEjW,EAAG,MAAOC,EAAG,MAAOiX,MAAO,IAAK7jB,OAAQ,IAAK6iB,MAAO,eAAiBD,EAAK,OAAQ,CAAEjW,EAAG,MAAOC,EAAG,MAAOiX,MAAO,IAAK7jB,OAAQ,IAAK6iB,MAAO,SAAWD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,IAAKC,GAAI,MAAOC,GAAI,IAAK6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,IAAKC,GAAI,MAAOC,GAAI,IAAKC,GAAI,MAAO6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,IAAKC,GAAI,MAAOC,GAAI,IAAK6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,IAAKC,GAAI,MAAOC,GAAI,KAAM6H,MAAO,gBACrpBxoB,KAAKsoB,QAAQxmB,YAAY9B,KAAK2qC,oBAC9B3qC,KAAK4qC,mBAAqBriB,EAAK,SAAU,CAAEpH,MAAO,iBAAkBjgB,SAAUooB,EAAM,MAAO,CAAEnmB,MAAO,CAAEyrB,QAAS,QAAS4N,OAAQ,QAAUjT,QAAS,WAAYC,MAAO,IAAK7jB,OAAQ,KAAMzE,SAAU,CAACqnB,EAAK,OAAQ,CAAEjW,EAAG,MAAOC,EAAG,MAAOiX,MAAO,IAAK7jB,OAAQ,IAAK6iB,MAAO,SAAWD,EAAK,OAAQ,CAAEjW,EAAG,MAAOC,EAAG,MAAOiX,MAAO,IAAK7jB,OAAQ,IAAK6iB,MAAO,eAAiBD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,KAAMC,GAAI,MAAOC,GAAI,KAAM6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,IAAKC,GAAI,OAAQC,GAAI,IAAKC,GAAI,OAAQ6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,IAAKC,GAAI,MAAOC,GAAI,IAAK6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,KAAMC,GAAI,MAAOC,GAAI,KAAM6H,MAAO,gBAC3oBxoB,KAAKsoB,QAAQxmB,YAAY9B,KAAK4qC,oBAC9B5qC,KAAK6qC,oBAAsBtiB,EAAK,SAAU,CAAEpH,MAAO,kBAAmBjgB,SAAUooB,EAAM,MAAO,CAAEC,QAAS,YAAaC,MAAO,KAAM7jB,OAAQ,KAAMzE,SAAU,CAACqnB,EAAK,OAAQ,CAAEjW,EAAG,MAAOC,EAAG,MAAOiX,MAAO,IAAK7jB,OAAQ,IAAK6iB,MAAO,eAAiBD,EAAK,OAAQ,CAAEjW,EAAG,MAAOC,EAAG,MAAOiX,MAAO,IAAK7jB,OAAQ,IAAK6iB,MAAO,SAAWD,EAAK,OAAQ,CAAE/H,GAAI,IAAKC,GAAI,MAAOC,GAAI,KAAMC,GAAI,MAAO6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,IAAKC,GAAI,MAAOC,GAAI,IAAK6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,IAAKC,GAAI,MAAOC,GAAI,IAAK6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,IAAKC,GAAI,MAAOC,GAAI,IAAKC,GAAI,MAAO6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,IAAKC,GAAI,MAAOC,GAAI,IAAK6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,IAAKC,GAAI,MAAOC,GAAI,KAAM6H,MAAO,gBACpvBxoB,KAAK6qC,oBAAoBniB,QAAU,OAEnC1oB,KAAKsoB,QAAQxmB,YAAY9B,KAAK6qC,qBAC9B7qC,KAAK8qC,mBAAqBviB,EAAK,SAAU,CAAEpH,MAAO,iBAAkBjgB,SAAUooB,EAAM,MAAO,CAAEC,QAAS,YAAaC,MAAO,KAAM7jB,OAAQ,KAAMzE,SAAU,CAACqnB,EAAK,OAAQ,CAAEjW,EAAG,MAAOC,EAAG,MAAOiX,MAAO,IAAK7jB,OAAQ,IAAK6iB,MAAO,SAAWD,EAAK,OAAQ,CAAEjW,EAAG,MAAOC,EAAG,MAAOiX,MAAO,IAAK7jB,OAAQ,IAAK6iB,MAAO,eAAiBD,EAAK,OAAQ,CAAE/H,GAAI,IAAKC,GAAI,MAAOC,GAAI,KAAMC,GAAI,MAAO6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,IAAKC,GAAI,MAAOC,GAAI,IAAK6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,KAAMC,GAAI,MAAOC,GAAI,KAAM6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,IAAKC,GAAI,OAAQC,GAAI,KAAMC,GAAI,OAAQ6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,IAAKC,GAAI,MAAOC,GAAI,KAAM6H,MAAO,gBAC5qBxoB,KAAKsoB,QAAQxmB,YAAY9B,KAAK8qC,oBAC9B9qC,KAAK+qC,iBAAmBxiB,EAAK,SAAU,CAAEC,MAAO,QAASrH,MAAO,cAAejgB,SAAUooB,EAAM,MAAO,CAAEC,QAAS,YAAaC,MAAO,KAAM7jB,OAAQ,KAAMzE,SAAU,CAACqnB,EAAK,OAAQ,CAAEjW,EAAG,MAAOC,EAAG,MAAOiX,MAAO,IAAK7jB,OAAQ,IAAK6iB,MAAO,eAAiBD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,IAAKC,GAAI,MAAOC,GAAI,IAAK6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,KAAMC,GAAI,MAAOC,GAAI,KAAM6H,MAAO,WAAaD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,MAAOC,GAAI,MAAOC,GAAI,OAAQ6H,MAAO,SAAU,eAAgB,QAAUD,EAAK,OAAQ,CAAE/H,GAAI,MAAOC,GAAI,MAAOC,GAAI,MAAOC,GAAI,OAAQ6H,MAAO,SAAU,eAAgB,aACplBxoB,KAAKsoB,QAAQxmB,YAAY9B,KAAK+qC,kBAC9B/qC,KAAKsnB,aAAa,CAAEC,KAAM,SAC1BvnB,KAAKkmB,WAAWpkB,YAAYR,SAAS6kB,WAAWgC,IAAe,IAC/DnoB,KAAKkmB,WAAWpkB,YAAY9B,KAAKsoB,QACpC,CACDiK,UAAUhQ,GACN,OAAOA,aAAgBma,EAC1B,CACDtJ,WACIpzB,KAAKiqC,gBAAkBrY,GAAYuB,WACnCnzB,KAAKsoB,QAAQ3lB,UAAUC,IAAI,SAC9B,CACDswB,aACIlzB,KAAKiqC,qBAAkB/nC,EACvBlC,KAAKsoB,QAAQ3lB,UAAUqB,OAAO,SACjC,IChGL,MAAMgnC,WAAkC7R,IAEjC,MAAM8R,WAA0BD,ICFhC,MAAME,GACTrrC,YAAYW,EAAMyJ,EAAO0D,GACrB3N,KAAKQ,KAAOA,EACZR,KAAKiK,MAAQA,EACbjK,KAAK2N,KAAOA,CACf,CACG4qB,UACA,OAAOv4B,KAAKiK,KACf,CACGuuB,UACA,OAAOx4B,KAAK2N,IACf,CACD1N,WACI,MAAO,qBAAqBo4B,GAAer4B,KAAKQ,iBAAiBR,KAAKiK,gBAAgBjK,KAAK2N,OAC9F,ECZE,MAAMw9B,GACTtrC,YAAY8tB,EAAM8E,EAAOlD,GAAO,GAC5BvvB,KAAK2tB,KAAOA,EACZ3tB,KAAKyyB,MAAQA,EACbzyB,KAAKuvB,KAAOA,CACf,EAEE,MAAM6b,WAAkBzS,GAC3B94B,YAAY+4B,EAAWzqB,GACnBlN,MAAM23B,GACN54B,KAAKqrC,KAAO,IAAItqC,WACHmB,IAATiM,GACAnO,KAAKsrC,oBAAoBtrC,KAAKqrC,KAAMl9B,EAAM,EAEjD,CACG8pB,eAAa,OAAO,CAAI,CACxBC,eAAa,OAAOl4B,KAAKqrC,KAAKjqC,MAAS,CAC3CmqC,OAAO5d,GACH,IAAK,IAAIxsB,EAAI,EAAGA,EAAInB,KAAKqrC,KAAKjqC,SAAUD,EACpC,GAAInB,KAAKqrC,KAAKlqC,GAAGwsB,OAASA,EACtB,OAAOxsB,CAIlB,CACDqqC,iBAAiBhT,GACb,MAAMiT,EAAKzrC,KAAK0rC,aAsBhB,OArByB,IAArB1rC,KAAKqrC,KAAKjqC,QACVo3B,EAAM,EACNx4B,KAAK2rC,QAAQF,GACbzrC,KAAKqrC,KAAKtnC,KAAK,IAAIonC,GAAQM,EAAI,KAGnB,IAARjT,GACAx4B,KAAK4rC,QAAQH,EAAIzrC,KAAK6rC,WACtB7rC,KAAK2rC,QAAQF,GACbzrC,KAAKqrC,KAAKS,QAAQ,IAAIX,GAAQM,EAAI,MAGlCzrC,KAAK4rC,QAAQH,EAAIzrC,KAAKqrC,KAAK7S,GAAK7K,MAC5B3tB,KAAK+rC,QAAQ/rC,KAAKqrC,KAAK7S,EAAM,GAAG7K,QAAU3tB,KAAKqrC,KAAK7S,GAAK7K,KACzD3tB,KAAK4rC,QAAQ5rC,KAAKqrC,KAAK7S,EAAM,GAAG7K,KAAM8d,GAEtCzrC,KAAKgsC,QAAQhsC,KAAKqrC,KAAK7S,EAAM,GAAG7K,KAAM8d,GAC1CzrC,KAAKqrC,KAAKpnC,OAAOu0B,EAAK,EAAG,IAAI2S,GAAQM,EAAIzrC,KAAKqrC,KAAK7S,GAAK/F,SAGhEzyB,KAAK2E,SAASH,QAAQ,IAAI0mC,GAAW7S,GAAeoO,WAAYjO,EAAK,IAC9DA,CACV,CACDyT,gBAAgBzT,GACZ,MAAMiT,EAAKzrC,KAAK0rC,aAChB,GAAyB,IAArB1rC,KAAKqrC,KAAKjqC,OACVo3B,EAAM,EACNx4B,KAAK2rC,QAAQF,GACbzrC,KAAKqrC,KAAKtnC,KAAK,IAAIonC,GAAQM,EAAI,QAE9B,CACDzrC,KAAK4rC,QAAQH,EAAIzrC,KAAK+rC,QAAQ/rC,KAAKqrC,KAAK7S,GAAK7K,OAC7C3tB,KAAK4rC,QAAQ5rC,KAAKqrC,KAAK7S,GAAK7K,KAAM8d,GAClC,MAAMvnC,EAAQlE,KAAKksC,UAAUlsC,KAAKmsC,QAAQnsC,KAAKqrC,KAAK7S,GAAK7K,OACnD8E,EAAQzyB,KAAKqrC,KAAK7S,GAAK/F,MAC7B+F,GAAOt0B,EAAQ,EACflE,KAAKqrC,KAAKpnC,OAAOu0B,EAAK,EAAG,IAAI2S,GAAQM,EAAIhZ,GAC5C,CAED,OADAzyB,KAAK2E,SAASH,QAAQ,IAAI0mC,GAAW7S,GAAeoO,WAAYjO,EAAK,IAC9DA,CACV,CACD4T,cAAc5T,GACV,MAAMiT,EAAKzrC,KAAK0rC,aAChB,GAAyB,IAArB1rC,KAAKqrC,KAAKjqC,OACVpB,KAAK2rC,QAAQF,GACbzrC,KAAKqrC,KAAKtnC,KAAK,IAAIonC,GAAQM,EAAI,IAC/BzrC,KAAK2E,SAASH,QAAQ,IAAI0mC,GAAW7S,GAAeoO,WAAY,EAAG,QAElE,CACD,MAAM7Y,EAAO5tB,KAAKmsC,QAAQnsC,KAAKqrC,KAAK7S,GAAK7K,MACnC0e,EAAcrsC,KAAKksC,UAAUte,GACnC,IAAK,IAAIzsB,EAAI,EAAGA,EAAIkrC,IAAelrC,IAC7BnB,KAAKqrC,KAAK7S,EAAM,EAAIr3B,GAAGsxB,MAC7BzyB,KAAKgsC,QAAQP,EAAI7d,GACjB5tB,KAAKgsC,QAAQhsC,KAAKqrC,KAAK7S,GAAK7K,KAAM8d,GAClCzrC,KAAKqrC,KAAKpnC,OAAOu0B,EAAM,EAAG,EAAG,IAAI2S,GAAQM,EAAIzrC,KAAKqrC,KAAK7S,GAAK/F,MAAQ,IACpEzyB,KAAK2E,SAASH,QAAQ,IAAI0mC,GAAW7S,GAAeoO,WAAYjO,EAAM,EAAG,GAC5E,CACD,OAAOA,CACV,CACD8T,gBAAgB9T,GACZ,MAAMiT,EAAKzrC,KAAK0rC,aAChB,GAAY,IAARlT,EAAW,CACX,IAAK,IAAIr3B,EAAI,EAAGA,EAAInB,KAAKqrC,KAAKjqC,SAAUD,IAClCnB,KAAKqrC,KAAK7S,EAAMr3B,GAAGsxB,MACzBzyB,KAAKgsC,QAAQP,EAAIzrC,KAAK6rC,WACtB7rC,KAAK2rC,QAAQF,GACbzrC,KAAKqrC,KAAKS,QAAQ,IAAIX,GAAQM,EAAI,GACrC,KACI,CACD,MAAMhZ,EAAQzyB,KAAKqrC,KAAK7S,GAAK/F,MACvB4Z,EAAcrsC,KAAKksC,UAAUlsC,KAAKmsC,QAAQnsC,KAAKqrC,KAAK7S,GAAK7K,OAAS,EACxE,IAAK,IAAIxsB,EAAI,EAAGA,EAAIkrC,IAAelrC,IAC7BnB,KAAKqrC,KAAK7S,EAAMr3B,GAAGsxB,MACzBzyB,KAAKgsC,QAAQP,EAAIzrC,KAAKqrC,KAAK7S,GAAK7K,MAChC3tB,KAAK4rC,QAAQH,EAAIzrC,KAAK+rC,QAAQ/rC,KAAKqrC,KAAK7S,GAAK7K,OAC7C3tB,KAAK4rC,QAAQ5rC,KAAKqrC,KAAK7S,GAAK7K,UAAMzrB,GAC9BlC,KAAK+rC,QAAQ/rC,KAAKqrC,KAAK7S,EAAM,GAAG7K,QAAU3tB,KAAKqrC,KAAK7S,GAAK7K,KACzD3tB,KAAK4rC,QAAQ5rC,KAAKqrC,KAAK7S,EAAM,GAAG7K,KAAM8d,GAEtCzrC,KAAKgsC,QAAQhsC,KAAKqrC,KAAK7S,EAAM,GAAG7K,KAAM8d,GAC1CzrC,KAAKqrC,KAAKpnC,OAAOu0B,EAAK,EAAG,IAAI2S,GAAQM,EAAIhZ,GAC5C,CAED,OADAzyB,KAAK2E,SAASH,QAAQ,IAAI0mC,GAAW7S,GAAeoO,WAAYjO,EAAK,IAC9DA,CACV,CACD+T,SAAS/T,GACL,IAAI5K,EAAO5tB,KAAKmsC,QAAQnsC,KAAKqrC,KAAK7S,GAAK7K,MACvC,QAAazrB,IAAT0rB,EAAoB,CACpB,MAAMye,EAAcrsC,KAAKksC,UAAUte,GAAQ,EAC3C,IAAK,IAAIzsB,EAAI,EAAGA,EAAIkrC,IAAelrC,IAC7BnB,KAAKqrC,KAAK7S,EAAMr3B,GAAGsxB,MACzBzyB,KAAKwsC,OAAO5e,EAAM5tB,KAAK+rC,QAAQ/rC,KAAKqrC,KAAK7S,GAAK7K,OAC9C3tB,KAAK4rC,QAAQ5rC,KAAKqrC,KAAK7S,GAAK7K,UAAMzrB,GACtB,IAARs2B,EACAx4B,KAAK2rC,QAAQ/d,GAGb5tB,KAAK4rC,QAAQ5rC,KAAKqrC,KAAK7S,EAAM,GAAG7K,KAAMC,EAE7C,MAEG,GAAY,IAAR4K,EAAW,CACX,MAAMtuB,EAAOlK,KAAK+rC,QAAQ/rC,KAAKqrC,KAAK7S,GAAK7K,MACzC3tB,KAAK4rC,QAAQ5rC,KAAKqrC,KAAK7S,GAAK7K,UAAMzrB,GAClClC,KAAK2rC,QAAQzhC,EAChB,KACI,CACD,MAAMA,EAAOlK,KAAK+rC,QAAQ/rC,KAAKqrC,KAAK7S,GAAK7K,MACzC3tB,KAAK4rC,QAAQ5rC,KAAKqrC,KAAK7S,GAAK7K,UAAMzrB,GAC9BlC,KAAK+rC,QAAQ/rC,KAAKqrC,KAAK7S,EAAM,GAAG7K,QAAU3tB,KAAKqrC,KAAK7S,GAAK7K,KACzD3tB,KAAK4rC,QAAQ5rC,KAAKqrC,KAAK7S,EAAM,GAAG7K,KAAMzjB,GAEtClK,KAAKgsC,QAAQhsC,KAAKqrC,KAAK7S,EAAM,GAAG7K,KAAMzjB,EAC7C,CAIL,OAFAlK,KAAKqrC,KAAKpnC,OAAOu0B,EAAK,GACtBx4B,KAAK2E,SAASH,QAAQ,IAAI0mC,GAAW7S,GAAeqO,WAAYlO,EAAK,IAC9DA,CACV,CACD9R,OAAU,CACV+lB,SAASjU,GACDx4B,KAAKqrC,KAAK7S,GAAKjJ,KACfvvB,KAAK0sC,QAAQlU,GAGbx4B,KAAK2sC,OAAOnU,EAEnB,CACDoU,OAAOpU,GACH,OAAOx4B,KAAKqrC,KAAK7S,GAAKjJ,IACzB,CACDod,OAAOnU,GACH,IAAIqU,EAAI7sC,KAAKqrC,KAAK7S,GAClB,GAAIqU,EAAEtd,WAAiCrtB,IAAzBlC,KAAKmsC,QAAQU,EAAElf,MACzB,OACJkf,EAAEtd,MAAO,EACT,MAAMud,EAAU9sC,KAAK+sC,cAAcvU,GACnCx4B,KAAKqrC,KAAKpnC,OAAOu0B,EAAM,EAAG,KAAMsU,GAChC9sC,KAAK2E,SAASH,QAAQ,IAAI0mC,GAAW7S,GAAeoO,WAAYjO,EAAM,EAAGsU,EAAQ1rC,QACpF,CACDsrC,QAAQlU,GACJ,IAAIqU,EAAI7sC,KAAKqrC,KAAK7S,GAClB,IAAKqU,EAAEtd,WAAiCrtB,IAAzBlC,KAAKmsC,QAAQU,EAAElf,MAC1B,OACJ,MAAMzpB,EAAQlE,KAAKgtC,qBAAqBxU,GACxCqU,EAAEtd,MAAO,EACTvvB,KAAKqrC,KAAKpnC,OAAOu0B,EAAM,EAAGt0B,GAC1BlE,KAAK2E,SAASH,QAAQ,IAAI0mC,GAAW7S,GAAeqO,WAAYlO,EAAM,EAAGt0B,GAC5E,CACDgyB,WACI,IAAIsC,EAAM,EACV,KAAOA,EAAMx4B,KAAKk4B,UACdl4B,KAAK0sC,QAAQlU,KACXA,EAEN,IAAK,IAAIyU,KAAWjtC,KAAKqrC,KACrB4B,EAAQ1d,MAAO,CAEtB,CACDwd,cAAcvU,GACV,MAAMsU,EAAU,IAAI/rC,MACpB,IAAI8rC,EAAI7sC,KAAKqrC,KAAK7S,GAIlB,OAHIqU,EAAEtd,MAAQvvB,KAAKmsC,QAAQU,EAAElf,OACzB3tB,KAAKsrC,oBAAoBwB,EAAS9sC,KAAKmsC,QAAQU,EAAElf,MAAOkf,EAAEpa,MAAQ,GAE/Dqa,CACV,CACDxB,oBAAoBwB,EAASnf,EAAM8E,GAC/B,MAAMya,EAAU,IAAI/B,GAAQxd,EAAM8E,GAAO,GACzCqa,EAAQ/oC,KAAKmpC,GACTA,EAAQ3d,MAAQvvB,KAAKmsC,QAAQxe,IAC7B3tB,KAAKsrC,oBAAoBwB,EAAS9sC,KAAKmsC,QAAQxe,GAAOuf,EAAQza,MAAQ,GAEtEzyB,KAAK+rC,QAAQpe,IACb3tB,KAAKsrC,oBAAoBwB,EAAS9sC,KAAK+rC,QAAQpe,GAAOuf,EAAQza,MAErE,CACDua,qBAAqBxU,GACjB,IAAIqU,EAAI7sC,KAAKqrC,KAAK7S,GACdt0B,EAAQ,EACZ,GAAI2oC,EAAEtd,MAAQvvB,KAAKmsC,QAAQU,EAAElf,MAAO,CAChC,MAAM0d,EAAOrrC,KAAKmtC,2BAA2B3U,EAAM,GACnDA,GAAO6S,EACPnnC,GAASmnC,CACZ,CACD,OAAOnnC,EAAQ,CAClB,CACDipC,2BAA2B3U,GACvB,IAAIqU,EAAI7sC,KAAKqrC,KAAK7S,GACdt0B,EAAQ,EACZ,GAAI2oC,EAAEtd,MAAQvvB,KAAKmsC,QAAQU,EAAElf,MAAO,CAChC,MAAM0d,EAAOrrC,KAAKmtC,2BAA2B3U,EAAM,GACnDA,GAAO6S,EACPnnC,GAASmnC,CACZ,CACD,GAAIrrC,KAAK+rC,QAAQc,EAAElf,MAAO,CACtB,MAAM0d,EAAOrrC,KAAKmtC,2BAA2B3U,EAAM,GACnDA,GAAO6S,EACPnnC,GAASmnC,CACZ,CACD,OAAOnnC,CACV,CACDsoC,OAAOY,EAAOzf,GACV,QAAazrB,IAATyrB,EACA,OACJ,IACIzjB,EADAyE,EAAIy+B,EAER,KACIljC,EAAOlK,KAAK+rC,QAAQp9B,QACPzM,IAATgI,GAEJyE,EAAIzE,EAERlK,KAAK4rC,QAAQj9B,EAAGgf,EACnB,CACDue,UAAUve,GACN,YAAazrB,IAATyrB,EACO,EACJ,EAAI3tB,KAAKksC,UAAUlsC,KAAKmsC,QAAQxe,IAAS3tB,KAAKksC,UAAUlsC,KAAK+rC,QAAQpe,GAC/E,ECxPE,MAAM0f,WAAoBpC,GAC7BprC,YAAYuiB,GACRnhB,MAAMmhB,GACNpiB,KAAKi3B,OAAO+B,UAAW,CAC1B,CACDsU,SAAS/T,EAAKC,EAAM1O,GAChB9qB,KAAKutC,UAAUhU,EAAKC,GACpB,MAAMgU,EAAYxtB,GAAKF,GAAKgL,IAC5B0iB,EAAUrqC,MAAMsqC,cAAgB,SAChCD,EAAUrqC,MAAMuqC,QAAU,MAC1BlU,EAAK13B,YAAY0rC,EACpB,CACDlU,SAASC,EAAKC,GACVx5B,KAAKutC,UAAUhU,EAAKC,EACvB,CACD+T,UAAUhU,EAAKC,GACX,QAAmBt3B,IAAflC,KAAKoiB,MAEL,YADAvZ,QAAQC,IAAI,YAGhB,MAAMmkC,EAAUjtC,KAAKoiB,MAAMipB,KAAK9R,EAAIf,KAE9BmV,EAAKC,GAELC,EAAK,IACLC,EAAKtkC,KAAKukC,MAAMpoC,GAAuB,GAEvC6jB,EAAQyjB,EAAQxa,MAAQkb,EAAKA,EAAKE,EAClCG,EAAU1tB,KAChB0tB,EAAQxqC,eAAe,KAAM,QAAS,GAAGgmB,KACzCwkB,EAAQxqC,eAAe,KAAM,SAAU,MACvCwqC,EAAQ7qC,MAAMsqC,cAAgB,SAC9BO,EAAQ7qC,MAAM8qC,WAAa,OAC3B,MAAM1tB,EAAI0sB,EAAQxa,MAClB,QAAyCvwB,IAArClC,KAAKoiB,MAAM+pB,QAAQc,EAAQtf,MAAqB,CAChD,MAAMugB,EAAK3tB,EAAIotB,EAAKE,EACdM,EvE6BX,SAAc77B,EAAGC,EAAGiX,EAAO7jB,EAAQib,EAAQxF,GAC9C,MAAMyxB,EAAIvrC,SAASiB,gBAAgB8d,GAAI,QAWvC,OAVAwsB,EAAErpC,eAAe,KAAM,IAAK,GAAG8O,KAC/Bu6B,EAAErpC,eAAe,KAAM,IAAK,GAAG+O,KAC/Bs6B,EAAErpC,eAAe,KAAM,QAAS,GAAGgmB,KACnCqjB,EAAErpC,eAAe,KAAM,SAAU,GAAGmC,UACrBzD,IAAX0e,GACAisB,EAAErpC,eAAe,KAAM,SAAUod,QAExB1e,IAATkZ,GACAyxB,EAAErpC,eAAe,KAAM,OAAQ4X,GAE5ByxB,CACX,CuE1CwBuB,CAAKF,EAAIJ,EAfd,IAe0B,OAAQ,QACzCK,EAAIhrC,MAAMkrC,OAAS,UACnBL,EAAQlsC,YAAYqsC,GACpB,MAAMG,EAAQljC,GAAK8iC,EAAM,EAAUJ,EAAM,EAAUI,EAlB5C,EAkBmD,EAAcJ,EAAE,EAAc,QACxFQ,EAAMnrC,MAAMkrC,OAAS,UACrBL,EAAQlsC,YAAYwsC,GACpB,MAAMC,EAAOnjC,GAAK8iC,EAAM,EAAUJ,EAAM,EAAUI,IAAgBJ,EArB3D,EAqBkE,EAAc,QACvFS,EAAKprC,MAAMkrC,OAAS,UACpBE,EAAKprC,MAAMyrB,QAAUqe,EAAQ1d,KAAO,OAAS,GAC7Cye,EAAQlsC,YAAYysC,GACpBP,EAAQlsC,YAAYsJ,GAAK8iC,EAzBlB,EAyB2BJ,EAAM,EAAUI,EAzB3C,EAKA,EAoByDJ,EAAE,EAAc,SAChFE,EAAQ1e,cAAiBrF,IACrBA,EAAMvC,iBACNuC,EAAMoK,kBACN,MAAMma,EAAYxuC,KAAKoiB,MAAMmpB,OAAO0B,EAAQtf,MAC5C,QAAkBzrB,IAAdssC,EAEA,YADA3lC,QAAQC,IAAI,2CAGhB,MAAMs1B,EAAS4P,EAAQ7f,wBACjB7b,EAAI2X,EAAM2F,QAAUwO,EAAO/P,KAC3B9b,EAAI0X,EAAM4F,QAAUuO,EAAO9P,IAC7B4f,GAAM57B,GAAKA,GAAK47B,EArCjB,GAqC4BJ,GAAMv7B,GAAKA,GAAKu7B,EArC5C,IAsCC9tC,KAAKoiB,OAAOqqB,SAAS+B,GACrBD,EAAKprC,MAAMyrB,QAAU5uB,KAAKoiB,MAAMwqB,OAAO4B,GAAa,OAAS,GAChE,CAER,MAEGR,EAAQlsC,YAAYsJ,GAAKmV,EAAIotB,EAAKE,EAAE,EAAe,GAAK,EAAGttB,EAAIotB,EAAKE,IAAgBC,EAAM,EAAU,SACpGE,EAAQlsC,YAAYsJ,GAAKmV,EAAIotB,EAAKE,EAAM,EAAUC,EAAE,EAAcvtB,EAAIotB,EAAKE,EA7CpE,EAKA,EAwCkFC,EAAM,EAAU,SAE7G,IAAIW,EAAQ,GACZ,IAAK,IAAIttC,EAAI,EAAGA,GAAKof,IAAKpf,EAAG,CACzB,MAAMmR,EAAInR,EAAIwsC,EAAKE,EAAE,EAAe,EACpC,IAAK,IAAIa,EAAInV,EAAIf,IAAM,EAAGkW,EAAI1uC,KAAKoiB,MAAM8V,YACjCl4B,KAAKoiB,MAAMipB,KAAKqD,GAAGjc,MAAQtxB,KADkButC,EAGjD,GAAIvtC,IAAMnB,KAAKoiB,MAAMipB,KAAKqD,GAAGjc,MAAO,EAC5BtxB,IAAMof,QAImCre,IAArClC,KAAKoiB,MAAM2pB,QAAQkB,EAAQtf,SAH/B8gB,GAAS,aAAan8B,iBAAiBA,mCAO3C,KACH,CAER,CACD,QAAyCpQ,IAArClC,KAAKoiB,MAAM+pB,QAAQc,EAAQtf,YAA4DzrB,IAArClC,KAAKoiB,MAAM2pB,QAAQkB,EAAQtf,MAAqB,CAClG,MAAMrb,EAAIiO,EAAIotB,EAAKE,EAAE,EAAe,EACpCY,GAAS,aAAan8B,iBAAiBA,8BAC1C,CACDknB,EAAKr2B,MAAM8qC,WAAa,oGAAqGQ,YAC7HjV,EAAKr2B,MAAMwrC,iBAAmB,WAC9BnV,EAAKmG,gBAAgBqO,EACxB,EC/FE,MAAMY,WAAsBxD,GAC/BvrC,YAAY+4B,EAAWzqB,GACnBlN,MAAM23B,EAAWzqB,GACjBnO,KAAKmO,KAAOA,CACf,CACDu9B,aAAe,OAAO,IAAI1rC,KAAK44B,SAAc,CAC7CiW,WAAWlhB,GAAS,CACpBke,UAAY,OAAO7rC,KAAKmO,IAAO,CAC/Bw9B,QAAQhe,GAAQ3tB,KAAKmO,KAAOwf,CAAO,CACnCwe,QAAQxe,GAAQ,OAAOA,EAAKC,IAAO,CACnCoe,QAAQre,EAAMC,GAAQD,EAAKC,KAAOA,CAAO,CACzCme,QAAQpe,GAAQ,OAAOA,EAAKzjB,IAAO,CACnC0hC,QAAQje,EAAMzjB,GAAQyjB,EAAKzjB,KAAOA,CAAO,QCNvB4kC,GAoBlBjvC,YAAY8I,EAAmBtG,GAC3BrC,KAAK2I,UAAYA,EAAU3F,QAAQ,IAAK,KACxChD,KAAKqC,KAAOA,EAAKW,QAAQ,IAAK,KAC9BhD,KAAKma,YAAc,GAEnBna,KAAKI,MAAQ,EACbJ,KAAK+uC,aAAe,EACpB/uC,KAAKwN,QAAU,EAClB,CAGDwhC,SAASC,GACLjvC,KAAKivC,MAAQA,EACbA,EAAMlmC,YAAY/I,KACrB,CAEGkJ,eACA,MAAO,GAAGlJ,KAAK2I,aAAa3I,KAAKqC,MACpC,CAED6sC,SACI,OAAO,CACV,CAEDC,SACI,OAAO,CACV,CAED3pB,SAASplB,GAAegvC,iBAACA,GAAmB,GAAS,CAAA,GAEjD,MAAMC,EAAervC,KAAKsvC,WAAWlvC,GAC/Bgf,EAAUpf,KAAKuvC,WAAWF,GAC1BG,EAAWrwB,EAAiBnf,KAAKwN,QAAS4R,EAASiwB,GACzD,IAAI,IAAI/8B,KAAKk9B,EACTxvC,KAAKivC,MAAO9lC,UAAUmJ,EAAE,GAAIA,EAAE,IAE9B88B,GAIJpvC,KAAKyvC,iBAAgB,EACxB,CAEDC,aACI,MAAM3nB,EAAW/nB,KAAKylB,WAEtB,OADAzlB,KAAKwlB,SAASxlB,KAAK2vC,mBACZ5nB,CACV,CAED0nB,gBAAgBG,GAAW,GACvB/mC,QAAQC,IAAI,2DAgBf,CAKD2c,WAEI,IAAIoqB,EAAM,EACV,IAAI,IAAIxgC,KAAUrP,KAAKwN,QACnBqiC,GAAO7vC,KAAKivC,MAAO3lC,UAAU+F,EAAOmQ,YACxC,OAAOqwB,CACV,CAEDF,kBACI,OAAO3vC,KAAK+uC,YACf,CAEDe,aACI,QAAmB5tC,IAAflC,KAAK8K,YAAsC5I,IAAflC,KAAK+vC,MAErC,IAAK,MAAM1gC,KAAUrP,KAAKwN,SAG7B,CAEDwiC,YAAY5vC,GAAe6vC,cAACA,EAAgB,EAACC,WAAEA,GAAa,GAAS,IAOjElwC,KAAKwlB,SAASplB,EAAO,CAACgvC,kBAAkB,GA4B3C,CAEDe,kBACI,MAAMvvC,MAAM,kBACf,CAEDwvC,uBACI,MAAMxvC,MAAM,kBACf,CAEDyvC,aACI,MAAMzvC,MAAM,kBACf,CAED0vC,UACI,YAA8BpuC,IAAvBlC,KAAKuwC,aACf,CAEDpK,WAII,YAHmBjkC,IAAflC,KAAKoiB,QACLpiB,KAAKoiB,MAAQ,IAAIrd,EAAY/E,KAAK2vC,kBAAmB,CAAE1qC,IAAKjF,KAAKkvC,SAAUhqC,IAAKlF,KAAKmvC,SAAUhqC,KAAM,OAElGnF,KAAKoiB,KACf,EC1KC,MAAOouB,WAA8B1B,GAQvCjvC,YAAY8I,EAAmBtG,GAC3BpB,MAAM0H,EAAWtG,EACpB,CAEQitC,WAAWlvC,GAOhB,OANAA,EAAQoJ,KAAKvE,IAAI7E,GAEbA,OADc8B,IAAdlC,KAAKquB,KACG7kB,KAAKtE,KAAK,EAAK9E,GAGfoJ,KAAKtE,IAAI,EAAK9E,EAE7B,CAEQolB,SAASplB,GAAegvC,iBAAEA,GAAmB,GAAU,CAAA,GAE5DhvC,EAAQJ,KAAKsvC,WAAWlvC,GACxB,MAAMgf,EAAUpf,KAAKuvC,WAAWnvC,GAE1BqwC,EAAgBtxB,EAAiBnf,KAAKwN,QAAS4R,GAGrD,IAAI,MAAM3Z,KAAUgrC,EAEhBzwC,KAAKivC,MAAO9lC,UAAU1D,EAAO,GAAIA,EAAO,IAGxC2pC,GAIJpvC,KAAKyvC,iBAAgB,EACxB,CAGQhqB,WAEL,GAAIzlB,KAAK0wC,SAAU,CACf,IAAIb,EAAM,EACV,IAAI,IAAIxgC,KAAUrP,KAAK0wC,SACnBb,GAAO7vC,KAAKivC,MAAO3lC,UAAU+F,EAAOmQ,YACxC,OAAOqwB,CACV,CACD,IAAIA,EAAM,EACV,IAAI,IAAIxgC,KAAUrP,KAAK2wC,SACnBd,GAAO7vC,KAAKivC,MAAO3lC,UAAU+F,EAAOmQ,YACxC,OAAOqwB,CACV,CAGQN,WAAWnvC,GAChB,MAAMkK,EAAS,IAAIhC,IACbsoC,EAAOvwC,OAAOwwC,0BAA0B7wC,KAAKivC,OACnD,IAAI,MAAM5sC,KAAQuuC,EACTvuC,EAAKyM,SAAS,QAEnBxE,EAAOnK,IACHkC,EAAKgB,UAAU,EAAGhB,EAAKjB,OAAS,GAChCwvC,EAAKvuC,GAAMjC,MAAMA,OAEzB,OAAOkK,CACV,QC3EQwmC,GAGTjxC,YAAY2f,EAAoBF,GAC5Btf,KAAKwf,WAAaA,EAClBxf,KAAKsf,mBAAqBA,CAC7B,ECAC,SAAUxR,GAAYV,GACxB,QAAalL,IAATkL,EACA,MAAO,GACX,MAAM2jC,EAAc1jC,EAAcpC,cAAciD,kBAAkBd,GAClE,QAAoBlL,IAAhB6uC,EACA,MAAMnwC,MAAM,gDAAgDwM,KAEhE,MAAM9C,EAAS,GACf,IAAK,MAAMgF,KAAayhC,EAAa,CACjC,MAAMC,EAAc1hC,EAAUxC,QACxBmkC,EAAqB3hC,EAAUtC,eACrCikC,EAAmBltC,KAAKitC,GACxB1mC,EAAOvG,KACH,IAAI+sC,GAAUxhC,EAAUlC,KAAO6jC,GAEtC,CACD,OAAO3mC,CACX,CClBM,MAAO4mC,WAAsBV,GAC/B3wC,YAAY8I,EAAmBtG,GAE3BpB,MAAM0H,EAAWtG,GACjBrC,KAAK+uC,aAAe,GACpB/uC,KAAKwN,QAAUM,GAAYnF,GAC3B3I,KAAKmxC,kBCTP,SAAgC/jC,SAClC,MAAM9C,EAAS,IAAI0S,IACnB,YAAa9a,IAATkL,GAY0C,QAA9CgkC,EAAA/jC,EAAcpC,cAAcwC,OAAOvN,IAAIkN,UAAO,IAAAgkC,GAAAA,EAAAp2B,SAAS3L,IACnDA,EAAO9K,KAAKyW,SAAS,CAAC5a,EAAO6B,UACXC,IAAV9B,GACAkK,EAAO1H,IAAIX,EACd,GACH,IAhBKqI,CAmBf,CDbiC+mC,CAAsB1oC,GAC/C3I,KAAKuwC,cAAgBvwC,KAAKsxC,mBACtBtxC,KAAKuwC,eAELvwC,KAAKmxC,kBAAkB9nC,OAAOrJ,KAAKuwC,cAE1C,CAESe,mBACN,GAAItxC,KAAKqC,KAAM,CACX,IAAIgQ,EAAIrS,KAAKqC,KAAKa,cAClB,IAAoC,IAAhCgJ,EAAgB7B,QAAQgI,GACxB,OAAOA,EACX,GAAIlG,EAAgBlD,IAAIoJ,GACpB,OAAOlG,EAAgBjM,IAAImS,EAClC,CAEJ,CAEQoT,WACL,OAAOzlB,KAAKmmC,WAAW/lC,KAC1B,CAEQolB,SAASplB,GAAegvC,iBAAEA,GAAmB,GAAU,CAAA,GAE5DhvC,EAAQJ,KAAKsvC,WAAWlvC,GACxBJ,KAAKmmC,WAAW/lC,MAAQA,EACxBa,MAAMukB,SAASplB,EAAO,CAAEgvC,oBAC3B,CAEQE,WAAWlvC,GAChB,OAAOoJ,KAAKtE,IAAI,EAAKsE,KAAKvE,IAAI,EAAK7E,GACtC,CAEQmvC,WAAWnvC,GAChB,MAAMgf,EAAUne,MAAMsuC,WAAWnvC,GAEjC,OADAgf,EAAQjf,IAAIH,KAAK2I,UAAW,GACrByW,CACV,CAEQ0wB,aACR,CAEQ3J,WACL,QAAmBjkC,IAAflC,KAAKoiB,MACL,OAAOpiB,KAAKoiB,MAEhB,QAAmBlgB,IAAflC,KAAKivC,MACL,MAAMruC,MAAM,yEAEhB,OAAQZ,KAAKqC,MACT,IAAK,SACDrC,KAAKoiB,MAAQpiB,KAAKivC,MAAMzpC,OACxB,MACJ,IAAK,MACDxF,KAAKoiB,MAAQpiB,KAAKivC,MAAM1pC,IACxB,MACJ,IAAK,SACDvF,KAAKoiB,MAAQpiB,KAAKivC,MAAMvpC,OACxB,MACJ,IAAK,SACD1F,KAAKoiB,MAAQpiB,KAAKivC,MAAMxpC,OACxB,MACJ,IAAK,SACDzF,KAAKoiB,MAAQpiB,KAAKivC,MAAMtpC,OACxB,MACJ,IAAK,kBACD3F,KAAKoiB,MAAQpiB,KAAKivC,MAAMnpC,gBACxB,MACJ,IAAK,aACD9F,KAAKoiB,MAAQpiB,KAAKivC,MAAMrpC,WACxB,MACJ,IAAK,iBACD5F,KAAKoiB,MAAQpiB,KAAKivC,MAAMppC,eACxB,MACJ,IAAK,UACD7F,KAAKoiB,MAAQpiB,KAAKivC,MAAMhpC,WACxB,MACJ,IAAK,QACDjG,KAAKoiB,MAAQpiB,KAAKivC,MAAMjpC,SACxB,MACJ,IAAK,YACDhG,KAAKoiB,MAAQpiB,KAAKivC,MAAMlpC,aACxB,MACJ,QACI,MAAMnF,MAAM,uDAAuDZ,KAAKqC,SAEhF,OAAOrC,KAAKoiB,KACf,EEjGC,MAAOmvB,WAAuBL,GAChCrxC,YAAY8I,EAAmBtG,GAC3BpB,MAAM0H,EAAWtG,GACjBrC,KAAK+uC,aAAe,EAAE,CACzB,ECAC,MAAOyC,WAA0BhB,GAInC3wC,YAAY8I,EAAmBS,EAAoBqoC,EAAkBC,EAAmBC,GAEpF,IACItvC,EACAgsB,EACAujB,EACAha,EAJAia,EAAiB,GAAGlpC,KAAaS,SAKrBlH,IAAZuvC,QAAsCvvC,IAAbwvC,GACzBrjB,EAAO,GAAGwjB,KAAkBJ,IAC5B7Z,EAAQ,GAAGia,KAAkBH,SAEXxvC,IAAdyvC,GACAC,EAAS,GAAGC,KAAkBF,IAC9BE,EAAiB,GAAGA,KAAkBJ,KAAWE,KAAaD,IAC9DrvC,EAAO,GAAG+G,KAAcqoC,KAAWE,KAAaD,MAEhDE,OAAS1vC,EACT2vC,EAAiB,GAAGA,KAAkBJ,KAAWC,IACjDrvC,EAAO,GAAG+G,KAAcqoC,KAAWC,OAGvCrjB,OAAOnsB,EACP01B,EAAQia,EACRD,OAAS1vC,EACTG,EAAO+G,GAEXnI,MAAM0H,EAAWtG,GACjBrC,KAAKoJ,WAAayoC,EAClB7xC,KAAKquB,KAAOA,EACZruB,KAAK4xC,OAASA,EACd5xC,KAAK43B,MAAQA,EAGb53B,KAAK2wC,SAAW7iC,GAAY9N,KAAKquB,MACjCruB,KAAK0wC,SAAW5iC,GAAY9N,KAAK43B,OACjC53B,KAAK8xC,SAAWhkC,GAAY9N,KAAK4xC,QAQjC,IAAI,MAAMpkC,IAAW,CAACxN,KAAK2wC,SAAU3wC,KAAK0wC,SAAU1wC,KAAK8xC,UACrD,QAAgB5vC,IAAZsL,EACA,IAAI,MAAM6B,KAAU7B,EAChBxN,KAAKwN,QAAQzJ,KAAKsL,EACjC,CAEQ6/B,SACL,YAAkBhtC,IAAdlC,KAAKquB,MACG,EAED,CACd,CAEQkhB,WAAWnvC,GAChB,MAAMgf,EAAUne,MAAMsuC,WAAWnvC,GAQjC,YANkB8B,IAAdlC,KAAKquB,MACLjP,EAAQjf,IAAIH,KAAKquB,MAAO7kB,KAAKvE,IAAI7E,EAAO,SACxB8B,IAAhBlC,KAAK4xC,QACLxyB,EAAQjf,IAAIH,KAAK4xC,OAAQ,EAAMpoC,KAAKK,IAAIzJ,IAC5Cgf,EAAQjf,IAAIH,KAAK43B,MAAQpuB,KAAKtE,IAAI,EAAG9E,IAE9Bgf,CACV,EC1DW,SAAA2yB,GAAc9C,EAAcjkC,GACxC,OAME,SAAyBikC,EAAc1qC,EAAcyG,EAAW,UAClE,MAAMgnC,EAAiB,IAAI1pC,IAAiB,CAMxC,CAAC,iBAAkBipC,MAEjB3zB,EAAON,KAAKO,MAAMtZ,GAClB8D,EAAY,IAAItH,MAChBqlC,EAAS,IAAI99B,IAEnB,IAAK,MAAM2pC,KAAiBr0B,EAAM,CAC9B,MAAMjV,EAAYspC,EAAcrpC,MAEhC,IAAK,MAAMspC,KAAeD,EAAc5pC,UAAW,CAC/C,IAAI8pC,EACAnpC,EACJ,GAAI,iBAAkBkpC,GAElB,GADAC,EAAgBH,EAAe9xC,IAAIgyC,EAAYE,mBACzBlwC,IAAlBiwC,EACA,MAAMvxC,MAAM,iCAAiCsxC,EAAYE,qBAG7DD,EADO,aAAcD,EACLhB,GAEAM,GAGpB,GAAI,aAAcU,EACdlpC,EAAW,IAAImpC,EAAcxpC,EAAWupC,EAAYG,UAC/CrpC,EAASsnC,WACVznC,QAAQC,IAAI,qBAAqBqpC,EAAc9vC,oIAEhD,CAEH,GAAI8vC,IAAkBX,GAClB,MAAM5wC,QACVoI,EAAW,IAAKmpC,EAA2CxpC,EAAWupC,EAAY7iC,OAAQ6iC,EAAYjtC,IAAKitC,EAAYhtC,IAAKgtC,EAAYI,IAC3I,CAEG,iBAAkBJ,IAClBlpC,EAAS+lC,aAAemD,EAAYnD,mBAGd7sC,IAAtB8G,EAASE,WACTL,QAAQC,IAAI,mCACZD,QAAQC,IAAIE,IAEhBX,EAAUtE,KAAKiF,GACfo9B,EAAOjmC,IAAI6I,EAASE,SAAUF,EAEjC,CACJ,CAGD,IAAK,MAAMA,KAAYX,EACnBW,EAASgmC,SAASC,GAwBtB,OArBApmC,QAAQC,IAAI,UAAUT,EAAUjH,8BAA8B4J,KAqBvD3C,CACX,CAzFWkqC,CACHtD,EACAvkC,EAAkBO,cAAcC,SAASF,GACzCA,EACR,OCHawnC,GAQT3yC,YAAYovC,EAAenkB,EAAgB2nB,GAKvC,GAJAD,GAAWtuC,QACXlE,KAAK8qB,MAAQA,GAAS,GACtB9qB,KAAKyyC,aAAeA,EAEhBA,EAAc,CAUd,MAAMzpC,EAAWimC,EAAOxmC,YAAYgqC,EAAaC,UAChCxwC,IAAb8G,IACAhJ,KAAKoiB,MAAQpZ,EAASm9B,WACtBnmC,KAAKoiB,MAAMzd,SAAS/B,KAAI,KAEpBoG,EAASgnC,YAAYhwC,KAAKoiB,MAAOhiB,OAEjC6uC,EAAOnlC,iBAAgB,EAAK,IAKvC,CACJ,EAGL,SAAS6oC,GAAW5lC,GAChB,OAAOA,EAAE,GAAG6lC,cAAgB7lC,EAAEP,MAAM,EACxC,CAEgB,SAAAqmC,GAAkBlqC,EAAmBtG,GACjD,MAAMywC,EAASzwC,EAAKkJ,MAAM,KAU1B,OARgD,IAA5CunC,EAAOA,EAAO1xC,OAAS,GAAGiJ,QAAQ,MAClCyoC,EAAOC,MAEPD,EAAO1xC,OAAS,GAAK0xC,EAAO,KAAOnqC,GACnCmqC,EAAOr0B,QAEXq0B,EAAO,GAAKH,GAAWG,EAAO,IAEvBA,EAAOzV,KAAK,IACvB,CASgB,SAAA2V,GAAY/D,EAAcjkC,GACtC,MAAMmD,EAQJ,SAAuB8gC,EAAc1qC,EAAcyG,EAAW,UAChE,MAAM4S,EAAON,KAAKO,MAAMtZ,GACxB,IAAI0uC,EACAC,EACJ,IAAK,MAAOC,EAAQC,KAAa/yC,OAAOmC,QAAQob,GAAMlP,MAClD,CAACU,EAAkB2C,IAA6B3C,EAAE,GAAGikC,UAAYthC,EAAE,GAAGshC,YACxE,CACE,MAAMlf,EAAMif,EAEZ,IAAItoB,EAAQqoB,OACMjxC,IAAdiyB,EAAIrJ,QACJA,EAAQqJ,EAAIrJ,OAEhB,MAAMwoB,EAAU,IAAId,GAAWvD,EAAOnkB,GAQtC,IAAIyoB,EAPJD,EAAQlnC,SAAW+nB,EACf+e,EACAA,EAAYhpC,KAAOopC,EAEnBL,EAAWK,EACfJ,EAAcI,EAGd,IAAK,MAAOE,EAAaC,KAAkBpzC,OAAOmC,QAAQ2xB,EAAI9rB,WAAY,CACtE,MAAMqrC,EAAe,IAAIlB,GAAWvD,EAAO0D,GAAWa,IAMtD,IAAIG,EALAJ,EACAA,EAAiBrpC,KAAOwpC,EAExBR,EAAYtlB,KAAO8lB,EACvBH,EAAmBG,EAEnB,IAAK,MAAM1qC,KAAYyqC,EAAiC,CACpD,IAAI3oB,EAAQ9hB,EAAS8hB,MACrB,QAAc5oB,IAAV4oB,EAAqB,CACrB,MAAMzoB,EAAO2G,EAAS0pC,IAAInnC,MAAM,KAChCuf,EAAQ+nB,GAAkBxwC,EAAK,GAAIA,EAAK,GAC3C,CACD,MAAMuxC,EAAa,IAAIpB,GAAWvD,EAAOnkB,EAAO9hB,GAC5C2qC,EACAA,EAAezpC,KAAO0pC,EAEtBL,EAAiB3lB,KAAOgmB,EAC5BD,EAAiBC,CACpB,CACJ,CACJ,CACD,QAAiB1xC,IAAb+wC,EACA,MAAMryC,MAAM,qBAChB,OAAOqyC,CACX,CAxDiBY,CACT5E,EACAvkC,EAAkBO,cAAcC,SAASF,GACzCA,GAEJ,OADAnC,QAAQC,IAAI,UAAU0pC,GAAWtuC,gCAAgC8G,KAC1DmD,CACX,CAtEWqkC,GAAKtuC,MAAG,QCrBN4vC,GAITj0C,YAAYwC,EAAcmhB,GACtBxjB,KAAKqC,KAAOA,EACZrC,KAAK+zC,WAAavwB,EAClBxjB,KAAKoB,OAAS,CACjB,QCHQ4yC,GAgBTn0C,cAfAG,KAAIqC,KAAG,GAaPrC,KAAAi0C,WAAa,IAAI3rC,IAGbtI,KAAKk0C,OAAS,GACdl0C,KAAKm0C,QAAU,GACfn0C,KAAK0W,OAAS,GACd1W,KAAKo0C,QAAU,GACfp0C,KAAKyN,OAAS,GACdzN,KAAKq0C,SAAW,EACnB,CAEDp0C,WACI,MAAO,wBAAwBD,KAAKqC,oBAAoBrC,KAAKk0C,OAAO9yC,OAAS,aAAapB,KAAKo0C,QAAQhzC,OAAS,cAAcpB,KAAKyN,OAAOrM,UAC7I,CAED2J,KAAKC,EAAkBzG,GACnBvE,KAAKqC,KAAO2I,OACC9I,IAATqC,IACAA,EAAOmG,EAAkBO,cAAcC,SAASF,IAEpD,MAAMkpC,EAAmB,GACnBC,EAAoB,GACpBz9B,EAAmB,GACnB09B,EAAoB,GACpBE,EAAuB,GACvBC,EAAsB,GACtBppC,EAAS,IAAIZ,EAAahG,GAEhC,IAAIiwC,EAAa,EACjB,IAAK,IAAIppC,KAAQD,EAAQ,CAIrB,KAHEqpC,EAEFppC,EAAOA,EAAKC,OACQ,IAAhBD,EAAKhK,OACL,SACJ,GAAgB,MAAZgK,EAAK,GAEL,SAEJ,MAAME,EAASF,EAAKG,MAAM,OAC1B,OAAQD,EAAO,IAEX,IAAK,IACD,GAAIA,EAAOlK,OAAS,EAChB,MAAMR,MAAM,wBAAwBwK,KACxC,GAAIE,EAAOlK,OAAS,EAChB,MAAMR,MAAM,yBAAyBwK,KAIzC,GAHA8oC,EAAOnwC,KAAKpD,WAAW2K,EAAO,KAC9B4oC,EAAOnwC,KAAKpD,WAAW2K,EAAO,KAC9B4oC,EAAOnwC,KAAKpD,WAAW2K,EAAO,KACR,IAAlBA,EAAOlK,OACP,MAAMR,MAAM,0CAIhB,MACJ,IAAK,KACD,GAAI0K,EAAOlK,OAAS,EAChB,MAAMR,MAAM,wBAAwBwK,KACxC,GAAIE,EAAOlK,OAAS,EAChB,MAAMR,MAAM,yBAAyBwK,KACzC+oC,EAAQpwC,KAAKpD,WAAW2K,EAAO,KAC/B6oC,EAAQpwC,KAAKpD,WAAW2K,EAAO,KAC/B,MACJ,IAAK,KACD,GAAIA,EAAOlK,OAAS,EAChB,MAAMR,MAAM,wBAAwBwK,KACxC,GAAIE,EAAOlK,OAAS,EAChB,MAAMR,MAAM,yBAAyBwK,KAIzC,GAHAsL,EAAO3S,KAAKpD,WAAW2K,EAAO,KAC9BoL,EAAO3S,KAAKpD,WAAW2K,EAAO,KAC9BoL,EAAO3S,KAAKpD,WAAW2K,EAAO,KACR,IAAlBA,EAAOlK,OACP,MAAMR,MAAM,0CAIhB,MACJ,IAAK,KAGL,IAAK,MACL,IAAK,OACL,IAAK,OACL,IAAK,SAGL,IAAK,IACL,IAAK,IAkBL,IAAK,OACL,IAAK,QACL,IAAK,OAGL,IAAK,OACL,IAAK,OACL,IAAK,OACL,IAAK,OACL,IAAK,KACL,IAAK,MAGL,IAAK,MAML,IAAK,IACL,IAAK,KAML,IAAK,QACL,IAAK,WACL,IAAK,WACL,IAAK,MAIL,IAAK,SACL,IAAK,aACL,IAAK,YACL,IAAK,QACL,IAAK,QAAS,MAtDd,IAAK,IACD,GAAsB,IAAlB0K,EAAOlK,OACP,MAAMR,MAAM,oDAAoD4zC,OAAgBppC,OAKpF,IAAK,IAAIjK,EAAI,EAAGA,EAAImK,EAAOlK,SAAUD,EAAG,CACpC,MAAMoK,EAAQD,EAAOnK,GAAGoK,MAAM,KAC9B6oC,EAAQrwC,KAAKyH,SAASD,EAAM,GAAI,IAAM,GACtC+oC,EAAWvwC,KAAKyH,SAASD,EAAM,GAAI,IAAM,GACzCgpC,EAAUxwC,KAAKyH,SAASD,EAAM,GAAI,IAAM,EAC3C,CACD,MAAM0kB,EAAMmkB,EAAQhzC,OAAS,EAC7BgzC,EAAQrwC,KAAKqwC,EAAQnkB,EAAM,IAC3BmkB,EAAQrwC,KAAKqwC,EAAQnkB,EAAM,IAC3B,MAiBJ,IAAK,IACDjwB,KAAKyN,OAAO1J,KAAK,IAAI+vC,GAAMxoC,EAAO,GAAI8oC,EAAQhzC,SAC9C,MAGJ,IAAK,IACDpB,KAAKqC,KAAOiJ,EAAO,GACnB,MAOJ,IAAK,SACDtL,KAAKq0C,SAAStwC,KAAK,IAAI+vC,GAAMxoC,EAAO,GAAI8oC,EAAQhzC,SAChD,MAOJ,QACI,MAAMR,MAAM,oBAAoB0K,EAAO,sCAAsCF,gBAAmBA,EAAKhK,YAEhH,CACDpB,KAAKk0C,OAASA,EAEdl0C,KAAK0W,OAASA,EACd1W,KAAKo0C,QAAUA,EAEfp0C,KAAKm0C,QAAU,IAAIpzC,MAAyB,EAAnBwzC,EAAUnzC,QACnC,IAAI,IAAID,EAAE,EAAGA,EAAEozC,EAAUnzC,SAAUD,EAC/BnB,KAAKm0C,QAAsB,EAAdG,EAAWnzC,IAASgzC,EAAqB,EAAbI,EAAUpzC,IACnDnB,KAAKm0C,QAAsB,EAAdG,EAAWnzC,GAAK,GAAMgzC,EAAqB,EAAbI,EAAUpzC,GAAK,GAI9D,GAAInB,KAAKyN,OAAOrM,OAAS,EAAG,CACxB,IAAK,IAAID,EAAI,EAAGA,EAAInB,KAAKyN,OAAOrM,OAAS,IAAKD,EAC1CnB,KAAKyN,OAAOtM,GAAGC,OAASpB,KAAKyN,OAAOtM,EAAI,GAAG4yC,WAAa/zC,KAAKyN,OAAOtM,GAAG4yC,WAE3E/zC,KAAKyN,OAAOzN,KAAKyN,OAAOrM,OAAS,GAAGA,OAASgzC,EAAQhzC,OAASpB,KAAKyN,OAAOzN,KAAKyN,OAAOrM,OAAS,GAAG2yC,UACrG,CAED,GAAI/zC,KAAKq0C,SAASjzC,OAAS,EAAG,CAC1B,IAAK,IAAID,EAAI,EAAGA,EAAInB,KAAKq0C,SAASjzC,OAAS,IAAKD,EAC5CnB,KAAKq0C,SAASlzC,GAAGC,OAASpB,KAAKq0C,SAASlzC,EAAI,GAAG4yC,WAAa/zC,KAAKq0C,SAASlzC,GAAG4yC,WAEjF/zC,KAAKq0C,SAASr0C,KAAKq0C,SAASjzC,OAAS,GAAGA,OAASgzC,EAAQhzC,OAASpB,KAAKq0C,SAASr0C,KAAKq0C,SAASjzC,OAAS,GAAG2yC,UAC7G,CAED/zC,KAAKy0C,cAAczpC,EACtB,CAED0pC,aAAaryC,GAUT,MAAMiQ,EAAItS,KAAKyN,OACVsO,QAAO44B,GAAKA,EAAEtyC,OAASA,IAC5B,GAAiB,IAAbiQ,EAAElR,OAGN,OAAOkR,EAAE,EACZ,CAEDmiC,cAAczpC,GACV,IAAI4pC,EAAa,GACbh4B,EAAS,EACTi4B,EAAU,EACd70C,KAAKyN,OAAOuN,SAAQ25B,IACZA,EAAEtyC,KAAKyyC,WAAW,YAChBl4B,EAEE+3B,EAAEtyC,KAAKyyC,WAAW,aAChBD,EAGED,EADsB,IAAtBA,EAAWxzC,OACEuzC,EAAEtyC,KAEF,GAAGuyC,MAAeD,EAAEtyC,MAExC,IAEiB,IAAtBuyC,EAAWxzC,SACXwzC,EAAa,QAAQA,KAEzB/rC,QAAQC,IAAI,UAAU9I,KAAKyN,OAAOrM,kBAAkBwb,aAAkBi4B,YAAkBD,OAAgB50C,KAAKq0C,SAASjzC,qBAAqBpB,KAAKk0C,OAAO9yC,OAAS,eAAepB,KAAKm0C,QAAQ/yC,OAAO,UAAUpB,KAAK0W,OAAOtV,OAAO,cAAcpB,KAAKo0C,QAAQhzC,OAAS,0BAA0B4J,KACjS,EC9NL,IAAY+pC,GCfAC,GCAAC,IFeZ,SAAYF,GACRA,EAAAA,EAAA,KAAA,GAAA,OACAA,EAAAA,EAAA,MAAA,GAAA,QACAA,EAAAA,EAAA,KAAA,GAAA,MACH,CAJD,CAAYA,KAAAA,GAIX,CAAA,UAEYG,GAWTr1C,YAAYovC,GAJZjvC,KAAOm1C,QAAG,IAAI7sC,IAEdtI,KAAAo1C,eAAiBL,GAAOM,KAGpBr1C,KAAKivC,MAAQA,EAEb,MAAMqG,EAAM,IAAItB,GAChBsB,EAAIvqC,KAAK,wBAET/K,KAAKu1C,SAAWD,EAChBt1C,KAAKw1C,aAAex1C,KAAKy1C,cAAgBH,EAAIpB,MAChD,CAEDh2B,yBACI,OAAOle,KAAKy1C,aACf,CAED9oC,SACQ3M,KAAKo1C,iBAAmBL,GAAOM,OAI/Br1C,KAAKo1C,iBAAmBL,GAAOW,QAE/B11C,KAAKy1C,cAAgB,IAAIz1C,KAAKu1C,SAASrB,QACvCl0C,KAAKivC,MAAMzmC,mBAAmBwS,SAAQ,CAAC5a,EAAOgJ,KAC1C,GAAIusC,MAAMv1C,GAEN,OAGJ,GAlDOgP,EAkDIhP,EAjDhBoJ,KAAKK,IAAIuF,IAHN,MAoDuBumC,MAAMv1C,GACvB,OAnDd,IAAiBgP,GhG2IjB,SAAoBpE,GACtB,IAAIqE,EAASG,EAAatP,IAAI8K,GAC9B,YAAe9I,IAAXmN,IAEJA,EAAS,IAAIxE,EACbwE,EAAOtE,KAAKC,GACZwE,EAAarP,IAAI6K,EAAUqE,IAHhBA,CAKf,EgG9F+BumC,CAAUxsC,GAClBqC,MAAMzL,KAAKy1C,cAAer1C,EAAM,IAE3CJ,KAAKmV,SAASmJ,eACdte,KAAKmV,SAASkB,QACdrW,KAAKmV,SAASxI,UAIlB3M,KAAKw1C,aAAex1C,KAAKmV,SAASwJ,SAAS3e,KAAKy1C,cAAez1C,KAAKmV,SAAS4I,cAAezD,OAE5Fta,KAAKo1C,eAAiBL,GAAOM,KAChC,EGlDC,SAAUQ,GAAcz5B,GAC1B,IAAIrP,EAAIqP,EAER,MAAM05B,EAAW,IAAIC,GAEfC,EAAQ55B,EAAM+4B,QAAQj1C,IAAI,SAG1B+1C,EAAwB,CAC1B,CACI/B,OAAQ93B,EAAMq5B,cACdrB,QAASh4B,EAAMm5B,SAASnB,QACxBr2B,cAAe3B,EAAMjH,SAAS4I,cAC9ByF,MAAOpH,EAAMm5B,SAAS9nC,OAAOwnC,GAAciB,MAAMnC,WACjD3yC,OAAQgb,EAAMm5B,SAAS9nC,OAAOwnC,GAAciB,MAAM90C,OAClDiB,KAAM,OAAQwqC,EAAG,EAAG8H,EAAG,GAAK5iC,EAAG,IAChC,CACCmiC,OAAQ93B,EAAMq5B,cACdrB,QAASh4B,EAAMm5B,SAASnB,QACxBr2B,cAAe3B,EAAMjH,SAAS4I,cAC9ByF,MAAOpH,EAAMm5B,SAAS9nC,OAAOwnC,GAAckB,UAAUpC,WACrD3yC,OAAQgb,EAAMm5B,SAAS9nC,OAAOwnC,GAAckB,UAAU/0C,OACtDiB,KAAM,OAAQwqC,EAAG,EAAK8H,EAAG,EAAK5iC,EAAG,IAClC,CACCmiC,OAAQ93B,EAAMq5B,cACdrB,QAASh4B,EAAMm5B,SAASnB,QACxBr2B,cAAe3B,EAAMjH,SAAS4I,cAC9ByF,MAAOpH,EAAMm5B,SAAS9nC,OAAOwnC,GAAcmB,UAAUrC,WACrD3yC,OAAQgb,EAAMm5B,SAAS9nC,OAAOwnC,GAAcmB,UAAUh1C,OACtDiB,KAAM,OAAQwqC,EAAG,EAAK8H,EAAG,EAAK5iC,EAAG,GAClC,CACCmiC,OAAQ8B,EAAMK,UAAUj6B,EAAMq5B,eAC9BrB,QAAS4B,EAAMM,KAAKlC,QACpBr2B,cAAei4B,EAAMO,iBAAiBn6B,EAAMjH,SAAS4I,eACrDyF,MAAO,EACPpiB,OAAQ40C,EAAMM,KAAKlC,QAAQhzC,OAC3BiB,KAAM,QAASwqC,EAAG,EAAK8H,EAAG,EAAK5iC,EAAG,GACnC,CACCmiC,OAAQ93B,EAAMq5B,cACdrB,QAASh4B,EAAMm5B,SAASnB,QACxBr2B,cAAe3B,EAAMjH,SAAS4I,cAC9ByF,MAAOpH,EAAMm5B,SAAS9nC,OAAOwnC,GAAcuB,QAAQzC,WACnD3yC,OAAQgb,EAAMm5B,SAAS9nC,OAAOwnC,GAAcuB,QAAQp1C,OACpDiB,KAAM,SAAUwqC,EAAG,EAAG8H,EAAG,EAAK5iC,EAAG,IAIzC,MA8BO,+WAOI,IAAIyxB,MAAOiT,2CACV,IAAIjT,MAAOiT,iIAS3B,SAAwBR,GACpB,IAAIpmC,EAAM,wBAqBV,OApBAomC,EAAUj7B,SAAQlG,IACdjF,GAAO,mBAAmBiF,EAAEzS,iQAQCyS,EAAE+3B,KAAK/3B,EAAE6/B,KAAK7/B,EAAE/C,qOAQrC,IAEZlC,GAAO,yBACAA,CACX,CArEQ6mC,CAAeT,GAuEvB,SAA0BA,GACtB,IAAIpmC,EAAM,0BAOV,OANAomC,EAAUj7B,SAAQlG,IACdjF,GAAO,qBAAqBiF,EAAEzS,wBAAwByS,EAAEzS,wCACjCyS,EAAEzS,mCACf,IAEdwN,GAAO,2BACAA,CACX,CA/EQ8mC,CAAiBV,GAiFzB,SAA2B75B,EAAkB05B,EAAoBG,GAE7D,IAAK,IAAInhC,KAAKmhC,EACVW,GACI9hC,EAAEo/B,OACFp/B,EAAEs/B,QACFt/B,EAAE0O,MACF1O,EAAE1T,OACF00C,GAKR,IAAIjmC,EAAM,6CACMgnC,aAAmBC,2CAEjBC,oCACOC,cAAkClB,EAAS5B,OAAO9yC,WAAW00C,EAAS5B,OAAO7W,KAAK,oFAE9E2Z,cAAkClB,EAAS5B,OAAO9yC,OAAS,8PAOpE61C,uDACwBF,+BAE5C,IAAK,IAAIjiC,EAAI,EAAGA,EAAImhC,EAAU70C,SAAU0T,EACpCjF,GAAO,+BAA+BomC,EAAUnhC,GAAGzS,yBAAyByzC,EAAS1B,QAAQt/B,GAAG1T,OAAS,oDACnE61C,uCAC1B,KAAKC,OAAOpB,EAAS1B,QAAQt/B,GAAG1T,OAAS,6BAC9C00C,EAAS1B,QAAQt/B,GAAGuoB,KAAK,kCAMpC,OAHAxtB,GAAO,4DAGAA,CACX,CAxHQsnC,CAAkBpqC,EAAG+oC,EAAUG,GA0HvC,SAA4B75B,EAAkB05B,EAAoBG,GAE9D,MAAMmB,EAAeh7B,EAAMjH,SAASgJ,UAAWrC,KAAIsC,GAAQA,EAAK/b,OAEhE,IAAIg1C,EAAS,GACbj7B,EAAMjH,SAASgJ,UAAWnD,SAASoD,IAC/Bi5B,GAqRR,SAAaj5B,GACT,OAAOk5B,GAAQ3+B,EAAY1C,IAAemI,EAAKxH,eACnD,CAvRkB2gC,CAAIn5B,GAAQ,GAAG,IAE7Bi5B,EAASA,EAAOG,UAEhB,MAAMC,gBAAEA,EAAeC,UAAEA,GAqNvB,SAAgC5B,GAClC,IAAI2B,EAAkB,IAAI12C,MAA4B+0C,EAAS5B,OAAO9yC,OAAS,GAC/E,IAAK,IAAID,EAAI,EAAGA,EAAIs2C,EAAgBr2C,SAAUD,EAC1Cs2C,EAAgBt2C,GAAK,GAEzB,MAAMu2C,EAAY,IAAIpvC,IACtB,MAAO,CAAEmvC,kBAAiBC,YAC9B,CA5N2CC,CAAsB7B,GAC7D,IAAK,MAAMhhC,KAAKmhC,EACZ2B,GACI9iC,EAAEo/B,OACFp/B,EAAEiJ,cACF3B,EAAMjH,SAASkH,MACfy5B,EACA2B,EAAiBC,GAKzB,MAAMl9B,EA2OJ,SAAyCk9B,GAC3C,MAAMl9B,EAAU,IAAIzZ,MAAc22C,EAAU/pC,MAE5C,OADA+pC,EAAU18B,SAAQ,CAAC/Q,EAAOxE,KAAa+U,EAAQvQ,GAASxE,CAAM,IACvD+U,CACX,CA/OoBq9B,CAA+BH,GACzCI,EAgPJ,SAA0CL,GAC5C,MAAMK,EAA+B,GAQrC,OAPAL,EAAgBz8B,SAAQ+8B,IACpBA,EAAW/8B,SAAQg9B,GACfA,EAAeh9B,SAAQ5a,GACnB03C,EAAmB/zC,KAAK3D,MAE/B,IAEE03C,CACX,CA1P+BG,CAAgCR,GAE3D,MAAO,gDACWS,aAAmBC,8BAClBtB,oCACMS,GAAQvnC,gDACfqoC,mCACMC,iBAAkCjB,EAAa/Z,KAAK,KAAKr6B,QAAQ,MAAO,mFAEnEq1C,cAA+BjB,EAAah2C,wKAKvDk3C,oCACOC,cAAkD,GAAtBnB,EAAah2C,WAAgBi2C,iFAErDkB,cAA4BnB,EAAah2C,iLAKpDo3C,oCACOC,cAAgCj+B,EAAQpZ,WAAWoZ,EAAQ6iB,KAAK,oFAE5Dob,cAAgCj+B,EAAQpZ,mNAM5Bg3C,+DACUE,4DAEtBb,EAAgBr2C,wDACJg3C,iEACCI,uCAC1Bf,EAAgB37B,KAAIza,GAAKA,EAAED,SAAQi8B,KAAK,+BAC7Cya,EAAmBza,KAAK,mGAKvC,CA3LQqb,CAAmB3rC,EAAG+oC,EAAUG,GA6LxC,SAA6B75B,EAAkB65B,GAC3C,IAAIpmC,EAAM,oDACU8oC,aAAoBA,yBAC1BR,aAAuBA,qDACPb,GAAQvnC,iBACxC6oC,GAAST,GAAc/7B,EAAMjH,SAASmH,MAAM,QAU1CzM,GAAO,qBAAqBinC,aAAqBA,uDACjBQ,GAAQvnC,sDACLmoC,gCACdC,MAAgB/7B,EAAMjH,SAASmH,MAAM,GAAGja,mFAG7D,IAAK,IAAIyS,EAAI,EAAGA,EAAImhC,EAAU70C,SAAU0T,EACpCjF,GAAO,8CAA8ComC,EAAUnhC,GAAGzS,2BAA2B4zC,EAAUnhC,GAAGzS,qBAU9G,OAPAwN,GAAO,uHAIPA,GAAO,mEAGAA,CACX,CA7NQgpC,CAAoB9rC,EAAGkpC,GAgOpB,+CACwB0C,+BA9NnC,EFhFA,SAAY3D,GACRA,EAAAA,EAAA,MAAA,GAAA,QACAA,EAAAA,EAAA,QAAA,GAAA,UACAA,EAAAA,EAAA,UAAA,GAAA,WACH,CAJD,CAAYA,KAAAA,GAIX,CAAA,ICJD,SAAYC,GACRA,EAAAA,EAAA,KAAA,GAAA,OACAA,EAAAA,EAAA,aAAA,GAAA,eAEAA,EAAAA,EAAA,MAAA,KAAA,QACAA,EAAAA,EAAA,KAAA,KAAA,OACAA,EAAAA,EAAA,SAAA,KAAA,WACAA,EAAAA,EAAA,SAAA,KAAA,WACAA,EAAAA,EAAA,MAAA,KAAA,QACAA,EAAAA,EAAA,UAAA,KAAA,YACAA,EAAAA,EAAA,aAAA,KAAA,eACAA,EAAAA,EAAA,OAAA,KAAA,SACAA,EAAAA,EAAA,KAAA,KAAA,MACH,CAbD,CAAYA,KAAAA,GAaX,CAAA,ICqED,MAAM0D,GAAY,QACZ7B,GAAa,QACbD,GAAW,GAAGC,UACdC,GAAoB,GAAGF,eACvBG,GAAyB,GAAGD,WAC5BE,GAAmB,GAAGJ,cAEtBsB,GAAe,WAEfD,GAAW,GADQ,GAAGC,MAAgBrB,YAEtCsB,GAAiB,GAAGF,YACpBG,GAAsB,GAAGD,WACzBI,GAAkB,GAAGN,aACrBO,GAAuB,GAAGD,WAC1BF,GAAc,GAAGJ,gBACjBK,GAAmB,GAAGD,iBAoNfvC,GAAbl2C,cACIG,KAAMk0C,OAAa,GACnBl0C,KAAOo0C,QAAe,GACtBp0C,KAAOwa,QAAa,GACZxa,KAAA84C,SAAW,IAAIxwC,GAgE1B,CA9DGkpB,SAAS0iB,EAAkBjqC,SACvB,OAAkC,QAA3BmnC,EAAApxC,KAAK84C,SAAS54C,IAAIg0C,UAAS,IAAA9C,OAAA,EAAAA,EAAAlxC,IAAI+J,EACzC,CAED8uC,SAAS7E,EAAkB8E,GACvB,IAAIF,EAAW94C,KAAK84C,SAAS54C,IAAIg0C,QAChBhyC,IAAb42C,IACAA,EAAW,IAAIxwC,IACftI,KAAK84C,SAAS34C,IAAI+zC,EAAQ4E,IAG9B,IAAIG,EAAWH,EAAS54C,IAAI84C,GAC5B,QAAiB92C,IAAb+2C,EACA,OAAOA,EAGXA,EAAWj5C,KAAKk0C,OAAO9yC,OAAS,EAChC03C,EAAS34C,IAAI64C,EAAWC,GAExB,MAAMC,EAAkB,EAAZF,EACNrqC,EAAI,CAACulC,EAAOgF,GAAMhF,EAAOgF,EAAM,GAAIhF,EAAOgF,EAAM,IAGtD,OAFAl5C,KAAKk0C,OAAOnwC,QAAQ4K,GAEbsqC,CACV,CACDE,UACIn5C,KAAKo0C,QAAQrwC,KAAK,GACrB,CACDq1C,QAAQlF,EAAkBE,EAAmBL,GACzC,MAAMsF,EAAcr5C,KAAKo0C,QAAQp0C,KAAKo0C,QAAQhzC,OAAS,GACvDi4C,EAAYt1C,KAAK/D,KAAK+4C,SAAS7E,EAAQE,EAAQL,KAC/CsF,EAAYt1C,KAAK/D,KAAK+4C,SAAS7E,EAAQE,EAAQL,EAAa,KAC5DsF,EAAYt1C,KAAK/D,KAAK+4C,SAAS7E,EAAQE,EAAQL,EAAa,KAC5DsF,EAAYt1C,KAAK/D,KAAK+4C,SAAS7E,EAAQE,EAAQL,EAAa,IAC/D,CACDuF,QAAQhD,EAAciD,GAClB,MAAMC,EAAoC,EAA/Bx5C,KAAKo0C,QAAQkC,GAAa,EAAPiD,GACxB9/B,EAAwC,EAAnCzZ,KAAKo0C,QAAQkC,GAAa,EAAPiD,EAAW,GACnC3/B,EAAwC,EAAnC5Z,KAAKo0C,QAAQkC,GAAa,EAAPiD,EAAW,GACnC1/B,EAAwC,EAAnC7Z,KAAKo0C,QAAQkC,GAAa,EAAPiD,EAAW,GAEzC,MAAO,CAAC,CACJv5C,KAAKk0C,OAAOsF,GACZx5C,KAAKk0C,OAAOsF,EAAK,GACjBx5C,KAAKk0C,OAAOsF,EAAK,IAErB,CACIx5C,KAAKk0C,OAAOz6B,GACZzZ,KAAKk0C,OAAOz6B,EAAK,GACjBzZ,KAAKk0C,OAAOz6B,EAAK,IAErB,CACIzZ,KAAKk0C,OAAOt6B,GACZ5Z,KAAKk0C,OAAOt6B,EAAK,GACjB5Z,KAAKk0C,OAAOt6B,EAAK,IAErB,CACI5Z,KAAKk0C,OAAOr6B,GACZ7Z,KAAKk0C,OAAOr6B,EAAK,GACjB7Z,KAAKk0C,OAAOr6B,EAAK,IAExB,EASC,SAAU+8B,GAAY1C,EAAkBE,EAAmBqF,EAAoBr4C,EAAgB00C,GACjG,MAAM4D,EAAWD,EAAar4C,EAC9B00C,EAASqD,UAET,IAAK,IAAIh4C,EAAIs4C,EAAYt4C,EAAIu4C,EAAUv4C,GAAK,EACxC20C,EAASsD,QAAQlF,EAAQE,EAASjzC,EAE1C,CAqCgB,SAAAy2C,GAAgC1D,EAAkBn2B,EAC9D47B,EACA7D,EACA2B,EACAC,GAEA35B,EAAezD,MAAMU,SAAQ,CAAC4+B,EAAUC,eCnbXzqC,EAAa2C,EAAa+nC,GACvD,GAAI1qC,EAAEhO,SAAW2Q,EAAE3Q,OACf,MAAMR,MAAM,iCAAiCwO,EAAEhO,cAAc2Q,EAAE3Q,UAEnE,IAAI,IAAID,EAAE,EAAGA,EAAEiO,EAAEhO,SAAUD,EACvB24C,EAAM1qC,EAAEjO,GAAI4Q,EAAE5Q,GAEtB,CD+aQ44C,CAFoBH,EAAS,GACTA,EAAS,IACQ,CAACI,EAAQv0C,KAC1C,MAAMwE,EAAQ6rC,EAAStkB,SAAS0iB,EAAQ8F,GACxC,QAAc93C,IAAV+H,EAEA,OAEJ,IAAIgwC,EAAcvC,EAAUx3C,IAAIuF,QACZvD,IAAhB+3C,IACAA,EAAcvC,EAAU/pC,KACxB+pC,EAAUv3C,IAAIsF,EAAQw0C,IAE1BxC,EAAgBxtC,GAAOlG,KAAK,CAAC41C,EAAQz5C,IAAI25C,GAAW5vC,MAAOgwC,GAAa,GAC1E,GAEV,CAoBA,MAAMlqC,GAAWiG,EAAcC,KAa/B,SAASqhC,GAAQxiC,GACb,MAAMgH,EAAM,CAAC,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,GAAI,EAAG,EAAG,GAAI,IAC/D,IAAIjM,EAAM,GACV,IAAK,IAAI1O,EAAI,EAAGA,EAAI,KAAMA,EAAG,CAEzB0O,GAAO,GADGiF,EAAEgH,EAAI3a,MAEnB,CACD,OAAO0O,EAAI2nC,SACf,CAEA,SAASoB,GAAST,EAAsB/5B,EAAY87B,EAAiB,EAAGC,GAA6B,GACjG,MAAMC,EAoCV,SAAwBF,GACpB,IAAIG,EAAY,GAChB,IAAK,IAAIl5C,EAAI,EAAGA,EAAI+4C,IAAU/4C,EAC1Bk5C,GAAa,KAEjB,OAAOA,CACX,CA1CeC,CAAeJ,GAC1B,IAAIrqC,EAAM,GACVA,GAAO,GAAGuqC,cAAejC,KAAgB/5B,EAAK/b,KAAKW,QAAQ,MAAO,eAAeob,EAAK/b,cAAc+b,EAAK/b,KAAKW,QAAQ,MAAO,wBAC7H6M,GAAO,GAAGuqC,8BAxBd,SAAah8B,GACT,OAAOk5B,GAAQl5B,EAAK3F,gBACxB,CAsB6C8hC,CAAIn8B,gBAC7CvO,GAAO,GAAGuqC,eACVvqC,GAAO,GAAGuqC,uCAEV,MAAMI,EAAwB,IAAIx9B,IAC5BlG,EAAO2jC,EAAmBC,IAAet8B,EAAKxF,SAAWwF,EAAKxH,eACpE,IAAK,IAAI/U,KAASuc,EAAKld,SAAU,CAC7B,MAAMy5C,EAAYF,EAAmBC,IAAe7hC,EAAgB,EAAG,EAAG,EAAG,GAAIhX,EAAM+U,e/FyDrE7E,E+FxDI4oC,E/FyDxBC,SACAC,SACAC,SACAC,SACA/oC,SACAC,SACAC,SACAC,SAPAyoC,GADiBxrC,E+FxDC0H,G/FyDX,GACP+jC,EAAKzrC,EAAE,GACP0rC,EAAK1rC,EAAE,GACP2rC,EAAK3rC,EAAE,GACP4C,EAAKD,EAAE,GACPE,EAAKF,EAAE,GACPG,EAAKH,EAAE,GACPI,EAAKJ,EAAE,GACJvI,KAAKK,IAAI+wC,EAAK5oC,IAAOoB,EAAmB5J,KAAKtE,IAAI,EAAKsE,KAAKK,IAAI+wC,GAAKpxC,KAAKK,IAAImI,KAAQxI,KAAKK,IAAIgxC,EAAK5oC,IAAOmB,EAAmB5J,KAAKtE,IAAI,EAAKsE,KAAKK,IAAIgxC,GAAKrxC,KAAKK,IAAIoI,KAAQzI,KAAKK,IAAIixC,EAAK5oC,IAAOkB,EAAmB5J,KAAKtE,IAAI,EAAKsE,KAAKK,IAAIixC,GAAKtxC,KAAKK,IAAIqI,KAAQ1I,KAAKK,IAAIkxC,EAAK5oC,IAAOiB,EAAmB5J,KAAKtE,IAAI,EAAKsE,KAAKK,IAAIkxC,GAAKvxC,KAAKK,IAAIsI,K+FhEzUqoC,EAAsB53C,IAAIf,EAEjC,C/FqDE,IAAgBuN,EAAG2C,EACpB6oC,EACAC,EACAC,EACAC,EACA/oC,EACAC,EACAC,EACAC,E+FvDF,GAJIgoC,IACAtqC,GAAO,GAAGuqC,2DAEdvqC,GAAO,GAAGuqC,sDACyB,IAA/BI,EAAsB7sC,KAAY,CAClC,MAAMkJ,EAAO4jC,EAAmBC,IAAe7hC,EAAgB,EAAG,EAAG,EAAG,GAAIuF,EAAKxH,eAC3EokC,EAAgBC,EAASP,IAAe5jC,EAAMD,GACpDhH,GAAO,GAAGuqC,0CAA2CY,EAAc,eACnEnrC,GAAO,GAAGuqC,0CAA2CY,EAAc,eACnEnrC,GAAO,GAAGuqC,0CAA2CY,EAAc,cACtE,CACDnrC,GAAO,GAAGuqC,sBACVvqC,GAAO,GAAGuqC,gBACV,IAAK,IAAIv4C,KAASuc,EAAKld,SACnB2O,GAAO+oC,GAAST,EAAct2C,EAAOq4C,EAAS,EAAGM,EAAsBvxC,IAAIpH,IAG/E,OADAgO,GAAO,GAAGuqC,aACHvqC,CACX,OEtgBaqrC,GAUTC,aACI,IAAItrC,EAAMoG,IACNmlC,EAAMnlC,KnGs1BX,SAAuBpG,EAAK6C,GACjC,IAAI3F,EAAIvD,KAAK6J,IAAIX,GACbE,EAAIpJ,KAAK8J,IAAIZ,GAEjB7C,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK+C,EACT/C,EAAI,GAAK9C,EACT8C,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,IAAM9C,EACV8C,EAAI,IAAM+C,EACV/C,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,CAEZ,CmG12BQwrC,CAAmBxrC,EAAK7P,KAAKsS,EAAElS,MAAQ,IAAM,EAAIoJ,KAAKmb,InGu3BvD,SAAuB9U,EAAK6C,GACjC,IAAI3F,EAAIvD,KAAK6J,IAAIX,GACbE,EAAIpJ,KAAK8J,IAAIZ,GAEjB7C,EAAI,GAAK+C,EACT/C,EAAI,GAAK,EACTA,EAAI,IAAM9C,EACV8C,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK9C,EACT8C,EAAI,GAAK,EACTA,EAAI,IAAM+C,EACV/C,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,CAEZ,CmG34BQyrC,CAAmBF,EAAKp7C,KAAKuS,EAAEnS,MAAQ,IAAM,EAAIoJ,KAAKmb,IACtD5L,EAAclJ,EAAKA,EAAKurC,GnGu5BzB,SAAuBvrC,EAAK6C,GACjC,IAAI3F,EAAIvD,KAAK6J,IAAIX,GACbE,EAAIpJ,KAAK8J,IAAIZ,GAEjB7C,EAAI,GAAK+C,EACT/C,EAAI,GAAK9C,EACT8C,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,IAAM9C,EACV8C,EAAI,GAAK+C,EACT/C,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,CAEZ,CmG36BQ0rC,CAAmBH,EAAKp7C,KAAKwS,EAAEpS,MAAQ,IAAM,EAAIoJ,KAAKmb,IACtD5L,EAAclJ,EAAKA,EAAKurC,GACxBp7C,KAAKoe,KAAKrI,QAAUlG,EAEpB7P,KAAKoe,KAAKjJ,SAASgJ,UAAWnD,SAAQoD,GAAQA,EAAKzR,UACtD,CAED6uC,KAAK3B,WACD,GAAI75C,KAAKoe,KAAK/b,OAASw3C,EACnB,OAAO75C,KAEX,MAAMkK,EAAgB,QAATknC,EAAApxC,KAAKkK,YAAI,IAAAknC,OAAA,EAAAA,EAAEoK,KAAK3B,GAC7B,GAAI3vC,EACA,OAAOA,EAEX,MAAM0jB,EAAgB,QAAT6tB,EAAAz7C,KAAK4tB,YAAI,IAAA6tB,OAAA,EAAAA,EAAED,KAAK3B,GAC7B,OAAIjsB,QAAJ,CAIH,CAED/tB,YAAYue,EAAyBlc,UAAWkf,EAAuClf,WAKnF,GAJAlC,KAAKsS,EAAI,IAAIvN,EAAY,EAAG,CAAEE,KAAM,IAAKC,IAAK,IAAKC,KAAM,IACzDnF,KAAKuS,EAAI,IAAIxN,EAAY,EAAG,CAAEE,KAAM,IAAKC,IAAK,IAAKC,KAAM,IACzDnF,KAAKwS,EAAI,IAAIzN,EAAY,EAAG,CAAEE,KAAM,IAAKC,IAAK,IAAKC,KAAM,SAE5CjD,IAATkc,QAAiClc,IAAXkf,EACtB,OAGJ,MAAMzU,EAAS,KACX3M,KAAKm7C,aACL/5B,EAAO5c,QAAQxE,KAAK,EAGxBA,KAAKsS,EAAE3N,SAAS/B,IAAI+J,GACpB3M,KAAKuS,EAAE5N,SAAS/B,IAAI+J,GACpB3M,KAAKwS,EAAE7N,SAAS/B,IAAI+J,GAEpB3M,KAAKoe,KAAOA,EAyBZA,EAAKld,SAAS8Z,SAAQ0gC,IAClB,QAAkBx5C,IAAdlC,KAAK4tB,KACL5tB,KAAK4tB,KAAO,IAAIstB,GAASQ,EAAWt6B,OACjC,CACH,MAAMlX,EAAOlK,KAAK4tB,KAClB5tB,KAAK4tB,KAAO,IAAIstB,GAASQ,EAAWt6B,GACpCphB,KAAK4tB,KAAK1jB,KAAOA,CACpB,IAER,EAzFMgxC,GAAKh3C,MAAG,EA6Fb,MAAOy3C,WAAwBtO,GAEjCxtC,YAAYuiB,GACRnhB,MAAMmhB,GACNpiB,KAAKi3B,OAAOgC,cAAe,CAC9B,CAEYhB,eACT,OAAO,CACV,CAEQqB,SAASC,EAAeC,GAC7B,QAAmBt3B,IAAflC,KAAKoiB,MAEL,YADAvZ,QAAQC,IAAI,YAGhB,MAAM6kB,EAAO3tB,KAAKoiB,MAAMipB,KAAK9R,EAAIf,KAAK7K,KACtC,OAAQ4L,EAAIhB,KACR,KAAK,EACDv4B,KAAKstC,SAAS/T,EAAKC,EAAM7L,EAAKvP,KAAK/b,MACnC,MACJ,KAAK,EACD,MAAMiQ,EAAIgX,EAAAsyB,EAAA,CAAA16C,SAAA,CACNqnB,EAACrB,GAAK,CAAA9E,MAAOuL,EAAKrb,EAAGnP,MAAO,CAAEqmB,MAAO,UACrCjB,EAACrB,GAAI,CAAC9E,MAAOuL,EAAKpb,EAAGpP,MAAO,CAAEqmB,MAAO,UACrCjB,EAACrB,GAAK,CAAA9E,MAAOuL,EAAKnb,EAAGrP,MAAO,CAAEqmB,MAAO,aAEzCgQ,EAAKmG,mBAAmBrtB,GAGnC,EC7HC,MAAOupC,WAA0BxO,GACnCxtC,YAAYuiB,GACRnhB,MAAMmhB,GACNpiB,KAAKi3B,OAAOgC,cAAe,CAC9B,CAEYhB,eACT,OAAO,CACV,CAEQqB,SAASC,EAAeC,GAC7B,QAAmBt3B,IAAflC,KAAKoiB,MAEL,YADAvZ,QAAQC,IAAI,YAGhB,MAAM6kB,EAAO3tB,KAAKoiB,MAAMipB,KAAK9R,EAAIf,KAAK7K,KACtC,OAAQ4L,EAAIhB,KACR,KAAK,EACDv4B,KAAKstC,SAAS/T,EAAKC,EAAM7L,EAAK7C,OAC9B,MACJ,KAAK,EACD,GAAI6C,EAAKvL,MAAO,CACZ,MAAM9P,EAAIgX,EAAAsyB,EAAA,CAAA16C,SAAA,CACNqnB,EAACrB,IAAK9E,MAAOuL,EAAKvL,MAAOjf,MAAO,CAAEqmB,MAAO,UACzCjB,EAACkJ,GAAM,CAACrP,MAAOuL,EAAKvL,MAAOjf,MAAO,CAACqmB,MAAO,cAE9CgQ,EAAKmG,mBAAmBrtB,EAC3B,EAGZ,QCvCiBwpC,GAYlBj8C,YAAYk8C,EAA4BC,EAAyBC,GAC7D,MAAMC,EAAUH,EAAGI,gBACnB,GAAgB,OAAZD,EACA,MAAMt7C,MAAM,iCAEhB,MAAMw7C,EAAeN,GAAeO,cAAcN,EAAIA,EAAGO,cAAeN,GAClEO,EAAiBT,GAAeO,cAAcN,EAAIA,EAAGS,gBAAiBP,GAK5E,GAJAF,EAAGU,aAAaP,EAASE,GACzBL,EAAGU,aAAaP,EAASK,GACzBR,EAAGW,YAAYR,IAEVH,EAAGY,oBAAoBT,EAASH,EAAGa,aACpC,MAAMh8C,MAAM,sCAAsCm7C,EAAGc,kBAAkBX,MAE3El8C,KAAK+7C,GAAKA,EACV/7C,KAAKk8C,QAAUA,EAEfl8C,KAAK88C,eAAiBf,EAAGgB,kBAAkB/8C,KAAKk8C,QAAS,mBACzDl8C,KAAKg9C,aAAejB,EAAGgB,kBAAkB/8C,KAAKk8C,QAAS,iBAEvDl8C,KAAKi9C,iBAAmBnB,GAAeoB,mBAAmBnB,EAAI/7C,KAAKk8C,QAAS,qBAC5El8C,KAAKm9C,gBAAkBrB,GAAeoB,mBAAmBnB,EAAI/7C,KAAKk8C,QAAS,oBAC3El8C,KAAKo9C,aAAetB,GAAeoB,mBAAmBnB,EAAI/7C,KAAKk8C,QAAS,gBAC3E,CAEDl5B,KAAKoxB,EAAsBiJ,EAAuBC,EAAuBnJ,GACrE,MAAyB3zC,EAAOR,KAAK+7C,GAAGwB,MACxCv9C,KAAK+7C,GAAGyB,WAAWx9C,KAAK+7C,GAAG0B,aAAcJ,GACzCr9C,KAAK+7C,GAAG2B,oBAAoB19C,KAAK88C,eAFX,EAE0Ct8C,EAFL,MAAgB,EAAY,GAGvFR,KAAK+7C,GAAG4B,wBAAwB39C,KAAK88C,gBAErC98C,KAAK+7C,GAAGyB,WAAWx9C,KAAK+7C,GAAG0B,aAAcH,GACzCt9C,KAAK+7C,GAAG2B,oBAAoB19C,KAAKg9C,aANX,EAMwCx8C,EANH,MAAgB,EAAY,GAOvFR,KAAK+7C,GAAG4B,wBAAwB39C,KAAKg9C,cAErCh9C,KAAK+7C,GAAGyB,WAAWx9C,KAAK+7C,GAAG6B,qBAAsBxJ,EACpD,CAED1tB,KAAKu2B,EAAwBE,EAAuBC,GAChDp9C,KAAK+7C,GAAG8B,WAAW79C,KAAKk8C,SACxBl8C,KAAK+7C,GAAG+B,iBAAiB99C,KAAKi9C,kBAAkB,EAAOA,GACvDj9C,KAAK+7C,GAAG+B,iBAAiB99C,KAAKm9C,iBAAiB,EAAOA,GACtDn9C,KAAK+7C,GAAG+B,iBAAiB99C,KAAKo9C,cAAc,EAAOA,EACtD,CAEDzyC,qBAAqBoxC,EAA4Bv7C,EAAcu9C,GAC3D,MAAMC,EAASjC,EAAGkC,aAAaz9C,GAC/B,GAAe,OAAXw9C,EACA,MAAMp9C,MAAM,gCAGhB,GAFAm7C,EAAGmC,aAAaF,EAAQD,GACxBhC,EAAGM,cAAc2B,IACZjC,EAAGoC,mBAAmBH,EAAQjC,EAAGqC,gBAElC,MADArC,EAAGsC,aAAaL,GACVp9C,MAAM,mCAAmCJ,kBAAqBu7C,EAAGuC,iBAAiBN,MAE5F,OAAOA,CACV,CAEDrzC,0BAA0BoxC,EAA4BG,EAAuB75C,GACzE,MAAMk8C,EAAWxC,EAAGmB,mBAAmBhB,EAAS75C,GAChD,GAAiB,OAAbk8C,EACA,MAAM39C,MAAM,sDAAsDyB,KACtE,OAAOk8C,CACV,EC3EC,MAAOC,WAAmB1C,GAE5Bj8C,YAAYk8C,GACR96C,MAAM86C,EAAI0C,GAAqBC,IAC/B1+C,KAAK2+C,OAAS7C,GAAeoB,mBAAmBnB,EAAI/7C,KAAKk8C,QAAS,SACrE,CAED0C,MAAMC,GACF7+C,KAAK+7C,GAAG+C,WAAW9+C,KAAK2+C,OAAQE,EACnC,EAEL,MAAMJ,GAAsB,+5BA8BtBC,GAAwB,uKCzCxB,MAAOK,WAAsBjD,GAE/Bj8C,YAAYk8C,GACR96C,MAAM86C,EAAIiD,GAAwBC,IAClCj/C,KAAKk/C,aAAenD,EAAGgB,kBAAkB/8C,KAAKk8C,QAAS,iBACvDl8C,KAAKm/C,SAAWpD,EAAGmB,mBAAmBl9C,KAAKk8C,QAAS,WACvD,CAGD/H,QAAQA,GACJn0C,KAAK+7C,GAAGqD,cAAcp/C,KAAK+7C,GAAGsD,UAC9Br/C,KAAK+7C,GAAGuD,YAAYt/C,KAAK+7C,GAAGwD,WAAYpL,GACxCn0C,KAAK+7C,GAAGyD,UAAUx/C,KAAKm/C,SAAU,EACpC,CACQn8B,KAAKoxB,EAAsBiJ,EAAuBC,EAAuBnJ,GAE9E,GADAlzC,MAAM+hB,KAAKoxB,EAASiJ,EAAUC,EAAUnJ,GACpCA,EAAS,CACT,MAAMsL,EAAM,EACNj/C,EAAOR,KAAK+7C,GAAGwB,MACflpC,GAAY,EACZqrC,EAAS,EACTC,EAAS,EACf3/C,KAAK+7C,GAAGyB,WAAWx9C,KAAK+7C,GAAG0B,aAActJ,GACzCn0C,KAAK+7C,GAAG2B,oBACJ19C,KAAKk/C,aACLO,EACAj/C,EACA6T,EACAqrC,EACAC,GAEJ3/C,KAAK+7C,GAAG4B,wBAAwB39C,KAAKk/C,aACxC,CACJ,EAEL,MAAMF,GAAyB,g8BA2BzBC,GAA2B,yPC9DjB,SAAAW,GAAiB1L,EAAkBE,GAE/C,SAASyL,EAAU51C,EAAeyM,GAC9BopC,EAAQ71C,IAAUyM,EAAO,GACzBopC,EAAQ71C,EAAQ,IAAMyM,EAAO,GAC7BopC,EAAQ71C,EAAQ,IAAMyM,EAAO,EAChC,CAED,MAAMopC,EAAU,IAAI/+C,MAAcmzC,EAAO9yC,QACzC0+C,EAAQ1kC,KAAK,GAGb,IAAK,IAAIja,EAAI,EAAGA,EAAIizC,EAAQhzC,QAAS,CACjC,MAAM2+C,EAAoB,EAAf3L,EAAQjzC,KACb6+C,EAAoB,EAAf5L,EAAQjzC,KACb8+C,EAAoB,EAAf7L,EAAQjzC,KAEbsY,EAAKjD,EAAgB09B,EAAO6L,GAAK7L,EAAO6L,EAAK,GAAI7L,EAAO6L,EAAK,IAC7DnmC,EAAKpD,EAAgB09B,EAAO8L,GAAK9L,EAAO8L,EAAK,GAAI9L,EAAO8L,EAAK,IAC7DnmC,EAAKrD,EAAgB09B,EAAO+L,GAAK/L,EAAO+L,EAAK,GAAI/L,EAAO+L,EAAK,IAE7DhvB,EAAIha,IACVD,EAAcia,EAAGrX,EAAIH,GAErB,MAAMpH,EAAI4E,IACVD,EAAc3E,EAAGwH,EAAIJ,GAErB,MAAMoe,EAAI5gB,IACVI,EAAWwgB,EAAG5G,EAAG5e,GAEjBwtC,EAAUE,EAAIloB,GACdgoB,EAAUG,EAAInoB,GACdgoB,EAAUI,EAAIpoB,EACjB,CAGD,IAAI,IAAIqoB,EAAc,EAAGA,EAAchM,EAAO9yC,OAAQ8+C,GAAe,EAAG,CACpE,MAAMxpC,EAASF,EAAgBspC,EAAQI,GAAcJ,EAAQI,EAAc,GAAIJ,EAAQI,EAAc,IACrGhpC,EAAeR,EAAQA,GACvBopC,EAAQI,GAAexpC,EAAO,GAC9BopC,EAAQI,EAAc,GAAKxpC,EAAO,GAClCopC,EAAQI,EAAc,GAAKxpC,EAAO,EACrC,CACD,OAAOopC,CACX,OCxCaK,GAQTtgD,YAAYk8C,EAA4B7H,EAAkBjqC,EAAiBkqC,GACvEn0C,KAAK+7C,GAAKA,EACV/7C,KAAKk0C,OAASl0C,KAAKogD,aAAarE,EAAG0B,aAAc1B,EAAGsE,YAAa1wC,aAAcukC,GAC/El0C,KAAKo0C,QAAUp0C,KAAKogD,aAAarE,EAAG6B,qBAAsB7B,EAAGsE,YAAaC,YAAar2C,GACvFjK,KAAK0W,OAAS1W,KAAKogD,aAAarE,EAAG0B,aAAc1B,EAAGsE,YAAa1wC,aAAciwC,GAAiB1L,EAAQjqC,SACxF/H,IAAZiyC,IACAn0C,KAAKm0C,QAAUn0C,KAAKogD,aAAarE,EAAG0B,aAAc1B,EAAGsE,YAAa1wC,aAAcwkC,IAEpFn0C,KAAKoB,OAAS6I,EAAM7I,MACvB,CAEDuL,OAAOunC,EAAkBjqC,GACrBjK,KAAKugD,aAAavgD,KAAKk0C,OAAQl0C,KAAK+7C,GAAG0B,aAAcz9C,KAAK+7C,GAAGsE,YAAa1wC,aAAcukC,GACxFl0C,KAAKugD,aAAavgD,KAAK0W,OAAQ1W,KAAK+7C,GAAG0B,aAAcz9C,KAAK+7C,GAAGsE,YAAa1wC,aAAciwC,GAAiB1L,EAAQjqC,GACpH,CAEDu2C,KAAKC,EAA6Bl5B,GAC9BvnB,KAAKgjB,KAAKy9B,GACVzgD,KAAK0gD,WAAWn5B,EAAM,EAAGvnB,KAAKoB,OACjC,CAED4hB,KAAKy9B,GACDA,EAAYz9B,KAAKhjB,KAAKo0C,QAASp0C,KAAKk0C,OAAQl0C,KAAK0W,OAAQ1W,KAAKm0C,QACjE,CAEDuM,WAAWn5B,EAAco4B,EAAgBv+C,GACrCpB,KAAK+7C,GAAG4E,aAAap5B,EAAMnmB,EAAQpB,KAAK+7C,GAAG6E,eAAgBjB,EAC9D,CAESS,aAAa/wC,EAAgBwxC,EAAergD,EAAwD+D,GAC1G,MAAMu8C,EAAS9gD,KAAK+7C,GAAGqE,eACvB,GAAe,OAAXU,EACA,MAAMlgD,MAAM,oCAEhB,OADAZ,KAAKugD,aAAaO,EAAQzxC,EAAQwxC,EAAOrgD,EAAM+D,GACxCu8C,CACV,CAESP,aAAaO,EAAqBzxC,EAAgBwxC,EAAergD,EAAwD+D,GAG/H,OAFAvE,KAAK+7C,GAAGyB,WAAWnuC,EAAQyxC,GAC3B9gD,KAAK+7C,GAAGgF,WAAW1xC,EAAQ,IAAI7O,EAAK+D,GAAOs8C,GACpCC,CACV,EC7CL,IAAIE,GAAe,WAEHC,GAAOC,EAA2B9kC,EAAkBmL,GAChE,MAAMw0B,EAAMmF,EAAOC,WAAW,WAAaD,EAAOC,WAAW,sBAC7D,GAAU,MAANpF,EACA,MAAMn7C,MAAM,2EAGhBm7C,EAAGqF,YAAYrF,EAAGsF,qBAAqB,GAEvC,MAAMC,EAAc,IAAI9C,GAAWzC,GAC7BwF,EAAa,IAAIxC,GAAchD,GAE/ByF,EAkPV,SAA0BzF,EAA4B3/B,GAClD,MAAMqlC,GAAEA,EAAEC,GAAEA,EAAEC,GAAEA,EAAEC,cAAEA,GAAkBC,GAAUzlC,GAC1ChO,EAAO,IAAI+xC,GAAWpE,EAAI0F,EAAIC,EAAIC,GAClCG,EA6GV,SAAoC/F,GAyBhC,OAAO,IAAIoE,GAAWpE,EAxBJ,EAEb,GAAM,EAAK,EAAK,GAAM,EAAK,EAAK,EAAK,EAAK,GAAM,EAAK,EAAK,GAE1D,GAAM,GAAM,GAAM,EAAK,GAAM,EAAK,EAAK,GAAM,EAAK,GAAM,GAAM,GAE9D,EAAK,GAAM,GAAM,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,GAAM,GAE1D,GAAM,GAAM,EAAK,GAAM,GAAM,EAAK,GAAM,EAAK,GAAM,GAAM,EAAK,EAE/D,GAAM,GAAM,EAAK,EAAK,GAAM,EAAK,EAAK,EAAK,EAAK,GAAM,EAAK,GAE1D,GAAM,GAAM,GAAM,GAAM,EAAK,GAAM,EAAK,EAAK,GAAM,EAAK,GAAM,GAGnD,CACZ,EAAG,EAAG,EAAG,EAAG,EAAG,EACf,EAAG,EAAG,EAAG,EAAG,EAAG,EACf,EAAG,EAAG,GAAI,EAAG,GAAI,GACjB,GAAI,GAAI,GAAI,GAAI,GAAI,GACpB,GAAI,GAAI,GAAI,GAAI,GAAI,GACpB,GAAI,GAAI,GAAI,GAAI,GAAI,IAGsB,CAE1C,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAEnC,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAEnC,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAEnC,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAEnC,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAEnC,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,GAG3C,CArJoBgG,CAA2BhG,GAE3C,IAAI5G,EAAU,IAAI7sC,IAKlB,OAJA8T,EAAM+4B,QAAQn6B,SAAQ,CAACg7B,EAAO3zC,KAC1B8yC,EAAQh1C,IAAIkC,EAAM,IAAI89C,GAAWpE,EAAI/F,EAAMK,UAAUj6B,EAAMo5B,cAAeQ,EAAMM,KAAKlC,SAAS,IAG3F,CAAEhmC,OAAM0zC,UAASF,gBAAezM,UAC3C,CA7PoB6M,CAAiBjG,EAAI3/B,GAC/B+3B,EAgSV,SAAqB4H,EAA2BkG,GAC5C,MAAM9N,EAAU4H,EAAGmG,gBACnBnG,EAAGuD,YAAYvD,EAAGwD,WAAYpL,GAO9B,MAAMr+B,EAAQ,EACRqsC,EAAiBpG,EAAGqG,KACpB54B,EAAQ,EACR7jB,EAAS,EACT62B,EAAS,EACT6lB,EAAYtG,EAAGqG,KACfE,EAAUvG,EAAGwG,cACbC,EAAQ,IAAIC,WAAW,CAAC,EAAG,EAAG,IAAK,MACzC1G,EAAG2G,WACC3G,EAAGwD,WACHzpC,EACAqsC,EACA34B,EACA7jB,EACA62B,EACA6lB,EACAC,EACAE,GAGJ,MAAMG,EAAQ,IAAIC,MA6BlB,OA5BAD,EAAME,OAAS,KACXh6C,QAAQC,IAAI,YAAYm5C,sBACxBlG,EAAGuD,YAAYvD,EAAGwD,WAAYpL,GAC9B4H,EAAG2G,WACC3G,EAAGwD,WACHzpC,EACAqsC,EACAE,EACAC,EACAK,GAMAG,GAAWH,EAAMn5B,QAAUs5B,GAAWH,EAAMh9C,QAE5Co2C,EAAGgH,eAAehH,EAAGwD,aAIrBxD,EAAGiH,cAAcjH,EAAGwD,WAAYxD,EAAGkH,eAAgBlH,EAAGmH,eACtDnH,EAAGiH,cAAcjH,EAAGwD,WAAYxD,EAAGoH,eAAgBpH,EAAGmH,eACtDnH,EAAGiH,cAAcjH,EAAGwD,WAAYxD,EAAGqH,mBAAoBrH,EAAGsH,QAC7D,EAELV,EAAM/uB,IAAMquB,EAEL9N,CACX,CA3VoBmP,CAAYvH,EAAI,+DAEhC,IAAIwH,EAAO,EAgBX7/B,uBAbA,SAASu9B,EAAOxd,GAEZ,MAAM+f,GADN/f,GAAO,MACiB8f,EACxBA,EAAO9f,EAEHrnB,EAAMg5B,iBAAmBL,GAAOM,MAoP5C,SAAuBj5B,EAAkBolC,GACrCplC,EAAMzP,SAEN,MAAM80C,GAAEA,EAAEC,GAAEA,GAAOG,GAAUzlC,GAC7BolC,EAAQpzC,KAAKzB,OAAO80C,EAAIC,GAExBF,EAAQrM,QAAQn6B,SAAQ,CAACyoC,EAAYphD,KACjC,MAAM2zC,EAAQ55B,EAAM+4B,QAAQj1C,IAAImC,GAC1BozC,EAAgBO,EAAMK,UAAUj6B,EAAMq5B,eACtC13B,EAAgBi4B,EAAMO,iBAAiBn6B,EAAMjH,SAAS4I,eACtDy3B,EAAep5B,EAAMjH,SAASwJ,SAAS82B,EAAe13B,EAAezD,OAC3EmpC,EAAW92C,OAAO6oC,EAAcQ,EAAMM,KAAKlC,QAAQ,GAE3D,CAhQYsP,CAActnC,EAAOolC,GAUjC,SACIzF,EACAuF,EACAC,EACApN,EACAqN,EACAgC,EACApnC,EACAunC,GAEA,MAAMzC,EAASnF,EAAGmF,QA6ItB,SAAuBA,GACfA,EAAO13B,QAAU03B,EAAOlsB,aAAeksB,EAAOv7C,SAAWu7C,EAAOpsB,eAChEosB,EAAO13B,MAAQ03B,EAAOlsB,YACtBksB,EAAOv7C,OAASu7C,EAAOpsB,aAE/B,EAjJI8uB,CAAc1C,GAmJlB,SAAyBnF,EAA4BmF,GACjDnF,EAAG8H,SAAS,EAAG,EAAG3C,EAAO13B,MAAO03B,EAAOv7C,QACvCo2C,EAAG+H,WAAW,EAAK,EAAK,EAAK,GAC7B/H,EAAGgI,WAAW,GACdhI,EAAGiI,OAAOjI,EAAGkI,YACblI,EAAGmI,UAAUnI,EAAGoI,QAChBpI,EAAGh5B,MAAMg5B,EAAGqI,iBAAmBrI,EAAGsI,iBACtC,CAzJIC,CAAgBvI,EAAImF,GACpB,MAAMjE,EAsKV,SAAgCiE,GAC5B,MAAMqD,EAAc,GAAK/6C,KAAKmb,GAAK,IAC7BhR,EAASutC,EAAO13B,MAAQ03B,EAAOv7C,OAC/B6+C,EAAQ,GACRC,EAAO,IACPxH,EAAmBhnC,IAEzB,OADAyuC,EAAiBzH,EAAkBsH,EAAa5wC,EAAQ6wC,EAAOC,GACxDxH,CACX,CA9K6B0H,CAAuBzD,GAC1C/D,EAyJV,SAA+BwG,GAC3B,MAAMxG,EAAkBlnC,IACpB0tC,IAAe3O,GAAW4P,OAC1BC,EAAe1H,EAAiBA,EAAiB,CAAC,GAAM,GAAM,IAC9D2H,EAAY3H,EAAiBA,GAAkB3zC,KAAKmb,GAAK,EAAG,CAAC,EAAG,EAAG,MAEnEkgC,EAAe1H,EAAiBA,EAAiB,EAAE,EAAK,GAAM,KAC9D2H,EAAY3H,EAAiBA,EAAgC,GAAf6D,GAAmB,CAAC,EAAG,EAAG,KAE5E,OAAO7D,CACX,CAnK4B4H,CAAsBpB,GACxCvG,EA8KV,SAA4BD,GACxB,MAAMC,EAAennC,IAGrB,OAFA0C,EAAYykC,EAAcD,G1G5BvB,SAAmBttC,EAAKT,GAE7B,GAAIS,IAAQT,EAAG,CACb,IAAIc,EAAMd,EAAE,GACRe,EAAMf,EAAE,GACRgB,EAAMhB,EAAE,GACRmB,EAAMnB,EAAE,GACRoB,EAAMpB,EAAE,GACRwB,EAAMxB,EAAE,IACZS,EAAI,GAAKT,EAAE,GACXS,EAAI,GAAKT,EAAE,GACXS,EAAI,GAAKT,EAAE,IACXS,EAAI,GAAKK,EACTL,EAAI,GAAKT,EAAE,GACXS,EAAI,GAAKT,EAAE,IACXS,EAAI,GAAKM,EACTN,EAAI,GAAKU,EACTV,EAAI,IAAMT,EAAE,IACZS,EAAI,IAAMO,EACVP,EAAI,IAAMW,EACVX,EAAI,IAAMe,CACd,MACIf,EAAI,GAAKT,EAAE,GACXS,EAAI,GAAKT,EAAE,GACXS,EAAI,GAAKT,EAAE,GACXS,EAAI,GAAKT,EAAE,IACXS,EAAI,GAAKT,EAAE,GACXS,EAAI,GAAKT,EAAE,GACXS,EAAI,GAAKT,EAAE,GACXS,EAAI,GAAKT,EAAE,IACXS,EAAI,GAAKT,EAAE,GACXS,EAAI,GAAKT,EAAE,GACXS,EAAI,IAAMT,EAAE,IACZS,EAAI,IAAMT,EAAE,IACZS,EAAI,IAAMT,EAAE,GACZS,EAAI,IAAMT,EAAE,GACZS,EAAI,IAAMT,EAAE,IACZS,EAAI,IAAMT,EAAE,GAIhB,C0GZI41C,CAAe5H,EAAcA,GACtBA,CACX,CAnLyB6H,CAAmB9H,GASxC,IAAI+H,EA0EAC,EAzEJ,OARA7D,EAAY56B,KAAKu2B,EAAkBE,EAAiBC,GAMpDoE,EAAQpzC,KAAK4U,KAAKs+B,GAEVqC,GACJ,KAAK3O,GAAWoQ,QACZF,EAAO,CAACjQ,GAAciB,KAAM,CAAC,EAAK,GAAK,GAAK,GAAI6F,EAAGsJ,WACnD,MACJ,KAAKrQ,GAAW4P,MAChB,KAAK5P,GAAWsQ,UACZJ,EAAO,CAACjQ,GAAciB,KAAM,CAAC,GAAS,IAAS,GAAM,EAAG,GAAI6F,EAAGwJ,OAC/D,MACJ,QACI,MAAM3kD,MAAM,uBAAuB+iD,KAG3C,IAAK,IAAIrxC,IAAK,CACV4yC,EACA,CAACjQ,GAAckB,SAAU,CAAC,EAAK,GAAK,EAAG,GAAI4F,EAAGsJ,WAC9C,CAACpQ,GAAcmB,SAAU,CAAC,EAAK,GAAK,EAAG,GAAI2F,EAAGsJ,WAC9C,CAACpQ,GAAcuQ,UAAW,CAAC,EAAK,EAAK,EAAG,GAAIzJ,EAAGsJ,WAC/C,CAACpQ,GAAcwQ,aAAc,CAAC,EAAK,EAAK,EAAG,GAAI1J,EAAGsJ,WAClD,CAACpQ,GAAcuB,OAAQ,CAAC,EAAK,EAAK,EAAG,GAAIuF,EAAGsJ,WAC5C,CAACpQ,GAAcyQ,KAAM,CAAC,EAAK,EAAK,GAAK,GAAI3J,EAAG4J,aAC7C,CACC,MAAM11B,EAAM3d,EAAE,GACRusC,EAAOvsC,EAAE,GACTiV,EAAOjV,EAAE,GAEf,GAAI2d,IAAQglB,GAAciB,MAAQyN,IAAe3O,GAAWoQ,QACxD,SAGJ,GAAIn1B,IAAQglB,GAAciB,MAAQsL,EAAQrM,QAAQlsC,IAAI,eAClD,SAEJ,IAAKgnB,IAAQglB,GAAckB,UAAYlmB,IAAQglB,GAAcmB,WAAaoL,EAAQrM,QAAQlsC,IAAI,QAC1F,SAEJ,IAAKgnB,IAAQglB,GAAcuQ,WAAav1B,IAAQglB,GAAcwQ,eAAiBjE,EAAQrM,QAAQlsC,IAAI,SAC/F,SAEJ,GAAIgnB,IAAQglB,GAAcuB,QAAUgL,EAAQrM,QAAQlsC,IAAI,UACpD,SAGJq4C,EAAY1C,MAAMC,GAClB,IAAIc,EAAiD,EAAxCvjC,EAAMm5B,SAAS9nC,OAAOwiB,GAAK8jB,WACpC3yC,EAASgb,EAAMm5B,SAAS9nC,OAAOwiB,GAAK7uB,OAExCogD,EAAQpzC,KAAKsyC,WAAWn5B,EAAMo4B,EAAQv+C,EACzC,CAKD,GAAIuiD,IAAe3O,GAAWoQ,QAAS,CACnC9D,EAAY1C,MAAM,CAAC,EAAG,EAAG,EAAG,IAC5B,MAAMe,EAAS6B,EAAQI,cACjB19C,EAA2C,EAAnCkY,EAAMjH,SAASgJ,UAAW/c,OACxCogD,EAAQpzC,KAAKsyC,WAAW3E,EAAGwJ,MAAO5F,EAAQz7C,EAC7C,CAKD,GAAIy/C,IAAe3O,GAAWoQ,QAAS,CACnC9D,EAAY1C,MAAM,CAAC,EAAG,EAAG,EAAG,IAC5B,MAAMe,EAA+C,EAAtCvjC,EAAMm5B,SAAS9nC,OAAO,GAAGsmC,WAClC7vC,EAA0C,IAAlCkY,EAAMm5B,SAAS9nC,OAAO,GAAGrM,OACvCogD,EAAQpzC,KAAKsyC,WAAW3E,EAAGsJ,UAAW1F,EAAQz7C,EACjD,CAOD,OAAQy/C,GACJ,KAAK3O,GAAWoQ,QACZD,EAASpJ,EAAGsJ,UACZ,MACJ,KAAKrQ,GAAWsQ,UAChB,KAAKtQ,GAAW4P,MACZO,EAASpJ,EAAGwJ,MA8BpB,GA1BA/D,EAAQrM,QAAQn6B,SAAQ,CAACyoC,EAAYphD,KACjC,IAAIw8C,EAAiB,CAAC,GAAK,GAAK,GAAK,GACrC,OAAQx8C,GACJ,IAAK,cACDw8C,EAAO,CAAC,EAAK,GAAK,GAAK,GACnB8E,IAAe3O,GAAWsQ,YAC1BzG,EAAO,CAACA,EAAK,GAAK,EAAGA,EAAK,GAAK,EAAGA,EAAK,GAAK,EAAG,IAEnD,MACJ,IAAK,OACDA,EAAO,CAAC,EAAK,GAAK,EAAG,GACrB,MACJ,IAAK,QACDA,EAAO,CAAC,EAAK,EAAK,EAAK,GACvB,MACJ,IAAK,SACDA,EAAO,CAAC,EAAK,EAAK,EAAG,GAG7ByC,EAAY1C,MAAMC,GAClB4E,EAAWjD,KAAKc,EAAa6D,EAAO,IAMpCxB,IAAe3O,GAAWsQ,UAAW,CAErC/D,EAAW76B,KAAKu2B,EAAkBE,EAAiBC,GACnDmE,EAAWpN,QAAQA,GAInB,IAAIwL,EAAgE,EAAvDvjC,EAAMm5B,SAAS9nC,OAAOwnC,GAAciB,MAAMnC,WACnD3yC,EAASgb,EAAMm5B,SAAS9nC,OAAOwnC,GAAciB,MAAM90C,OACvDogD,EAAQpzC,KAAK4U,KAAKu+B,GAClBC,EAAQpzC,KAAKsyC,WAAW3E,EAAGsJ,UAAW1F,EAAQv+C,EACjD,CAED4/C,IAAgBwC,CACpB,CA5JQoC,CAAU7J,EAAIuF,EAAaC,EAAYpN,EAASqN,EAASgC,EAAWpnC,EAAOmL,EAAKnnB,OAEhFsjB,sBAAsBu9B,EACzB,GAEL,CA0PA,SAASY,GAAUzlC,GACf,IAAIjH,EApDR,SAA8BiH,GAC1B,MAAMlD,EAAOkD,EAAMjH,SACb9C,EAAIwG,EAAgB,EAAG,EAAG,EAAG,GAC7Bq7B,EAAS,IAAInzC,MAAuC,EAAzBmY,EAAKiF,UAAW/c,QAC3CgzC,EAAU,IAAIrzC,MAAuC,EAAzBmY,EAAKiF,UAAW/c,QAgBlD,OAfA8X,EAAKiF,UAAWnD,SAAQ,CAACoD,EAAMnU,KAC3B,MAAM6K,EAAIsJ,EAAKtF,cAAgBsF,EAAKtF,cAAgBsF,EAAKxH,cACnDxH,EAAIqrC,EAAmBC,IAAeroC,EAAGyC,GACzC/C,EAAI0oC,EAAmBC,IAAet8B,EAAKxF,SAAW9D,GACtD+wC,EAAa,EAAR57C,EACL67C,EAAa,EAAR77C,EACXiqC,EAAO2R,GAAMz2C,EAAE,GACf8kC,EAAO2R,EAAK,GAAKz2C,EAAE,GACnB8kC,EAAO2R,EAAK,GAAKz2C,EAAE,GACnB8kC,EAAO2R,EAAK,GAAK9zC,EAAE,GACnBmiC,EAAO2R,EAAK,GAAK9zC,EAAE,GACnBmiC,EAAO2R,EAAK,GAAK9zC,EAAE,GACnBqiC,EAAQ0R,GAAc,EAAR77C,EACdmqC,EAAQ0R,EAAK,GAAa,EAAR77C,EAAY,CAAC,IAE5B,CAAEiqC,SAAQE,UACrB,CA+BmB2R,CAAqB3pC,GAEhCqlC,EAAKrlC,EAAMo5B,aACXkM,EAAKtlC,EAAMm5B,SAASnB,QACpBuN,EAAKvlC,EAAMm5B,SAASpB,QAExB,MAAMyN,EAA4B,EAAZF,EAAGtgD,OAEnB4kD,EAAe5pC,EAAMo5B,aAAap0C,OAAS,EAGjD,OAFAqgD,EAAKA,EAAGxzC,OAAOkH,EAAS++B,QACxBwN,EAAKA,EAAGzzC,OAAOkH,EAASi/B,QAAQt4B,KAAIzJ,GAAKA,EAAI2zC,KACtC,CAAEvE,KAAIC,KAAIC,KAAIC,gBACzB,CAmEA,SAASkB,GAAW1iD,GAChB,OAAiC,IAAzBA,EAASA,EAAQ,EAC7B,CCzVA,IAAI6lD,GAAKxD,WAAYyD,GAAM5F,YAAa6F,GAAMC,YAE1CC,GAAO,IAAIJ,GAAG,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAgB,EAAG,EAAoB,IAG1IK,GAAO,IAAIL,GAAG,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAiB,EAAG,IAEjIM,GAAO,IAAIN,GAAG,CAAC,GAAI,GAAI,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,KAE7EO,GAAO,SAAUC,EAAIjjC,GAErB,IADA,IAAIzR,EAAI,IAAIm0C,GAAI,IACP/kD,EAAI,EAAGA,EAAI,KAAMA,EACtB4Q,EAAE5Q,GAAKqiB,GAAS,GAAKijC,EAAGtlD,EAAI,GAGhC,IAAI0rC,EAAI,IAAIsZ,GAAIp0C,EAAE,KAClB,IAAS5Q,EAAI,EAAGA,EAAI,KAAMA,EACtB,IAAK,IAAIutC,EAAI38B,EAAE5Q,GAAIutC,EAAI38B,EAAE5Q,EAAI,KAAMutC,EAC/B7B,EAAE6B,GAAOA,EAAI38B,EAAE5Q,IAAO,EAAKA,EAGnC,MAAO,CAAC4Q,EAAG86B,EACf,EACIuE,GAAKoV,GAAKH,GAAM,GAAIK,GAAKtV,GAAG,GAAIuV,GAAQvV,GAAG,GAE/CsV,GAAG,IAAM,IAAKC,GAAM,KAAO,GAI3B,IAHG,IAAqBC,GAAfJ,GAAKF,GAAM,GAAY,GAE5BO,GAAM,IAAIX,GAAI,OACT/kD,GAAI,EAAGA,GAAI,QAASA,GAAG,CAE5B,IAAImR,IAAU,MAAJnR,MAAgB,GAAW,MAAJA,KAAe,EAEhDmR,IAAU,OADVA,IAAU,MAAJA,MAAgB,GAAW,MAAJA,KAAe,MACtB,GAAW,KAAJA,KAAe,EAC5Cu0C,GAAI1lD,MAAY,MAAJmR,MAAgB,GAAW,IAAJA,KAAe,KAAQ,CAC9D,CAIA,IAAIw0C,YAAkBC,EAAIC,EAAIna,GAO1B,IANA,IAAI9/B,EAAIg6C,EAAG3lD,OAEPD,EAAI,EAEJ0f,EAAI,IAAIqlC,GAAIc,GAET7lD,EAAI4L,IAAK5L,EACR4lD,EAAG5lD,MACD0f,EAAEkmC,EAAG5lD,GAAK,GAGpB,IAII8lD,EAJAC,EAAK,IAAIhB,GAAIc,GACjB,IAAK7lD,EAAI,EAAGA,EAAI6lD,IAAM7lD,EAClB+lD,EAAG/lD,GAAM+lD,EAAG/lD,EAAI,GAAK0f,EAAE1f,EAAI,IAAO,EAGtC,GAAI0rC,EAAG,CAEHoa,EAAK,IAAIf,GAAI,GAAKc,GAElB,IAAIG,EAAM,GAAKH,EACf,IAAK7lD,EAAI,EAAGA,EAAI4L,IAAK5L,EAEjB,GAAI4lD,EAAG5lD,GAQH,IANA,IAAIimD,EAAMjmD,GAAK,EAAK4lD,EAAG5lD,GAEnBkmD,EAAML,EAAKD,EAAG5lD,GAEdkR,EAAI60C,EAAGH,EAAG5lD,GAAK,MAAQkmD,EAElBvyC,EAAIzC,GAAM,GAAKg1C,GAAO,EAAIh1C,GAAKyC,IAAKzC,EAEzC40C,EAAGJ,GAAIx0C,KAAO80C,GAAOC,CAIpC,MAGG,IADAH,EAAK,IAAIf,GAAIn5C,GACR5L,EAAI,EAAGA,EAAI4L,IAAK5L,EACb4lD,EAAG5lD,KACH8lD,EAAG9lD,GAAK0lD,GAAIK,EAAGH,EAAG5lD,GAAK,QAAW,GAAK4lD,EAAG5lD,IAItD,OAAO8lD,CACV,EAEGK,GAAM,IAAIrB,GAAG,KACjB,IAAS9kD,GAAI,EAAGA,GAAI,MAAOA,GACvBmmD,GAAInmD,IAAK,EACb,IAASA,GAAI,IAAKA,GAAI,MAAOA,GACzBmmD,GAAInmD,IAAK,EACb,IAASA,GAAI,IAAKA,GAAI,MAAOA,GACzBmmD,GAAInmD,IAAK,EACb,IAASA,GAAI,IAAKA,GAAI,MAAOA,GACzBmmD,GAAInmD,IAAK,EAEb,IAAIomD,GAAM,IAAItB,GAAG,IACjB,IAAS9kD,GAAI,EAAGA,GAAI,KAAMA,GACtBomD,GAAIpmD,IAAK,EAE4B,IAAAqmD,GAAqBV,GAAKQ,GAAK,EAAG,GAElCG,GAAqBX,GAAKS,GAAK,EAAG,GAEvEriD,GAAM,SAAUkK,GAEhB,IADA,IAAI0F,EAAI1F,EAAE,GACDjO,EAAI,EAAGA,EAAIiO,EAAEhO,SAAUD,EACxBiO,EAAEjO,GAAK2T,IACPA,EAAI1F,EAAEjO,IAEd,OAAO2T,CACX,EAEI4yC,GAAO,SAAUnnC,EAAG5R,EAAGmG,GACvB,IAAI6yC,EAAKh5C,EAAI,EAAK,EAClB,OAAS4R,EAAEonC,GAAMpnC,EAAEonC,EAAI,IAAM,KAAY,EAAJh5C,GAAUmG,CACnD,EAEI8yC,GAAS,SAAUrnC,EAAG5R,GACtB,IAAIg5C,EAAKh5C,EAAI,EAAK,EAClB,OAAS4R,EAAEonC,GAAMpnC,EAAEonC,EAAI,IAAM,EAAMpnC,EAAEonC,EAAI,IAAM,MAAa,EAAJh5C,EAC5D,EAoCIk5C,GAAK,CACL,iBACA,qBACA,yBACA,mBACA,kBACA,oBACJ,CACI,cACA,qBACA,uBACA,8BACA,oBACA,mBACA,oBAIAC,GAAM,SAAUC,EAAK5tB,EAAK6tB,GAC1B,IAAI3mD,EAAI,IAAIT,MAAMu5B,GAAO0tB,GAAGE,IAI5B,GAHA1mD,EAAE4mD,KAAOF,EACLnnD,MAAMsnD,mBACNtnD,MAAMsnD,kBAAkB7mD,EAAGymD,KAC1BE,EACD,MAAM3mD,EACV,OAAOA,CACX,EAEI8mD,GAAQ,SAAUC,EAAKC,EAAKC,GAE5B,IAAIC,EAAKH,EAAIhnD,OACb,IAAKmnD,GAAOD,GAAMA,EAAGv0C,IAAMu0C,EAAGznC,EAC1B,OAAOwnC,GAAO,IAAIpC,GAAG,GAEzB,IAAIuC,GAASH,GAAOC,EAEhBG,GAAQH,GAAMA,EAAGnnD,EAChBmnD,IACDA,EAAK,CAAA,GAEJD,IACDA,EAAM,IAAIpC,GAAQ,EAALsC,IAEjB,IAAIG,EAAO,SAAU7nC,GACjB,IAAI8nC,EAAKN,EAAIjnD,OAEb,GAAIyf,EAAI8nC,EAAI,CAER,IAAIC,EAAO,IAAI3C,GAAGz8C,KAAKtE,IAAS,EAALyjD,EAAQ9nC,IACnC+nC,EAAKzoD,IAAIkoD,GACTA,EAAMO,CACT,CACT,EAEQC,EAAQP,EAAGv0C,GAAK,EAAGwlB,EAAM+uB,EAAG35C,GAAK,EAAGm6C,EAAKR,EAAGv2C,GAAK,EAAGg3C,EAAKT,EAAGznC,EAAGmoC,EAAKV,EAAG/nC,EAAG0oC,EAAMX,EAAGxzC,EAAGo0C,EAAMZ,EAAGzwB,EAE/FsxB,EAAY,EAALZ,EACX,EAAG,CACC,IAAKQ,EAAI,CAELF,EAAQnB,GAAKU,EAAK7uB,EAAK,GAEvB,IAAI/4B,EAAOknD,GAAKU,EAAK7uB,EAAM,EAAG,GAE9B,GADAA,GAAO,GACF/4B,EAAM,CAEP,IAAuBqgB,EAAIunC,GAAvBr7C,EAAgB,IAAPwsB,EApGU,GAAK,EAAK,IAoGE,GAAM6uB,EAAIr7C,EAAI,IAAM,EAAI8F,EAAI9F,EAAI8T,EACnE,GAAIhO,EAAI01C,EAAI,CACJE,GACAX,GAAI,GACR,KACH,CAEGU,GACAE,EAAKI,EAAKjoC,GAEdwnC,EAAIloD,IAAIioD,EAAIgB,SAASr8C,EAAG8F,GAAIi2C,GAE5BR,EAAGv2C,EAAI+2C,GAAMjoC,EAAGynC,EAAG35C,EAAI4qB,EAAU,EAAJ1mB,EAAOy1C,EAAGv0C,EAAI80C,EAC3C,QACH,CACI,GAAY,GAARroD,EACLuoD,EAAKvB,GAAMwB,EAAKvB,GAAMwB,EAAM,EAAGC,EAAM,OACpC,GAAY,GAAR1oD,EAAW,CAEhB,IAAI6oD,EAAO3B,GAAKU,EAAK7uB,EAAK,IAAM,IAAK+vB,EAAQ5B,GAAKU,EAAK7uB,EAAM,GAAI,IAAM,EACnEgwB,EAAKF,EAAO3B,GAAKU,EAAK7uB,EAAM,EAAG,IAAM,EACzCA,GAAO,GAKP,IAHA,IAAIiwB,EAAM,IAAIvD,GAAGsD,GAEbE,EAAM,IAAIxD,GAAG,IACR9kD,EAAI,EAAGA,EAAImoD,IAASnoD,EAEzBsoD,EAAIlD,GAAKplD,IAAMumD,GAAKU,EAAK7uB,EAAU,EAAJp4B,EAAO,GAE1Co4B,GAAe,EAAR+vB,EAEP,IAAII,EAAMxkD,GAAIukD,GAAME,GAAU,GAAKD,GAAO,EAEtCE,EAAM9C,GAAK2C,EAAKC,EAAK,GACzB,IAASvoD,EAAI,EAAGA,EAAIooD,GAAK,CACrB,IAIIx8C,EAJA8/B,EAAI+c,EAAIlC,GAAKU,EAAK7uB,EAAKowB,IAM3B,GAJApwB,GAAW,GAAJsT,GAEH9/B,EAAI8/B,IAAM,GAEN,GACJ2c,EAAIroD,KAAO4L,MAEV,CAED,IAAI6F,EAAI,EAAGilB,EAAI,EAOf,IANS,IAAL9qB,GACA8qB,EAAI,EAAI6vB,GAAKU,EAAK7uB,EAAK,GAAIA,GAAO,EAAG3mB,EAAI42C,EAAIroD,EAAI,IACvC,IAAL4L,GACL8qB,EAAI,EAAI6vB,GAAKU,EAAK7uB,EAAK,GAAIA,GAAO,GACxB,IAALxsB,IACL8qB,EAAI,GAAK6vB,GAAKU,EAAK7uB,EAAK,KAAMA,GAAO,GAClC1B,KACH2xB,EAAIroD,KAAOyR,CAClB,CACJ,CAED,IAAIi3C,EAAKL,EAAIJ,SAAS,EAAGC,GAAOS,EAAKN,EAAIJ,SAASC,GAElDJ,EAAM/jD,GAAI2kD,GAEVX,EAAMhkD,GAAI4kD,GACVf,EAAKjC,GAAK+C,EAAIZ,EAAK,GACnBD,EAAKlC,GAAKgD,EAAIZ,EAAK,EACtB,MAEGpB,GAAI,GACR,GAAIvuB,EAAM4vB,EAAM,CACRV,GACAX,GAAI,GACR,KACH,CACJ,CAGGU,GACAE,EAAKI,EAAK,QAGd,IAFA,IAAIiB,GAAO,GAAKd,GAAO,EAAGe,GAAO,GAAKd,GAAO,EACzCe,EAAO1wB,GACH0wB,EAAO1wB,EAAK,CAEhB,IAAoC2wB,GAAhCt3C,EAAIm2C,EAAGnB,GAAOQ,EAAK7uB,GAAOwwB,MAAkB,EAEhD,IADAxwB,GAAW,GAAJ3mB,GACGu2C,EAAM,CACRV,GACAX,GAAI,GACR,KACH,CAGD,GAFKl1C,GACDk1C,GAAI,GACJoC,EAAM,IACN7B,EAAIS,KAAQoB,MACX,IAAW,KAAPA,EAAY,CACjBD,EAAO1wB,EAAKwvB,EAAK,KACjB,KACH,CAEG,IAAInmD,EAAMsnD,EAAM,IAEhB,GAAIA,EAAM,IAAK,CAEX,IAAmBn4C,EAAIs0C,GAAnBllD,EAAI+oD,EAAM,KACdtnD,EAAM8kD,GAAKU,EAAK7uB,GAAM,GAAKxnB,GAAK,GAAK20C,GAAGvlD,GACxCo4B,GAAOxnB,CACV,CAED,IAAIwO,EAAIyoC,EAAGpB,GAAOQ,EAAK7uB,GAAOywB,GAAMG,EAAO5pC,IAAM,EAC5CA,GACDunC,GAAI,GACRvuB,GAAW,GAAJhZ,EACHupC,EAAKlD,GAAGuD,GACZ,GAAIA,EAAO,EAAG,CACNp4C,EAAIu0C,GAAK6D,GACbL,GAAMlC,GAAOQ,EAAK7uB,IAAS,GAAKxnB,GAAK,EAAIwnB,GAAOxnB,CACnD,CACD,GAAIwnB,EAAM4vB,EAAM,CACRV,GACAX,GAAI,GACR,KACH,CACGU,GACAE,EAAKI,EAAK,QAEd,IADA,IAAIsB,EAAMtB,EAAKlmD,EACRkmD,EAAKsB,EAAKtB,GAAM,EACnBT,EAAIS,GAAMT,EAAIS,EAAKgB,GACnBzB,EAAIS,EAAK,GAAKT,EAAIS,EAAK,EAAIgB,GAC3BzB,EAAIS,EAAK,GAAKT,EAAIS,EAAK,EAAIgB,GAC3BzB,EAAIS,EAAK,GAAKT,EAAIS,EAAK,EAAIgB,GAE/BhB,EAAKsB,CACR,CACJ,CACD9B,EAAGznC,EAAIkoC,EAAIT,EAAG35C,EAAIs7C,EAAM3B,EAAGv2C,EAAI+2C,EAAIR,EAAGv0C,EAAI80C,EACtCE,IACAF,EAAQ,EAAGP,EAAGxzC,EAAIm0C,EAAKX,EAAG/nC,EAAIyoC,EAAIV,EAAGzwB,EAAIqxB,EAChD,QAASL,GACV,OAAOC,GAAMT,EAAIjnD,OAASinD,EA3OpB,SAAUh2C,EAAGtF,EAAG1L,IACb,MAAL0L,GAAaA,EAAI,KACjBA,EAAI,IACC,MAAL1L,GAAaA,EAAIgR,EAAEjR,UACnBC,EAAIgR,EAAEjR,QAEV,IAAIy2B,EAAI,IAA4B,GAAvBxlB,EAAEg4C,kBAAyBnE,GAA6B,GAAvB7zC,EAAEg4C,kBAAyBlE,GAAMF,IAAI5kD,EAAI0L,GAEvF,OADA8qB,EAAE13B,IAAIkS,EAAE+2C,SAASr8C,EAAG1L,IACbw2B,CACX,CAkOoCyyB,CAAIjC,EAAK,EAAGS,EAChD,EAmOIyB,GAAmB,IAAItE,GAAG,GAuxBvB,SAASuE,GAAWjmD,EAAMsL,GAC7B,OAAOs4C,KAvcY,IAAP,IADI5nC,EAwcEhc,GAvcX,KAAkBgc,EAAE,KAAO,EAAK,IAAOA,EAAE,IAAM,EAAIA,EAAE,IAAM,KAC9DunC,GAAI,EAAG,qBACA,GAAPvnC,EAAE,IACFunC,GAAI,EAAG,wDAoccvjD,EAAK6kD,SAAS,GAAI,IAAKv5C,GAxc1C,IAAU0Q,CAycpB,CAsHA,IAAIkqC,GAA2B,oBAAfC,aAA4C,IAAIA,YAGhE,IACID,GAAGE,OAAOJ,GAAI,CAAEK,QAAQ,IAClB,CACV,CACA,MAAOvpD,GAAG,OC1/CGwpD,GAIT3/C,SAASiC,GACL,GAAIA,EAAS2B,SAAS,MAAO,CAEzB,MAAMg8C,EAAM,IAAIC,eAIhB,GAHAD,EAAIE,iBAAiB,sCACrBF,EAAIv7B,KAAK,MAAOpiB,GAAU,GAC1B29C,EAAIG,KAAK,MACLH,EAAII,OAAS,IACb,MAAM,IAAItqD,MAAM,uBAAuBuM,OAAc29C,EAAIK,cAE7D,MAAMC,EAAK,IAAIC,YAAYP,EAAIQ,aAAalqD,QACtCmqD,EAAK,IAAI9I,WAAW2I,GAC1B,IAAK,IAAIjqD,EAAI,EAAGA,EAAI2pD,EAAIQ,aAAalqD,SAAUD,EAC3CoqD,EAAGpqD,GAAK2pD,EAAIQ,aAAaE,WAAWrqD,GAGxC,OADY,IAAIupD,YAAY,SACjBC,OAAOH,GAAWe,GAChC,CACD,GAAIp+C,EAAS2B,SAAS,mBAAoB,CAEtC,MAAMg8C,EAAM,IAAIC,eAGhB,GAFAD,EAAIv7B,KAAK,MAAOpiB,GAAU,GAC1B29C,EAAIG,KAAK,MACLH,EAAII,OAAS,IACb,OAAOJ,EAAIQ,aACf,MAAM,IAAI1qD,MAAM,uBAAuBuM,OAAc29C,EAAIK,aAC5D,CACD,OAAOnrD,KAAKkL,SAAS,GAAGiC,MAC3B,CACD0B,OAAO1B,GAEH,IAAI8M,EAAO4wC,GAAcY,UAAUvrD,IAAIiN,GACvC,QAAajL,IAAT+X,EAAoB,CACpB,IACIja,KAAKyO,QAAQtB,EAChB,CACD,MAAM9L,GAGF,MAFAwH,QAAQC,IAAI,4BAA4BqE,KACxC09C,GAAcY,UAAUzwC,SAAS,CAAC5a,EAAO6B,IAAQ4G,QAAQC,IAAI7G,EAAK7B,KAC5DQ,OACT,CACDqZ,EAAO4wC,GAAcY,UAAUvrD,IAAIiN,EACtC,CACD,QAAajL,IAAT+X,EACA,MAAMrZ,MAAM,2BAA2BuM,OAE3C,OAAQ8M,EAAK/K,KAChB,CACDA,MAAM/B,GAEF,MAAM8M,EAAO4wC,GAAcY,UAAUvrD,IAAIiN,GACzC,QAAajL,IAAT+X,EACA,MAAMrZ,MAAM,2BAA2BuM,OAE3C,OAAO8M,EAAK/K,KACf,CACDT,QAAQtB,GAGJ,IAAI8M,EAAO4wC,GAAcY,UAAUvrD,IAAIiN,GACvC,QAAajL,IAAT+X,QAAmC/X,IAAb+X,EAAKzL,IAC3B,OAAOyL,EAAKzL,SAGHtM,IAAT+X,IACAA,EAAO,CAAEyxC,KAAM,GAAIx8C,OAAO,EAAMV,SAAKtM,IAEzC,MAAMqe,EAAIvgB,KAAKkL,SAAS,QAAQiC,oBAC1BuhC,EAAIpxB,KAAKO,MAAM0C,GACrBtG,EAAKzL,IAAM,GACX,IAAK,MAAM8D,KAAKo8B,EAAG,CACf,MAAMid,EAAW,GAAGx+C,KAAYmF,EAAEo5C,OAElCzxC,EAAKzL,IAAIzK,KAAKuO,EAAEo5C,MACXp5C,EAAEpD,OACH27C,GAAcY,UAAUtrD,IAAIwrD,EAAU,CAAED,KAAMp5C,EAAEo5C,KAAMx8C,OAAO,GACpE,CAED,OADA27C,GAAcY,UAAUtrD,IAAIgN,EAAU8M,GAC/BA,EAAKzL,GACf,CACDD,SAASpB,GAGL,OAAOA,CACV,CACDyB,SAASg9C,EAAmBC,GAExB,MAAO,GAAGD,KAAaC,GAC1B,WCzEWC,KACZ,KAeJ,WACIjjD,QAAQC,IAAI,qBACZ4B,EAAkBqhD,YAAY,IAAIlB,IAElC,MAAM5b,EAAQ,IAAI3pC,EACZ8W,EAAQ,IAAI84B,GAAUjG,GAC5BA,EAAM7yB,MAAQA,EAQd6yB,EAAMtqC,SAAS/B,KAAI,IAAMwZ,EAAMg5B,eAAiBL,GAAOW,QAEvD,MAAMvgC,EAAW8J,EAAa7C,EAAO,4BACrCA,EAAMjH,SAAWA,EAGjB48B,GAAc9C,EAAO,0CACrB8C,GAAc9C,EAAO,6CAGrB,MAAM+c,EAAchZ,GAAY/D,EAAO,yCA6G3C,WACI,MAAMgd,EAAgB5+C,EAAcpC,cAEpC,IAAK,MAAMoE,KAAU48C,EAAcn+C,YAAY,iBAMnD,EApHIo+C,GAKArjD,QAAQC,IAAI,2BAEZukC,GAAY8e,SAAStQ,GAAmBjN,GAAe4D,IACvDnF,GAAY8e,SAASxQ,GAAiB/M,GAAesM,IAErD,MAAMyI,EAAa,IAAIr+B,GAAsB0vB,GAAYA,GAAWoQ,SAE9DgH,EAAgB,IAAIxd,GAAc4D,GAAYwZ,GAE9CK,EAAc,IAAIxoD,EACxBwoD,EAAYzpD,KAAK0pD,IAETlwC,EAAMg5B,iBAAmBL,GAAOM,OAChCj5B,EAAMg5B,eAAiBL,GAAOwX,KACjC,IAEL,MAAMC,EAAY,IAAItR,GAAS/lC,EAASmH,MAAM,GAAI+vC,GAC5CI,EAAe,IAAI7d,GAAcsM,GAAUsR,GAE3CE,EAAa,IAAI5rC,IAAa,GAC9B6rC,EAAc,IAAI7rC,IAAa,GAC/B8rC,EAAY,IAAI9rC,IAAa,GAC7B+rC,EAAY,IAAI/rC,IAAa,GAEnC4rC,EAAW/nD,SAAS/B,KAAI,KACpBiG,QAAQC,IAAI,0BAA0B4jD,EAAWtsD,QAAQ,IAGjDosD,EAAUhR,KAAK,OAE3B,MAAMsR,EAgDV,WACI,MAAMA,EAAWxrD,SAASue,cAAc,KAIxC,OAHAitC,EAAStsD,KAAO,aAChBssD,EAAS3pD,MAAMyrB,QAAU,SACzBk+B,EAASA,SAAW,gBACbA,CACX,CAtDqBC,GACXC,EAAY,IAAI,QACH1jC,EAAAsyB,EAAA,CAAA16C,SAAA,CACfooB,EAACyK,GAAK1zB,OAAA4sD,OAAA,CAAA7qC,MAAOuhC,EAAYxgD,MAAO,CAAEkuB,SAAU,WAAYhD,KAAM,EAAG7E,MAAO,QAAS8E,IAAK,EAAGuO,OAAQ,IAS7F,CAAA37B,SAAA,CAAAqnB,EAAC0M,GAAG50B,OAAA4sD,OAAA,CAACniC,MAAM,QAAQ1qB,MAAM,WAAS,CAAAc,SAC9BqnB,EAACmU,GAAM,CAAAta,MAAOgqC,EAAejpD,MAAO,CAAEqmB,MAAO,OAAQ7jB,OAAQ,aAEjE4iB,EAAC0M,GAAG50B,OAAA4sD,OAAA,CAACniC,MAAM,OAAO1qB,MAAM,aAAW,CAAAc,SAC/BqnB,EAACmU,GAAM,CAAAta,MAAOqqC,EAActpD,MAAO,CAAEqmB,MAAO,OAAQ7jB,OAAQ,aAEhE4iB,EAAC0M,GAAG50B,OAAA4sD,OAAA,CAACniC,MAAM,SAAS1qB,MAAM,aAAW,CAAAc,SACjCooB,EAAK,MAAAjpB,OAAA4sD,OAAA,CAAA9pD,MAAO,CAAEuqC,QAAS,SACiB,CAAAxsC,SAAA,CAAA,uCAAAqnB,EAAA,KAAA,CAAA,GAEpC,0BAAAe,EAAA,QAAA,CAAApoB,SAAA,CACIooB,EACI,KAAA,CAAApoB,SAAA,CAAAqnB,EAAA,KAAA,CAAArnB,SAAIqnB,EAACwD,IAAS3J,MAAOsqC,MAAmBnkC,EAAc,KAAA,CAAArnB,SAAA,aAE1DooB,EAAA,KAAA,CAAApoB,SAAA,CACIqnB,EAAI,KAAA,CAAArnB,SAAAqnB,EAACwD,GAAQ,CAAC3J,MAAOuqC,MAAoBpkC,EAAe,KAAA,CAAArnB,SAAA,cAE5DooB,EAAA,KAAA,CAAApoB,SAAA,CACIqnB,EAAI,KAAA,CAAArnB,SAAAqnB,EAACwD,GAAQ,CAAC3J,MAAOwqC,MAAkBrkC,EAAa,KAAA,CAAArnB,SAAA,YAExDooB,EAAA,KAAA,CAAApoB,SAAA,CACIqnB,EAAI,KAAA,CAAArnB,SAAAqnB,EAACwD,GAAQ,CAAC3J,MAAOyqC,MAAkBtkC,EAAa,KAAA,CAAArnB,SAAA,eAG5DqnB,EAACsC,GAAOxqB,OAAA4sD,OAAA,CAAAjrC,OAAQ,IAoBpC,SAAyB5F,EAAkB0wC,GACvCA,EAASA,SAAW,gBACpBA,EAASI,KAAOC,IAAIC,gBAAgB,IAAIC,KAAK,CAACxX,GAAcz5B,IAAS,CAAE5b,KAAM,gBAC7EssD,EAASp3B,cAAc,IAAIC,WAAW,SAC1C,CAxB0C23B,CAAgBlxC,EAAO0wC,IAAkC,CAAA5rD,SAAA,+BAI3FqnB,EAAA,MAAAloB,OAAA4sD,OAAA,CAAK9pD,MAAO,CAAEkuB,SAAU,WAAYhD,KAAM,QAASuJ,MAAO,EAAGtJ,IAAK,EAAGuO,OAAQ,EAAG0wB,SAAU,WAAU,CAAArsD,SAChGqnB,EAAQ,SAAA,CAAApoB,IAAKU,EAAImsD,EAAW,UAAW7pD,MAAO,CAAEqmB,MAAO,OAAQ7jB,OAAQ,gBAGpE/D,SAASN,SAASy5B,MAC7BkmB,GAAO+L,EAAU9L,OAAQ9kC,EAAOunC,EACpC,CAzHQ7+B,EACH,CACD,MAAOzjB,GACHwH,QAAQC,IAAIzH,GACRA,aAAaT,MACb4sD,MAAM,GAAGnsD,EAAEgB,SAAShB,EAAEosD,WAEtBD,MAAMnsD,EACb,CACL,QD5BWwpD,GAAAY,UAAY,IAAInjD,ICe3B6b,OAAO0+B,OAAS,KAAQiJ,IAAM","x_google_ignoreList":[0,12,13,14,15,21,120]}